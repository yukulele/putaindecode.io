<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, init-scale=1.0, minimal-ui"><title>Introduction au testing js front</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@putaindecode"/><meta name="twitter:title" content="Introduction au testing js front"/><meta name="twitter:creator" content="@bloodyowl"/><meta name="twitter:image" content="http://www.gravatar.com/avatar/37500337ba5d2aebc962959ed83928e5.png?s=200"/><meta property="og:title" content="Introduction au testing js front"/><meta property="og:type" content="article"/><meta property="og:image" content="http://www.gravatar.com/avatar/37500337ba5d2aebc962959ed83928e5.png?s=200"/><meta property="og:site_name" content="Putain de code !"/><link rel="stylesheet" href="../../../stylesheets/index.css"><link rel="alternate" href="../../../feed.xml" title="Putain de code !" type="application/atom+xml"></head><body><svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="putainde-Icon-bookmark" viewBox="0 0 512 512">
      <title>bookmark icon</title>
      <path d="M318.275 90v283.23L256 318.16l-62.275 55.07V90h124.55m40-40h-204.55v412L256 371.557 358.275 462V50z"/>
    </symbol>

    <symbol id="putainde-Icon-github" viewBox="0 0 512 512">
      <title>github icon</title>
      <path d="M461.633 250.645l.367-3.82c-22.896-2.22-45.667-2.418-67.79-.73 3.557-11.346 5.43-24.163 5.295-38.738-.292-30.965-10.616-55.08-26.843-75.096 3.116-18.85.77-37.7-5.11-56.56-23.188 1.898-44.054 9.493-62.635 22.686-34.725-7.044-69.447-7.493-104.172 0-21.673-14.627-42.956-21.802-63.91-22.686-6.21 20.765-7.168 41.233-1.916 61.357-18.28 19.397-25.27 42.944-24.926 69.02.196 14.926 2.496 28.208 6.738 39.95-21.796-1.598-44.2-1.385-66.732.8l.367 3.818c22.947-2.228 45.76-2.41 67.92-.678.813 1.974 1.632 3.94 2.566 5.815-24.01-.633-45.618 1.453-65.854 6.43l.913 3.723c20.538-5.048 42.54-7.08 67.107-6.254 16.246 28.865 47.52 45.825 93.063 51.206-10.58 8.594-16.27 18.73-17.735 30.2h-24.12c-32.395 0-41.227-41.303-74.78-37.228C132 320 125.5 371.598 177.588 371.598h21.88v47.297c.234 7.643-3.093 12.754-8.47 16.297 18.655 1.884 32.675-7.43 32.675-18.854V353.82l5.833-6v72.992c.245 7.265-3.284 11.392-7.03 15.34 16.433.653 31.89-2.63 32.59-16.616V349.68s5.757-3.6 5.757 0v66.58c.17 11.8 10.36 21.366 31.953 19.892-5.776-4.65-7.55-9.35-7.55-16.15v-72.18s5.95-.307 5.95 6v60.88c0 13.55 16.268 19.14 34.83 18.615-6.08-4.558-10.196-9.99-10.223-17.256v-73.216c-.63-10.762-5.003-20.906-13.582-30.358 41.63-6.392 71.638-23.01 86.58-52.796 24.646-.847 46.714 1.183 67.306 6.246l.914-3.723c-20.394-5.014-42.18-7.096-66.416-6.415.84-1.89 1.67-3.79 2.39-5.785 22.39-1.798 45.457-1.622 68.66.632zM114 310.023c-1.023 0-1.853-.588-1.853-1.313 0-.728.83-1.315 1.853-1.315 1.024 0 1.854.588 1.854 1.315 0 .726-.83 1.313-1.854 1.313zm5.833 3.98c-1.137 0-2.06-.653-2.06-1.46s.923-1.462 2.06-1.462 2.06.656 2.06 1.463-.923 1.46-2.06 1.46zm5.917 5.17c-1.333 0-2.415-.767-2.415-1.713s1.082-1.714 2.415-1.714 2.416.768 2.416 1.714-1.083 1.712-2.416 1.712zm5.75 6.206c-1.56 0-2.825-.897-2.825-2.004s1.265-2.005 2.825-2.005 2.825.9 2.825 2.006-1.265 2.003-2.825 2.003zm6.333 7.014c-1.733 0-3.14-.996-3.14-2.226s1.407-2.228 3.14-2.228 3.14.998 3.14 2.228-1.407 2.226-3.14 2.226zm7.334 7.123c-1.926 0-3.488-1.107-3.488-2.474s1.56-2.476 3.487-2.476c1.925 0 3.487 1.11 3.487 2.476s-1.562 2.474-3.487 2.474zm9.916 6.774c-2.14 0-3.875-1.23-3.875-2.748 0-1.52 1.735-2.75 3.875-2.75s3.875 1.23 3.875 2.75c0 1.518-1.735 2.75-3.875 2.75zm12.292 3.626c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.958.417c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.792.25c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75z"/>
    </symbol>

    <symbol id="putainde-Icon-home" viewBox="0 0 512 512">
      <title>home icon</title>
      <path d="M394.072 174.805l-47.916-48.023v-38.31h47.916v86.333zM462 275.815h-42.508v166.213H92.508V275.815H50L256 69.972l206 205.843zm-165.153-3.843c-15.81-3.316-29.02 4.086-38.792 19.387-9.77-15.302-22.98-22.704-38.79-19.388-36.745 10.876-36.335 69.543 38.583 113.047 75.06-43.26 75.742-102.172 39-113.048z"/>
    </symbol>

    <symbol id="putainde-Icon-pencil" viewBox="0 0 512 512">
      <title>pencil icon</title>
      <path d="M74.686 340.686L50 460.95l122.365-22.585L379.52 231.21l-97.68-97.68L74.686 340.687zm228.402-135.654l-181.89 181.89-21.214-21.213 181.89-181.89 21.214 21.212zM462 148.732l-52.662 52.66-97.682-97.68 52.662-52.662L462 148.73z"/>
    </symbol>

    <symbol id="putainde-Icon-text-file" viewBox="0 0 512 512">
      <title>text-file icon</title>
      <path d="M256 370.312h-84.495v-30H256v30zm83.495-55.416h-167.99v-30h167.99v30zm0-55.334h-167.99v-30h167.99v30zM297.818 90v85.75h85.864V422H128.317V90h169.5m25-40h-234.5v412h335.365V150.75L322.818 50z"/>
    </symbol>

    <symbol id="putainde-Icon-twitter" viewBox="0 0 512 512">
      <title>twitter icon</title>
      <path d="M462 128.223c-15.158 6.724-31.45 11.27-48.547 13.31 17.45-10.46 30.854-27.025 37.164-46.764-16.333 9.686-34.422 16.72-53.676 20.51-15.417-16.428-37.385-26.69-61.697-26.69-54.56 0-94.668 50.915-82.337 103.786-70.25-3.524-132.534-37.177-174.223-88.314-22.142 37.983-11.485 87.69 26.158 112.85-13.853-.438-26.89-4.24-38.284-10.574-.917 39.162 27.146 75.78 67.795 83.95-11.895 3.236-24.925 3.977-38.17 1.446 10.755 33.58 41.973 58.018 78.96 58.7C139.605 378.28 94.847 390.72 50 385.435c37.406 23.982 81.837 37.977 129.57 37.977 156.933 0 245.596-132.55 240.252-251.435 16.517-11.917 30.846-26.804 42.178-43.755z"/>
    </symbol>
</svg><div class="putainde-Header"><div class="Grid"><div class="Grid-cell u-size5of12"><a href="../../.." class="putainde-SiteTitle"><img alt="Putain de code !" src="../../../images/p!-logo.svg" class="putainde-Logo"><span>Putain de code !</span></a></div><div class="Grid-cell u-size7of12"><nav class="putainde-Nav"><a href="../.." data-rcp-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-bookmark"><use xlink:href="#putainde-Icon-bookmark"></use></svg> Articles</a><a href="../../../c-est-quoi-putaindecode" data-rcp-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-text-file"><use xlink:href="#putainde-Icon-text-file"></use></svg> Readme</a><a href="../../comment-contribuer" data-rcp-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-pencil"><use xlink:href="#putainde-Icon-pencil"></use></svg> Participer</a><a href="https://github.com/putaindecode/" data-rcp-tooltip="GitHub" class="putainde-Nav-item  putainde-Nav-item--icon rcp-Tooltip rcp-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a><a href="https://twitter.com/putaindecode/" data-rcp-tooltip="Twitter" class="putainde-Nav-item  putainde-Nav-item--icon rcp-Tooltip rcp-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></nav></div></div></div><div class="putainde-Main"><article class="Grid putainde-Post"><div class="Grid-cell u-size8of12 Grid putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">Introduction au testing js front</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas">Écrit par <a href="http://bloodyowl.io">bloodyowl</a>,<span class="putainde-Date"> le 1 mai 2014</span>. <span data-rcp-tooltip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingTime-wpm="250" class="putainde-Post-readingTime putainde-Post-readingTime--hidden rcp-Tooltip rcp-Tooltip--top rcp-Tooltip--nowrap">Temps de lecture : environ  <span class="putainde-Post-readingTime-value"></span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">javascript</li><li class="putainde-Tag">tape</li><li class="putainde-Tag">unit-test</li><li class="putainde-Tag">browserify</li></ul></header><div class="putainde-Post-md"><p>Les tests automatisés en front-end ont longtemps été ignorés,
et le sont encore trop.</p>
<p>Écrire des tests peut paraître chiant, mais le temps qu’ils rapportent
compense largement celui que l’on passe à les écrire.</p>
<h2 id="ecrire-du-js-testable"><a class="putainde-Title-anchor" href="#ecrire-du-js-testable">#</a>Écrire du js testable</h2><p>Prenons un exemple simple et moche :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//app.js</span>
;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{

  <span class="hljs-keyword">var</span> cart = $(<span class="hljs-string">"#cart"</span>)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToCart</span><span class="hljs-params">(id)</span></span>{
    <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>)
    element.html(catalog[id])
    cart.append(element)
  }

  $(<span class="hljs-string">".js-updateCart"</span>)
    .on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span></span>{
      addToCart($(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"id"</span>))
    })

})()
</code></pre>
<p>Tester ce code est particulièrement lourd, pour plusieurs raisons :</p>
<ul>
<li>les functions à tester ne sont pas accessibles</li>
<li>on doit simuler un <code>click</code> pour tester un comportement logique.</li>
<li>on doit créer un element et modifier sont <code>data-id</code> à chaque cas souhaité.</li>
<li>pour tester <code>addToCart</code> on doit aller regarder dans le DOM.</li>
</ul>
<h3 id="1-rendez-accessibles-vos-methodes-au-test-runner"><a class="putainde-Title-anchor" href="#1-rendez-accessibles-vos-methodes-au-test-runner">#</a>1. Rendez accessibles vos méthodes au test runner</h3><p>Vous pouvez utiliser un namespace adéquat.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-built_in">window</span>.app = {}
app.cart = {}
app.cart.addToCart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-comment">/* … */</span> }
</code></pre>
<p>Mais ne souhaitez probablement pas rendre vos méthodes accessibles à la console.</p>
<p>Utilisez un module-system : <a href="http://browserify.org">browserify</a> ou
<a href="http://requirejs.org">requirejs</a> (si vous n’avez pas besoin de chargement
conditionnel et souhaitez créer un bundle par build, utilisez browserify qui
possède une syntaxe beaucoup plus sympathique et une codebase réduite, vous
pourrez même <code>require</code> depuis un module npm
<a href="/posts/js/browserify-all-the-things/">comme on vous l’explique dans un article dédié</a>).</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>) <span class="hljs-comment">// oh, un module npm</span>

<span class="hljs-built_in">module</span>.exports = {
  element : $(<span class="hljs-string">"#cart"</span>),
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-comment">/* … */</span>
  }
}
</code></pre>
<p>Vous pourrez ainsi séparer proprement votre application en modules et les tester individuellement.</p>
<h3 id="2-oui-mais-les-modules-interdependants-alors-"><a class="putainde-Title-anchor" href="#2-oui-mais-les-modules-interdependants-alors-">#</a>2. Oui, mais les modules interdépendants alors ?</h3><p>Là, ça devient un peu plus tricky.
Ce que je conseille à titre personnel c’est d’utiliser des events
pour faire communiquer les différentes parties de l’application.</p>
<p>Cela permet d’éviter d’utiliser des mocks d’autres parties de l’application partout.</p>
<p>Par exemple, si je souhaite tester le fait qu’un click sur <code>.js-updateCart</code>
déclanchera bien <code>updateCart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//view.js</span>

<span class="hljs-comment">// view est une petite class qui route les events</span>
<span class="hljs-comment">// en rendant les listeners accessibles aux tests</span>
<span class="hljs-comment">// vous pouvez très facilement en concevoir une</span>
<span class="hljs-comment">// à votre goût en quelques lignes de code</span>
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/view"</span>)

<span class="hljs-comment">// eventbus est l'event bus de l'application, il orchestre</span>
<span class="hljs-comment">// la communication entre les différents modules</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)

<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

<span class="hljs-built_in">module</span>.exports = view.extend({
  element : <span class="hljs-built_in">document</span>.body,
  events : [
    {
      type : <span class="hljs-string">"click"</span>,
      selector : <span class="hljs-string">".js-addToCart"</span>,
      listener : <span class="hljs-string">"addToCart"</span>
    }
  ],
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span></span>{
    <span class="hljs-keyword">var</span> target = eventObject.currentTarget
    <span class="hljs-keyword">var</span> id = $(target).data(<span class="hljs-string">"id"</span>)
    eventbus.fire(<span class="hljs-string">"addToCart"</span>, {
      id : id
    })
  }
})
</code></pre>
<p>et je n’aurais qu’à écouter cet event depuis <code>cart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.js</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

<span class="hljs-built_in">module</span>.exports = {
  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">this</span>._addToCart = <span class="hljs-keyword">this</span>.addToCart.bind(<span class="hljs-keyword">this</span>)
    eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  release : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    eventbus.stopListening(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span></span>{
    <span class="hljs-comment">// et on a eventObject.id</span>
    <span class="hljs-keyword">this</span>.products.push(catalog[eventObject.currentTarget.data(<span class="hljs-string">"id"</span>)])
  }
}
</code></pre>
<p>Grâce à cette architecture, je vais pouvoir tester individuellement
les deux modules.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// view.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/view"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

tape(<span class="hljs-string">"view"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.plan(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>)
  element.data(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>)
  <span class="hljs-comment">// on teste facilement l'envoi</span>
  eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span></span>{
    test.equal(eventObject.id, <span class="hljs-number">1</span>)
  })
  view.addToCart({
    currentTarget : element
  })
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> cart = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/cart"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

tape(<span class="hljs-string">"cart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  cart.initialize()
  eventbus.fireSync(<span class="hljs-string">"addToCart"</span>, {id:<span class="hljs-number">1</span>})
  test.deepEqual(
    cart[<span class="hljs-number">0</span>],
    catalog[<span class="hljs-number">1</span>],
    <span class="hljs-string">"receives addToCart event"</span>
  )
  test.end()
})
</code></pre>
<h2 id="tester-tous-les-cas-possibles"><a class="putainde-Title-anchor" href="#tester-tous-les-cas-possibles">#</a>Tester tous les cas possibles</h2><p>Ce sont souvent les edge-cases qui nous font nous arracher les cheveux.
Pour pallier ces soucis, tester en profondeur est essentiel.</p>
<p>Prenons un exemple, une méthode qui teste si la valeur qu’on lui passe est
une <code>string</code>.</p>
<p>On serait tenté de simplement tester les résultats positifs de cette façon :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.equal(<span class="hljs-built_in">type</span>.isString(<span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>Or, si par mégarde ma méthode <code>isString</code> se révèle être :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">"string"</span>
}
</code></pre>
<p>on ne vérifie pas le cas <code>type.isString(new String(&quot;&quot;))</code>.</p>
<p>Du coup, des tests complets :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-keyword">function</span>(test){
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span></span>(<span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span></span>(<span class="hljs-keyword">new</span> String(<span class="hljs-string">""</span>)), <span class="hljs-keyword">false</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>permettent ici d’identifier qu’en réalité on a besoin de :</p>
<pre><code class="lang-javascript"><span class="hljs-typedef"><span class="hljs-keyword">type</span>.isString = function<span class="hljs-container">(<span class="hljs-title">value</span>)</span> <span class="hljs-container">{
  <span class="hljs-title">return</span> <span class="hljs-type">Object</span>.<span class="hljs-title">prototype</span>.<span class="hljs-title">toString</span>.<span class="hljs-title">call</span>(<span class="hljs-title">value</span>) == "[<span class="hljs-title">object</span> <span class="hljs-type">String</span>]"
}</span></span>
</code></pre>
<p>Et c’est à la force des résultats de tests que vous identifierez rapidement
vous familiariserez à tous ces edge-cases.</p>
<p>À chaque correctif de bug, ajoutez des tests (mais ça, vous le saviez déjà).</p>
<h2 id="cross-browser-testing"><a class="putainde-Title-anchor" href="#cross-browser-testing">#</a>Cross-browser testing</h2><p>À l’heure actuelle, où l’on se trouve notamment très souvent avec du
feature testing.
Pour le tester complètement, on doit se servir de vrais navigateurs :
un headless (certes, très pratique) comme <a href="http://phantomjs.org">phantomjs</a>
ne permettra pas d’obtenir 100% de coverage.</p>
<pre><code class="lang-javascript"><span class="hljs-tag">var</span> supportsAnimationFrame =
  !!(
    win<span class="hljs-class">.requestAnimationFrame</span> ||
    win<span class="hljs-class">.webkitRequestAnimationFrame</span> ||
    win<span class="hljs-class">.mozRequestAnimationFrame</span> ||
    win<span class="hljs-class">.ORequestAnimationFrame</span> ||
    <span class="hljs-comment">// vous avez fait une faute de frappe,</span>
    <span class="hljs-comment">// et mis un `O` majuscule, seul un</span>
    <span class="hljs-comment">// test sur les version concernées d'Opera</span>
    <span class="hljs-comment">// vous permettront de l'identifier</span>
    win<span class="hljs-class">.msRequestAnimationFrame</span>
  )
</code></pre>
<p>De plus, vous pouvez par habitude être tenté d’utiliser un
<code>Array.prototype.forEach</code> alors que votre scope navigateur inclut
IE8; seuls des tests sur un vrai browser vous permettront d’identifier le souci.</p>
<p>Je vous conseille fortement testling, très simple à intégrer dans vos
modules, et gratuit pour tout projet open-source.</p>
<p>Dans le <code>package.json</code> :</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">testling</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">files</span>": <span class="hljs-value"><span class="hljs-string">"test/**/*.js"</span></span>,
    "<span class="hljs-attribute">browsers</span>": <span class="hljs-value">[
      <span class="hljs-string">"ie/9..latest"</span>,
      <span class="hljs-string">"chrome/22..latest"</span>,
      <span class="hljs-string">"firefox/16..latest"</span>,
      <span class="hljs-string">"safari/6..latest"</span>,
      <span class="hljs-string">"opera/11.0..latest"</span>,
      <span class="hljs-string">"iphone/6..latest"</span>,
      <span class="hljs-string">"ipad/6..latest"</span>,
      <span class="hljs-string">"android-browser/latest"</span>
    ]
  </span>}
</span>}
</code></pre>
<p>Et ajouter un webhook dans l’admin de votre repository GitHub pointant vers</p>
<blockquote>
<p><a href="http://git.testling.com">http://git.testling.com</a></p>
</blockquote>
<p>Vous pouvez l’utiliser avec tape (son test harness par défaut)
Mocha, QUnit et n’importe quelle bibliothèque
de test supportant <code>TAP</code> comme indiqué sur
<a href="https://ci.testling.com/guide/custom_libraries">le site de testling</a>.</p>
<p>Vous trouverez aussi des alternatives populaires
<a href="http://www.browserstack.com">similaires</a>,
ou ayant <a href="http://karma-runner.github.io">une approche différente</a>.</p>
<p>Par ailleurs, si dans votre code il existe des variations entre les navigateurs,
vous pouvez utiliser du test conditionnel :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">if</span>(typeof {}.__proto__ == <span class="hljs-string">"object"</span>){
  test.equal(<span class="hljs-keyword">list</span>.__proto__ === <span class="hljs-keyword">Array</span>.prototype, <span class="hljs-keyword">false</span>, <span class="hljs-string">"__proto__ isn't Array.prototype"</span>)
} <span class="hljs-keyword">else</span> {
  test.equal(<span class="hljs-keyword">list</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">Array</span>, <span class="hljs-keyword">false</span>, <span class="hljs-string">"Isn't a window Array"</span>)
}
</code></pre>
<p>Happy testing!</p>
<pre><code class="lang-bash">$ testling

TAP version <span class="hljs-number">13</span>
<span class="hljs-preprocessor"># tests</span>
ok <span class="hljs-number">1</span> bisous

<span class="hljs-number">1.</span><span class="hljs-number">.1</span>
<span class="hljs-preprocessor"># tests 1</span>
<span class="hljs-preprocessor"># pass  1</span>

<span class="hljs-preprocessor"># ok</span>
</code></pre>
</div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="Grid"><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/website/edit/master/src/pages/posts/js/introduction-au-testing-js-front/index.md" class="putainde-Post-footer-action">Modifier</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/website/blame/master/src/pages/posts/js/introduction-au-testing-js-front/index.md" class="putainde-Post-footer-action">Tracer les changements</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/website/commits/master/src/pages/posts/js/introduction-au-testing-js-front/index.md" class="putainde-Post-footer-action">Historique</a></div></div></footer><div class="putainde-Author"><a href="http://bloodyowl.io" data-rcp-tooltip="bloodyowl" class="putainde-Author-picture "><img src="http://www.gravatar.com/avatar/37500337ba5d2aebc962959ed83928e5.png" alt="" class="putainde-Avatar js-AnimateLoad"/></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par</span> <a href="http://bloodyowl.io" class="putainde-Link">bloodyowl</a></h3><div class="putainde-Author-social"><a href="http://bloodyowl.io" data-rcp-tooltip="Website" class="rcp-Tooltip rcp-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-home"><use xlink:href="#putainde-Icon-home"></use></svg></a><a href="https://twitter.com/bloodyowl" data-rcp-tooltip="Twitter" class="rcp-Tooltip rcp-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a><a href="https://github.com/bloodyowl" data-rcp-tooltip="Github" class="rcp-Tooltip rcp-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></div></div><p class="putainde-Author-bio">Développeur front-end, aime la bonne bière artisanale, la musique, et JavaScript; n'aime ni les points virgules, ni les gens</p></div></div><div id="disqus_thread" aria-live="polite"><noscript>| Please enable JavaScript to view the
a(href="http://disqus.com/?ref_noscript") comments powered by Disqus.</noscript></div></div></article></div><div class="putainde-Footer"><div class="Grid"><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text">© 1970 - 2014 Putain de Code !</p></div><div class="Grid-cell u-size6of12"><ul class="putainde-Footer-list"><li></li><li><a href="../../../feed.xml">Flux RSS</a></li><li><a href="../../../projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><a href="https://github.com/putaindecode/" data-rcp-tooltip="GitHub" class="rcp-Tooltip rcp-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a><a href="https://twitter.com/putaindecode/" data-rcp-tooltip="Twitter" class="rcp-Tooltip rcp-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></ul></div><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎ by <a href="../../../#crew">le crew</a></p></div></div></div><script>var disqus_shortname = "putaindecode";var disqus_identifier = "http://putaindecode.fr/posts/js/introduction-au-testing-js-front/";
var disqus_url = "http://putaindecode.fr/posts/js/introduction-au-testing-js-front/";
var disqus_script = "embed.js";;(function(d,s) {
s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
(d.getElementsByTagName('head')[0]).appendChild(s)
})(document)</script><script src="../../../scripts/index.js"></script><script>var _gaq=[['_setAccount','UA-43771806-1'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src='//www.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>