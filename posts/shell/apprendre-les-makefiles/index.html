<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/statinamic-client.css" /><meta data-react-helmet="true" property="og:site_name" content="putaindecode.fr"/><meta data-react-helmet="true" name="twitter:site" content="@putaindecode_fr"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Laissez-vous pousser la barbe, apprenez à écrire des Makefiles"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Laissez-vous pousser la barbe, apprenez à écrire des Makefiles"/><meta data-react-helmet="true" name="twitter:creator" content="@madx"/><title data-react-helmet="true">Laissez-vous pousser la barbe, apprenez à écrire des Makefiles</title></head><body><div id="statinamic"><div id="statinamic-container" data-reactid=".21vhfkthxc0" data-react-checksum="1468691024"><div class="r-VerticalRhythm" data-reactid=".21vhfkthxc0.0"><div data-reactid=".21vhfkthxc0.0.0"><noscript data-reactid=".21vhfkthxc0.0.0.0:0"></noscript><div class="putainde-Header" data-reactid=".21vhfkthxc0.0.0.0:1"><div class="r-Grid" data-reactid=".21vhfkthxc0.0.0.0:1.0"><div class="r-Grid-cell r-minM--1of3" data-reactid=".21vhfkthxc0.0.0.0:1.0.0"><a class="putainde-SiteTitle" href="/" data-reactid=".21vhfkthxc0.0.0.0:1.0.0.0"><span class="SVGIcon SVGIcon--cleaned putainde-Logo" data-reactid=".21vhfkthxc0.0.0.0:1.0.0.0.0"><?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Logo-svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="-49.5 652.5 512 512" enable-background="new -49.5 652.5 512 512" xml:space="preserve">
<g id="shadow-group">
	
		<radialGradient id="shadow_1_" cx="206.4546" cy="-395.0098" r="243.7911" gradientTransform="matrix(0.9784 0 0 -0.9765 4.504 505.6038)" gradientUnits="userSpaceOnUse">
		<stop  offset="0.8" style="stop-color:#000000"/>
		<stop  offset="0.95" style="stop-color:#333333"/>
	</radialGradient>
	
		<linearGradient id="shadow_2_" gradientUnits="userSpaceOnUse" x1="-34" y1="-376.3311" x2="447" y2="-376.3311" gradientTransform="matrix(1 0 0 -1 0 515)">
		<stop  offset="0" style="stop-color:#333333"/>
		<stop  offset="1" style="stop-color:#000000"/>
	</linearGradient>
	
		<path id="shadow" vector-effect="non-scaling-stroke" opacity="0.4" fill="url(#shadow_1_)" stroke="url(#shadow_2_)" stroke-miterlimit="10" enable-background="new    " d="
		M-33.5,891.331c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.927,239.99,236.581
		c0,130.653-107.455,236.581-239.99,236.581C73.956,1127.911-33.5,1021.984-33.5,891.331z"/>
	
		<linearGradient id="shadow--stroke_1_" gradientUnits="userSpaceOnUse" x1="-34.5" y1="-377.1689" x2="447.5" y2="-377.1689" gradientTransform="matrix(1 0 0 -1 0 515)">
		<stop  offset="0" style="stop-color:#333333"/>
		<stop  offset="1" style="stop-color:#000000"/>
	</linearGradient>
	
		<path id="shadow--stroke" opacity="0.2" fill="none" stroke="url(#shadow--stroke_1_)" stroke-width="2" stroke-miterlimit="10" enable-background="new    " d="
		M-33.5,892.169c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.928,239.99,236.581
		c0,130.654-107.455,236.581-239.99,236.581C73.956,1128.75-33.5,1022.824-33.5,892.169z"/>
</g>
<g id="bubble-group">
	
		<linearGradient id="bubble_2_" gradientUnits="userSpaceOnUse" x1="30.2466" y1="427.8506" x2="30.2465" y2="228.3193" gradientTransform="matrix(2.3906 0 0 -2.3906 134.1921 1708.0696)">
		<stop  offset="0" style="stop-color:#FFFFFF"/>
		<stop  offset="1" style="stop-color:#EEEEEE"/>
	</linearGradient>
	<path id="bubble_1_" vector-effect="non-scaling-stroke" fill="url(#bubble_2_)" stroke="#7A7A7A" stroke-miterlimit="10" d="
		M1,889.671c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175
		c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673
		c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/>
	<path id="bubble--stroke" fill="none" stroke="#7A7A7A" stroke-width="2" stroke-miterlimit="10" d="M1,889.671
		c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175
		c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673
		c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/>
</g>
<g id="p_x21_">
	<g id="P-group">
		
			<path id="P" vector-effect="non-scaling-stroke" fill="#444444" stroke="#333333" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745
			c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428
			c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z
			 M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738
			c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68
			c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/>
		
			<path id="P--stroke" fill="none" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745
			c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428
			c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z
			 M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738
			c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68
			c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/>
	</g>
	<g id="exclamation-group">
		
			<path id="exclamation-mark" vector-effect="non-scaling-stroke" fill="#444444" stroke="#333333" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328
			C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"
			/>
		
			<path id="exclamation-mark--stroke" fill="none" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328
			C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"
			/>
	</g>
</g>
<g id="braces">
	<g id="Layer_6_2_">
		
			<linearGradient id="brace-left_1_" gradientUnits="userSpaceOnUse" x1="87.1362" y1="385.3936" x2="87.1362" y2="297.5488" gradientTransform="matrix(2.3906 0 0 -2.3906 134.1921 1708.0696)">
			<stop  offset="0" style="stop-color:#C5372F"/>
			<stop  offset="1" style="stop-color:#990000"/>
		</linearGradient>
		
			<path id="brace-left_2_" vector-effect="non-scaling-stroke" fill="url(#brace-left_1_)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362
			c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516
			c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356
			c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669
			c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986
			s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762
			c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788
			c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076
			c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88
			c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688
			c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195
			L314.164,970.195z"/>
		
			<path id="brace-left--stroke_2_" fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362
			c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516
			c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356
			c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669
			c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986
			s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762
			c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788
			c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076
			c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88
			c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688
			c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195
			L314.164,970.195z"/>
	</g>
	<g id="brace-l_2_">
		
			<linearGradient id="brace-right_1_" gradientUnits="userSpaceOnUse" x1="-26.6421" y1="385.3936" x2="-26.6421" y2="297.5498" gradientTransform="matrix(2.3906 0 0 -2.3906 134.1921 1708.0696)">
			<stop  offset="0" style="stop-color:#C5372F"/>
			<stop  offset="1" style="stop-color:#990000"/>
		</linearGradient>
		
			<path id="brace-right_2_" vector-effect="non-scaling-stroke" fill="url(#brace-right_1_)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362
			c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993
			c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495
			c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501
			c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006
			c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74
			c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933
			c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82
			c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459
			c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669
			c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/>
		
			<path id="brace-right--stroke_2_" fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
			M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362
			c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993
			c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495
			c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501
			c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006
			c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74
			c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933
			c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82
			c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459
			c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669
			c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/>
	</g>
</g>
</svg></span><span data-reactid=".21vhfkthxc0.0.0.0:1.0.0.0.1">Putain de code !</span></a></div><div class="r-Grid-cell r-minM--2of3" data-reactid=".21vhfkthxc0.0.0.0:1.0.1"><nav class="putainde-Nav" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0"><a class="putainde-Nav-item" href="/posts" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts.0"><?xml version="1.0" encoding="utf-8"?>



<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">
<path id="bookmark-2-icon" d="M318.275,90v283.23L256,318.16l-62.275,55.07V90H318.275 M358.275,50H153.725v412L256,371.557
	L358.275,462V50L358.275,50z"/>
</svg></span><span data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts.1">Articles</span></a><a class="putainde-Nav-item" href="/c-est-quoi-putaindecode" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/c-est-quoi-putaindecode"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/c-est-quoi-putaindecode.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="text-file-3-icon" d="M256,370.312h-84.495v-30H256V370.312z M339.495,314.896h-167.99v-30h167.99V314.896z

	 M339.495,259.562h-167.99v-30h167.99V259.562z M297.818,90v85.75h85.864V422H128.317V90H297.818 M322.818,50H88.317v412h335.365

	V150.75L322.818,50z"/>

</svg></span><span data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/c-est-quoi-putaindecode.1">Readme</span></a><a class="putainde-Nav-item" href="/posts/comment-contribuer" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts/comment-contribuer"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts/comment-contribuer.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="pencil-2-icon" d="M74.686,340.686L50,460.949l122.365-22.584L379.52,231.211l-97.68-97.68L74.686,340.686z

	 M303.088,205.032l-181.891,181.89l-21.213-21.213l181.891-181.89L303.088,205.032z M462,148.731l-52.662,52.662l-97.682-97.68

	l52.662-52.663L462,148.731z"/>

</svg></span><span data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.0:$/posts/comment-contribuer.1">Participer</span></a><a href="https://github.com/putaindecode/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="GitHub" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="github-2-icon" d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73

	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561

	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686

	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952

	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815

	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254

	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0

	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296

	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992

	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0

	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6

	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217

	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246

	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785

	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315

	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46

	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172

	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z

	 M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z

	 M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228

	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476

	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C197,349.352,195.265,350.583,193.125,350.583z"/>

</svg></span></a><a href="https://twitter.com/putaindecode/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Twitter" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode/.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="twitter-icon" d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764

	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787

	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574

	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699

	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435

	C436.339,160.061,450.668,145.174,462,128.223z"/>

</svg></span></a><a href="https://putaindecode-slack.herokuapp.com/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Slack" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//putaindecode-slack=1herokuapp=1com/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:1.0.1.0.1:$https=2//putaindecode-slack=1herokuapp=1com/.0"><?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">
<path d="M435.099,242.134c10.233,0,18.776,3.344,25.627,10.029c6.85,6.685,10.274,15.062,10.274,25.13
	c0,16.012-7.676,26.74-23.026,32.188l-42.587,14.608l13.865,41.349c1.155,3.467,1.734,7.345,1.734,11.637
	c0,9.739-3.467,18.157-10.399,25.256c-6.933,7.097-15.269,10.646-25.007,10.646c-7.759,0-14.815-2.228-21.17-6.686
	c-6.354-4.455-10.771-10.397-13.247-17.826l-13.618-40.853l-76.755,26.244l13.618,40.606c1.32,3.962,1.98,7.84,1.98,11.637
	c0,9.738-3.465,18.157-10.397,25.254C259.058,458.451,250.639,462,240.736,462c-7.759,0-14.773-2.228-21.046-6.686
	c-6.272-4.457-10.646-10.399-13.123-17.826l-13.618-40.358l-37.882,13.122c-4.786,1.486-8.913,2.229-12.379,2.229
	c-10.069,0-18.446-3.301-25.131-9.904c-6.686-6.602-10.028-14.938-10.028-25.007c0-7.758,2.27-14.772,6.809-21.045
	c4.539-6.273,10.44-10.647,17.703-13.123l38.625-13.122l-25.998-77.498l-38.625,13.37c-4.291,1.32-8.253,1.98-11.884,1.98
	c-9.904,0-18.24-3.342-25.007-10.027C62.384,251.42,59,243.125,59,233.221c0-7.758,2.27-14.772,6.809-21.045
	c4.54-6.272,10.441-10.646,17.703-13.122l38.873-13.123l-13.123-39.368c-1.32-3.962-1.98-7.84-1.98-11.637
	c0-9.904,3.466-18.364,10.399-25.379c6.933-7.015,15.351-10.522,25.255-10.522c7.758,0,14.773,2.228,21.045,6.685
	c6.272,4.457,10.647,10.399,13.123,17.827l13.37,39.616l76.754-25.998l-13.37-39.616c-1.32-3.961-1.981-7.84-1.981-11.636
	c0-9.739,3.508-18.158,10.522-25.255C269.415,53.549,277.793,50,287.531,50c7.758,0,14.814,2.27,21.17,6.809
	c6.354,4.54,10.77,10.441,13.245,17.703l13.123,39.863l40.111-13.618c3.467-0.99,7.016-1.485,10.646-1.485
	c9.904,0,18.364,3.26,25.379,9.78c7.016,6.521,10.522,14.65,10.522,24.389c0,7.428-2.476,14.154-7.427,20.179
	c-4.952,6.024-11.06,10.275-18.323,12.751l-38.872,13.37l25.997,78.24l40.607-13.864
	C427.67,242.795,431.468,242.134,435.099,242.134z M238.507,307.005l76.755-25.998l-25.998-77.993l-76.754,26.493L238.507,307.005z"
	/>
</svg></span></a></nav></div></div></div><div data-reactid=".21vhfkthxc0.0.0.0:2"><div class="putainde-Main" data-reactid=".21vhfkthxc0.0.0.0:2.3"><noscript data-reactid=".21vhfkthxc0.0.0.0:2.3.0"></noscript><article class="putainde-Post" data-reactid=".21vhfkthxc0.0.0.0:2.3.1"><header data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0"><div class="putainde-Post-header" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.0"><h1 class="putainde-Title" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.0.2">Laissez-vous pousser la barbe, apprenez à écrire des Makefiles</h1></div><div class="putainde-Post-metas" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.0"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.0.0">Écrit par </span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.0.1"><a href="http://madx.me/" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.0.1.0:$[object Object]">madx</a><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.0.1.0:$[object Object]-glue"></span></span></span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.1">, </span><span class="putainde-Date" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.2"> le 3 nov. 2014</span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.3">. </span><span class="r-Tooltip r-Tooltip--top putainde-Post-readingTime" data-r-tooltip="Temps de lecture approximatif, sur une base de 250 mots par minute" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.4"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.4.0">Temps de lecture : </span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.1.4.2">environ 7 minutes</span></span></div><ul class="putainde-Tags putainde-Post-tags" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.2"><li class="putainde-Tag" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.2.$shell">shell</li><li class="putainde-Tag" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.0.2.$makefile">makefile</li></ul></header><div class="r-Grid" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1"><div class="r-Grid-cell r-all--8of12 putainde-Post-contents" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0"><div class="putainde-Post-md" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.0"><div data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.0.0"><p>À l’heure où tout le monde se rue sur des outils comme <a href="/posts/js/introduction-gulp/">Gulp</a>,
<a href="/posts/js/premiers-pas-avec-grunt/">Grunt</a> ou autres <a href="https://rubygems.org/gems/rake">Rake</a>, certains irréductibles (dont je
fais partie) ont fait le choix d’employer un des outils les plus standards et
emblématiques dont tout développeur a entendu parler au moins une fois dans sa
vie : <em>Make</em>.</p>
<p>Si de prime abord on a l’impression d’un système assez archaïque (ce qui n’est
pas toujours forcément faux), on se rend rapidement compte que <em>Make</em>, couplé à
une petite dose de scripting shell permet rapidement de mettre en place un moyen
de compiler ses fichiers et de lancer des tâches.</p>
<p>Les fichiers de configuration de <em>Make</em> sont appellés <em>Makefiles</em> (oui, ce sont
eux qui ont donné leurs noms aux <code>(Gulp|Grunt|Rake)files</code>). Les instructions
qu’ils contiennent sont exécutées grâce à la commande <code>make</code> dans votre
terminal.</p>
<h1 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world">#</a> Hello World</h1>
<p>Je vous propose de commencer en douceur par un classique <em>Hello World</em>. On va
simplement définir une tâche <code>hello-world</code> dont l’action va être d’afficher
<em>“Hello, world”</em> à l’écran (boooring).</p>
<pre><code class="language-make">hello-world:
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello, world"</span></code></pre>
<p>Première remarque importante, les indentations dans un <em>Makefile</em> <strong>doivent</strong>
être faites avec des tabulations. Oui, je sais, c’est moche, on dirait du
Python, mais c’est comme ça.</p>
<p>Voilà le genre d’erreurs qu’on se prend si on met des espaces à la place des
tabulations :</p>
<pre><code>Makefile:2: <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span> séparateur manquant . Arrêt.</code></pre>
<p>Pour exécuter notre commande, il nous suffit de lancer <code>make hello-world</code> dans
un terminal :</p>
<pre><code class="language-console">$ <span class="hljs-keyword">make</span> hello-world
<span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello, world"</span>
Hello, world</code></pre>
<p>Décortiquons un peu cette exécution. Pour chaque commande qu’il exécute, <em>Make</em>
affiche la commande complète avant d’afficher la sortie standard de ladite
commande. C’est souvent très pratique car toutes les variables (on va revenir là dessus)
qu’on met dans la commande sont résolues, et on voit clairement ce que <em>Make</em>
exécute. Par contre, dans certains cas on s’en fout un peu, on peut alors
préfixer la ligne à rendre silencieuse par un <code>@</code>, comme ça :</p>
<pre><code class="language-make">hello-world:
	@ <span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello, world"</span></code></pre>
<pre><code class="language-console"><span class="hljs-variable">$ </span>make hello-world
<span class="hljs-constant">Hello</span>, world</code></pre>
<h1 id="r-gles-cibles-recettes-et-pr-requis"><a class="markdownIt-Anchor" href="#r-gles-cibles-recettes-et-pr-requis">#</a> Règles, cibles, recettes et pré-requis</h1>
<p>OK, jusque là c’est génial, on a un super outil pour lancer des commandes qu’on
pourrait déjà stocker dans un bête script shell. Pas super utile finalement.</p>
<p>Bon, on va corser un peu les choses et commencer par définir un peu de
terminologie avant que vous soyez totalement largués.</p>
<p>Un <em>Makefile</em> est une collection de <strong>règles</strong>, chacune étant composée d’une
<strong>cible</strong>, de <strong>pré-requis</strong> (ou pas) et d’une <strong>recette</strong>. Dans notre exemple
précédent, <code>hello-world</code> est la cible et <code>@ echo &quot;Hello, world&quot;</code> est la recette
de la règle. Elle ne spécifie par contre pas de pré-requis.</p>
<p>Relisez trois ou quatre fois le paragraphe précédent jusqu’à ce que ce soit bien
imprimé.</p>
<p>Vous l’aurez compris, on invoque une règle depuis la ligne de commande en
spécifiant le nom de sa cible après la commande <code>make</code>. Si on ne précise rien,
c’est la première règle trouvée qui est exécutée (donc dans notre cas,
<code>hello-world</code>).</p>
<p>Les pré-requis sont déclarés après la cible. On pourrait par exemple ajouter un
<code>sauter-une-ligne</code> comme pré-requis à notre cible <code>hello-world</code> :</p>
<pre><code class="language-make">hello-world: sauter-une-ligne
	@ <span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello, world"</span>

sauter-une-ligne:
	@ <span class="hljs-built_in">echo</span></code></pre>
<pre><code class="language-console"><span class="hljs-variable">$ </span>make hello-world

<span class="hljs-constant">Hello</span>, world</code></pre>
<p>Facile, non ? Ok alors on peut <em>vraiment</em> attaquer les choses sérieuses.</p>
<h1 id="construire-des-fichiers"><a class="markdownIt-Anchor" href="#construire-des-fichiers">#</a> Construire des fichiers</h1>
<p>Les pré-requis sont particulièrement pratiques quand on veut construire un
fichier depuis un autre, ce qui est la principale action d’à peu près tout
processus de compilation (paraît même que c’est grosso modo la définition de la
compilation).</p>
<p>On peut par exemple écrire un <em>Makefile</em> nous permettant de compiler un fichier
<em>Markdown</em> en <em>HTML</em> :</p>
<pre><code class="language-make"><span class="hljs-tag">article</span><span class="hljs-class">.html</span>: <span class="hljs-tag">article</span><span class="hljs-class">.md</span>
	marked <span class="hljs-tag">article</span><span class="hljs-class">.md</span> &gt; <span class="hljs-tag">article</span>.html</code></pre>
<p>Cette règle spécifie simplement que pour construire le fichier <code>article.html</code>
j’ai besoin du fichier <code>article.md</code> et que j’utilise la commande
<a href="https://www.npmjs.org/package/marked"><code>marked</code></a> pour construire le fichier. Essayez, vous verrez, c’est
magique.</p>
<p>Là où ça devient intéressant, c’est que si je lance de nouveau <code>make article.html</code>, rien ne se passe. Eh oui, <em>Make</em> vérifie les dates de
modification des pré-requis et les compare avec la date de modification de la
cible pour savoir s’il doit où non reconstruire la cible.</p>
<p>On peut bien sûr aller plus loin en ayant des fichiers qui dépendent de
fichiers, qui à leur tour dépendent de fichiers, …</p>
<p><a name="ref-phony-target"></a></p>
<p>On peut aussi avoir une cible factice qui ne représente pas un fichier et qui
elle-même dépend de plusieurs fichiers (<code>website: index.html apropos.html contact.html</code>).</p>
<h1 id="variables-et-substitutions"><a class="markdownIt-Anchor" href="#variables-et-substitutions">#</a> Variables et substitutions</h1>
<p>La syntaxe des variables dans un <em>Makefile</em> ressemblent beaucoup aux variables
de votre Shell, <em>mais pas tout à fait</em>.</p>
<pre><code class="language-make">SOURCE = <span class="hljs-keyword">index</span>.md
DESTINATION = <span class="hljs-keyword">index</span>.html

<span class="hljs-variable">${DESTINATION}</span>: <span class="hljs-variable">${SOURCE}</span>
  marked <span class="hljs-variable">${SOURCE}</span> &gt; <span class="hljs-variable">${DESTINATION}</span></code></pre>
<p>On peut aussi utiliser une substitution pour s’éviter de tout retaper. La
syntaxe pour ça est assez simple et se passe d’explications :</p>
<pre><code class="language-make"><span class="hljs-setting">SOURCE = <span class="hljs-value">index.md</span></span>
<span class="hljs-setting">DESTINATION = <span class="hljs-value"><span class="hljs-variable">${SOURCE:.md=.html}</span></span></span></code></pre>
<p>Là où ça devient beaucoup plus intéressant c’est qu’on peut stocker des listes
dans une variable. Pour ça, pas vraiment d’effort à faire, il suffit de rajouter
des noms à la suite :</p>
<pre><code class="language-make">SOURCE = index.<span class="hljs-built_in">md</span> article.<span class="hljs-built_in">md</span>
DESTINATION = ${SOURCE:.<span class="hljs-built_in">md</span>=.html}</code></pre>
<p>Attention par contre ! En faisant ça si vous utilisez <code>${SOURCE}</code> comme cible
d’une règle, vous allez définir plusieurs règles d’un coup, ce qui n’est peut
être pas ce que vous voulez.</p>
<p>On peut contourner ça assez simplement en utilisant une substitution au niveau
de la règle. La syntaxe est un poil différente :</p>
<pre><code class="language-make">%<span class="hljs-class">.html</span>: %<span class="hljs-class">.md</span>
  <span class="hljs-attr_selector">[...]</span></code></pre>
<p>Vous l’aurez compris, <code>%</code> est identique dans la cible et dans la dépendance,
donc avec cette règle si vous faites un <code>make index.html</code>, <em>Make</em> va tenter de
construire la dépendance <code>index.md</code> avant tout.</p>
<p>Un problème se pose à nous avec cette syntaxe : « Bah merde, comment je récupère
les noms de fichiers là ? »</p>
<h1 id="variables-sp-ciales"><a class="markdownIt-Anchor" href="#variables-sp-ciales">#</a> Variables spéciales</h1>
<p>Superbe transition étant donné qu’on va parler ici de quelques variables
spéciales bien pratiques !</p>
<ul>
<li><code>$@</code> contient le nom de la cible de la règle en cours d’exécution ;</li>
<li><code>$^</code> contient la liste des dépendances de la règle (la flèche pointe vers la
liste de dépendances) ;</li>
<li><code>$&lt;</code> contient la première dépendance de la règle (la flèche pointe à gauche,
là où est la dépendance).</li>
</ul>
<p>À l’aide de celles-ci on peut du coup compléter notre exemple précédent :</p>
<pre><code class="language-make"><span class="hljs-variable">%.</span>html: <span class="hljs-variable">%.</span>md
  marked <span class="hljs-variable">$&lt;</span> &gt; <span class="hljs-variable">$@</span>
  [...]</code></pre>
<h1 id="fonctions"><a class="markdownIt-Anchor" href="#fonctions">#</a> Fonctions</h1>
<p>Pour faciliter quelques opérations, <em>Make</em> fournit un ensemble de fonctions de
base. Appeler ces fonctions rappelle un peu la façon dont on lance une commande
dans un sous-shell en Bash : <code>$(fonction argument1 argument2)</code>.</p>
<p>Voici une petite démonstration de <code>wildcard</code>, <code>addsuffix</code> et <code>basename</code> dont
vous vous doutez sans doute les effets :</p>
<pre><code class="language-make">SOURCES = <span class="hljs-variable">$(</span>wildcard <span class="hljs-variable">*.</span>md)
DESTINATIONS = <span class="hljs-variable">$(</span>addsuffix .html,<span class="hljs-variable">$(</span><span class="hljs-keyword">basename</span> <span class="hljs-variable">${SOURCES}</span>))

all: <span class="hljs-variable">${DESTINATIONS}</span>

<span class="hljs-variable">%.</span>html: <span class="hljs-variable">%.</span>md
  marked <span class="hljs-variable">$&lt;</span> &gt; <span class="hljs-variable">$@</span></code></pre>
<p>L’exemple construit dynamiquement la liste des fichiers HTML à produire à partir
de la liste des fichiers <em>Markdown</em> disponibles puis définit une règle <code>all</code>
permettant de tout construire d’un coup, et une règle définissant compiler
unitairement un fichier <em>Markdown</em> vers HTML.</p>
<p>Vous noterez qu’<code>addsuffix</code>/<code>basename</code> peut être remplacé par une substitution
simple comme on a vu précédemment.</p>
<p>Je vous invite à fouiller
<a href="https://www.gnu.org/software/make/manual/make.html#Functions">le chapitre sur les fonctions du manuel</a>.</p>
<h1 id="la-cible-phony"><a class="markdownIt-Anchor" href="#la-cible-phony">#</a> La cible <code>.PHONY</code></h1>
<p>Dans certains cas la cible d’une règle ne représente pas un fichier (c’était le
cas de notre cible <code>website</code> <a href="#ref-phony-target">un peu plus haut</a>).</p>
<p>Dans ces cas-là, on va vouloir exécuter la règle quoi qu’il arrive, comme si la
cible était tout le temps périmée.</p>
<p>Une cible particulière existe pour ça : <code>.PHONY</code>. Toutes les dépendances de
cette cible seront marquées comme (traduction pourrie) imposteurs (<em>phony</em>
donc).</p>
<p>Pour reprendre l’exemple précédent, on déclarera donc :</p>
<pre><code class="language-make"><span class="hljs-class">.PHONY</span>: website

website: index<span class="hljs-class">.html</span> apropos<span class="hljs-class">.html</span> contact<span class="hljs-class">.html</span>
  [...]</code></pre>
<p>Désormais, chaque appel à <code>make website</code> tentera de construire les dépendances
et exécutera les commandes de la recette de la règle.</p>
<h1 id="un-exemple-complet"><a class="markdownIt-Anchor" href="#un-exemple-complet">#</a> Un exemple complet</h1>
<p>L’exemple suivant permet de compiler un site Web depuis un ensemble de fichiers
<em>Markdown</em>.</p>
<pre><code class="language-make"><span class="hljs-constant">SOURCES</span> = <span class="hljs-variable">$(</span>wildcard src/*.md)
<span class="hljs-constant">DESTINATIONS</span> = <span class="hljs-variable">${</span><span class="hljs-constant">SOURCES</span><span class="hljs-symbol">:src/%</span>.md=build/%.html}

<span class="hljs-symbol">all:</span> <span class="hljs-variable">${</span><span class="hljs-constant">DESTINATIONS</span>}

<span class="hljs-symbol">info:</span>
	@ echo <span class="hljs-constant">Will</span> build <span class="hljs-variable">${</span><span class="hljs-constant">DESTINATIONS</span>} from <span class="hljs-variable">${</span><span class="hljs-constant">SOURCES</span>}

<span class="hljs-symbol">clean:</span>
	rm -f <span class="hljs-variable">${</span><span class="hljs-constant">DESTINATIONS</span>}

build/%.<span class="hljs-symbol">html:</span> src/%.md
	mkdir -p build
	marked <span class="hljs-variable">$&lt;</span> &gt; <span class="hljs-variable">$@</span>

.<span class="hljs-constant">PHONY</span><span class="hljs-symbol">:</span> all info clean</code></pre>
<p>Vous noterez que comme on stocke nos résultats dans le dossier <code>build</code>, il faut
potentiellement le créer quand on compile un fichier dedans.</p>
<h1 id="pour-aller-plus-loin"><a class="markdownIt-Anchor" href="#pour-aller-plus-loin">#</a> Pour aller plus loin</h1>
<p>Il existe bien d’autres fonctionnalités dans <em>Make</em> (du moins dans <em>GNU Make</em>),
avec notamment :</p>
<ul>
<li>Les <a href="https://www.gnu.org/software/make/manual/make.html#Canned-Recipes"><em>canned recipes</em></a> (recettes en boîte), permettant de
définir un bout de règle réutilisable à plusieurs endroits.</li>
<li>Des <a href="https://www.gnu.org/software/make/manual/make.html#Functions">expressions conditionnelles</a> pour avoir des tests
dans votre <em>Makefile</em> et effectuer des traitements différents selon
l’environnement.</li>
<li>Les <a href="https://www.gnu.org/software/make/manual/make.html##Prerequisite-Types">règles en <em>order only</em></a> qui permettent d’indiquer une
dépendance dont la date de modification ne doit pas être prise en compte (on
peut s’en servir pour éviter le <code>mkdir</code> dans l’exemple complet).</li>
<li>Et <a href="https://www.gnu.org/software/make/manual/make.html#Functions">plein d’autres fonctions</a> bien pratiques !</li>
</ul>
<p>Je vous invite aussi à jeter un coup d’œil au <a href="https://github.com/madx/veil/"><em>Makefile</em> de Veil</a>, un outil que
j’utilise pour générer des sites statiques à partir de fichiers <em>Markdown</em>
(ah bah tiens, comme dans mes exemples, c’est rigolo). Il y a plein de
fonctionnalités de <em>Make</em> utilisées dans ce projet et je pense que ça peut être
source d’idées.</p>
<p>Voilà pour cette premier introduction à <em>Make</em>, j’espère que ça vous a plu et
que vous êtes fin prêts à affronter tous ces bouseux avec leur système de build
à base de streams, de brocolis et autres râteaux.</p>
</div></div><footer class="putainde-Post-footer" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1"><div data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0"><div class="putainde-Author undefined" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0"><a href="http://madx.me/" class="putainde-Avatar putainde-Author-picture" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/5723?v=3&amp;s=128" alt="" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.0.0"/></a><div class="putainde-Author-description" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1"><div class="putainde-Author-title" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0"><h3 class="putainde-Author-name" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.0"><span class="putainde-WrittenBy" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.0.0">Écrit par </span><a class="putainde-Link" href="http://madx.me/" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.0.1">madx</a></h3><div class="putainde-Author-social" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1"><a href="http://madx.me/" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Website" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.0.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="home-5-icon" d="M394.072,174.805l-47.916-48.023V88.472h47.916V174.805z M462,275.815h-42.508v166.213H92.508V275.815H50

	L256,69.972L462,275.815z M296.847,271.972c-15.811-3.316-29.021,4.086-38.792,19.387c-9.771-15.301-22.98-22.703-38.789-19.387

	c-36.746,10.876-36.336,69.543,38.582,113.047C332.908,341.761,333.59,282.848,296.847,271.972z"/>

</svg></span></a><a href="https://twitter.com/madx" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Twitter" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="twitter-icon" d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764

	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787

	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574

	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699

	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435

	C436.339,160.061,450.668,145.174,462,128.223z"/>

</svg></span></a><a href="https://github.com/madx" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Github" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="github-2-icon" d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73

	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561

	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686

	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952

	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815

	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254

	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0

	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296

	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992

	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0

	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6

	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217

	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246

	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785

	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315

	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46

	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172

	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z

	 M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z

	 M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228

	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476

	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C197,349.352,195.265,350.583,193.125,350.583z"/>

</svg></span></a></div></div><p class="putainde-Author-bio" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.1"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.1.0">Développeur Ruby et JavaScript, avec un goût prononcé pour la simplicité, le soleil, le pastis.</span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.1.1">Il n&#x27;aime pas OS X car, objectivement, c&#x27;est nul.</span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.1.2">Quand il n&#x27;est pas devant son ordi, il y a de grandes chances qu&#x27;il compense avec son téléphone.</span><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.0.0.1.1.3">Spécialiste en développement d&#x27;applications inutiles.</span></p></div></div></div><div class="putainde-Contributors" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2"><strong class="putainde-Contributors-label" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.0"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.0.1">4 contributeurs sur cette page</span></strong><div class="r-Grid putainde-Contributors-actions" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1"><div class="r-Grid-cell r-all--1of3" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.0"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.fr/edit/master/content/posts/shell/apprendre-les-makefiles/index.md" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.0.0">Modifier</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.1"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.fr/blame/master/content/posts/shell/apprendre-les-makefiles/index.md" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.1.0">Tracer les changements</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.2"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.fr/commits/master/content/posts/shell/apprendre-les-makefiles/index.md" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.1.2.0">Historique</a></div></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Macxim
(3 commits)" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$Macxim"><a href="http://macx.im" class="putainde-Avatar putainde-Contributor-avatar" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$Macxim.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1909957?v=3&amp;s=128" alt="" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$Macxim.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="MoOx
(2 commits)" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$MoOx"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$MoOx.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt="" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$MoOx.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="madx
(1 commit)" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$madx"><a href="http://madx.me/" class="putainde-Avatar putainde-Contributor-avatar" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$madx.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/5723?v=3&amp;s=128" alt="" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$madx.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="ssimono
(1 commit)" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$ssimono"><a href="https://github.com/ssimono" class="putainde-Avatar putainde-Contributor-avatar" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$ssimono.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/2179169?v=3&amp;s=128" alt="" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.2.2:$ssimono.0.0"/></a></div></div><div data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3"><div id="disqus_thread" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.0"></div><noscript data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.1"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.1.0"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.1.0.0">Please enable JavaScript to view the</span><a href="http://disqus.com/?ref_noscript" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.1.0.1">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.2"><span data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.2.0">blog comments powered by</span><span class="logo-disqus" data-reactid=".21vhfkthxc0.0.0.0:2.3.1.1.0.1.3.2.1">Disqus</span></a></div></footer></div></div></article></div></div><div class="putainde-Footer" data-reactid=".21vhfkthxc0.0.0.0:3"><div class="r-Grid" data-reactid=".21vhfkthxc0.0.0.0:3.0"><div class="r-Grid-cell r-minM--1of4" data-reactid=".21vhfkthxc0.0.0.0:3.0.0"><p class="putainde-Footer-text" data-reactid=".21vhfkthxc0.0.0.0:3.0.0.0">© 1970 - 2015 Putain de code !</p></div><div class="r-Grid-cell r-minM--2of4" data-reactid=".21vhfkthxc0.0.0.0:3.0.1"><ul class="putainde-Footer-list" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0"><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.0:$/feed=1xml"><a class="" href="/feed.xml" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.0:$/feed=1xml.0">Flux RSS</a></li><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.0:$/projets"><a class="" href="/projets" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.0:$/projets.0">Projets</a></li><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues"><a class="" href="https://github.com/putaindecode/forum/issues" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues.0">Forum</a></li><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1fr"><a href="https://github.com/putaindecode/putaindecode.fr" data-r-tooltip="GitHub" class="r-Tooltip r-Tooltip--top" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1fr.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1fr.0.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="github-2-icon" d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73

	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561

	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686

	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952

	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815

	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254

	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0

	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296

	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992

	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0

	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6

	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217

	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246

	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785

	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315

	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46

	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172

	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z

	 M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z

	 M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228

	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476

	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749

	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583

	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751

	C197,349.352,195.265,350.583,193.125,350.583z"/>

</svg></span></a></li><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/"><a href="https://twitter.com/putaindecode_fr/" data-r-tooltip="Twitter" class="r-Tooltip r-Tooltip--top" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0.0"><?xml version="1.0" encoding="utf-8"?>


<!-- The icon can be used freely in both personal and commercial projects with no attribution required, but always appreciated. 
You may NOT sub-license, resell, rent, redistribute or otherwise transfer the icon without express written permission from iconmonstr.com -->


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"

	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">

<path id="twitter-icon" d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764

	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787

	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574

	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699

	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435

	C436.339,160.061,450.668,145.174,462,128.223z"/>

</svg></span></a></li><li data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//putaindecode-slack=1herokuapp=1com/"><a href="https://putaindecode-slack.herokuapp.com/" data-r-tooltip="Slack" class="r-Tooltip r-Tooltip--top" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//putaindecode-slack=1herokuapp=1com/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".21vhfkthxc0.0.0.0:3.0.1.0.$https=2//putaindecode-slack=1herokuapp=1com/.0.0"><?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">
<path d="M435.099,242.134c10.233,0,18.776,3.344,25.627,10.029c6.85,6.685,10.274,15.062,10.274,25.13
	c0,16.012-7.676,26.74-23.026,32.188l-42.587,14.608l13.865,41.349c1.155,3.467,1.734,7.345,1.734,11.637
	c0,9.739-3.467,18.157-10.399,25.256c-6.933,7.097-15.269,10.646-25.007,10.646c-7.759,0-14.815-2.228-21.17-6.686
	c-6.354-4.455-10.771-10.397-13.247-17.826l-13.618-40.853l-76.755,26.244l13.618,40.606c1.32,3.962,1.98,7.84,1.98,11.637
	c0,9.738-3.465,18.157-10.397,25.254C259.058,458.451,250.639,462,240.736,462c-7.759,0-14.773-2.228-21.046-6.686
	c-6.272-4.457-10.646-10.399-13.123-17.826l-13.618-40.358l-37.882,13.122c-4.786,1.486-8.913,2.229-12.379,2.229
	c-10.069,0-18.446-3.301-25.131-9.904c-6.686-6.602-10.028-14.938-10.028-25.007c0-7.758,2.27-14.772,6.809-21.045
	c4.539-6.273,10.44-10.647,17.703-13.123l38.625-13.122l-25.998-77.498l-38.625,13.37c-4.291,1.32-8.253,1.98-11.884,1.98
	c-9.904,0-18.24-3.342-25.007-10.027C62.384,251.42,59,243.125,59,233.221c0-7.758,2.27-14.772,6.809-21.045
	c4.54-6.272,10.441-10.646,17.703-13.122l38.873-13.123l-13.123-39.368c-1.32-3.962-1.98-7.84-1.98-11.637
	c0-9.904,3.466-18.364,10.399-25.379c6.933-7.015,15.351-10.522,25.255-10.522c7.758,0,14.773,2.228,21.045,6.685
	c6.272,4.457,10.647,10.399,13.123,17.827l13.37,39.616l76.754-25.998l-13.37-39.616c-1.32-3.961-1.981-7.84-1.981-11.636
	c0-9.739,3.508-18.158,10.522-25.255C269.415,53.549,277.793,50,287.531,50c7.758,0,14.814,2.27,21.17,6.809
	c6.354,4.54,10.77,10.441,13.245,17.703l13.123,39.863l40.111-13.618c3.467-0.99,7.016-1.485,10.646-1.485
	c9.904,0,18.364,3.26,25.379,9.78c7.016,6.521,10.522,14.65,10.522,24.389c0,7.428-2.476,14.154-7.427,20.179
	c-4.952,6.024-11.06,10.275-18.323,12.751l-38.872,13.37l25.997,78.24l40.607-13.864
	C427.67,242.795,431.468,242.134,435.099,242.134z M238.507,307.005l76.755-25.998l-25.998-77.993l-76.754,26.493L238.507,307.005z"
	/>
</svg></span></a></li></ul></div><div class="r-Grid-cell r-minM--1of4 putainde-Footer-text--right" data-reactid=".21vhfkthxc0.0.0.0:3.0.2"><span class="putainde-Footer-text putainde-Footer-text--small" data-reactid=".21vhfkthxc0.0.0.0:3.0.2.0">Made with ♥︎</span></div></div></div><script data-reactid=".21vhfkthxc0.0.0.1"></script></div></div></div></div><script>window.__INITIAL_STATE__ = {"pages":{"posts/shell/apprendre-les-makefiles":{"head":{"layout":"Post","comments":true,"date":"2014-11-03","title":"Laissez-vous pousser la barbe, apprenez à écrire des Makefiles","tags":["shell","makefile"],"authors":["madx"]},"body":"<p>À l’heure où tout le monde se rue sur des outils comme <a href=\"/posts/js/introduction-gulp/\">Gulp</a>,\n<a href=\"/posts/js/premiers-pas-avec-grunt/\">Grunt</a> ou autres <a href=\"https://rubygems.org/gems/rake\">Rake</a>, certains irréductibles (dont je\nfais partie) ont fait le choix d’employer un des outils les plus standards et\nemblématiques dont tout développeur a entendu parler au moins une fois dans sa\nvie : <em>Make</em>.</p>\n<p>Si de prime abord on a l’impression d’un système assez archaïque (ce qui n’est\npas toujours forcément faux), on se rend rapidement compte que <em>Make</em>, couplé à\nune petite dose de scripting shell permet rapidement de mettre en place un moyen\nde compiler ses fichiers et de lancer des tâches.</p>\n<p>Les fichiers de configuration de <em>Make</em> sont appellés <em>Makefiles</em> (oui, ce sont\neux qui ont donné leurs noms aux <code>(Gulp|Grunt|Rake)files</code>). Les instructions\nqu’ils contiennent sont exécutées grâce à la commande <code>make</code> dans votre\nterminal.</p>\n<h1 id=\"hello-world\"><a class=\"markdownIt-Anchor\" href=\"#hello-world\">#</a> Hello World</h1>\n<p>Je vous propose de commencer en douceur par un classique <em>Hello World</em>. On va\nsimplement définir une tâche <code>hello-world</code> dont l’action va être d’afficher\n<em>“Hello, world”</em> à l’écran (boooring).</p>\n<pre><code class=\"language-make\">hello-world:\n\t<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Hello, world\"</span></code></pre>\n<p>Première remarque importante, les indentations dans un <em>Makefile</em> <strong>doivent</strong>\nêtre faites avec des tabulations. Oui, je sais, c’est moche, on dirait du\nPython, mais c’est comme ça.</p>\n<p>Voilà le genre d’erreurs qu’on se prend si on met des espaces à la place des\ntabulations :</p>\n<pre><code>Makefile:2: <span class=\"hljs-keyword\">*</span><span class=\"hljs-keyword\">*</span><span class=\"hljs-keyword\">*</span> séparateur manquant . Arrêt.</code></pre>\n<p>Pour exécuter notre commande, il nous suffit de lancer <code>make hello-world</code> dans\nun terminal :</p>\n<pre><code class=\"language-console\">$ <span class=\"hljs-keyword\">make</span> hello-world\n<span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\"Hello, world\"</span>\nHello, world</code></pre>\n<p>Décortiquons un peu cette exécution. Pour chaque commande qu’il exécute, <em>Make</em>\naffiche la commande complète avant d’afficher la sortie standard de ladite\ncommande. C’est souvent très pratique car toutes les variables (on va revenir là dessus)\nqu’on met dans la commande sont résolues, et on voit clairement ce que <em>Make</em>\nexécute. Par contre, dans certains cas on s’en fout un peu, on peut alors\npréfixer la ligne à rendre silencieuse par un <code>@</code>, comme ça :</p>\n<pre><code class=\"language-make\">hello-world:\n\t@ <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Hello, world\"</span></code></pre>\n<pre><code class=\"language-console\"><span class=\"hljs-variable\">$ </span>make hello-world\n<span class=\"hljs-constant\">Hello</span>, world</code></pre>\n<h1 id=\"r-gles-cibles-recettes-et-pr-requis\"><a class=\"markdownIt-Anchor\" href=\"#r-gles-cibles-recettes-et-pr-requis\">#</a> Règles, cibles, recettes et pré-requis</h1>\n<p>OK, jusque là c’est génial, on a un super outil pour lancer des commandes qu’on\npourrait déjà stocker dans un bête script shell. Pas super utile finalement.</p>\n<p>Bon, on va corser un peu les choses et commencer par définir un peu de\nterminologie avant que vous soyez totalement largués.</p>\n<p>Un <em>Makefile</em> est une collection de <strong>règles</strong>, chacune étant composée d’une\n<strong>cible</strong>, de <strong>pré-requis</strong> (ou pas) et d’une <strong>recette</strong>. Dans notre exemple\nprécédent, <code>hello-world</code> est la cible et <code>@ echo &quot;Hello, world&quot;</code> est la recette\nde la règle. Elle ne spécifie par contre pas de pré-requis.</p>\n<p>Relisez trois ou quatre fois le paragraphe précédent jusqu’à ce que ce soit bien\nimprimé.</p>\n<p>Vous l’aurez compris, on invoque une règle depuis la ligne de commande en\nspécifiant le nom de sa cible après la commande <code>make</code>. Si on ne précise rien,\nc’est la première règle trouvée qui est exécutée (donc dans notre cas,\n<code>hello-world</code>).</p>\n<p>Les pré-requis sont déclarés après la cible. On pourrait par exemple ajouter un\n<code>sauter-une-ligne</code> comme pré-requis à notre cible <code>hello-world</code> :</p>\n<pre><code class=\"language-make\">hello-world: sauter-une-ligne\n\t@ <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Hello, world\"</span>\n\nsauter-une-ligne:\n\t@ <span class=\"hljs-built_in\">echo</span></code></pre>\n<pre><code class=\"language-console\"><span class=\"hljs-variable\">$ </span>make hello-world\n\n<span class=\"hljs-constant\">Hello</span>, world</code></pre>\n<p>Facile, non ? Ok alors on peut <em>vraiment</em> attaquer les choses sérieuses.</p>\n<h1 id=\"construire-des-fichiers\"><a class=\"markdownIt-Anchor\" href=\"#construire-des-fichiers\">#</a> Construire des fichiers</h1>\n<p>Les pré-requis sont particulièrement pratiques quand on veut construire un\nfichier depuis un autre, ce qui est la principale action d’à peu près tout\nprocessus de compilation (paraît même que c’est grosso modo la définition de la\ncompilation).</p>\n<p>On peut par exemple écrire un <em>Makefile</em> nous permettant de compiler un fichier\n<em>Markdown</em> en <em>HTML</em> :</p>\n<pre><code class=\"language-make\"><span class=\"hljs-tag\">article</span><span class=\"hljs-class\">.html</span>: <span class=\"hljs-tag\">article</span><span class=\"hljs-class\">.md</span>\n\tmarked <span class=\"hljs-tag\">article</span><span class=\"hljs-class\">.md</span> &gt; <span class=\"hljs-tag\">article</span>.html</code></pre>\n<p>Cette règle spécifie simplement que pour construire le fichier <code>article.html</code>\nj’ai besoin du fichier <code>article.md</code> et que j’utilise la commande\n<a href=\"https://www.npmjs.org/package/marked\"><code>marked</code></a> pour construire le fichier. Essayez, vous verrez, c’est\nmagique.</p>\n<p>Là où ça devient intéressant, c’est que si je lance de nouveau <code>make article.html</code>, rien ne se passe. Eh oui, <em>Make</em> vérifie les dates de\nmodification des pré-requis et les compare avec la date de modification de la\ncible pour savoir s’il doit où non reconstruire la cible.</p>\n<p>On peut bien sûr aller plus loin en ayant des fichiers qui dépendent de\nfichiers, qui à leur tour dépendent de fichiers, …</p>\n<p><a name=\"ref-phony-target\"></a></p>\n<p>On peut aussi avoir une cible factice qui ne représente pas un fichier et qui\nelle-même dépend de plusieurs fichiers (<code>website: index.html apropos.html contact.html</code>).</p>\n<h1 id=\"variables-et-substitutions\"><a class=\"markdownIt-Anchor\" href=\"#variables-et-substitutions\">#</a> Variables et substitutions</h1>\n<p>La syntaxe des variables dans un <em>Makefile</em> ressemblent beaucoup aux variables\nde votre Shell, <em>mais pas tout à fait</em>.</p>\n<pre><code class=\"language-make\">SOURCE = <span class=\"hljs-keyword\">index</span>.md\nDESTINATION = <span class=\"hljs-keyword\">index</span>.html\n\n<span class=\"hljs-variable\">${DESTINATION}</span>: <span class=\"hljs-variable\">${SOURCE}</span>\n  marked <span class=\"hljs-variable\">${SOURCE}</span> &gt; <span class=\"hljs-variable\">${DESTINATION}</span></code></pre>\n<p>On peut aussi utiliser une substitution pour s’éviter de tout retaper. La\nsyntaxe pour ça est assez simple et se passe d’explications :</p>\n<pre><code class=\"language-make\"><span class=\"hljs-setting\">SOURCE = <span class=\"hljs-value\">index.md</span></span>\n<span class=\"hljs-setting\">DESTINATION = <span class=\"hljs-value\"><span class=\"hljs-variable\">${SOURCE:.md=.html}</span></span></span></code></pre>\n<p>Là où ça devient beaucoup plus intéressant c’est qu’on peut stocker des listes\ndans une variable. Pour ça, pas vraiment d’effort à faire, il suffit de rajouter\ndes noms à la suite :</p>\n<pre><code class=\"language-make\">SOURCE = index.<span class=\"hljs-built_in\">md</span> article.<span class=\"hljs-built_in\">md</span>\nDESTINATION = ${SOURCE:.<span class=\"hljs-built_in\">md</span>=.html}</code></pre>\n<p>Attention par contre ! En faisant ça si vous utilisez <code>${SOURCE}</code> comme cible\nd’une règle, vous allez définir plusieurs règles d’un coup, ce qui n’est peut\nêtre pas ce que vous voulez.</p>\n<p>On peut contourner ça assez simplement en utilisant une substitution au niveau\nde la règle. La syntaxe est un poil différente :</p>\n<pre><code class=\"language-make\">%<span class=\"hljs-class\">.html</span>: %<span class=\"hljs-class\">.md</span>\n  <span class=\"hljs-attr_selector\">[...]</span></code></pre>\n<p>Vous l’aurez compris, <code>%</code> est identique dans la cible et dans la dépendance,\ndonc avec cette règle si vous faites un <code>make index.html</code>, <em>Make</em> va tenter de\nconstruire la dépendance <code>index.md</code> avant tout.</p>\n<p>Un problème se pose à nous avec cette syntaxe : « Bah merde, comment je récupère\nles noms de fichiers là ? »</p>\n<h1 id=\"variables-sp-ciales\"><a class=\"markdownIt-Anchor\" href=\"#variables-sp-ciales\">#</a> Variables spéciales</h1>\n<p>Superbe transition étant donné qu’on va parler ici de quelques variables\nspéciales bien pratiques !</p>\n<ul>\n<li><code>$@</code> contient le nom de la cible de la règle en cours d’exécution ;</li>\n<li><code>$^</code> contient la liste des dépendances de la règle (la flèche pointe vers la\nliste de dépendances) ;</li>\n<li><code>$&lt;</code> contient la première dépendance de la règle (la flèche pointe à gauche,\nlà où est la dépendance).</li>\n</ul>\n<p>À l’aide de celles-ci on peut du coup compléter notre exemple précédent :</p>\n<pre><code class=\"language-make\"><span class=\"hljs-variable\">%.</span>html: <span class=\"hljs-variable\">%.</span>md\n  marked <span class=\"hljs-variable\">$&lt;</span> &gt; <span class=\"hljs-variable\">$@</span>\n  [...]</code></pre>\n<h1 id=\"fonctions\"><a class=\"markdownIt-Anchor\" href=\"#fonctions\">#</a> Fonctions</h1>\n<p>Pour faciliter quelques opérations, <em>Make</em> fournit un ensemble de fonctions de\nbase. Appeler ces fonctions rappelle un peu la façon dont on lance une commande\ndans un sous-shell en Bash : <code>$(fonction argument1 argument2)</code>.</p>\n<p>Voici une petite démonstration de <code>wildcard</code>, <code>addsuffix</code> et <code>basename</code> dont\nvous vous doutez sans doute les effets :</p>\n<pre><code class=\"language-make\">SOURCES = <span class=\"hljs-variable\">$(</span>wildcard <span class=\"hljs-variable\">*.</span>md)\nDESTINATIONS = <span class=\"hljs-variable\">$(</span>addsuffix .html,<span class=\"hljs-variable\">$(</span><span class=\"hljs-keyword\">basename</span> <span class=\"hljs-variable\">${SOURCES}</span>))\n\nall: <span class=\"hljs-variable\">${DESTINATIONS}</span>\n\n<span class=\"hljs-variable\">%.</span>html: <span class=\"hljs-variable\">%.</span>md\n  marked <span class=\"hljs-variable\">$&lt;</span> &gt; <span class=\"hljs-variable\">$@</span></code></pre>\n<p>L’exemple construit dynamiquement la liste des fichiers HTML à produire à partir\nde la liste des fichiers <em>Markdown</em> disponibles puis définit une règle <code>all</code>\npermettant de tout construire d’un coup, et une règle définissant compiler\nunitairement un fichier <em>Markdown</em> vers HTML.</p>\n<p>Vous noterez qu’<code>addsuffix</code>/<code>basename</code> peut être remplacé par une substitution\nsimple comme on a vu précédemment.</p>\n<p>Je vous invite à fouiller\n<a href=\"https://www.gnu.org/software/make/manual/make.html#Functions\">le chapitre sur les fonctions du manuel</a>.</p>\n<h1 id=\"la-cible-phony\"><a class=\"markdownIt-Anchor\" href=\"#la-cible-phony\">#</a> La cible <code>.PHONY</code></h1>\n<p>Dans certains cas la cible d’une règle ne représente pas un fichier (c’était le\ncas de notre cible <code>website</code> <a href=\"#ref-phony-target\">un peu plus haut</a>).</p>\n<p>Dans ces cas-là, on va vouloir exécuter la règle quoi qu’il arrive, comme si la\ncible était tout le temps périmée.</p>\n<p>Une cible particulière existe pour ça : <code>.PHONY</code>. Toutes les dépendances de\ncette cible seront marquées comme (traduction pourrie) imposteurs (<em>phony</em>\ndonc).</p>\n<p>Pour reprendre l’exemple précédent, on déclarera donc :</p>\n<pre><code class=\"language-make\"><span class=\"hljs-class\">.PHONY</span>: website\n\nwebsite: index<span class=\"hljs-class\">.html</span> apropos<span class=\"hljs-class\">.html</span> contact<span class=\"hljs-class\">.html</span>\n  [...]</code></pre>\n<p>Désormais, chaque appel à <code>make website</code> tentera de construire les dépendances\net exécutera les commandes de la recette de la règle.</p>\n<h1 id=\"un-exemple-complet\"><a class=\"markdownIt-Anchor\" href=\"#un-exemple-complet\">#</a> Un exemple complet</h1>\n<p>L’exemple suivant permet de compiler un site Web depuis un ensemble de fichiers\n<em>Markdown</em>.</p>\n<pre><code class=\"language-make\"><span class=\"hljs-constant\">SOURCES</span> = <span class=\"hljs-variable\">$(</span>wildcard src/*.md)\n<span class=\"hljs-constant\">DESTINATIONS</span> = <span class=\"hljs-variable\">${</span><span class=\"hljs-constant\">SOURCES</span><span class=\"hljs-symbol\">:src/%</span>.md=build/%.html}\n\n<span class=\"hljs-symbol\">all:</span> <span class=\"hljs-variable\">${</span><span class=\"hljs-constant\">DESTINATIONS</span>}\n\n<span class=\"hljs-symbol\">info:</span>\n\t@ echo <span class=\"hljs-constant\">Will</span> build <span class=\"hljs-variable\">${</span><span class=\"hljs-constant\">DESTINATIONS</span>} from <span class=\"hljs-variable\">${</span><span class=\"hljs-constant\">SOURCES</span>}\n\n<span class=\"hljs-symbol\">clean:</span>\n\trm -f <span class=\"hljs-variable\">${</span><span class=\"hljs-constant\">DESTINATIONS</span>}\n\nbuild/%.<span class=\"hljs-symbol\">html:</span> src/%.md\n\tmkdir -p build\n\tmarked <span class=\"hljs-variable\">$&lt;</span> &gt; <span class=\"hljs-variable\">$@</span>\n\n.<span class=\"hljs-constant\">PHONY</span><span class=\"hljs-symbol\">:</span> all info clean</code></pre>\n<p>Vous noterez que comme on stocke nos résultats dans le dossier <code>build</code>, il faut\npotentiellement le créer quand on compile un fichier dedans.</p>\n<h1 id=\"pour-aller-plus-loin\"><a class=\"markdownIt-Anchor\" href=\"#pour-aller-plus-loin\">#</a> Pour aller plus loin</h1>\n<p>Il existe bien d’autres fonctionnalités dans <em>Make</em> (du moins dans <em>GNU Make</em>),\navec notamment :</p>\n<ul>\n<li>Les <a href=\"https://www.gnu.org/software/make/manual/make.html#Canned-Recipes\"><em>canned recipes</em></a> (recettes en boîte), permettant de\ndéfinir un bout de règle réutilisable à plusieurs endroits.</li>\n<li>Des <a href=\"https://www.gnu.org/software/make/manual/make.html#Functions\">expressions conditionnelles</a> pour avoir des tests\ndans votre <em>Makefile</em> et effectuer des traitements différents selon\nl’environnement.</li>\n<li>Les <a href=\"https://www.gnu.org/software/make/manual/make.html##Prerequisite-Types\">règles en <em>order only</em></a> qui permettent d’indiquer une\ndépendance dont la date de modification ne doit pas être prise en compte (on\npeut s’en servir pour éviter le <code>mkdir</code> dans l’exemple complet).</li>\n<li>Et <a href=\"https://www.gnu.org/software/make/manual/make.html#Functions\">plein d’autres fonctions</a> bien pratiques !</li>\n</ul>\n<p>Je vous invite aussi à jeter un coup d’œil au <a href=\"https://github.com/madx/veil/\"><em>Makefile</em> de Veil</a>, un outil que\nj’utilise pour générer des sites statiques à partir de fichiers <em>Markdown</em>\n(ah bah tiens, comme dans mes exemples, c’est rigolo). Il y a plein de\nfonctionnalités de <em>Make</em> utilisées dans ce projet et je pense que ça peut être\nsource d’idées.</p>\n<p>Voilà pour cette premier introduction à <em>Make</em>, j’espère que ça vous a plu et\nque vous êtes fin prêts à affronter tous ces bouseux avec leur système de build\nà base de streams, de brocolis et autres râteaux.</p>\n","rawBody":"\nÀ l'heure où tout le monde se rue sur des outils comme [Gulp][p!gulp],\n[Grunt][p!grunt] ou autres [Rake][gem:rake], certains irréductibles (dont je\nfais partie) ont fait le choix d'employer un des outils les plus standards et\nemblématiques dont tout développeur a entendu parler au moins une fois dans sa\nvie : *Make*.\n\nSi de prime abord on a l'impression d'un système assez archaïque (ce qui n'est\npas toujours forcément faux), on se rend rapidement compte que _Make_, couplé à\nune petite dose de scripting shell permet rapidement de mettre en place un moyen\nde compiler ses fichiers et de lancer des tâches.\n\nLes fichiers de configuration de _Make_ sont appellés _Makefiles_ (oui, ce sont\neux qui ont donné leurs noms aux `(Gulp|Grunt|Rake)files`). Les instructions\nqu'ils contiennent sont exécutées grâce à la commande `make` dans votre\nterminal.\n\n# Hello World\n\nJe vous propose de commencer en douceur par un classique _Hello World_. On va\nsimplement définir une tâche `hello-world` dont l'action va être d'afficher\n_\"Hello, world\"_ à l'écran (boooring).\n\n``` make\nhello-world:\n\techo \"Hello, world\"\n```\n\nPremière remarque importante, les indentations dans un _Makefile_ **doivent**\nêtre faites avec des tabulations. Oui, je sais, c'est moche, on dirait du\nPython, mais c'est comme ça.\n\nVoilà le genre d'erreurs qu'on se prend si on met des espaces à la place des\ntabulations :\n\n```\nMakefile:2: *** séparateur manquant . Arrêt.\n```\n\n\nPour exécuter notre commande, il nous suffit de lancer `make hello-world` dans\nun terminal :\n\n``` console\n$ make hello-world\necho \"Hello, world\"\nHello, world\n```\n\nDécortiquons un peu cette exécution. Pour chaque commande qu'il exécute, _Make_\naffiche la commande complète avant d'afficher la sortie standard de ladite\ncommande. C'est souvent très pratique car toutes les variables (on va revenir là dessus)\nqu'on met dans la commande sont résolues, et on voit clairement ce que _Make_\nexécute. Par contre, dans certains cas on s'en fout un peu, on peut alors\npréfixer la ligne à rendre silencieuse par un `@`, comme ça :\n\n``` make\nhello-world:\n\t@ echo \"Hello, world\"\n```\n\n``` console\n$ make hello-world\nHello, world\n```\n\n# Règles, cibles, recettes et pré-requis\n\nOK, jusque là c'est génial, on a un super outil pour lancer des commandes qu'on\npourrait déjà stocker dans un bête script shell. Pas super utile finalement.\n\nBon, on va corser un peu les choses et commencer par définir un peu de\nterminologie avant que vous soyez totalement largués.\n\nUn _Makefile_ est une collection de **règles**, chacune étant composée d'une\n**cible**, de **pré-requis** (ou pas) et d'une **recette**. Dans notre exemple\nprécédent, `hello-world` est la cible et `@ echo \"Hello, world\"` est la recette\nde la règle. Elle ne spécifie par contre pas de pré-requis.\n\nRelisez trois ou quatre fois le paragraphe précédent jusqu'à ce que ce soit bien\nimprimé.\n\nVous l'aurez compris, on invoque une règle depuis la ligne de commande en\nspécifiant le nom de sa cible après la commande `make`. Si on ne précise rien,\nc'est la première règle trouvée qui est exécutée (donc dans notre cas,\n`hello-world`).\n\nLes pré-requis sont déclarés après la cible. On pourrait par exemple ajouter un\n`sauter-une-ligne` comme pré-requis à notre cible `hello-world` :\n\n``` make\nhello-world: sauter-une-ligne\n\t@ echo \"Hello, world\"\n\nsauter-une-ligne:\n\t@ echo\n```\n\n``` console\n$ make hello-world\n\nHello, world\n```\n\nFacile, non ? Ok alors on peut *vraiment* attaquer les choses sérieuses.\n\n# Construire des fichiers\n\nLes pré-requis sont particulièrement pratiques quand on veut construire un\nfichier depuis un autre, ce qui est la principale action d'à peu près tout\nprocessus de compilation (paraît même que c'est grosso modo la définition de la\ncompilation).\n\nOn peut par exemple écrire un _Makefile_ nous permettant de compiler un fichier\n_Markdown_ en _HTML_ :\n\n``` make\narticle.html: article.md\n\tmarked article.md > article.html\n```\n\nCette règle spécifie simplement que pour construire le fichier `article.html`\nj'ai besoin du fichier `article.md` et que j'utilise la commande\n[`marked`][npm:marked] pour construire le fichier. Essayez, vous verrez, c'est\nmagique.\n\nLà où ça devient intéressant, c'est que si je lance de nouveau `make\narticle.html`, rien ne se passe. Eh oui, _Make_ vérifie les dates de\nmodification des pré-requis et les compare avec la date de modification de la\ncible pour savoir s'il doit où non reconstruire la cible.\n\nOn peut bien sûr aller plus loin en ayant des fichiers qui dépendent de\nfichiers, qui à leur tour dépendent de fichiers, …\n\n<a name=\"ref-phony-target\"></a>\n\nOn peut aussi avoir une cible factice qui ne représente pas un fichier et qui\nelle-même dépend de plusieurs fichiers (`website: index.html apropos.html\ncontact.html`).\n\n# Variables et substitutions\n\nLa syntaxe des variables dans un *Makefile* ressemblent beaucoup aux variables\nde votre Shell, *mais pas tout à fait*.\n\n``` make\nSOURCE = index.md\nDESTINATION = index.html\n\n${DESTINATION}: ${SOURCE}\n  marked ${SOURCE} > ${DESTINATION}\n```\n\nOn peut aussi utiliser une substitution pour s'éviter de tout retaper. La\nsyntaxe pour ça est assez simple et se passe d'explications :\n\n``` make\nSOURCE = index.md\nDESTINATION = ${SOURCE:.md=.html}\n```\n\nLà où ça devient beaucoup plus intéressant c'est qu'on peut stocker des listes\ndans une variable. Pour ça, pas vraiment d'effort à faire, il suffit de rajouter\ndes noms à la suite :\n\n``` make\nSOURCE = index.md article.md\nDESTINATION = ${SOURCE:.md=.html}\n```\n\nAttention par contre ! En faisant ça si vous utilisez `${SOURCE}` comme cible\nd'une règle, vous allez définir plusieurs règles d'un coup, ce qui n'est peut\nêtre pas ce que vous voulez.\n\nOn peut contourner ça assez simplement en utilisant une substitution au niveau\nde la règle. La syntaxe est un poil différente :\n\n``` make\n%.html: %.md\n  [...]\n```\n\nVous l'aurez compris, `%` est identique dans la cible et dans la dépendance,\ndonc avec cette règle si vous faites un `make index.html`, *Make* va tenter de\nconstruire la dépendance `index.md` avant tout.\n\nUn problème se pose à nous avec cette syntaxe : « Bah merde, comment je récupère\nles noms de fichiers là ? »\n\n# Variables spéciales\n\nSuperbe transition étant donné qu'on va parler ici de quelques variables\nspéciales bien pratiques !\n\n- `$@` contient le nom de la cible de la règle en cours d'exécution ;\n- `$^` contient la liste des dépendances de la règle (la flèche pointe vers la\n  liste de dépendances) ;\n- `$<` contient la première dépendance de la règle (la flèche pointe à gauche,\n  là où est la dépendance).\n\nÀ l'aide de celles-ci on peut du coup compléter notre exemple précédent :\n\n``` make\n%.html: %.md\n  marked $< > $@\n  [...]\n```\n\n# Fonctions\n\nPour faciliter quelques opérations, *Make* fournit un ensemble de fonctions de\nbase. Appeler ces fonctions rappelle un peu la façon dont on lance une commande\ndans un sous-shell en Bash : `$(fonction argument1 argument2)`.\n\nVoici une petite démonstration de `wildcard`, `addsuffix` et `basename` dont\nvous vous doutez sans doute les effets :\n\n``` make\nSOURCES = $(wildcard *.md)\nDESTINATIONS = $(addsuffix .html,$(basename ${SOURCES}))\n\nall: ${DESTINATIONS}\n\n%.html: %.md\n  marked $< > $@\n```\n\nL'exemple construit dynamiquement la liste des fichiers HTML à produire à partir\nde la liste des fichiers *Markdown* disponibles puis définit une règle `all`\npermettant de tout construire d'un coup, et une règle définissant compiler\nunitairement un fichier *Markdown* vers HTML.\n\nVous noterez qu'`addsuffix`/`basename` peut être remplacé par une substitution\nsimple comme on a vu précédemment.\n\nJe vous invite à fouiller\n[le chapitre sur les fonctions du manuel][man:make:functions].\n\n# La cible `.PHONY`\n\nDans certains cas la cible d'une règle ne représente pas un fichier (c'était le\ncas de notre cible `website` [un peu plus haut](#ref-phony-target)).\n\nDans ces cas-là, on va vouloir exécuter la règle quoi qu'il arrive, comme si la\ncible était tout le temps périmée.\n\nUne cible particulière existe pour ça : `.PHONY`. Toutes les dépendances de\ncette cible seront marquées comme (traduction pourrie) imposteurs (*phony*\ndonc).\n\nPour reprendre l'exemple précédent, on déclarera donc :\n\n``` make\n.PHONY: website\n\nwebsite: index.html apropos.html contact.html\n  [...]\n```\n\nDésormais, chaque appel à `make website` tentera de construire les dépendances\net exécutera les commandes de la recette de la règle.\n\n# Un exemple complet\n\nL'exemple suivant permet de compiler un site Web depuis un ensemble de fichiers\n*Markdown*.\n\n``` make\nSOURCES = $(wildcard src/*.md)\nDESTINATIONS = ${SOURCES:src/%.md=build/%.html}\n\nall: ${DESTINATIONS}\n\ninfo:\n\t@ echo Will build ${DESTINATIONS} from ${SOURCES}\n\nclean:\n\trm -f ${DESTINATIONS}\n\nbuild/%.html: src/%.md\n\tmkdir -p build\n\tmarked $< > $@\n\n.PHONY: all info clean\n```\n\nVous noterez que comme on stocke nos résultats dans le dossier `build`, il faut\npotentiellement le créer quand on compile un fichier dedans.\n\n# Pour aller plus loin\n\nIl existe bien d'autres fonctionnalités dans *Make* (du moins dans *GNU Make*),\navec notamment :\n\n- Les [*canned recipes*][man:make:canned] (recettes en boîte), permettant de\n  définir un bout de règle réutilisable à plusieurs endroits.\n- Des [expressions conditionnelles][man:make:conditions] pour avoir des tests\n  dans votre *Makefile* et effectuer des traitements différents selon\n  l'environnement.\n- Les [règles en *order only*][man:make:types] qui permettent d'indiquer une\n  dépendance dont la date de modification ne doit pas être prise en compte (on\n  peut s'en servir pour éviter le `mkdir` dans l'exemple complet).\n- Et [plein d'autres fonctions][man:make:functions] bien pratiques !\n\nJe vous invite aussi à jeter un coup d'œil au [*Makefile* de Veil][gh:veil], un outil que\nj'utilise pour générer des sites statiques à partir de fichiers *Markdown*\n(ah bah tiens, comme dans mes exemples, c'est rigolo). Il y a plein de\nfonctionnalités de *Make* utilisées dans ce projet et je pense que ça peut être\nsource d'idées.\n\nVoilà pour cette premier introduction à *Make*, j'espère que ça vous a plu et\nque vous êtes fin prêts à affronter tous ces bouseux avec leur système de build\nà base de streams, de brocolis et autres râteaux.\n\n[p!gulp]: /posts/js/introduction-gulp/\n[p!grunt]: /posts/js/premiers-pas-avec-grunt/\n[gem:rake]: https://rubygems.org/gems/rake\n[npm:marked]: https://www.npmjs.org/package/marked\n[man:make]: https://www.gnu.org/software/make/manual/make.html\n[man:make:canned]: https://www.gnu.org/software/make/manual/make.html#Canned-Recipes\n[man:make:conditions]: https://www.gnu.org/software/make/manual/make.html#Functions\n[man:make:types]: https://www.gnu.org/software/make/manual/make.html##Prerequisite-Types\n[man:make:functions]: https://www.gnu.org/software/make/manual/make.html#Functions\n[gh:veil]: https://github.com/madx/veil/\n","raw":"---\ndate: \"2014-11-03\"\ntitle: \"Laissez-vous pousser la barbe, apprenez à écrire des Makefiles\"\ntags:\n  - shell\n  - makefile\nauthors:\n  - madx\n---\n\nÀ l'heure où tout le monde se rue sur des outils comme [Gulp][p!gulp],\n[Grunt][p!grunt] ou autres [Rake][gem:rake], certains irréductibles (dont je\nfais partie) ont fait le choix d'employer un des outils les plus standards et\nemblématiques dont tout développeur a entendu parler au moins une fois dans sa\nvie : *Make*.\n\nSi de prime abord on a l'impression d'un système assez archaïque (ce qui n'est\npas toujours forcément faux), on se rend rapidement compte que _Make_, couplé à\nune petite dose de scripting shell permet rapidement de mettre en place un moyen\nde compiler ses fichiers et de lancer des tâches.\n\nLes fichiers de configuration de _Make_ sont appellés _Makefiles_ (oui, ce sont\neux qui ont donné leurs noms aux `(Gulp|Grunt|Rake)files`). Les instructions\nqu'ils contiennent sont exécutées grâce à la commande `make` dans votre\nterminal.\n\n# Hello World\n\nJe vous propose de commencer en douceur par un classique _Hello World_. On va\nsimplement définir une tâche `hello-world` dont l'action va être d'afficher\n_\"Hello, world\"_ à l'écran (boooring).\n\n``` make\nhello-world:\n\techo \"Hello, world\"\n```\n\nPremière remarque importante, les indentations dans un _Makefile_ **doivent**\nêtre faites avec des tabulations. Oui, je sais, c'est moche, on dirait du\nPython, mais c'est comme ça.\n\nVoilà le genre d'erreurs qu'on se prend si on met des espaces à la place des\ntabulations :\n\n```\nMakefile:2: *** séparateur manquant . Arrêt.\n```\n\n\nPour exécuter notre commande, il nous suffit de lancer `make hello-world` dans\nun terminal :\n\n``` console\n$ make hello-world\necho \"Hello, world\"\nHello, world\n```\n\nDécortiquons un peu cette exécution. Pour chaque commande qu'il exécute, _Make_\naffiche la commande complète avant d'afficher la sortie standard de ladite\ncommande. C'est souvent très pratique car toutes les variables (on va revenir là dessus)\nqu'on met dans la commande sont résolues, et on voit clairement ce que _Make_\nexécute. Par contre, dans certains cas on s'en fout un peu, on peut alors\npréfixer la ligne à rendre silencieuse par un `@`, comme ça :\n\n``` make\nhello-world:\n\t@ echo \"Hello, world\"\n```\n\n``` console\n$ make hello-world\nHello, world\n```\n\n# Règles, cibles, recettes et pré-requis\n\nOK, jusque là c'est génial, on a un super outil pour lancer des commandes qu'on\npourrait déjà stocker dans un bête script shell. Pas super utile finalement.\n\nBon, on va corser un peu les choses et commencer par définir un peu de\nterminologie avant que vous soyez totalement largués.\n\nUn _Makefile_ est une collection de **règles**, chacune étant composée d'une\n**cible**, de **pré-requis** (ou pas) et d'une **recette**. Dans notre exemple\nprécédent, `hello-world` est la cible et `@ echo \"Hello, world\"` est la recette\nde la règle. Elle ne spécifie par contre pas de pré-requis.\n\nRelisez trois ou quatre fois le paragraphe précédent jusqu'à ce que ce soit bien\nimprimé.\n\nVous l'aurez compris, on invoque une règle depuis la ligne de commande en\nspécifiant le nom de sa cible après la commande `make`. Si on ne précise rien,\nc'est la première règle trouvée qui est exécutée (donc dans notre cas,\n`hello-world`).\n\nLes pré-requis sont déclarés après la cible. On pourrait par exemple ajouter un\n`sauter-une-ligne` comme pré-requis à notre cible `hello-world` :\n\n``` make\nhello-world: sauter-une-ligne\n\t@ echo \"Hello, world\"\n\nsauter-une-ligne:\n\t@ echo\n```\n\n``` console\n$ make hello-world\n\nHello, world\n```\n\nFacile, non ? Ok alors on peut *vraiment* attaquer les choses sérieuses.\n\n# Construire des fichiers\n\nLes pré-requis sont particulièrement pratiques quand on veut construire un\nfichier depuis un autre, ce qui est la principale action d'à peu près tout\nprocessus de compilation (paraît même que c'est grosso modo la définition de la\ncompilation).\n\nOn peut par exemple écrire un _Makefile_ nous permettant de compiler un fichier\n_Markdown_ en _HTML_ :\n\n``` make\narticle.html: article.md\n\tmarked article.md > article.html\n```\n\nCette règle spécifie simplement que pour construire le fichier `article.html`\nj'ai besoin du fichier `article.md` et que j'utilise la commande\n[`marked`][npm:marked] pour construire le fichier. Essayez, vous verrez, c'est\nmagique.\n\nLà où ça devient intéressant, c'est que si je lance de nouveau `make\narticle.html`, rien ne se passe. Eh oui, _Make_ vérifie les dates de\nmodification des pré-requis et les compare avec la date de modification de la\ncible pour savoir s'il doit où non reconstruire la cible.\n\nOn peut bien sûr aller plus loin en ayant des fichiers qui dépendent de\nfichiers, qui à leur tour dépendent de fichiers, …\n\n<a name=\"ref-phony-target\"></a>\n\nOn peut aussi avoir une cible factice qui ne représente pas un fichier et qui\nelle-même dépend de plusieurs fichiers (`website: index.html apropos.html\ncontact.html`).\n\n# Variables et substitutions\n\nLa syntaxe des variables dans un *Makefile* ressemblent beaucoup aux variables\nde votre Shell, *mais pas tout à fait*.\n\n``` make\nSOURCE = index.md\nDESTINATION = index.html\n\n${DESTINATION}: ${SOURCE}\n  marked ${SOURCE} > ${DESTINATION}\n```\n\nOn peut aussi utiliser une substitution pour s'éviter de tout retaper. La\nsyntaxe pour ça est assez simple et se passe d'explications :\n\n``` make\nSOURCE = index.md\nDESTINATION = ${SOURCE:.md=.html}\n```\n\nLà où ça devient beaucoup plus intéressant c'est qu'on peut stocker des listes\ndans une variable. Pour ça, pas vraiment d'effort à faire, il suffit de rajouter\ndes noms à la suite :\n\n``` make\nSOURCE = index.md article.md\nDESTINATION = ${SOURCE:.md=.html}\n```\n\nAttention par contre ! En faisant ça si vous utilisez `${SOURCE}` comme cible\nd'une règle, vous allez définir plusieurs règles d'un coup, ce qui n'est peut\nêtre pas ce que vous voulez.\n\nOn peut contourner ça assez simplement en utilisant une substitution au niveau\nde la règle. La syntaxe est un poil différente :\n\n``` make\n%.html: %.md\n  [...]\n```\n\nVous l'aurez compris, `%` est identique dans la cible et dans la dépendance,\ndonc avec cette règle si vous faites un `make index.html`, *Make* va tenter de\nconstruire la dépendance `index.md` avant tout.\n\nUn problème se pose à nous avec cette syntaxe : « Bah merde, comment je récupère\nles noms de fichiers là ? »\n\n# Variables spéciales\n\nSuperbe transition étant donné qu'on va parler ici de quelques variables\nspéciales bien pratiques !\n\n- `$@` contient le nom de la cible de la règle en cours d'exécution ;\n- `$^` contient la liste des dépendances de la règle (la flèche pointe vers la\n  liste de dépendances) ;\n- `$<` contient la première dépendance de la règle (la flèche pointe à gauche,\n  là où est la dépendance).\n\nÀ l'aide de celles-ci on peut du coup compléter notre exemple précédent :\n\n``` make\n%.html: %.md\n  marked $< > $@\n  [...]\n```\n\n# Fonctions\n\nPour faciliter quelques opérations, *Make* fournit un ensemble de fonctions de\nbase. Appeler ces fonctions rappelle un peu la façon dont on lance une commande\ndans un sous-shell en Bash : `$(fonction argument1 argument2)`.\n\nVoici une petite démonstration de `wildcard`, `addsuffix` et `basename` dont\nvous vous doutez sans doute les effets :\n\n``` make\nSOURCES = $(wildcard *.md)\nDESTINATIONS = $(addsuffix .html,$(basename ${SOURCES}))\n\nall: ${DESTINATIONS}\n\n%.html: %.md\n  marked $< > $@\n```\n\nL'exemple construit dynamiquement la liste des fichiers HTML à produire à partir\nde la liste des fichiers *Markdown* disponibles puis définit une règle `all`\npermettant de tout construire d'un coup, et une règle définissant compiler\nunitairement un fichier *Markdown* vers HTML.\n\nVous noterez qu'`addsuffix`/`basename` peut être remplacé par une substitution\nsimple comme on a vu précédemment.\n\nJe vous invite à fouiller\n[le chapitre sur les fonctions du manuel][man:make:functions].\n\n# La cible `.PHONY`\n\nDans certains cas la cible d'une règle ne représente pas un fichier (c'était le\ncas de notre cible `website` [un peu plus haut](#ref-phony-target)).\n\nDans ces cas-là, on va vouloir exécuter la règle quoi qu'il arrive, comme si la\ncible était tout le temps périmée.\n\nUne cible particulière existe pour ça : `.PHONY`. Toutes les dépendances de\ncette cible seront marquées comme (traduction pourrie) imposteurs (*phony*\ndonc).\n\nPour reprendre l'exemple précédent, on déclarera donc :\n\n``` make\n.PHONY: website\n\nwebsite: index.html apropos.html contact.html\n  [...]\n```\n\nDésormais, chaque appel à `make website` tentera de construire les dépendances\net exécutera les commandes de la recette de la règle.\n\n# Un exemple complet\n\nL'exemple suivant permet de compiler un site Web depuis un ensemble de fichiers\n*Markdown*.\n\n``` make\nSOURCES = $(wildcard src/*.md)\nDESTINATIONS = ${SOURCES:src/%.md=build/%.html}\n\nall: ${DESTINATIONS}\n\ninfo:\n\t@ echo Will build ${DESTINATIONS} from ${SOURCES}\n\nclean:\n\trm -f ${DESTINATIONS}\n\nbuild/%.html: src/%.md\n\tmkdir -p build\n\tmarked $< > $@\n\n.PHONY: all info clean\n```\n\nVous noterez que comme on stocke nos résultats dans le dossier `build`, il faut\npotentiellement le créer quand on compile un fichier dedans.\n\n# Pour aller plus loin\n\nIl existe bien d'autres fonctionnalités dans *Make* (du moins dans *GNU Make*),\navec notamment :\n\n- Les [*canned recipes*][man:make:canned] (recettes en boîte), permettant de\n  définir un bout de règle réutilisable à plusieurs endroits.\n- Des [expressions conditionnelles][man:make:conditions] pour avoir des tests\n  dans votre *Makefile* et effectuer des traitements différents selon\n  l'environnement.\n- Les [règles en *order only*][man:make:types] qui permettent d'indiquer une\n  dépendance dont la date de modification ne doit pas être prise en compte (on\n  peut s'en servir pour éviter le `mkdir` dans l'exemple complet).\n- Et [plein d'autres fonctions][man:make:functions] bien pratiques !\n\nJe vous invite aussi à jeter un coup d'œil au [*Makefile* de Veil][gh:veil], un outil que\nj'utilise pour générer des sites statiques à partir de fichiers *Markdown*\n(ah bah tiens, comme dans mes exemples, c'est rigolo). Il y a plein de\nfonctionnalités de *Make* utilisées dans ce projet et je pense que ça peut être\nsource d'idées.\n\nVoilà pour cette premier introduction à *Make*, j'espère que ça vous a plu et\nque vous êtes fin prêts à affronter tous ces bouseux avec leur système de build\nà base de streams, de brocolis et autres râteaux.\n\n[p!gulp]: /posts/js/introduction-gulp/\n[p!grunt]: /posts/js/premiers-pas-avec-grunt/\n[gem:rake]: https://rubygems.org/gems/rake\n[npm:marked]: https://www.npmjs.org/package/marked\n[man:make]: https://www.gnu.org/software/make/manual/make.html\n[man:make:canned]: https://www.gnu.org/software/make/manual/make.html#Canned-Recipes\n[man:make:conditions]: https://www.gnu.org/software/make/manual/make.html#Functions\n[man:make:types]: https://www.gnu.org/software/make/manual/make.html##Prerequisite-Types\n[man:make:functions]: https://www.gnu.org/software/make/manual/make.html#Functions\n[gh:veil]: https://github.com/madx/veil/\n","__filename":"posts/shell/apprendre-les-makefiles/index.md","__url":"/posts/shell/apprendre-les-makefiles/","type":"Post"}}}</script><script src="/statinamic-client.js"></script></body></html>