<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/statinamic-client.css" /><meta data-react-helmet="true" property="og:site_name" content="Putain de code !"/><meta data-react-helmet="true" name="twitter:site" content="@putaindecode_fr"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Les Dockerfiles"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Les Dockerfiles"/><meta data-react-helmet="true" name="twitter:creator" content="@Uhsac0"/><title data-react-helmet="true">Les Dockerfiles</title></head><body><div id="statinamic"><div id="statinamic-container" data-reactid=".92nbxovd34" data-react-checksum="1462620439"><div class="r-VerticalRhythm" lang="fr" data-reactid=".92nbxovd34.0"><div data-reactid=".92nbxovd34.0.0"><noscript data-reactid=".92nbxovd34.0.0.0:0"></noscript><div class="putainde-Header" data-reactid=".92nbxovd34.0.0.0:1"><div class="r-Grid" data-reactid=".92nbxovd34.0.0.0:1.0"><div class="r-Grid-cell r-minM--1of3" data-reactid=".92nbxovd34.0.0.0:1.0.0"><a class="putainde-SiteTitle" href="/" data-reactid=".92nbxovd34.0.0.0:1.0.0.0"><span class="SVGIcon SVGIcon--cleaned putainde-Logo" data-reactid=".92nbxovd34.0.0.0:1.0.0.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="-49.5 652.5 512 512"><radialGradient id="a" cx="206.455" cy="-395.01" r="243.791" gradientTransform="matrix(.9784 0 0 -.9765 4.504 505.604)" gradientUnits="userSpaceOnUse"><stop offset=".8"/><stop offset=".95" stop-color="#333"/></radialGradient><linearGradient id="b" gradientUnits="userSpaceOnUse" x1="-34" y1="-376.331" x2="447" y2="-376.331" gradientTransform="matrix(1 0 0 -1 0 515)"><stop offset="0" stop-color="#333"/><stop offset="1"/></linearGradient><path vector-effect="non-scaling-stroke" opacity=".4" fill="url(#a)" stroke="url(#b)" stroke-miterlimit="10" d="M-33.5,891.331c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.927,239.99,236.581 c0,130.653-107.455,236.581-239.99,236.581C73.956,1127.911-33.5,1021.984-33.5,891.331z"/><linearGradient id="c" gradientUnits="userSpaceOnUse" x1="-34.5" y1="-377.169" x2="447.5" y2="-377.169" gradientTransform="matrix(1 0 0 -1 0 515)"><stop offset="0" stop-color="#333"/><stop offset="1"/></linearGradient><path opacity=".2" fill="none" stroke="url(#c)" stroke-width="2" stroke-miterlimit="10" d="M-33.5,892.169c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.928,239.99,236.581 c0,130.654-107.455,236.581-239.99,236.581C73.956,1128.75-33.5,1022.824-33.5,892.169z"/><g><linearGradient id="d" gradientUnits="userSpaceOnUse" x1="30.247" y1="427.851" x2="30.247" y2="228.319" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#FFF"/><stop offset="1" stop-color="#EEE"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#d)" stroke="#7A7A7A" stroke-miterlimit="10" d="M1,889.671c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175 c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673 c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/><path fill="none" stroke="#7A7A7A" stroke-width="2" stroke-miterlimit="10" d="M1,889.671 c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175 c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673 c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/></g><g stroke="#333333" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"><path vector-effect="non-scaling-stroke" fill="#444444" d="M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745 c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428 c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738 c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68 c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/><path fill="none" stroke-width="2" d="M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745 c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428 c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738 c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68 c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/><g><path vector-effect="non-scaling-stroke" fill="#444444" d="M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328 C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"/><path fill="none" stroke-width="2" d="M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328 C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"/></g></g><g><linearGradient id="e" gradientUnits="userSpaceOnUse" x1="87.136" y1="385.394" x2="87.136" y2="297.549" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#c5372f"/><stop offset="1" stop-color="#900"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#e)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362 c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516 c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356 c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669 c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986 s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762 c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788 c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076 c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88 c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688 c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195 L314.164,970.195z"/><path fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362 c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516 c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356 c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669 c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986 s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762 c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788 c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076 c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88 c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688 c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195 L314.164,970.195z"/><g><linearGradient id="f" gradientUnits="userSpaceOnUse" x1="-26.642" y1="385.394" x2="-26.642" y2="297.55" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#c5372f"/><stop offset="1" stop-color="#900"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#f)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362 c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993 c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495 c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501 c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006 c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74 c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933 c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82 c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459 c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669 c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/><path fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362 c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993 c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495 c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501 c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006 c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74 c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933 c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82 c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459 c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669 c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/></g></g></svg></span><span data-reactid=".92nbxovd34.0.0.0:1.0.0.0.1">Putain de code !</span></a></div><div class="r-Grid-cell r-minM--2of3" data-reactid=".92nbxovd34.0.0.0:1.0.1"><nav class="putainde-Nav" data-reactid=".92nbxovd34.0.0.0:1.0.1.0"><a class="putainde-Nav-item" href="/fr/articles" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/articles"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/articles.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M318.275,90v283.23L256,318.16l-62.275,55.07V90H318.275 M358.275,50H153.725v412L256,371.557	L358.275,462V50L358.275,50z"/></svg></span><span data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/articles.1">Articles</span></a><a class="putainde-Nav-item" href="/fr/contribuer" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/contribuer"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/contribuer.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M74.686,340.686L50,460.949l122.365-22.584L379.52,231.211l-97.68-97.68L74.686,340.686z M303.088,205.032l-181.891,181.89l-21.213-21.213l181.891-181.89L303.088,205.032z M462,148.731l-52.662,52.662l-97.682-97.68	l52.662-52.663L462,148.731z"/></svg></span><span data-reactid=".92nbxovd34.0.0.0:1.0.1.0.0:$/fr/contribuer.1">Contribuer</span></a><a href="https://github.com/putaindecode/putaindecode.io" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="GitHub" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/putaindecode=1io"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/putaindecode=1io.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a><a href="https://twitter.com/putaindecode_fr/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Twitter" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode_fr/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode_fr/.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a><a href="/discuss/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Discuter" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$/discuss/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:1.0.1.0.1:$/discuss/.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M174.059,354.374c-0.031-0.008-0.062-0.014-0.093-0.021	c-25.892,15.965-82.983,32.107-123.141,39.412c14.984-29.725,31.616-70.527,30.764-98.977C61.403,270.511,50,239.224,50,207.358	c0-89.84,87.383-155.527,185.209-155.527c97.22,0,185.211,65.193,185.211,155.527c0,1.283-0.027,2.564-0.066,3.844	c-11.285-6.088-23.506-11.037-36.622-14.68c-6.854-60.861-70.842-108.715-148.522-108.715c-82.237,0-149.141,53.631-149.141,119.551	c0,34.688,15.009,56.529,36.192,78.068c-4.306,31.98-14.646,59.781-14.646,59.781s30.542-8.064,65.253-28.275	C171.395,329.616,171.806,342.101,174.059,354.374z M461.432,460.169c-27.634-5.029-66.922-16.137-84.739-27.123	c-98.102,24.029-169.6-36.424-169.6-101.154c0-62.166,60.552-107.029,127.453-107.029c67.322,0,127.454,45.203,127.454,107.029	c0,21.928-7.85,43.457-21.738,60.164C439.674,411.634,451.121,439.712,461.432,460.169z M302.524,333.198	c0-9.648-7.841-17.469-17.515-17.469c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471	C294.684,350.669,302.524,342.847,302.524,333.198z M354.75,333.198c0-9.648-7.841-17.469-17.515-17.469	c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471C346.909,350.669,354.75,342.847,354.75,333.198z M406.339,333.198	c0-9.648-7.842-17.469-17.515-17.469c-9.674,0-17.515,7.82-17.515,17.469s7.841,17.471,17.515,17.471	C398.497,350.669,406.339,342.847,406.339,333.198z"/></svg></span></a></nav></div></div></div><div data-reactid=".92nbxovd34.0.0.0:2"><div class="putainde-Main" data-reactid=".92nbxovd34.0.0.0:2.3"><noscript data-reactid=".92nbxovd34.0.0.0:2.3.0"></noscript><article class="putainde-Post putainde-Post--customHeader" data-reactid=".92nbxovd34.0.0.0:2.3.1"><header data-reactid=".92nbxovd34.0.0.0:2.3.1.0"><div class="putainde-Post-header putainde-Post-header--custom putainde-Post-header--dark" data-reactid=".92nbxovd34.0.0.0:2.3.1.0.0"><div class="putainde-Post-header-picture" style="background-color:#c33;background:#c33 url(&quot;index.jpg&quot;) no-repeat 50% 50% / cover;" data-reactid=".92nbxovd34.0.0.0:2.3.1.0.0.0"></div><a class="putainde-Post-header-pictureCredit" href="https://www.flickr.com/photos/tristantaussac/15145365916/" data-reactid=".92nbxovd34.0.0.0:2.3.1.0.0.1">Crédit photo</a><h1 class="putainde-Title" data-reactid=".92nbxovd34.0.0.0:2.3.1.0.0.2">Les Dockerfiles</h1></div></header><div class="r-Grid" data-reactid=".92nbxovd34.0.0.0:2.3.1.1"><div class="r-Grid-cell r-minM--8of12 putainde-Post-contents" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0"><div class="putainde-Post-md" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.0"><div data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.0.0"><p>Dans <a href="/fr/articles/docker/">l’article précédent</a>, je vous ai
présenté le fonctionnement de base de Docker. Mais cela vous limitait à
l’usage des images que vous pouviez trouver sur le <a href="https://registry.hub.docker.com/">Docker
Hub</a>. Afin de vraiment pouvoir utiliser
Docker au maximum, il serait appréciable de pouvoir créer des images adaptées à
nos projets et c’est là l’utilité des Dockerfiles.</p>
<h1 id="les-dockerfiles"><a class="markdownIt-Anchor" href="#les-dockerfiles">#</a> Les Dockerfiles</h1>
<p>Les Dockerfiles sont des fichiers qui permettent de construire une image Docker
adaptée à nos besoins, étape par étape. Rentrons dans le vif du sujet en créant
une image permettant de lancer un projet JavaScript.</p>
<p>Pour commencer, créez un nouveau fichier <code>Dockerfile</code> à la racine de votre
projet.</p>
<p>La première chose à faire dans un Dockerfile est de définir de quelle image
vous héritez. Pour cet exemple, je vous propose d’utiliser une image de Debian
comme base (ce qui est une bonne pratique, car cette image
est plutôt légère en comparaison avec celle d’Ubuntu par exemple).</p>
<pre><code><span class="hljs-tag">FROM</span> <span class="hljs-tag">debian</span><span class="hljs-pseudo">:jessie</span></code></pre>
<p><code>FROM</code> permet de définir notre image de base, vous pouvez l’utiliser uniquement
une fois dans un Dockerfile.</p>
<p>Comme nous voulons créer une image pour une application JavaScript full-stack,
nous devons commencer par installer Node.js. Pour ce faire, on va télécharger
l’archive Node.js directement depuis le site officiel à l’aide de curl que nous
allons aussi devoir installer.</p>
<pre><code><span class="hljs-constant">RUN</span> apt-get update \
&amp;&amp; apt-get install -y curl \
&amp;&amp; rm -rf /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">apt</span>/<span class="hljs-title">lists</span>/*</span>

<span class="hljs-constant">RUN</span> curl -<span class="hljs-constant">LO</span> <span class="hljs-string">"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz"</span> \
&amp;&amp; tar -xzf node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz -<span class="hljs-constant">C</span> /usr/local --strip-components=<span class="hljs-number">1</span> \
&amp;&amp; rm node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz</code></pre>
<p><code>RUN</code> permet d’exécuter une commande à l’intérieur de votre image comme si vous
étiez devant un shell unix.</p>
<p>La première commande nous permet d’installer curl et de nettoyer ensuite le
gestionnaire de paquets afin que notre image soit un peu plus légère.</p>
<p>Avec la deuxième commande, nous téléchargeons le binaire de Node.js que nous
installons ensuite à ça place, et on n’oublie pas de supprimer l’archive
ensuite.</p>
<p>Vous pouvez vous demander pourquoi j’exécute plusieurs commandes sur une même
instruction <code>RUN</code> ? Eh bien, cela permet simplement de limiter le nombre
d’instructions dans votre Dockerfile ce qui rendra votre image finale plus
légère.</p>
<p>Maintenant, nous allons ajouter les sources de notre projet dans l’image et
télécharger nos dépendances.</p>
<pre><code><span class="hljs-built_in">ADD</span> <span class="bash">package.json /app/
</span>
<span class="hljs-built_in">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-built_in">RUN</span> <span class="bash">npm install
</span>
<span class="hljs-built_in">ADD</span> <span class="bash">. /app/</span></code></pre>
<p><code>ADD</code> permet d’ajouter des fichiers locaux ou distants à l’intérieur de votre
image, il est le plus souvent utilisé pour importer les sources de votre projet
ou des fichiers de configuration.</p>
<p><code>WORKDIR</code> permet de changer le répertoire courant de votre image, toutes les
commandes qui suivront seront exécutées à partir de ce répertoire.</p>
<p>Avec la dernière instruction, nous ajoutons les sources de notre projet à
l’intérieur de l’image, mais vous allez vous demander pourquoi nous ne l’avons
pas fait en même temps que l’ajout des fichiers de dépendances. Eh bien, cela
nous permet d’économiser beaucoup de temps !</p>
<p>Quand Docker crée une nouvelle image à partir d’un Dockerfile, il exécute chaque
instruction dans un conteneur, et le résultat de cette instruction est
sauvegardé sous forme de couche. Au final, une image est un assemblage de
plusieurs couches (une par instruction). Et donc, quand vous reconstruisez une
image pour la seconde fois, les instructions qui n’impliquent pas de changements
ne sont pas réexécutées, car la couche est récupérée depuis l’image précédente. Par
contre, si l’instruction implique un changement quelconque, elle est réexécutée
ainsi que toutes les instructions suivantes.</p>
<p>Dans notre cas, les sources auront tendance à beaucoup changer, et donc ne pas
retélécharger les dépendances à chaque changement dans le code est un réel gain
de temps !</p>
<p>Maintenant, nous allons indiquer quel port et dossier nous souhaitons partager
avec l’extérieur du conteneur.</p>
<pre><code><span class="hljs-built_in">EXPOSE</span> <span class="hljs-number">3000</span>

<span class="hljs-built_in">VOLUME</span> <span class="bash">/app/<span class="hljs-built_in">log</span></span></code></pre>
<p><code>EXPOSE</code> et <code>VOLUME</code> permettent respectivement d’indiquer quel port et quel
dossier nous souhaitons partager.</p>
<p>Et pour finir, nous pouvons indiquer quelle instruction doit s’exécuter au
lancement de votre conteneur grâce à l’instruction <code>CMD</code>.</p>
<pre><code>CMD <span class="hljs-keyword">node</span><span class="hljs-identifier"> </span><span class="hljs-title">server</span>.js</code></pre>
<p>Voici un résumé de notre Dockerfile :</p>
<pre><code><span class="hljs-comment"># Image de base</span>
<span class="hljs-built_in">FROM</span> debian:jessie

<span class="hljs-comment"># Installation de curl avec apt-get</span>
<span class="hljs-built_in">RUN</span> <span class="bash">apt-get update \
&amp;&amp; apt-get install -y curl \
&amp;&amp; rm -rf /var/lib/apt/lists/*
</span>
<span class="hljs-comment"># Installation de Node.js à partir du site officiel</span>
<span class="hljs-built_in">RUN</span> <span class="bash">curl -LO <span class="hljs-string">"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz"</span> \
&amp;&amp; tar -xzf node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz -C /usr/<span class="hljs-built_in">local</span> --strip-components=<span class="hljs-number">1</span> \
&amp;&amp; rm node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz
</span>
<span class="hljs-comment"># Ajout du fichier de dépendances package.json</span>
<span class="hljs-built_in">ADD</span> <span class="bash">package.json /app/
</span>
<span class="hljs-comment"># Changement du repertoire courant</span>
<span class="hljs-built_in">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-comment"># Installation des dépendances</span>
<span class="hljs-built_in">RUN</span> <span class="bash">npm install
</span>
<span class="hljs-comment"># Ajout des sources</span>
<span class="hljs-built_in">ADD</span> <span class="bash">. /app/
</span>
<span class="hljs-comment"># On expose le port 3000</span>
<span class="hljs-built_in">EXPOSE</span> <span class="hljs-number">3000</span>

<span class="hljs-comment"># On partage un dossier de log</span>
<span class="hljs-built_in">VOLUME</span> <span class="bash">/app/<span class="hljs-built_in">log</span>
</span>
<span class="hljs-comment"># On lance le serveur quand on démarre le conteneur</span>
<span class="hljs-built_in">CMD</span> <span class="bash">node server.js</span></code></pre>
<p>Avant de transformer ce Dockerfile en une image, vous devez créer un fichier de
plus, le <code>.dockerignore</code>, ce fichier permet comme un <code>.gitignore</code> de ne pas
inclure certain fichiers dans votre image Docker, et c’est très important afin
d’éviter d’inclure les dépendances de votre projet dans votre image
(<code>node_modules</code> dans notre cas) qui sont propres à votre
système, mais pas au système du conteneur. Voici à quoi votre <code>.dockerignore</code>
doit ressembler :</p>
<pre><code><span class="hljs-tag">node_modules</span>
<span class="hljs-class">.git</span></code></pre>
<p>Pour transformer ce Dockerfile en une image Docker, vous devez utiliser cette
commande :</p>
<pre><code class="language-console">$ docker build -t fullstack-js .
Sending build context to Docker daemon 4.381 MB
Sending build context to Docker daemon
Step 0 : FROM debian:jessie
 -<span class="ruby">--&gt; bf84c1d84a8f
</span>Step 1 : RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">93258459</span>a279
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">4</span>fffcf3749a2
</span>Removing intermediate container 93258459a279
Step 2 : RUN curl -LO "https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz" &amp;&amp; tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 &amp;&amp; rm node-v0.12.5-linux-x64.tar.gz
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> a3a17d584bae
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">4</span>eaa62ace8de
</span>Removing intermediate container a3a17d584bae
Step 3 : ADD *.json /app/
 -<span class="ruby">--&gt; <span class="hljs-number">1</span>e8ffd7e10a8
</span>Removing intermediate container 5db20e8b8ed2
Step 4 : WORKDIR /app
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">7</span>b84b06642b1
</span> -<span class="ruby">--&gt; <span class="hljs-number">9</span>c0e2287c34d
</span>Removing intermediate container 7b84b06642b1
Step 5 : RUN npm install
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0523</span>df6e9aac
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">6</span>d7327ebee3<span class="hljs-number">0</span>
</span>Removing intermediate container 0523df6e9aac
Step 6 : ADD . /app
 -<span class="ruby">--&gt; <span class="hljs-number">13</span>bdbe70c6fa
</span>Removing intermediate container 3c83d82c1d53
Step 7 : EXPOSE 3000
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">51</span>e252173b12
</span> -<span class="ruby">--&gt; <span class="hljs-number">6</span>c62eb1197e2
</span>Removing intermediate container 51e252173b12
Step 8 : VOLUME /app/log
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">4</span>af0bb73307b
</span> -<span class="ruby">--&gt; <span class="hljs-number">15</span>b6190de473
</span>Removing intermediate container 4af0bb73307b
Step 9 : CMD node server.js
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">9522</span>c6b9bf95
</span> -<span class="ruby">--&gt; aaf20fb25dac
</span>Removing intermediate container 9522c6b9bf95
Successfully built aaf20fb25dac</code></pre>
<p>L’option <code>-t</code> permet de nommer votre image docker, ce qui vous servira lorsque
vous voudrez lancer votre conteneur. Et le <code>.</code> est le repertoire où se trouve
le Dockerfile, dans notre cas le dossier courant.</p>
<p>Maintenant, vous pouvez lancer votre conteneur de cette manière :</p>
<pre><code class="language-console">$ docker <span class="hljs-keyword">run</span> -<span class="hljs-keyword">d</span> -p 3000:3000 -v $(<span class="hljs-keyword">pwd</span>)/<span class="hljs-keyword">log</span>:/<span class="hljs-keyword">app</span>/<span class="hljs-keyword">log</span> fullstack-js</code></pre>
<p>Cette commande permet de lancer notre image en partageant le port et un dossier
avec votre ordinateur, si vous voulez plus de détails sur le fonctionnement du
client Docker, je vous invite à lire mon <a href="/fr/articles/docker/">article
précédent</a>.</p>
<hr>
<p>Dans cet article, vous avez pu voir comment créer votre propre Dockerfile,
maintenant vous pouvez créer des images Docker parfaitement adaptées à votre
projet, et même plus. En cherchant sur Internet, vous pourrez trouver des images
Docker pour tout et n’importe quoi, comme des images pour lancer Chrome dans un
conteneur par exemple. Pour en savoir plus, je vous redirige vers le
blog de <a href="https://blog.jessfraz.com/post/docker-containers-on-the-desktop/">Jessie
Frazelle</a>.</p>
<p>Dans le prochain article, je vous parlerai de docker-compose, un outil qui
permet de lancer des applications multi-conteneurs facilement.</p>
</div></div><footer class="putainde-Post-footer" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1"><div data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0"><div class="putainde-Author undefined" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0"><a href="https://github.com/Uhsac" class="putainde-Avatar putainde-Author-picture" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/6172122?v=3&amp;s=128" alt="" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.0.0"/></a><div class="putainde-Author-description" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1"><div class="putainde-Author-title" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0"><h3 class="putainde-Author-name" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.0"><span class="putainde-WrittenBy" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.0.0">Écrit par </span><a class="putainde-Link" href="https://github.com/Uhsac" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.0.1">Uhsac</a></h3><div class="putainde-Author-social" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.1"><a href="https://twitter.com/Uhsac0" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Twitter" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a><a href="https://github.com/Uhsac" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Github" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a></div></div><p class="putainde-Author-bio" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.1"><span data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.0.0.1.1.0">Développeur touche à tout fan de JavaScript, Docker, Python et de bière</span></p></div></div></div><div class="putainde-Contributors" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2"><strong class="putainde-Contributors-label" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.0"><span data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.0.1">3 contributeurs sur cette page</span></strong><div class="r-Grid putainde-Contributors-actions" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1"><div class="r-Grid-cell r-all--1of3" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.0"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/edit/master/content/fr/articles/docker/dockerfile/index.md" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.0.0">Modifier</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.1"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/blame/master/content/fr/articles/docker/dockerfile/index.md" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.1.0">Tracer les changements</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.2"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/commits/master/content/fr/articles/docker/dockerfile/index.md" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.1.2.0">Historique</a></div></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="MoOx
(4 commits)" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:0"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:0.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt="" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:0.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Macxim
(1 commit)" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:1"><a href="http://macx.im" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:1.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1909957?v=3&amp;s=128" alt="" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:1.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Uhsac
(1 commit)" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:2"><a href="https://github.com/Uhsac" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:2.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/6172122?v=3&amp;s=128" alt="" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.1.2.2:2.0.0"/></a></div></div></footer><div data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2"><div id="disqus_thread" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.0"></div><noscript data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.1"><span data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.1.0"><span data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.1.0.0">Please enable JavaScript to view the</span><a href="http://disqus.com/?ref_noscript" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.1.0.1">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.2"><span data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.2.0">blog comments powered by</span><span class="logo-disqus" data-reactid=".92nbxovd34.0.0.0:2.3.1.1.0.2.2.1">Disqus</span></a></div></div></div></article></div></div><div class="putainde-Footer" data-reactid=".92nbxovd34.0.0.0:3"><div class="r-Grid" data-reactid=".92nbxovd34.0.0.0:3.0"><div class="r-Grid-cell r-minM--1of4" data-reactid=".92nbxovd34.0.0.0:3.0.0"><p class="putainde-Footer-text" data-reactid=".92nbxovd34.0.0.0:3.0.0.0">© 1970 - 2015 Putain de code !</p></div><div class="r-Grid-cell r-minM--2of4" data-reactid=".92nbxovd34.0.0.0:3.0.1"><ul class="putainde-Footer-list" data-reactid=".92nbxovd34.0.0.0:3.0.1.0"><li data-reactid=".92nbxovd34.0.0.0:3.0.1.0.0:$/feed=1xml"><a href="/feed.xml" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.0:$/feed=1xml.0">Flux RSS</a></li><li data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues"><a href="https://github.com/putaindecode/forum/issues" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues.0">Forum</a></li><li data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io"><a href="https://github.com/putaindecode/putaindecode.io" data-r-tooltip="GitHub" class="r-Tooltip r-Tooltip--top" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a></li><li data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/"><a href="https://twitter.com/putaindecode_fr/" data-r-tooltip="Twitter" class="r-Tooltip r-Tooltip--top" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a></li><li data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$/discuss/"><a href="/discuss/" data-r-tooltip="Discuter" class="r-Tooltip r-Tooltip--top" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$/discuss/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".92nbxovd34.0.0.0:3.0.1.0.$/discuss/.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M174.059,354.374c-0.031-0.008-0.062-0.014-0.093-0.021	c-25.892,15.965-82.983,32.107-123.141,39.412c14.984-29.725,31.616-70.527,30.764-98.977C61.403,270.511,50,239.224,50,207.358	c0-89.84,87.383-155.527,185.209-155.527c97.22,0,185.211,65.193,185.211,155.527c0,1.283-0.027,2.564-0.066,3.844	c-11.285-6.088-23.506-11.037-36.622-14.68c-6.854-60.861-70.842-108.715-148.522-108.715c-82.237,0-149.141,53.631-149.141,119.551	c0,34.688,15.009,56.529,36.192,78.068c-4.306,31.98-14.646,59.781-14.646,59.781s30.542-8.064,65.253-28.275	C171.395,329.616,171.806,342.101,174.059,354.374z M461.432,460.169c-27.634-5.029-66.922-16.137-84.739-27.123	c-98.102,24.029-169.6-36.424-169.6-101.154c0-62.166,60.552-107.029,127.453-107.029c67.322,0,127.454,45.203,127.454,107.029	c0,21.928-7.85,43.457-21.738,60.164C439.674,411.634,451.121,439.712,461.432,460.169z M302.524,333.198	c0-9.648-7.841-17.469-17.515-17.469c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471	C294.684,350.669,302.524,342.847,302.524,333.198z M354.75,333.198c0-9.648-7.841-17.469-17.515-17.469	c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471C346.909,350.669,354.75,342.847,354.75,333.198z M406.339,333.198	c0-9.648-7.842-17.469-17.515-17.469c-9.674,0-17.515,7.82-17.515,17.469s7.841,17.471,17.515,17.471	C398.497,350.669,406.339,342.847,406.339,333.198z"/></svg></span></a></li></ul></div><div class="r-Grid-cell r-minM--1of4 putainde-Footer-text--right" data-reactid=".92nbxovd34.0.0.0:3.0.2"><span class="putainde-Footer-text putainde-Footer-text--small" data-reactid=".92nbxovd34.0.0.0:3.0.2.0"><a class="" href="/en/" data-reactid=".92nbxovd34.0.0.0:3.0.2.0.0">English</a><span data-reactid=".92nbxovd34.0.0.0:3.0.2.0.1"> | </span><a class="" href="/fr/" data-reactid=".92nbxovd34.0.0.0:3.0.2.0.2">Français</a></span></div></div></div><script data-reactid=".92nbxovd34.0.0.1"></script></div></div></div></div><script>window.__INITIAL_STATE__ = {"pages":{"fr/articles/docker/dockerfile":{"head":{"layout":"Post","comments":true,"date":"2015-07-02","title":"Les Dockerfiles","tags":["docker"],"authors":["Uhsac"],"header":{"credit":"https://www.flickr.com/photos/tristantaussac/15145365916/"}},"body":"<p>Dans <a href=\"/fr/articles/docker/\">l’article précédent</a>, je vous ai\nprésenté le fonctionnement de base de Docker. Mais cela vous limitait à\nl’usage des images que vous pouviez trouver sur le <a href=\"https://registry.hub.docker.com/\">Docker\nHub</a>. Afin de vraiment pouvoir utiliser\nDocker au maximum, il serait appréciable de pouvoir créer des images adaptées à\nnos projets et c’est là l’utilité des Dockerfiles.</p>\n<h1 id=\"les-dockerfiles\"><a class=\"markdownIt-Anchor\" href=\"#les-dockerfiles\">#</a> Les Dockerfiles</h1>\n<p>Les Dockerfiles sont des fichiers qui permettent de construire une image Docker\nadaptée à nos besoins, étape par étape. Rentrons dans le vif du sujet en créant\nune image permettant de lancer un projet JavaScript.</p>\n<p>Pour commencer, créez un nouveau fichier <code>Dockerfile</code> à la racine de votre\nprojet.</p>\n<p>La première chose à faire dans un Dockerfile est de définir de quelle image\nvous héritez. Pour cet exemple, je vous propose d’utiliser une image de Debian\ncomme base (ce qui est une bonne pratique, car cette image\nest plutôt légère en comparaison avec celle d’Ubuntu par exemple).</p>\n<pre><code><span class=\"hljs-tag\">FROM</span> <span class=\"hljs-tag\">debian</span><span class=\"hljs-pseudo\">:jessie</span></code></pre>\n<p><code>FROM</code> permet de définir notre image de base, vous pouvez l’utiliser uniquement\nune fois dans un Dockerfile.</p>\n<p>Comme nous voulons créer une image pour une application JavaScript full-stack,\nnous devons commencer par installer Node.js. Pour ce faire, on va télécharger\nl’archive Node.js directement depuis le site officiel à l’aide de curl que nous\nallons aussi devoir installer.</p>\n<pre><code><span class=\"hljs-constant\">RUN</span> apt-get update \\\n&amp;&amp; apt-get install -y curl \\\n&amp;&amp; rm -rf /var/<span class=\"hljs-class\"><span class=\"hljs-keyword\">lib</span>/<span class=\"hljs-title\">apt</span>/<span class=\"hljs-title\">lists</span>/*</span>\n\n<span class=\"hljs-constant\">RUN</span> curl -<span class=\"hljs-constant\">LO</span> <span class=\"hljs-string\">\"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\"</span> \\\n&amp;&amp; tar -xzf node-v0.<span class=\"hljs-number\">12.5</span>-linux-x64.tar.gz -<span class=\"hljs-constant\">C</span> /usr/local --strip-components=<span class=\"hljs-number\">1</span> \\\n&amp;&amp; rm node-v0.<span class=\"hljs-number\">12.5</span>-linux-x64.tar.gz</code></pre>\n<p><code>RUN</code> permet d’exécuter une commande à l’intérieur de votre image comme si vous\nétiez devant un shell unix.</p>\n<p>La première commande nous permet d’installer curl et de nettoyer ensuite le\ngestionnaire de paquets afin que notre image soit un peu plus légère.</p>\n<p>Avec la deuxième commande, nous téléchargeons le binaire de Node.js que nous\ninstallons ensuite à ça place, et on n’oublie pas de supprimer l’archive\nensuite.</p>\n<p>Vous pouvez vous demander pourquoi j’exécute plusieurs commandes sur une même\ninstruction <code>RUN</code> ? Eh bien, cela permet simplement de limiter le nombre\nd’instructions dans votre Dockerfile ce qui rendra votre image finale plus\nlégère.</p>\n<p>Maintenant, nous allons ajouter les sources de notre projet dans l’image et\ntélécharger nos dépendances.</p>\n<pre><code><span class=\"hljs-built_in\">ADD</span> <span class=\"bash\">package.json /app/\n</span>\n<span class=\"hljs-built_in\">WORKDIR</span> <span class=\"bash\">/app\n</span>\n<span class=\"hljs-built_in\">RUN</span> <span class=\"bash\">npm install\n</span>\n<span class=\"hljs-built_in\">ADD</span> <span class=\"bash\">. /app/</span></code></pre>\n<p><code>ADD</code> permet d’ajouter des fichiers locaux ou distants à l’intérieur de votre\nimage, il est le plus souvent utilisé pour importer les sources de votre projet\nou des fichiers de configuration.</p>\n<p><code>WORKDIR</code> permet de changer le répertoire courant de votre image, toutes les\ncommandes qui suivront seront exécutées à partir de ce répertoire.</p>\n<p>Avec la dernière instruction, nous ajoutons les sources de notre projet à\nl’intérieur de l’image, mais vous allez vous demander pourquoi nous ne l’avons\npas fait en même temps que l’ajout des fichiers de dépendances. Eh bien, cela\nnous permet d’économiser beaucoup de temps !</p>\n<p>Quand Docker crée une nouvelle image à partir d’un Dockerfile, il exécute chaque\ninstruction dans un conteneur, et le résultat de cette instruction est\nsauvegardé sous forme de couche. Au final, une image est un assemblage de\nplusieurs couches (une par instruction). Et donc, quand vous reconstruisez une\nimage pour la seconde fois, les instructions qui n’impliquent pas de changements\nne sont pas réexécutées, car la couche est récupérée depuis l’image précédente. Par\ncontre, si l’instruction implique un changement quelconque, elle est réexécutée\nainsi que toutes les instructions suivantes.</p>\n<p>Dans notre cas, les sources auront tendance à beaucoup changer, et donc ne pas\nretélécharger les dépendances à chaque changement dans le code est un réel gain\nde temps !</p>\n<p>Maintenant, nous allons indiquer quel port et dossier nous souhaitons partager\navec l’extérieur du conteneur.</p>\n<pre><code><span class=\"hljs-built_in\">EXPOSE</span> <span class=\"hljs-number\">3000</span>\n\n<span class=\"hljs-built_in\">VOLUME</span> <span class=\"bash\">/app/<span class=\"hljs-built_in\">log</span></span></code></pre>\n<p><code>EXPOSE</code> et <code>VOLUME</code> permettent respectivement d’indiquer quel port et quel\ndossier nous souhaitons partager.</p>\n<p>Et pour finir, nous pouvons indiquer quelle instruction doit s’exécuter au\nlancement de votre conteneur grâce à l’instruction <code>CMD</code>.</p>\n<pre><code>CMD <span class=\"hljs-keyword\">node</span><span class=\"hljs-identifier\"> </span><span class=\"hljs-title\">server</span>.js</code></pre>\n<p>Voici un résumé de notre Dockerfile :</p>\n<pre><code><span class=\"hljs-comment\"># Image de base</span>\n<span class=\"hljs-built_in\">FROM</span> debian:jessie\n\n<span class=\"hljs-comment\"># Installation de curl avec apt-get</span>\n<span class=\"hljs-built_in\">RUN</span> <span class=\"bash\">apt-get update \\\n&amp;&amp; apt-get install -y curl \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n</span>\n<span class=\"hljs-comment\"># Installation de Node.js à partir du site officiel</span>\n<span class=\"hljs-built_in\">RUN</span> <span class=\"bash\">curl -LO <span class=\"hljs-string\">\"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\"</span> \\\n&amp;&amp; tar -xzf node-v0.<span class=\"hljs-number\">12.5</span>-linux-x64.tar.gz -C /usr/<span class=\"hljs-built_in\">local</span> --strip-components=<span class=\"hljs-number\">1</span> \\\n&amp;&amp; rm node-v0.<span class=\"hljs-number\">12.5</span>-linux-x64.tar.gz\n</span>\n<span class=\"hljs-comment\"># Ajout du fichier de dépendances package.json</span>\n<span class=\"hljs-built_in\">ADD</span> <span class=\"bash\">package.json /app/\n</span>\n<span class=\"hljs-comment\"># Changement du repertoire courant</span>\n<span class=\"hljs-built_in\">WORKDIR</span> <span class=\"bash\">/app\n</span>\n<span class=\"hljs-comment\"># Installation des dépendances</span>\n<span class=\"hljs-built_in\">RUN</span> <span class=\"bash\">npm install\n</span>\n<span class=\"hljs-comment\"># Ajout des sources</span>\n<span class=\"hljs-built_in\">ADD</span> <span class=\"bash\">. /app/\n</span>\n<span class=\"hljs-comment\"># On expose le port 3000</span>\n<span class=\"hljs-built_in\">EXPOSE</span> <span class=\"hljs-number\">3000</span>\n\n<span class=\"hljs-comment\"># On partage un dossier de log</span>\n<span class=\"hljs-built_in\">VOLUME</span> <span class=\"bash\">/app/<span class=\"hljs-built_in\">log</span>\n</span>\n<span class=\"hljs-comment\"># On lance le serveur quand on démarre le conteneur</span>\n<span class=\"hljs-built_in\">CMD</span> <span class=\"bash\">node server.js</span></code></pre>\n<p>Avant de transformer ce Dockerfile en une image, vous devez créer un fichier de\nplus, le <code>.dockerignore</code>, ce fichier permet comme un <code>.gitignore</code> de ne pas\ninclure certain fichiers dans votre image Docker, et c’est très important afin\nd’éviter d’inclure les dépendances de votre projet dans votre image\n(<code>node_modules</code> dans notre cas) qui sont propres à votre\nsystème, mais pas au système du conteneur. Voici à quoi votre <code>.dockerignore</code>\ndoit ressembler :</p>\n<pre><code><span class=\"hljs-tag\">node_modules</span>\n<span class=\"hljs-class\">.git</span></code></pre>\n<p>Pour transformer ce Dockerfile en une image Docker, vous devez utiliser cette\ncommande :</p>\n<pre><code class=\"language-console\">$ docker build -t fullstack-js .\nSending build context to Docker daemon 4.381 MB\nSending build context to Docker daemon\nStep 0 : FROM debian:jessie\n -<span class=\"ruby\">--&gt; bf84c1d84a8f\n</span>Step 1 : RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">93258459</span>a279\n</span>...\n -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">4</span>fffcf3749a2\n</span>Removing intermediate container 93258459a279\nStep 2 : RUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" &amp;&amp; tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 &amp;&amp; rm node-v0.12.5-linux-x64.tar.gz\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> a3a17d584bae\n</span>...\n -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">4</span>eaa62ace8de\n</span>Removing intermediate container a3a17d584bae\nStep 3 : ADD *.json /app/\n -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">1</span>e8ffd7e10a8\n</span>Removing intermediate container 5db20e8b8ed2\nStep 4 : WORKDIR /app\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">7</span>b84b06642b1\n</span> -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">9</span>c0e2287c34d\n</span>Removing intermediate container 7b84b06642b1\nStep 5 : RUN npm install\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">0523</span>df6e9aac\n</span>...\n -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">6</span>d7327ebee3<span class=\"hljs-number\">0</span>\n</span>Removing intermediate container 0523df6e9aac\nStep 6 : ADD . /app\n -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">13</span>bdbe70c6fa\n</span>Removing intermediate container 3c83d82c1d53\nStep 7 : EXPOSE 3000\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">51</span>e252173b12\n</span> -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">6</span>c62eb1197e2\n</span>Removing intermediate container 51e252173b12\nStep 8 : VOLUME /app/log\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">4</span>af0bb73307b\n</span> -<span class=\"ruby\">--&gt; <span class=\"hljs-number\">15</span>b6190de473\n</span>Removing intermediate container 4af0bb73307b\nStep 9 : CMD node server.js\n -<span class=\"ruby\">--&gt; <span class=\"hljs-constant\">Running</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">9522</span>c6b9bf95\n</span> -<span class=\"ruby\">--&gt; aaf20fb25dac\n</span>Removing intermediate container 9522c6b9bf95\nSuccessfully built aaf20fb25dac</code></pre>\n<p>L’option <code>-t</code> permet de nommer votre image docker, ce qui vous servira lorsque\nvous voudrez lancer votre conteneur. Et le <code>.</code> est le repertoire où se trouve\nle Dockerfile, dans notre cas le dossier courant.</p>\n<p>Maintenant, vous pouvez lancer votre conteneur de cette manière :</p>\n<pre><code class=\"language-console\">$ docker <span class=\"hljs-keyword\">run</span> -<span class=\"hljs-keyword\">d</span> -p 3000:3000 -v $(<span class=\"hljs-keyword\">pwd</span>)/<span class=\"hljs-keyword\">log</span>:/<span class=\"hljs-keyword\">app</span>/<span class=\"hljs-keyword\">log</span> fullstack-js</code></pre>\n<p>Cette commande permet de lancer notre image en partageant le port et un dossier\navec votre ordinateur, si vous voulez plus de détails sur le fonctionnement du\nclient Docker, je vous invite à lire mon <a href=\"/fr/articles/docker/\">article\nprécédent</a>.</p>\n<hr>\n<p>Dans cet article, vous avez pu voir comment créer votre propre Dockerfile,\nmaintenant vous pouvez créer des images Docker parfaitement adaptées à votre\nprojet, et même plus. En cherchant sur Internet, vous pourrez trouver des images\nDocker pour tout et n’importe quoi, comme des images pour lancer Chrome dans un\nconteneur par exemple. Pour en savoir plus, je vous redirige vers le\nblog de <a href=\"https://blog.jessfraz.com/post/docker-containers-on-the-desktop/\">Jessie\nFrazelle</a>.</p>\n<p>Dans le prochain article, je vous parlerai de docker-compose, un outil qui\npermet de lancer des applications multi-conteneurs facilement.</p>\n","rawBody":"\nDans [l'article précédent](/fr/articles/docker/), je vous ai\nprésenté le fonctionnement de base de Docker. Mais cela vous limitait à\nl'usage des images que vous pouviez trouver sur le [Docker\nHub](https://registry.hub.docker.com/). Afin de vraiment pouvoir utiliser\nDocker au maximum, il serait appréciable de pouvoir créer des images adaptées à\nnos projets et c'est là l'utilité des Dockerfiles.\n\n# Les Dockerfiles\n\nLes Dockerfiles sont des fichiers qui permettent de construire une image Docker\nadaptée à nos besoins, étape par étape. Rentrons dans le vif du sujet en créant\nune image permettant de lancer un projet JavaScript.\n\nPour commencer, créez un nouveau fichier `Dockerfile` à la racine de votre\nprojet.\n\nLa première chose à faire dans un Dockerfile est de définir de quelle image\nvous héritez. Pour cet exemple, je vous propose d'utiliser une image de Debian\ncomme base (ce qui est une bonne pratique, car cette image\nest plutôt légère en comparaison avec celle d'Ubuntu par exemple).\n\n```\nFROM debian:jessie\n```\n\n`FROM` permet de définir notre image de base, vous pouvez l'utiliser uniquement\nune fois dans un Dockerfile.\n\nComme nous voulons créer une image pour une application JavaScript full-stack,\nnous devons commencer par installer Node.js. Pour ce faire, on va télécharger\nl'archive Node.js directement depuis le site officiel à l'aide de curl que nous\nallons aussi devoir installer.\n\n```\nRUN apt-get update \\\n&& apt-get install -y curl \\\n&& rm -rf /var/lib/apt/lists/*\n\nRUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" \\\n&& tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 \\\n&& rm node-v0.12.5-linux-x64.tar.gz\n```\n\n`RUN` permet d'exécuter une commande à l'intérieur de votre image comme si vous\nétiez devant un shell unix.\n\nLa première commande nous permet d'installer curl et de nettoyer ensuite le\ngestionnaire de paquets afin que notre image soit un peu plus légère.\n\nAvec la deuxième commande, nous téléchargeons le binaire de Node.js que nous\ninstallons ensuite à ça place, et on n'oublie pas de supprimer l'archive\nensuite.\n\nVous pouvez vous demander pourquoi j'exécute plusieurs commandes sur une même\ninstruction `RUN` ? Eh bien, cela permet simplement de limiter le nombre\nd'instructions dans votre Dockerfile ce qui rendra votre image finale plus\nlégère.\n\nMaintenant, nous allons ajouter les sources de notre projet dans l'image et\ntélécharger nos dépendances.\n\n```\nADD package.json /app/\n\nWORKDIR /app\n\nRUN npm install\n\nADD . /app/\n```\n\n`ADD` permet d'ajouter des fichiers locaux ou distants à l'intérieur de votre\nimage, il est le plus souvent utilisé pour importer les sources de votre projet\nou des fichiers de configuration.\n\n`WORKDIR` permet de changer le répertoire courant de votre image, toutes les\ncommandes qui suivront seront exécutées à partir de ce répertoire.\n\nAvec la dernière instruction, nous ajoutons les sources de notre projet à\nl'intérieur de l'image, mais vous allez vous demander pourquoi nous ne l'avons\npas fait en même temps que l'ajout des fichiers de dépendances. Eh bien, cela\nnous permet d'économiser beaucoup de temps !\n\nQuand Docker crée une nouvelle image à partir d'un Dockerfile, il exécute chaque\ninstruction dans un conteneur, et le résultat de cette instruction est\nsauvegardé sous forme de couche. Au final, une image est un assemblage de\nplusieurs couches (une par instruction). Et donc, quand vous reconstruisez une\nimage pour la seconde fois, les instructions qui n'impliquent pas de changements\nne sont pas réexécutées, car la couche est récupérée depuis l'image précédente. Par\ncontre, si l'instruction implique un changement quelconque, elle est réexécutée\nainsi que toutes les instructions suivantes.\n\nDans notre cas, les sources auront tendance à beaucoup changer, et donc ne pas\nretélécharger les dépendances à chaque changement dans le code est un réel gain\nde temps !\n\nMaintenant, nous allons indiquer quel port et dossier nous souhaitons partager\navec l'extérieur du conteneur.\n\n```\nEXPOSE 3000\n\nVOLUME /app/log\n```\n`EXPOSE` et `VOLUME` permettent respectivement d'indiquer quel port et quel\ndossier nous souhaitons partager.\n\nEt pour finir, nous pouvons indiquer quelle instruction doit s'exécuter au\nlancement de votre conteneur grâce à l'instruction `CMD`.\n\n```\nCMD node server.js\n```\n\nVoici un résumé de notre Dockerfile :\n\n```\n# Image de base\nFROM debian:jessie\n\n# Installation de curl avec apt-get\nRUN apt-get update \\\n&& apt-get install -y curl \\\n&& rm -rf /var/lib/apt/lists/*\n\n# Installation de Node.js à partir du site officiel\nRUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" \\\n&& tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 \\\n&& rm node-v0.12.5-linux-x64.tar.gz\n\n# Ajout du fichier de dépendances package.json\nADD package.json /app/\n\n# Changement du repertoire courant\nWORKDIR /app\n\n# Installation des dépendances\nRUN npm install\n\n# Ajout des sources\nADD . /app/\n\n# On expose le port 3000\nEXPOSE 3000\n\n# On partage un dossier de log\nVOLUME /app/log\n\n# On lance le serveur quand on démarre le conteneur\nCMD node server.js\n```\n\nAvant de transformer ce Dockerfile en une image, vous devez créer un fichier de\nplus, le `.dockerignore`, ce fichier permet comme un `.gitignore` de ne pas\ninclure certain fichiers dans votre image Docker, et c'est très important afin\nd'éviter d'inclure les dépendances de votre projet dans votre image\n(`node_modules` dans notre cas) qui sont propres à votre\nsystème, mais pas au système du conteneur. Voici à quoi votre `.dockerignore`\ndoit ressembler :\n\n```\nnode_modules\n.git\n```\n\nPour transformer ce Dockerfile en une image Docker, vous devez utiliser cette\ncommande :\n\n```console\n$ docker build -t fullstack-js .\nSending build context to Docker daemon 4.381 MB\nSending build context to Docker daemon\nStep 0 : FROM debian:jessie\n ---> bf84c1d84a8f\nStep 1 : RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\n ---> Running in 93258459a279\n...\n ---> 4fffcf3749a2\nRemoving intermediate container 93258459a279\nStep 2 : RUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" && tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 && rm node-v0.12.5-linux-x64.tar.gz\n ---> Running in a3a17d584bae\n...\n ---> 4eaa62ace8de\nRemoving intermediate container a3a17d584bae\nStep 3 : ADD *.json /app/\n ---> 1e8ffd7e10a8\nRemoving intermediate container 5db20e8b8ed2\nStep 4 : WORKDIR /app\n ---> Running in 7b84b06642b1\n ---> 9c0e2287c34d\nRemoving intermediate container 7b84b06642b1\nStep 5 : RUN npm install\n ---> Running in 0523df6e9aac\n...\n ---> 6d7327ebee30\nRemoving intermediate container 0523df6e9aac\nStep 6 : ADD . /app\n ---> 13bdbe70c6fa\nRemoving intermediate container 3c83d82c1d53\nStep 7 : EXPOSE 3000\n ---> Running in 51e252173b12\n ---> 6c62eb1197e2\nRemoving intermediate container 51e252173b12\nStep 8 : VOLUME /app/log\n ---> Running in 4af0bb73307b\n ---> 15b6190de473\nRemoving intermediate container 4af0bb73307b\nStep 9 : CMD node server.js\n ---> Running in 9522c6b9bf95\n ---> aaf20fb25dac\nRemoving intermediate container 9522c6b9bf95\nSuccessfully built aaf20fb25dac\n```\n\nL'option `-t` permet de nommer votre image docker, ce qui vous servira lorsque\nvous voudrez lancer votre conteneur. Et le `.` est le repertoire où se trouve\nle Dockerfile, dans notre cas le dossier courant.\n\nMaintenant, vous pouvez lancer votre conteneur de cette manière :\n\n```console\n$ docker run -d -p 3000:3000 -v $(pwd)/log:/app/log fullstack-js\n```\n\nCette commande permet de lancer notre image en partageant le port et un dossier\navec votre ordinateur, si vous voulez plus de détails sur le fonctionnement du\nclient Docker, je vous invite à lire mon [article\nprécédent](/fr/articles/docker/).\n\n---\n\nDans cet article, vous avez pu voir comment créer votre propre Dockerfile,\nmaintenant vous pouvez créer des images Docker parfaitement adaptées à votre\nprojet, et même plus. En cherchant sur Internet, vous pourrez trouver des images\nDocker pour tout et n'importe quoi, comme des images pour lancer Chrome dans un\nconteneur par exemple. Pour en savoir plus, je vous redirige vers le\nblog de [Jessie\nFrazelle](https://blog.jessfraz.com/post/docker-containers-on-the-desktop/).\n\nDans le prochain article, je vous parlerai de docker-compose, un outil qui\npermet de lancer des applications multi-conteneurs facilement.\n","raw":"---\ndate: \"2015-07-02\"\ntitle: Les Dockerfiles\ntags:\n  - docker\nauthors:\n  - Uhsac\nheader:\n  credit: https://www.flickr.com/photos/tristantaussac/15145365916/\n---\n\nDans [l'article précédent](/fr/articles/docker/), je vous ai\nprésenté le fonctionnement de base de Docker. Mais cela vous limitait à\nl'usage des images que vous pouviez trouver sur le [Docker\nHub](https://registry.hub.docker.com/). Afin de vraiment pouvoir utiliser\nDocker au maximum, il serait appréciable de pouvoir créer des images adaptées à\nnos projets et c'est là l'utilité des Dockerfiles.\n\n# Les Dockerfiles\n\nLes Dockerfiles sont des fichiers qui permettent de construire une image Docker\nadaptée à nos besoins, étape par étape. Rentrons dans le vif du sujet en créant\nune image permettant de lancer un projet JavaScript.\n\nPour commencer, créez un nouveau fichier `Dockerfile` à la racine de votre\nprojet.\n\nLa première chose à faire dans un Dockerfile est de définir de quelle image\nvous héritez. Pour cet exemple, je vous propose d'utiliser une image de Debian\ncomme base (ce qui est une bonne pratique, car cette image\nest plutôt légère en comparaison avec celle d'Ubuntu par exemple).\n\n```\nFROM debian:jessie\n```\n\n`FROM` permet de définir notre image de base, vous pouvez l'utiliser uniquement\nune fois dans un Dockerfile.\n\nComme nous voulons créer une image pour une application JavaScript full-stack,\nnous devons commencer par installer Node.js. Pour ce faire, on va télécharger\nl'archive Node.js directement depuis le site officiel à l'aide de curl que nous\nallons aussi devoir installer.\n\n```\nRUN apt-get update \\\n&& apt-get install -y curl \\\n&& rm -rf /var/lib/apt/lists/*\n\nRUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" \\\n&& tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 \\\n&& rm node-v0.12.5-linux-x64.tar.gz\n```\n\n`RUN` permet d'exécuter une commande à l'intérieur de votre image comme si vous\nétiez devant un shell unix.\n\nLa première commande nous permet d'installer curl et de nettoyer ensuite le\ngestionnaire de paquets afin que notre image soit un peu plus légère.\n\nAvec la deuxième commande, nous téléchargeons le binaire de Node.js que nous\ninstallons ensuite à ça place, et on n'oublie pas de supprimer l'archive\nensuite.\n\nVous pouvez vous demander pourquoi j'exécute plusieurs commandes sur une même\ninstruction `RUN` ? Eh bien, cela permet simplement de limiter le nombre\nd'instructions dans votre Dockerfile ce qui rendra votre image finale plus\nlégère.\n\nMaintenant, nous allons ajouter les sources de notre projet dans l'image et\ntélécharger nos dépendances.\n\n```\nADD package.json /app/\n\nWORKDIR /app\n\nRUN npm install\n\nADD . /app/\n```\n\n`ADD` permet d'ajouter des fichiers locaux ou distants à l'intérieur de votre\nimage, il est le plus souvent utilisé pour importer les sources de votre projet\nou des fichiers de configuration.\n\n`WORKDIR` permet de changer le répertoire courant de votre image, toutes les\ncommandes qui suivront seront exécutées à partir de ce répertoire.\n\nAvec la dernière instruction, nous ajoutons les sources de notre projet à\nl'intérieur de l'image, mais vous allez vous demander pourquoi nous ne l'avons\npas fait en même temps que l'ajout des fichiers de dépendances. Eh bien, cela\nnous permet d'économiser beaucoup de temps !\n\nQuand Docker crée une nouvelle image à partir d'un Dockerfile, il exécute chaque\ninstruction dans un conteneur, et le résultat de cette instruction est\nsauvegardé sous forme de couche. Au final, une image est un assemblage de\nplusieurs couches (une par instruction). Et donc, quand vous reconstruisez une\nimage pour la seconde fois, les instructions qui n'impliquent pas de changements\nne sont pas réexécutées, car la couche est récupérée depuis l'image précédente. Par\ncontre, si l'instruction implique un changement quelconque, elle est réexécutée\nainsi que toutes les instructions suivantes.\n\nDans notre cas, les sources auront tendance à beaucoup changer, et donc ne pas\nretélécharger les dépendances à chaque changement dans le code est un réel gain\nde temps !\n\nMaintenant, nous allons indiquer quel port et dossier nous souhaitons partager\navec l'extérieur du conteneur.\n\n```\nEXPOSE 3000\n\nVOLUME /app/log\n```\n`EXPOSE` et `VOLUME` permettent respectivement d'indiquer quel port et quel\ndossier nous souhaitons partager.\n\nEt pour finir, nous pouvons indiquer quelle instruction doit s'exécuter au\nlancement de votre conteneur grâce à l'instruction `CMD`.\n\n```\nCMD node server.js\n```\n\nVoici un résumé de notre Dockerfile :\n\n```\n# Image de base\nFROM debian:jessie\n\n# Installation de curl avec apt-get\nRUN apt-get update \\\n&& apt-get install -y curl \\\n&& rm -rf /var/lib/apt/lists/*\n\n# Installation de Node.js à partir du site officiel\nRUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" \\\n&& tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 \\\n&& rm node-v0.12.5-linux-x64.tar.gz\n\n# Ajout du fichier de dépendances package.json\nADD package.json /app/\n\n# Changement du repertoire courant\nWORKDIR /app\n\n# Installation des dépendances\nRUN npm install\n\n# Ajout des sources\nADD . /app/\n\n# On expose le port 3000\nEXPOSE 3000\n\n# On partage un dossier de log\nVOLUME /app/log\n\n# On lance le serveur quand on démarre le conteneur\nCMD node server.js\n```\n\nAvant de transformer ce Dockerfile en une image, vous devez créer un fichier de\nplus, le `.dockerignore`, ce fichier permet comme un `.gitignore` de ne pas\ninclure certain fichiers dans votre image Docker, et c'est très important afin\nd'éviter d'inclure les dépendances de votre projet dans votre image\n(`node_modules` dans notre cas) qui sont propres à votre\nsystème, mais pas au système du conteneur. Voici à quoi votre `.dockerignore`\ndoit ressembler :\n\n```\nnode_modules\n.git\n```\n\nPour transformer ce Dockerfile en une image Docker, vous devez utiliser cette\ncommande :\n\n```console\n$ docker build -t fullstack-js .\nSending build context to Docker daemon 4.381 MB\nSending build context to Docker daemon\nStep 0 : FROM debian:jessie\n ---> bf84c1d84a8f\nStep 1 : RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\n ---> Running in 93258459a279\n...\n ---> 4fffcf3749a2\nRemoving intermediate container 93258459a279\nStep 2 : RUN curl -LO \"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz\" && tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 && rm node-v0.12.5-linux-x64.tar.gz\n ---> Running in a3a17d584bae\n...\n ---> 4eaa62ace8de\nRemoving intermediate container a3a17d584bae\nStep 3 : ADD *.json /app/\n ---> 1e8ffd7e10a8\nRemoving intermediate container 5db20e8b8ed2\nStep 4 : WORKDIR /app\n ---> Running in 7b84b06642b1\n ---> 9c0e2287c34d\nRemoving intermediate container 7b84b06642b1\nStep 5 : RUN npm install\n ---> Running in 0523df6e9aac\n...\n ---> 6d7327ebee30\nRemoving intermediate container 0523df6e9aac\nStep 6 : ADD . /app\n ---> 13bdbe70c6fa\nRemoving intermediate container 3c83d82c1d53\nStep 7 : EXPOSE 3000\n ---> Running in 51e252173b12\n ---> 6c62eb1197e2\nRemoving intermediate container 51e252173b12\nStep 8 : VOLUME /app/log\n ---> Running in 4af0bb73307b\n ---> 15b6190de473\nRemoving intermediate container 4af0bb73307b\nStep 9 : CMD node server.js\n ---> Running in 9522c6b9bf95\n ---> aaf20fb25dac\nRemoving intermediate container 9522c6b9bf95\nSuccessfully built aaf20fb25dac\n```\n\nL'option `-t` permet de nommer votre image docker, ce qui vous servira lorsque\nvous voudrez lancer votre conteneur. Et le `.` est le repertoire où se trouve\nle Dockerfile, dans notre cas le dossier courant.\n\nMaintenant, vous pouvez lancer votre conteneur de cette manière :\n\n```console\n$ docker run -d -p 3000:3000 -v $(pwd)/log:/app/log fullstack-js\n```\n\nCette commande permet de lancer notre image en partageant le port et un dossier\navec votre ordinateur, si vous voulez plus de détails sur le fonctionnement du\nclient Docker, je vous invite à lire mon [article\nprécédent](/fr/articles/docker/).\n\n---\n\nDans cet article, vous avez pu voir comment créer votre propre Dockerfile,\nmaintenant vous pouvez créer des images Docker parfaitement adaptées à votre\nprojet, et même plus. En cherchant sur Internet, vous pourrez trouver des images\nDocker pour tout et n'importe quoi, comme des images pour lancer Chrome dans un\nconteneur par exemple. Pour en savoir plus, je vous redirige vers le\nblog de [Jessie\nFrazelle](https://blog.jessfraz.com/post/docker-containers-on-the-desktop/).\n\nDans le prochain article, je vous parlerai de docker-compose, un outil qui\npermet de lancer des applications multi-conteneurs facilement.\n","__filename":"fr/articles/docker/dockerfile/index.md","__url":"/fr/articles/docker/dockerfile/","type":"Post"}}}</script><script src="/statinamic-client.js"></script></body></html>