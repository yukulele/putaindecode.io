<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/statinamic-client.css" /><meta data-react-helmet="true" property="og:site_name" content="Putain de code !"/><meta data-react-helmet="true" name="twitter:site" content="@putaindecode_fr"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Structurer son projet avec Revel et Mgo"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Structurer son projet avec Revel et Mgo"/><meta data-react-helmet="true" name="twitter:creator" content="@OwlyCode"/><title data-react-helmet="true">Structurer son projet avec Revel et Mgo</title></head><body><div id="statinamic"><div id="statinamic-container" data-reactid=".11p4pgszxfk" data-react-checksum="-16410233"><div class="r-VerticalRhythm" lang="fr" data-reactid=".11p4pgszxfk.0"><div data-reactid=".11p4pgszxfk.0.0"><noscript data-reactid=".11p4pgszxfk.0.0.0:0"></noscript><div class="putainde-Header" data-reactid=".11p4pgszxfk.0.0.0:1"><div class="r-Grid" data-reactid=".11p4pgszxfk.0.0.0:1.0"><div class="r-Grid-cell r-minM--1of3" data-reactid=".11p4pgszxfk.0.0.0:1.0.0"><a class="putainde-SiteTitle" href="/" data-reactid=".11p4pgszxfk.0.0.0:1.0.0.0"><span class="SVGIcon SVGIcon--cleaned putainde-Logo" data-reactid=".11p4pgszxfk.0.0.0:1.0.0.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="-49.5 652.5 512 512"><radialGradient id="a" cx="206.455" cy="-395.01" r="243.791" gradientTransform="matrix(.9784 0 0 -.9765 4.504 505.604)" gradientUnits="userSpaceOnUse"><stop offset=".8"/><stop offset=".95" stop-color="#333"/></radialGradient><linearGradient id="b" gradientUnits="userSpaceOnUse" x1="-34" y1="-376.331" x2="447" y2="-376.331" gradientTransform="matrix(1 0 0 -1 0 515)"><stop offset="0" stop-color="#333"/><stop offset="1"/></linearGradient><path vector-effect="non-scaling-stroke" opacity=".4" fill="url(#a)" stroke="url(#b)" stroke-miterlimit="10" d="M-33.5,891.331c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.927,239.99,236.581 c0,130.653-107.455,236.581-239.99,236.581C73.956,1127.911-33.5,1021.984-33.5,891.331z"/><linearGradient id="c" gradientUnits="userSpaceOnUse" x1="-34.5" y1="-377.169" x2="447.5" y2="-377.169" gradientTransform="matrix(1 0 0 -1 0 515)"><stop offset="0" stop-color="#333"/><stop offset="1"/></linearGradient><path opacity=".2" fill="none" stroke="url(#c)" stroke-width="2" stroke-miterlimit="10" d="M-33.5,892.169c0-130.655,107.456-236.581,240.01-236.581c132.535,0,239.99,105.928,239.99,236.581 c0,130.654-107.455,236.581-239.99,236.581C73.956,1128.75-33.5,1022.824-33.5,892.169z"/><g><linearGradient id="d" gradientUnits="userSpaceOnUse" x1="30.247" y1="427.851" x2="30.247" y2="228.319" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#FFF"/><stop offset="1" stop-color="#EEE"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#d)" stroke="#7A7A7A" stroke-miterlimit="10" d="M1,889.671c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175 c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673 c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/><path fill="none" stroke="#7A7A7A" stroke-width="2" stroke-miterlimit="10" d="M1,889.671 c0,112.916,92.003,204.444,205.51,204.444c1.283,0,2.565-0.019,3.828-0.04c19.795,40.379,61.281,68.175,109.258,68.175 c3.686,0,7.334-0.157,10.941-0.481c-20.401-23.875-33.307-54.348-35.07-87.771C364.424,1041.018,412,970.873,412,889.673 c0-112.894-92.004-204.423-205.49-204.423C93.004,685.247,1,776.777,1,889.671z"/></g><g stroke="#333333" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"><path vector-effect="non-scaling-stroke" fill="#444444" d="M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745 c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428 c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738 c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68 c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/><path fill="none" stroke-width="2" d="M187.747,832.25H132.5v123h27.551v-45.188h28.086c7.596,0,14.055-1.102,19.378-3.302c5.323-2.196,9.656-5.138,13.019-8.745 c3.364-3.605,5.801-7.795,7.327-12.498c1.527-4.707,2.312-9.494,2.312-14.363c0-4.978-0.785-9.807-2.312-14.428 c-1.567-4.625-4.024-8.789-7.387-12.396c-3.363-3.605-7.765-6.551-13.168-8.747C201.924,833.391,195.421,832.25,187.747,832.25z M181.225,889.979h-21.173v-37.641h21.173c3.096,0,6.107,0.227,8.996,0.704c2.891,0.478,5.428,1.411,7.635,2.738 c2.187,1.346,3.941,3.274,5.285,5.698c1.319,2.463,1.979,5.679,1.979,9.682s-0.66,7.253-1.979,9.68 c-1.344,2.486-3.1,4.395-5.285,5.742c-2.207,1.327-4.744,2.236-7.635,2.695C187.334,889.753,184.32,889.979,181.225,889.979z"/><g><path vector-effect="non-scaling-stroke" fill="#444444" d="M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328 C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"/><path fill="none" stroke-width="2" d="M247.616,944.686c0,9.709,7.241,17.064,17.44,17.064c10.202,0,17.442-7.357,17.442-17.064c0-9.25-7.24-16.328-17.441-16.328 C254.855,927.592,247.616,934.95,247.616,944.686z M280.201,881.346V831.75h-30.292v49.596l6.886,37.639h16.521L280.201,881.346z"/></g></g><g><linearGradient id="e" gradientUnits="userSpaceOnUse" x1="87.136" y1="385.394" x2="87.136" y2="297.549" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#c5372f"/><stop offset="1" stop-color="#900"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#e)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362 c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516 c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356 c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669 c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986 s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762 c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788 c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076 c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88 c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688 c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195 L314.164,970.195z"/><path fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M314.164,970.195c2.755,0,4.955-0.561,6.592-1.577c1.639-1.095,2.916-2.451,3.854-4.009c0.923-1.614,1.519-3.43,1.758-5.362 c0.22-1.996,0.382-3.806,0.382-5.465v-36.5c0-4.823,0.895-8.829,2.715-11.96c1.818-3.09,3.978-5.622,6.469-7.516 c2.48-1.873,5.058-3.27,7.773-4.106c2.733-0.818,4.952-1.354,6.706-1.496v-0.697c-1.756-0.139-3.973-0.598-6.706-1.356 c-2.718-0.735-5.293-2.111-7.773-3.984c-2.491-1.895-4.648-4.564-6.469-7.994c-1.82-3.408-2.715-7.936-2.715-13.574v-34.669 c0-1.812-0.162-3.706-0.382-5.661c-0.239-1.955-0.837-3.769-1.758-5.363c-0.938-1.574-2.218-2.93-3.854-3.986 s-3.837-1.613-6.592-1.613H302.5V786.75h28.781c2.694,0,5.753,0.676,9.169,1.953c3.414,1.316,6.632,3.25,9.591,5.762 c2.953,2.532,5.449,5.741,7.53,9.669c2.036,3.927,3.112,8.472,3.112,13.695v43.299c0,3.849,0.742,7.118,2.299,9.788 c1.56,2.691,3.417,4.844,5.614,6.459c2.157,1.615,4.875,2.751,7.392,3.43c2.496,0.678,4.652,1.016,6.512,1.016v20.076 c-1.857,0-4.016,0.379-6.512,1.058c-2.517,0.677-5.232,1.772-7.394,3.209c-2.195,1.455-4.055,3.429-5.612,5.88 c-1.557,2.453-2.299,5.423-2.299,8.932v44.697c0,5.2-1.076,9.771-3.112,13.696c-2.079,3.927-4.577,7.116-7.532,9.688 c-2.955,2.487-6.175,4.402-9.589,5.74c-3.416,1.275-6.475,1.954-9.169,1.954H302.5v-26.554L314.164,970.195L314.164,970.195 L314.164,970.195z"/><g><linearGradient id="f" gradientUnits="userSpaceOnUse" x1="-26.642" y1="385.394" x2="-26.642" y2="297.55" gradientTransform="matrix(2.3906 0 0 -2.3906 134.192 1708.07)"><stop offset="0" stop-color="#c5372f"/><stop offset="1" stop-color="#900"/></linearGradient><path vector-effect="non-scaling-stroke" fill="url(#f)" stroke="#8B2721" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362 c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993 c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495 c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501 c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006 c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74 c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933 c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82 c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459 c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669 c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/><path fill="none" stroke="#8B2721" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M98.835,813.305c-2.797,0-4.995,0.56-6.632,1.615c-1.618,1.057-2.916,2.413-3.815,3.987c-0.958,1.596-1.559,3.409-1.778,5.362 c-0.24,1.955-0.339,3.848-0.339,5.664V864.6c0,5.642-0.958,10.166-2.776,13.576c-1.818,3.43-3.975,6.1-6.432,7.993 c-2.496,1.874-5.073,3.25-7.811,3.985c-2.716,0.759-4.914,1.217-6.671,1.355v0.697c1.758,0.141,3.955,0.678,6.671,1.495 c2.737,0.838,5.314,2.233,7.811,4.106c2.456,1.895,4.614,4.426,6.432,7.517c1.817,3.13,2.776,7.136,2.776,11.96v36.501 c0,1.651,0.101,3.466,0.339,5.463c0.22,1.931,0.818,3.748,1.778,5.362c0.899,1.555,2.197,2.908,3.815,4.006 c1.637,1.021,3.835,1.58,6.632,1.58H110.5v26.552H81.716c-2.716,0-5.792-0.676-9.208-1.954c-3.396-1.337-6.592-3.251-9.548-5.74 c-2.937-2.574-5.493-5.762-7.531-9.688c-2.077-3.929-3.097-8.496-3.097-13.701v-44.692c0-3.51-0.798-6.479-2.357-8.933 c-1.558-2.449-3.415-4.424-5.573-5.879c-2.198-1.437-5.154-2.531-7.65-3.209c-2.497-0.679-4.534-1.058-6.252-1.058V881.82 c1.718,0,3.755-0.338,6.252-1.016c2.497-0.68,5.453-1.813,7.65-3.431c2.158-1.615,4.015-3.769,5.573-6.459 c1.559-2.671,2.357-5.938,2.357-9.788v-43.299c0-5.225,1.019-9.77,3.097-13.695c2.038-3.927,4.595-7.137,7.531-9.669 c2.956-2.511,6.151-4.444,9.548-5.761c3.416-1.276,6.492-1.954,9.208-1.954H110.5v26.553L98.835,813.305L98.835,813.305z"/></g></g></svg></span><span data-reactid=".11p4pgszxfk.0.0.0:1.0.0.0.1">Putain de code !</span></a></div><div class="r-Grid-cell r-minM--2of3" data-reactid=".11p4pgszxfk.0.0.0:1.0.1"><nav class="putainde-Nav" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0"><a class="putainde-Nav-item" href="/fr/articles" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/articles"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/articles.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M318.275,90v283.23L256,318.16l-62.275,55.07V90H318.275 M358.275,50H153.725v412L256,371.557	L358.275,462V50L358.275,50z"/></svg></span><span data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/articles.1">Articles</span></a><a class="putainde-Nav-item" href="/fr/contribuer" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/contribuer"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/contribuer.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M74.686,340.686L50,460.949l122.365-22.584L379.52,231.211l-97.68-97.68L74.686,340.686z M303.088,205.032l-181.891,181.89l-21.213-21.213l181.891-181.89L303.088,205.032z M462,148.731l-52.662,52.662l-97.682-97.68	l52.662-52.663L462,148.731z"/></svg></span><span data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.0:$/fr/contribuer.1">Contribuer</span></a><a href="https://github.com/putaindecode/putaindecode.io" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="GitHub" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/putaindecode=1io"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$https=2//github=1com/putaindecode/putaindecode=1io.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a><a href="https://twitter.com/putaindecode_fr/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Twitter" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode_fr/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$https=2//twitter=1com/putaindecode_fr/.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a><a href="/discuss/" class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" data-r-tooltip="Discuter" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$/discuss/"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:1.0.1.0.1:$/discuss/.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M174.059,354.374c-0.031-0.008-0.062-0.014-0.093-0.021	c-25.892,15.965-82.983,32.107-123.141,39.412c14.984-29.725,31.616-70.527,30.764-98.977C61.403,270.511,50,239.224,50,207.358	c0-89.84,87.383-155.527,185.209-155.527c97.22,0,185.211,65.193,185.211,155.527c0,1.283-0.027,2.564-0.066,3.844	c-11.285-6.088-23.506-11.037-36.622-14.68c-6.854-60.861-70.842-108.715-148.522-108.715c-82.237,0-149.141,53.631-149.141,119.551	c0,34.688,15.009,56.529,36.192,78.068c-4.306,31.98-14.646,59.781-14.646,59.781s30.542-8.064,65.253-28.275	C171.395,329.616,171.806,342.101,174.059,354.374z M461.432,460.169c-27.634-5.029-66.922-16.137-84.739-27.123	c-98.102,24.029-169.6-36.424-169.6-101.154c0-62.166,60.552-107.029,127.453-107.029c67.322,0,127.454,45.203,127.454,107.029	c0,21.928-7.85,43.457-21.738,60.164C439.674,411.634,451.121,439.712,461.432,460.169z M302.524,333.198	c0-9.648-7.841-17.469-17.515-17.469c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471	C294.684,350.669,302.524,342.847,302.524,333.198z M354.75,333.198c0-9.648-7.841-17.469-17.515-17.469	c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471C346.909,350.669,354.75,342.847,354.75,333.198z M406.339,333.198	c0-9.648-7.842-17.469-17.515-17.469c-9.674,0-17.515,7.82-17.515,17.469s7.841,17.471,17.515,17.471	C398.497,350.669,406.339,342.847,406.339,333.198z"/></svg></span></a></nav></div></div></div><div data-reactid=".11p4pgszxfk.0.0.0:2"><div class="putainde-Main" data-reactid=".11p4pgszxfk.0.0.0:2.3"><noscript data-reactid=".11p4pgszxfk.0.0.0:2.3.0"></noscript><article class="putainde-Post" data-reactid=".11p4pgszxfk.0.0.0:2.3.1"><header data-reactid=".11p4pgszxfk.0.0.0:2.3.1.0"><div class="putainde-Post-header" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.0.0"><h1 class="putainde-Title" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.0.0.2">Structurer son projet avec Revel et Mgo</h1></div></header><div class="r-Grid" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1"><div class="r-Grid-cell r-minM--8of12 putainde-Post-contents" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0"><div class="putainde-Post-md" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.0"><div data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.0.0"><p>Tu te sens l’âme d’un rebelle ? Tu veux tester de la techno atypique ? Ça tombe
bien, aujourd’hui on est là pour ça. On va toucher à un sujet pas forcément
majoritaire : le langage Go. Si tu ne connais pas les bases, je t’invite à aller
sur la <a href="http://golang.org/">homepage du projet</a> et à parcourir le
<a href="http://tour.golang.org/">go-tour anglais</a> ou
<a href="http://go-tour-fr.appspot.com/">celui en français</a>, c’est un showcase complet du langage
(et très bien fichu).
Mais si t’es juste curieux et que comprendre chaque pixel de l’article n’est pas
une obsession pour toi, tu devrais pouvoir voir de quoi on parle. Même
<a href="/#crew">Nyalab</a> y est arrivé.</p>
<p>Dans cet article on va voir <strong>comment brancher un projet go+revel à une base de
données mongodb</strong> et obtenir ainsi une base de travail sympa pour explorer le
développement web avec Go.</p>
<h2 id="les-technos-utilis-es"><a class="markdownIt-Anchor" href="#les-technos-utilis-es">#</a> Les technos utilisées</h2>
<h3 id="golang"><a class="markdownIt-Anchor" href="#golang">#</a> <a href="http://golang.org">Golang</a></h3>
<p>Langage compilé, publié en 2009, communément considéré comme “désorienté objet”,
c’est une alternative solide au C/C++ qui prône un découpage modulaire (par
“package”) des applications. Il est prédisposé à une utilisation en
développement web grâce à un package natif de gestion des réseaux et du
protocole http.</p>
<h3 id="revel"><a class="markdownIt-Anchor" href="#revel">#</a> <a href="http://robfig.github.io/revel/">Revel</a></h3>
<p>Framework développé en Go et pour Go. Il intègre tout ce qu’il faut pour
développer une application web : rechargement du code à chaud, gestion des urls
par routing, parsing des paramètres GET et POST, mécanisme de validation des
données, gestion de sessions, gestion du cache, framework de tests et même
moteur de tâches planifiées cron-likes. Il a pour particularité d’être
complètement découplé sur la partie modèle et ne fourni aucun ORM ou ODM,
juste un petit module pour gérer des transactions sur des bases sql-like.</p>
<h3 id="mgo"><a class="markdownIt-Anchor" href="#mgo">#</a> <a href="http://labix.org/mgo">Mgo</a></h3>
<p>Driver Go complet pour MongoDB, permettant d’établir la connexion et d’envoyer
des requêtes. Il dispose d’un mécanisme de mapping des documents mongodb sur les
type struct de Go.</p>
<h3 id="mongodb"><a class="markdownIt-Anchor" href="#mongodb">#</a> <a href="http://www.mongodb.org/">MongoDB</a></h3>
<p>Base de données NoSql agile et scalable, les documents sont stockés au format
json dans des collections. Le requêtage se fait en manipulant des objets et des
fonctions javascript.</p>
<h2 id="attends-attends-pourquoi-go"><a class="markdownIt-Anchor" href="#attends-attends-pourquoi-go">#</a> Attends, attends … Pourquoi Go ?</h2>
<p>Le premier vrai argument, c’est la <strong>performance</strong>. Sans rentrer dans
l’explication hyper poussée d’un <a href="http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013">benchmark</a>, on peut
affirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On
va pas risquer de vexer les autres membres du crew avec des affirmations
trollesques dès le premier post.</p>
<p>On peut aussi ajouter que Go est un <strong>langage moderne</strong>, qui inclut toutes les
<strong>petites friandises pour attirer le développeur</strong> curieux et assoiffé de
qualité. Framework de tests et outil de mise en forme du code sont natifs et
permettent à la techno d’échapper aux interminables guerres de conventions :</p>
<blockquote>
<p>De toutes façons le no-newline avant “{” c’est vraiment pour les pourritures
responsables de 99% des maux de la Terre.</p>
<ul>
<li>Un évangeliste du PSR</li>
</ul>
</blockquote>
<p>Troisième argument de choix en Go : la <strong>simplicité de parallélisation</strong>.
Personne ne viendra te dire <em>“ça c’est synchrone, sry bro.”</em> ou <em>“ça c’est
asynchrone, callback it bitch.”</em>. Tout repose sur le mot clef qui a donné son
nom au langage (ou l’inverse) <code>go</code>. Tu peux te faire un <code>go myFunc()</code> et paf !
Tout ce qui est appelé dans myFunc() saute sur un thread séparé. Et pour gérer
la synchronicité entre plusieurs thread il y a un mécanisme de canaux. Ce sont
des files FIFO (the First In is the First Out) dont la lecture est bloquante
(il existe des techniques évoluées pour faire du polling, cf
<a href="http://tour.golang.org/#68">gotour#68</a>).</p>
<p>Pour finir, cerise sur le gateau, <strong>Go compile vite</strong>, extrêment vite, et ça va
sauver ton intégrité mentale sur les gros projets. Par contre c’est foutu pour
tes pauses cafés aux prétextes douteux.</p>
<p>##Let’s Go (#nojoke, siriouz bizness)
On va partir du principe que tu as Go et Revel prêts pour la baston. On attaque
direct à sec par le classique “revel new” puisqu’on va partir de la structure de
base.</p>
<pre><code class="language-console">$ revel <span class="hljs-keyword">new</span> github.com<span class="hljs-regexp">/OwlyCode/</span>PutainDeProjet</code></pre>
<p>Là théoriquement, tu te retrouves avec la structure par défaut du boilerplate
revel, quelque chose comme ça:</p>
<ul>
<li>app
<ul>
<li>controllers</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>C’est là qu’on se met au boulot. On a de quoi faire un site complet avec ça mais
aucune trace de gestion de base de données là dedans. On commence donc par
créer un dossier <code>app/modules</code> et un sous dossier <code>app/modules/mongo</code>. C’est
dans ce dossier que va se trouver notre gestionnaire de connexion à mongoDB.
En fait ce n’est rien de plus qu’un binding entre Revel et Mgo. La technique
utilisée pour brancher ce binding côté Revel est celle des
<a href="http://robfig.github.io/revel/manual/interceptors.html">interceptors</a>.</p>
<pre><code class="language-go"><span class="hljs-keyword">package</span> mongo

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"labix.org/v2/mgo"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-comment">// Extension du controlleur.</span>
<span class="hljs-keyword">type</span> Mongo <span class="hljs-keyword">struct</span> {
    *revel.Controller
    MongoSession  *mgo.Session
    MongoDatabase *mgo.Database
}

<span class="hljs-comment">// Stockage global de la session dont la visibilité est restreinte au package.</span>
<span class="hljs-keyword">var</span> session *mgo.Session

<span class="hljs-comment">// Singleton</span>
<span class="hljs-keyword">var</span> dial sync.Once

<span class="hljs-comment">// Renvoie la session mgo en cours, si aucune n'existe, elle est créée.</span>
<span class="hljs-keyword">func</span> GetSession() *mgo.Session {

    host, _ := revel.Config.String(<span class="hljs-string">"mongo.host"</span>)

    <span class="hljs-comment">// Grâce au package sync cette fonction n'est appelée</span>
    <span class="hljs-comment">// qu'une seule fois et de manière synchrone.</span>
    dial.Do(<span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">var</span> err error
        session, err = mgo.Dial(host)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
    })

    <span class="hljs-keyword">return</span> session
}

<span class="hljs-comment">// Alimente les propriétés affectées au controlleur en clonant la session mongo.</span>
<span class="hljs-keyword">func</span> (c *Mongo) Bind() revel.Result {
    <span class="hljs-comment">// Oublie pas de mettre mongo.database dans le app.conf, genre "localhost"</span>
    databaseName, _ := revel.Config.String(<span class="hljs-string">"mongo.database"</span>)

    c.MongoSession = GetSession().Clone()
    c.MongoDatabase = c.MongoSession.DB(databaseName)

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Ferme un clone</span>
<span class="hljs-keyword">func</span> (c *Mongo) Close() revel.Result {

    <span class="hljs-keyword">if</span> c.MongoSession != <span class="hljs-constant">nil</span> {
        c.MongoSession.Close()
    }

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Fonction appelée au chargement de l'application.</span>
<span class="hljs-comment">// Elle effectue un appel a notre fonction Bind avant</span>
<span class="hljs-comment">// chaque execution du controlleur.</span>
<span class="hljs-keyword">func</span> init() {
    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)
    revel.InterceptMethod((*Mongo).Close, revel.AFTER)
    <span class="hljs-comment">// On veut aussi fermer le clone si le controlleur plante.</span>
    revel.InterceptMethod((*Mongo).Close, revel.PANIC)
}</code></pre>
<p>On a créé notre connexion à mongo, mais maintenant on va aussi l’utiliser. Dans
le contrôleur, rien de plus simple :</p>
<pre><code class="language-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

<span class="hljs-keyword">type</span> AppController <span class="hljs-keyword">struct</span> {
    *revel.Controller
    mongo.Mongo <span class="hljs-comment">// Le controlleur doit étendre notre type Mongo.</span>
}

<span class="hljs-keyword">func</span> (c *AppController) Index() revel.Result {
    usersCollection := c.MongoDatabase.C(<span class="hljs-string">"users"</span>)
    <span class="hljs-comment">// tu peux maintenant manipuler ta mgo.Collection.</span>
    <span class="hljs-comment">// [ ... ]</span>
}</code></pre>
<p>Mais tu peux aussi l’appeler ailleurs dans le projet, par exemple dans un autre
module :</p>
<pre><code class="language-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

<span class="hljs-keyword">func</span> DoStuff(user *models.User) {
    session := mongo.GetSession()
    <span class="hljs-keyword">defer</span> session.Close() <span class="hljs-comment">// Oublie pas de fermer le robinet à la fin!</span>

    <span class="hljs-comment">// tu peux maintenant manipuler ta mgo.Session.</span>
    <span class="hljs-comment">// [ ... ]</span>
}</code></pre>
<p><strong>C’est bien beau de copier coller mais …</strong></p>
<p>… tu te demandes certainement pourquoi on a créé un dossier <code>app/modules</code>, si
c’est pour n’y mettre qu’un sous dossier mongo dedans. Et c’est une très bonne
question. En fait, notre dossier mongo représente un module du projet bien
délimité. A l’avenir, si tu veux aussi brancher du mysql, et bien y a juste à
créer <code>app/modules/mysql</code>. Rien ne change pour l’existant et tu ne pollues pas
la racine de ton projet. L’autre avantage c’est qu’en un coup d’oeil dans ce
dossier tu as un aperçu direct des features de l’application.</p>
<p>Enfin, l’approche module, c’est aussi un gage de MVC. Admettons qu’on veuille
coder une application de facturation, il nous suffit de créer un dossier
<code>app/modules/invoicing</code> et de travailler dans ce dossier sur toute la partie
métier. Comme par exemple le calcul des totaux, le calcul de la TVA etc… Grâce
à cette approche, on garde des contrôleurs très fins et restreints à ce que
doit être leur rôle premier : faire communiquer le modèle et la vue.</p>
<h2 id="mod-les-globaux-mod-les-locaux"><a class="markdownIt-Anchor" href="#mod-les-globaux-mod-les-locaux">#</a> Modèles globaux, modèles locaux</h2>
<p>J’ai évoqué plus haut dans la liste des technos une feature hyper sexy de mgo :
le mapping des documents mongodb en json sur les types struct. Ce qui veut dire
qu’avec mgo, on peut définir des modèles bien structurés. Certains seront
communs à toute l’application, par exemple un utilisateur, mais d’autres seront
spécifiques à un module, comme par exemple une facture.</p>
<p>Une bonne pratique est d’approcher le rangement des modèles selon cette
structure:</p>
<ul>
<li>app
<ul>
<li>controllers</li>
<li><strong>models</strong></li>
<li>modules
<ul>
<li>invoicing
<ul>
<li>engine</li>
<li><strong>models</strong></li>
</ul>
</li>
<li>mongo</li>
</ul>
</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>Le but du jeu évidemment c’est d’avoir le moins de modèles globaux possibles.
Idéalement, si le dossier <code>app/models</code> n’existe pas ce n’est pas plus mal. Mais
attention à ne pas chercher à l’éliminer au prix de la modularité du code. Il
vaut mieux avoir un modèle explicitement déclaré comme global plutot que de
l’isoler dans un module et de rendre tous les autres modules du projet
dépendants de ce dernier.</p>
<p>Pourquoi c’est important ? C’est surtout parce que ça pose les bonnes questions
et amène les bonnes remarques. “Vais-je avoir besoin de ce modèle réellement
PARTOUT ?”, “C’est étrange j’ai créé deux modules mais au final je passe mon
temps à faire des va-et-vient de l’un à l’autre… Peut être que je devrais les
fusionner.” ou encore “90% de mon projet se trouve dans un seul module, il y a
peut être un problème.”. Mais au delà de ça, ça te permets d’isoler des modules
quasi autonomes (deux ou trois coups d’abstraction avec des interfaces et ça
roule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les
réutiliser sur un autre (svn include pour les ancêtres, git submodules pour les
autres).</p>
<h2 id="pour-aller-plus-loin"><a class="markdownIt-Anchor" href="#pour-aller-plus-loin">#</a> Pour aller plus loin</h2>
<p>Isoler distinctement le gestionnaire de connexion, la logique métier et les
modèles dans des modules est une première étape vers une architecture propre et
évolutive. Tu peux même pousser ça plus loin en utilisant des interfaces comme
je l’ai brièvement mentionné un peu plus tôt, c’est même d’ailleurs ce que je te
conseille. Si tu veux creuser ce sujet là tu trouveras pas mal de monde qui s’y
intéresse en fouinant sur le
<a href="https://groups.google.com/forum/#!forum/Golang-Nuts">groupe de discussion des utilisateurs golang</a>.
Tu as par exemple ce gars là qui a
<a href="https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ">remplacé sa dépendance à la librairie mgo par des interfaces</a>
pour éviter d’inclure le package a chaque fois et faciliter ses tests. Tu peux
envisager de faire la même chose pour découpler tes modèles et la logique métier
.</p>
<p>En attendant il ne me reste qu’à te souhaiter une bonne coding night, tu as
toutes les armes nécessaires pour gérer mongo dans ton projet revel. ;-)</p>
</div></div><footer class="putainde-Post-footer" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1"><div data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0"><div class="putainde-Author undefined" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0"><a href="http://tristan.maindron.io" class="putainde-Avatar putainde-Author-picture" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1631270?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.0.0"/></a><div class="putainde-Author-description" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1"><div class="putainde-Author-title" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0"><h3 class="putainde-Author-name" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.0"><span class="putainde-WrittenBy" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.0.0">Écrit par </span><a class="putainde-Link" href="http://tristan.maindron.io" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.0.1">OwlyCode</a></h3><div class="putainde-Author-social" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1"><a href="http://tristan.maindron.io" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Website" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M394.072,174.805l-47.916-48.023V88.472h47.916V174.805z M462,275.815h-42.508v166.213H92.508V275.815H50	L256,69.972L462,275.815z M296.847,271.972c-15.811-3.316-29.021,4.086-38.792,19.387c-9.771-15.301-22.98-22.703-38.789-19.387	c-36.746,10.876-36.336,69.543,38.582,113.047C332.908,341.761,333.59,282.848,296.847,271.972z"/></svg></span></a><a href="https://twitter.com/OwlyCode" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Twitter" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.1.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a><a href="https://github.com/OwlyCode" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Github" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.0.1.2.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a></div></div><p class="putainde-Author-bio" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.1"><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.1.0">Développeur Full Stack 100% Ubuntu, code en PHP le jour et en Go la nuit.</span><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.1.1">Entretient une liaison secrète avec AngularJS.</span><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.0.0.1.1.2">Amateur de science fiction, d&#x27;insectes et reste sur Windows pour Starcraft 2.</span></p></div></div></div><div class="putainde-Contributors" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2"><strong class="putainde-Contributors-label" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.0"><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.0.1">6 contributeurs sur cette page</span></strong><div class="r-Grid putainde-Contributors-actions" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1"><div class="r-Grid-cell r-all--1of3" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.0"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/edit/master/content/fr/articles/go/structure-revel-mgo/index.md" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.0.0">Modifier</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.1"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/blame/master/content/fr/articles/go/structure-revel-mgo/index.md" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.1.0">Tracer les changements</a></div><div class="r-Grid-cell r-all--1of3" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.2"><a class="putainde-Contributors-action" href="https://github.com/putaindecode/putaindecode.io/commits/master/content/fr/articles/go/structure-revel-mgo/index.md" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.1.2.0">Historique</a></div></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="MoOx
(10 commits)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:0"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:0.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:0.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="OwlyCode
(1 commit)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:1"><a href="http://tristan.maindron.io" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:1.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1631270?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:1.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="bloodyowl
(2 commits)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:2"><a href="http://bloodyowl.github.io" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:2.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1688645?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:2.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="kud
(1 commit)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:3"><a href="http://kud.io" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:3.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/655838?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:3.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="magsout
(1 commit)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:4"><a href="http://magsout.github.io/" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:4.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1997108?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:4.0.0"/></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Macxim
(1 commit)" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:5"><a href="http://macx.im" class="putainde-Avatar putainde-Contributor-avatar--small" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:5.0"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1909957?v=3&amp;s=128" alt="" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.1.2.2:5.0.0"/></a></div></div></footer><div data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2"><div id="disqus_thread" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.0"></div><noscript data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.1"><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.1.0"><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.1.0.0">Please enable JavaScript to view the</span><a href="http://disqus.com/?ref_noscript" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.1.0.1">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.2"><span data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.2.0">blog comments powered by</span><span class="logo-disqus" data-reactid=".11p4pgszxfk.0.0.0:2.3.1.1.0.2.2.1">Disqus</span></a></div></div></div></article></div></div><div class="putainde-Footer" data-reactid=".11p4pgszxfk.0.0.0:3"><div class="r-Grid" data-reactid=".11p4pgszxfk.0.0.0:3.0"><div class="r-Grid-cell r-minM--1of4" data-reactid=".11p4pgszxfk.0.0.0:3.0.0"><p class="putainde-Footer-text" data-reactid=".11p4pgszxfk.0.0.0:3.0.0.0">© 1970 - 2015 Putain de code !</p></div><div class="r-Grid-cell r-minM--2of4" data-reactid=".11p4pgszxfk.0.0.0:3.0.1"><ul class="putainde-Footer-list" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0"><li data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.0:$/feed=1xml"><a href="/feed.xml" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.0:$/feed=1xml.0">Flux RSS</a></li><li data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues"><a href="https://github.com/putaindecode/forum/issues" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/forum/issues.0">Forum</a></li><li data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io"><a href="https://github.com/putaindecode/putaindecode.io" data-r-tooltip="GitHub" class="r-Tooltip r-Tooltip--top" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//github=1com/putaindecode/putaindecode=1io.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M461.633,250.645l0.367-3.819c-22.896-2.221-45.667-2.419-67.79-0.73	c3.557-11.347,5.43-24.164,5.295-38.739c-0.292-30.965-10.616-55.081-26.843-75.096c3.116-18.852,0.769-37.702-5.111-56.561	c-23.187,1.898-44.053,9.493-62.634,22.686c-34.725-7.044-69.447-7.493-104.172,0c-21.673-14.627-42.956-21.802-63.909-22.686	c-6.21,20.765-7.169,41.233-1.917,61.357c-18.28,19.397-25.268,42.944-24.925,69.019c0.196,14.927,2.496,28.209,6.738,39.952	c-21.796-1.599-44.201-1.386-66.732,0.798l0.367,3.819c22.947-2.228,45.76-2.411,67.919-0.678c0.814,1.974,1.633,3.939,2.567,5.815	c-24.009-0.633-45.618,1.453-65.854,6.43l0.914,3.723c20.538-5.048,42.54-7.081,67.107-6.254	c16.246,28.864,47.52,45.824,93.063,51.205c-10.581,8.594-16.269,18.731-17.735,30.201c0,0-4.787,0-24.121,0	c-32.394,0-41.226-41.304-74.779-37.229C132,320,125.5,371.599,177.587,371.599c17.506,0,21.226,0,21.881,0v47.296	c0.234,7.643-3.093,12.754-8.469,16.297c18.654,1.884,32.674-7.43,32.674-18.854s0-56.948,0-62.518s5.833-6,5.833-6v72.992	c0.245,7.265-3.284,11.392-7.031,15.339c16.434,0.654,31.892-2.629,32.592-16.615c0,0,0-66.345,0-69.857s5.756-3.599,5.756,0	s0,66.58,0,66.58c0.169,11.8,10.361,21.367,31.953,19.893c-5.776-4.65-7.549-9.35-7.549-16.15s0-72.181,0-72.181s5.95-0.306,5.95,6	s0,50.331,0,60.881c0,13.55,16.267,19.14,34.829,18.615c-6.081-4.558-10.196-9.991-10.223-17.256v-73.217	c-0.629-10.762-5.003-20.906-13.582-30.358c41.63-6.392,71.637-23.011,86.578-52.796c24.647-0.847,46.715,1.183,67.307,6.246	l0.914-3.723c-20.394-5.014-42.181-7.096-66.416-6.415c0.839-1.891,1.67-3.789,2.389-5.785	C415.363,248.215,438.431,248.391,461.633,250.645z M114,310.023c-1.023,0-1.853-0.588-1.853-1.313c0-0.728,0.83-1.315,1.853-1.315	c1.024,0,1.854,0.588,1.854,1.315C115.854,309.436,115.024,310.023,114,310.023z M119.833,314.003c-1.137,0-2.06-0.653-2.06-1.46	s0.923-1.462,2.06-1.462s2.059,0.655,2.059,1.462S120.97,314.003,119.833,314.003z M125.75,319.172	c-1.333,0-2.415-0.766-2.415-1.712s1.082-1.714,2.415-1.714c1.333,0,2.416,0.768,2.416,1.714S127.083,319.172,125.75,319.172z M131.5,325.379c-1.56,0-2.825-0.896-2.825-2.003s1.265-2.005,2.825-2.005s2.825,0.898,2.825,2.005S133.06,325.379,131.5,325.379z M137.833,332.394c-1.733,0-3.139-0.996-3.139-2.226s1.406-2.228,3.139-2.228s3.139,0.998,3.139,2.228	S139.566,332.394,137.833,332.394z M145.167,339.517c-1.926,0-3.488-1.107-3.488-2.474s1.562-2.476,3.488-2.476	c1.925,0,3.487,1.109,3.487,2.476S147.092,339.517,145.167,339.517z M155.083,346.291c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C158.958,345.06,157.223,346.291,155.083,346.291z M167.375,349.916	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C171.25,348.685,169.515,349.916,167.375,349.916z M180.333,350.333c-2.14,0-3.875-1.231-3.875-2.749	c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751C184.208,349.102,182.473,350.333,180.333,350.333z M193.125,350.583	c-2.14,0-3.875-1.231-3.875-2.749c0-1.519,1.735-2.751,3.875-2.751s3.875,1.232,3.875,2.751	C197,349.352,195.265,350.583,193.125,350.583z"/></svg></span></a></li><li data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/"><a href="https://twitter.com/putaindecode_fr/" data-r-tooltip="Twitter" class="r-Tooltip r-Tooltip--top" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$https=2//twitter=1com/putaindecode_fr/.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462,128.223c-15.158,6.724-31.449,11.269-48.547,13.31c17.449-10.461,30.854-27.025,37.164-46.764	c-16.333,9.687-34.422,16.721-53.676,20.511c-15.418-16.428-37.386-26.691-61.698-26.691c-54.56,0-94.668,50.916-82.337,103.787	c-70.25-3.524-132.534-37.177-174.223-88.314c-22.142,37.983-11.485,87.691,26.158,112.85c-13.854-0.438-26.891-4.241-38.285-10.574	c-0.917,39.162,27.146,75.781,67.795,83.949c-11.896,3.237-24.926,3.978-38.17,1.447c10.754,33.58,41.972,58.018,78.96,58.699	C139.604,378.282,94.846,390.721,50,385.436c37.406,23.982,81.837,37.977,129.571,37.977c156.932,0,245.595-132.551,240.251-251.435	C436.339,160.061,450.668,145.174,462,128.223z"/></svg></span></a></li><li data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$/discuss/"><a href="/discuss/" data-r-tooltip="Discuter" class="r-Tooltip r-Tooltip--top" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$/discuss/.0"><span class="SVGIcon SVGIcon--cleaned putainde-Icon" data-reactid=".11p4pgszxfk.0.0.0:3.0.1.0.$/discuss/.0.0"><svg class="SVGIcon-svg SVGIcon--cleaned-svg putainde-Icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M174.059,354.374c-0.031-0.008-0.062-0.014-0.093-0.021	c-25.892,15.965-82.983,32.107-123.141,39.412c14.984-29.725,31.616-70.527,30.764-98.977C61.403,270.511,50,239.224,50,207.358	c0-89.84,87.383-155.527,185.209-155.527c97.22,0,185.211,65.193,185.211,155.527c0,1.283-0.027,2.564-0.066,3.844	c-11.285-6.088-23.506-11.037-36.622-14.68c-6.854-60.861-70.842-108.715-148.522-108.715c-82.237,0-149.141,53.631-149.141,119.551	c0,34.688,15.009,56.529,36.192,78.068c-4.306,31.98-14.646,59.781-14.646,59.781s30.542-8.064,65.253-28.275	C171.395,329.616,171.806,342.101,174.059,354.374z M461.432,460.169c-27.634-5.029-66.922-16.137-84.739-27.123	c-98.102,24.029-169.6-36.424-169.6-101.154c0-62.166,60.552-107.029,127.453-107.029c67.322,0,127.454,45.203,127.454,107.029	c0,21.928-7.85,43.457-21.738,60.164C439.674,411.634,451.121,439.712,461.432,460.169z M302.524,333.198	c0-9.648-7.841-17.469-17.515-17.469c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471	C294.684,350.669,302.524,342.847,302.524,333.198z M354.75,333.198c0-9.648-7.841-17.469-17.515-17.469	c-9.673,0-17.515,7.82-17.515,17.469s7.842,17.471,17.515,17.471C346.909,350.669,354.75,342.847,354.75,333.198z M406.339,333.198	c0-9.648-7.842-17.469-17.515-17.469c-9.674,0-17.515,7.82-17.515,17.469s7.841,17.471,17.515,17.471	C398.497,350.669,406.339,342.847,406.339,333.198z"/></svg></span></a></li></ul></div><div class="r-Grid-cell r-minM--1of4 putainde-Footer-text--right" data-reactid=".11p4pgszxfk.0.0.0:3.0.2"><span class="putainde-Footer-text putainde-Footer-text--small" data-reactid=".11p4pgszxfk.0.0.0:3.0.2.0"><a class="" href="/en/" data-reactid=".11p4pgszxfk.0.0.0:3.0.2.0.0">English</a><span data-reactid=".11p4pgszxfk.0.0.0:3.0.2.0.1"> | </span><a class="" href="/fr/" data-reactid=".11p4pgszxfk.0.0.0:3.0.2.0.2">Français</a></span></div></div></div><script data-reactid=".11p4pgszxfk.0.0.1"></script></div></div></div></div><script>window.__INITIAL_STATE__ = {"pages":{"fr/articles/go/structure-revel-mgo":{"head":{"layout":"Post","comments":true,"date":"2013-11-11","title":"Structurer son projet avec Revel et Mgo","tags":["golang","mongo","revel","mgo"],"authors":["OwlyCode"]},"body":"<p>Tu te sens l’âme d’un rebelle ? Tu veux tester de la techno atypique ? Ça tombe\nbien, aujourd’hui on est là pour ça. On va toucher à un sujet pas forcément\nmajoritaire : le langage Go. Si tu ne connais pas les bases, je t’invite à aller\nsur la <a href=\"http://golang.org/\">homepage du projet</a> et à parcourir le\n<a href=\"http://tour.golang.org/\">go-tour anglais</a> ou\n<a href=\"http://go-tour-fr.appspot.com/\">celui en français</a>, c’est un showcase complet du langage\n(et très bien fichu).\nMais si t’es juste curieux et que comprendre chaque pixel de l’article n’est pas\nune obsession pour toi, tu devrais pouvoir voir de quoi on parle. Même\n<a href=\"/#crew\">Nyalab</a> y est arrivé.</p>\n<p>Dans cet article on va voir <strong>comment brancher un projet go+revel à une base de\ndonnées mongodb</strong> et obtenir ainsi une base de travail sympa pour explorer le\ndéveloppement web avec Go.</p>\n<h2 id=\"les-technos-utilis-es\"><a class=\"markdownIt-Anchor\" href=\"#les-technos-utilis-es\">#</a> Les technos utilisées</h2>\n<h3 id=\"golang\"><a class=\"markdownIt-Anchor\" href=\"#golang\">#</a> <a href=\"http://golang.org\">Golang</a></h3>\n<p>Langage compilé, publié en 2009, communément considéré comme “désorienté objet”,\nc’est une alternative solide au C/C++ qui prône un découpage modulaire (par\n“package”) des applications. Il est prédisposé à une utilisation en\ndéveloppement web grâce à un package natif de gestion des réseaux et du\nprotocole http.</p>\n<h3 id=\"revel\"><a class=\"markdownIt-Anchor\" href=\"#revel\">#</a> <a href=\"http://robfig.github.io/revel/\">Revel</a></h3>\n<p>Framework développé en Go et pour Go. Il intègre tout ce qu’il faut pour\ndévelopper une application web : rechargement du code à chaud, gestion des urls\npar routing, parsing des paramètres GET et POST, mécanisme de validation des\ndonnées, gestion de sessions, gestion du cache, framework de tests et même\nmoteur de tâches planifiées cron-likes. Il a pour particularité d’être\ncomplètement découplé sur la partie modèle et ne fourni aucun ORM ou ODM,\njuste un petit module pour gérer des transactions sur des bases sql-like.</p>\n<h3 id=\"mgo\"><a class=\"markdownIt-Anchor\" href=\"#mgo\">#</a> <a href=\"http://labix.org/mgo\">Mgo</a></h3>\n<p>Driver Go complet pour MongoDB, permettant d’établir la connexion et d’envoyer\ndes requêtes. Il dispose d’un mécanisme de mapping des documents mongodb sur les\ntype struct de Go.</p>\n<h3 id=\"mongodb\"><a class=\"markdownIt-Anchor\" href=\"#mongodb\">#</a> <a href=\"http://www.mongodb.org/\">MongoDB</a></h3>\n<p>Base de données NoSql agile et scalable, les documents sont stockés au format\njson dans des collections. Le requêtage se fait en manipulant des objets et des\nfonctions javascript.</p>\n<h2 id=\"attends-attends-pourquoi-go\"><a class=\"markdownIt-Anchor\" href=\"#attends-attends-pourquoi-go\">#</a> Attends, attends … Pourquoi Go ?</h2>\n<p>Le premier vrai argument, c’est la <strong>performance</strong>. Sans rentrer dans\nl’explication hyper poussée d’un <a href=\"http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013\">benchmark</a>, on peut\naffirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On\nva pas risquer de vexer les autres membres du crew avec des affirmations\ntrollesques dès le premier post.</p>\n<p>On peut aussi ajouter que Go est un <strong>langage moderne</strong>, qui inclut toutes les\n<strong>petites friandises pour attirer le développeur</strong> curieux et assoiffé de\nqualité. Framework de tests et outil de mise en forme du code sont natifs et\npermettent à la techno d’échapper aux interminables guerres de conventions :</p>\n<blockquote>\n<p>De toutes façons le no-newline avant “{” c’est vraiment pour les pourritures\nresponsables de 99% des maux de la Terre.</p>\n<ul>\n<li>Un évangeliste du PSR</li>\n</ul>\n</blockquote>\n<p>Troisième argument de choix en Go : la <strong>simplicité de parallélisation</strong>.\nPersonne ne viendra te dire <em>“ça c’est synchrone, sry bro.”</em> ou <em>“ça c’est\nasynchrone, callback it bitch.”</em>. Tout repose sur le mot clef qui a donné son\nnom au langage (ou l’inverse) <code>go</code>. Tu peux te faire un <code>go myFunc()</code> et paf !\nTout ce qui est appelé dans myFunc() saute sur un thread séparé. Et pour gérer\nla synchronicité entre plusieurs thread il y a un mécanisme de canaux. Ce sont\ndes files FIFO (the First In is the First Out) dont la lecture est bloquante\n(il existe des techniques évoluées pour faire du polling, cf\n<a href=\"http://tour.golang.org/#68\">gotour#68</a>).</p>\n<p>Pour finir, cerise sur le gateau, <strong>Go compile vite</strong>, extrêment vite, et ça va\nsauver ton intégrité mentale sur les gros projets. Par contre c’est foutu pour\ntes pauses cafés aux prétextes douteux.</p>\n<p>##Let’s Go (#nojoke, siriouz bizness)\nOn va partir du principe que tu as Go et Revel prêts pour la baston. On attaque\ndirect à sec par le classique “revel new” puisqu’on va partir de la structure de\nbase.</p>\n<pre><code class=\"language-console\">$ revel <span class=\"hljs-keyword\">new</span> github.com<span class=\"hljs-regexp\">/OwlyCode/</span>PutainDeProjet</code></pre>\n<p>Là théoriquement, tu te retrouves avec la structure par défaut du boilerplate\nrevel, quelque chose comme ça:</p>\n<ul>\n<li>app\n<ul>\n<li>controllers</li>\n<li>views</li>\n</ul>\n</li>\n<li>conf</li>\n<li>messages</li>\n<li>public</li>\n<li>tests</li>\n</ul>\n<p>C’est là qu’on se met au boulot. On a de quoi faire un site complet avec ça mais\naucune trace de gestion de base de données là dedans. On commence donc par\ncréer un dossier <code>app/modules</code> et un sous dossier <code>app/modules/mongo</code>. C’est\ndans ce dossier que va se trouver notre gestionnaire de connexion à mongoDB.\nEn fait ce n’est rien de plus qu’un binding entre Revel et Mgo. La technique\nutilisée pour brancher ce binding côté Revel est celle des\n<a href=\"http://robfig.github.io/revel/manual/interceptors.html\">interceptors</a>.</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">package</span> mongo\n\n<span class=\"hljs-keyword\">import</span> (\n    <span class=\"hljs-string\">\"github.com/robfig/revel\"</span>\n    <span class=\"hljs-string\">\"labix.org/v2/mgo\"</span>\n    <span class=\"hljs-string\">\"sync\"</span>\n)\n\n<span class=\"hljs-comment\">// Extension du controlleur.</span>\n<span class=\"hljs-keyword\">type</span> Mongo <span class=\"hljs-keyword\">struct</span> {\n    *revel.Controller\n    MongoSession  *mgo.Session\n    MongoDatabase *mgo.Database\n}\n\n<span class=\"hljs-comment\">// Stockage global de la session dont la visibilité est restreinte au package.</span>\n<span class=\"hljs-keyword\">var</span> session *mgo.Session\n\n<span class=\"hljs-comment\">// Singleton</span>\n<span class=\"hljs-keyword\">var</span> dial sync.Once\n\n<span class=\"hljs-comment\">// Renvoie la session mgo en cours, si aucune n'existe, elle est créée.</span>\n<span class=\"hljs-keyword\">func</span> GetSession() *mgo.Session {\n\n    host, _ := revel.Config.String(<span class=\"hljs-string\">\"mongo.host\"</span>)\n\n    <span class=\"hljs-comment\">// Grâce au package sync cette fonction n'est appelée</span>\n    <span class=\"hljs-comment\">// qu'une seule fois et de manière synchrone.</span>\n    dial.Do(<span class=\"hljs-keyword\">func</span>() {\n        <span class=\"hljs-keyword\">var</span> err error\n        session, err = mgo.Dial(host)\n        <span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-constant\">nil</span> {\n            <span class=\"hljs-built_in\">panic</span>(err)\n        }\n    })\n\n    <span class=\"hljs-keyword\">return</span> session\n}\n\n<span class=\"hljs-comment\">// Alimente les propriétés affectées au controlleur en clonant la session mongo.</span>\n<span class=\"hljs-keyword\">func</span> (c *Mongo) Bind() revel.Result {\n    <span class=\"hljs-comment\">// Oublie pas de mettre mongo.database dans le app.conf, genre \"localhost\"</span>\n    databaseName, _ := revel.Config.String(<span class=\"hljs-string\">\"mongo.database\"</span>)\n\n    c.MongoSession = GetSession().Clone()\n    c.MongoDatabase = c.MongoSession.DB(databaseName)\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-constant\">nil</span>\n}\n\n<span class=\"hljs-comment\">// Ferme un clone</span>\n<span class=\"hljs-keyword\">func</span> (c *Mongo) Close() revel.Result {\n\n    <span class=\"hljs-keyword\">if</span> c.MongoSession != <span class=\"hljs-constant\">nil</span> {\n        c.MongoSession.Close()\n    }\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-constant\">nil</span>\n}\n\n<span class=\"hljs-comment\">// Fonction appelée au chargement de l'application.</span>\n<span class=\"hljs-comment\">// Elle effectue un appel a notre fonction Bind avant</span>\n<span class=\"hljs-comment\">// chaque execution du controlleur.</span>\n<span class=\"hljs-keyword\">func</span> init() {\n    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)\n    revel.InterceptMethod((*Mongo).Close, revel.AFTER)\n    <span class=\"hljs-comment\">// On veut aussi fermer le clone si le controlleur plante.</span>\n    revel.InterceptMethod((*Mongo).Close, revel.PANIC)\n}</code></pre>\n<p>On a créé notre connexion à mongo, mais maintenant on va aussi l’utiliser. Dans\nle contrôleur, rien de plus simple :</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> (\n    <span class=\"hljs-string\">\"github.com/robfig/revel\"</span>\n    <span class=\"hljs-string\">\"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"</span>\n)\n\n<span class=\"hljs-keyword\">type</span> AppController <span class=\"hljs-keyword\">struct</span> {\n    *revel.Controller\n    mongo.Mongo <span class=\"hljs-comment\">// Le controlleur doit étendre notre type Mongo.</span>\n}\n\n<span class=\"hljs-keyword\">func</span> (c *AppController) Index() revel.Result {\n    usersCollection := c.MongoDatabase.C(<span class=\"hljs-string\">\"users\"</span>)\n    <span class=\"hljs-comment\">// tu peux maintenant manipuler ta mgo.Collection.</span>\n    <span class=\"hljs-comment\">// [ ... ]</span>\n}</code></pre>\n<p>Mais tu peux aussi l’appeler ailleurs dans le projet, par exemple dans un autre\nmodule :</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> (\n    <span class=\"hljs-string\">\"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"</span>\n)\n\n<span class=\"hljs-keyword\">func</span> DoStuff(user *models.User) {\n    session := mongo.GetSession()\n    <span class=\"hljs-keyword\">defer</span> session.Close() <span class=\"hljs-comment\">// Oublie pas de fermer le robinet à la fin!</span>\n\n    <span class=\"hljs-comment\">// tu peux maintenant manipuler ta mgo.Session.</span>\n    <span class=\"hljs-comment\">// [ ... ]</span>\n}</code></pre>\n<p><strong>C’est bien beau de copier coller mais …</strong></p>\n<p>… tu te demandes certainement pourquoi on a créé un dossier <code>app/modules</code>, si\nc’est pour n’y mettre qu’un sous dossier mongo dedans. Et c’est une très bonne\nquestion. En fait, notre dossier mongo représente un module du projet bien\ndélimité. A l’avenir, si tu veux aussi brancher du mysql, et bien y a juste à\ncréer <code>app/modules/mysql</code>. Rien ne change pour l’existant et tu ne pollues pas\nla racine de ton projet. L’autre avantage c’est qu’en un coup d’oeil dans ce\ndossier tu as un aperçu direct des features de l’application.</p>\n<p>Enfin, l’approche module, c’est aussi un gage de MVC. Admettons qu’on veuille\ncoder une application de facturation, il nous suffit de créer un dossier\n<code>app/modules/invoicing</code> et de travailler dans ce dossier sur toute la partie\nmétier. Comme par exemple le calcul des totaux, le calcul de la TVA etc… Grâce\nà cette approche, on garde des contrôleurs très fins et restreints à ce que\ndoit être leur rôle premier : faire communiquer le modèle et la vue.</p>\n<h2 id=\"mod-les-globaux-mod-les-locaux\"><a class=\"markdownIt-Anchor\" href=\"#mod-les-globaux-mod-les-locaux\">#</a> Modèles globaux, modèles locaux</h2>\n<p>J’ai évoqué plus haut dans la liste des technos une feature hyper sexy de mgo :\nle mapping des documents mongodb en json sur les types struct. Ce qui veut dire\nqu’avec mgo, on peut définir des modèles bien structurés. Certains seront\ncommuns à toute l’application, par exemple un utilisateur, mais d’autres seront\nspécifiques à un module, comme par exemple une facture.</p>\n<p>Une bonne pratique est d’approcher le rangement des modèles selon cette\nstructure:</p>\n<ul>\n<li>app\n<ul>\n<li>controllers</li>\n<li><strong>models</strong></li>\n<li>modules\n<ul>\n<li>invoicing\n<ul>\n<li>engine</li>\n<li><strong>models</strong></li>\n</ul>\n</li>\n<li>mongo</li>\n</ul>\n</li>\n<li>views</li>\n</ul>\n</li>\n<li>conf</li>\n<li>messages</li>\n<li>public</li>\n<li>tests</li>\n</ul>\n<p>Le but du jeu évidemment c’est d’avoir le moins de modèles globaux possibles.\nIdéalement, si le dossier <code>app/models</code> n’existe pas ce n’est pas plus mal. Mais\nattention à ne pas chercher à l’éliminer au prix de la modularité du code. Il\nvaut mieux avoir un modèle explicitement déclaré comme global plutot que de\nl’isoler dans un module et de rendre tous les autres modules du projet\ndépendants de ce dernier.</p>\n<p>Pourquoi c’est important ? C’est surtout parce que ça pose les bonnes questions\net amène les bonnes remarques. “Vais-je avoir besoin de ce modèle réellement\nPARTOUT ?”, “C’est étrange j’ai créé deux modules mais au final je passe mon\ntemps à faire des va-et-vient de l’un à l’autre… Peut être que je devrais les\nfusionner.” ou encore “90% de mon projet se trouve dans un seul module, il y a\npeut être un problème.”. Mais au delà de ça, ça te permets d’isoler des modules\nquasi autonomes (deux ou trois coups d’abstraction avec des interfaces et ça\nroule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les\nréutiliser sur un autre (svn include pour les ancêtres, git submodules pour les\nautres).</p>\n<h2 id=\"pour-aller-plus-loin\"><a class=\"markdownIt-Anchor\" href=\"#pour-aller-plus-loin\">#</a> Pour aller plus loin</h2>\n<p>Isoler distinctement le gestionnaire de connexion, la logique métier et les\nmodèles dans des modules est une première étape vers une architecture propre et\névolutive. Tu peux même pousser ça plus loin en utilisant des interfaces comme\nje l’ai brièvement mentionné un peu plus tôt, c’est même d’ailleurs ce que je te\nconseille. Si tu veux creuser ce sujet là tu trouveras pas mal de monde qui s’y\nintéresse en fouinant sur le\n<a href=\"https://groups.google.com/forum/#!forum/Golang-Nuts\">groupe de discussion des utilisateurs golang</a>.\nTu as par exemple ce gars là qui a\n<a href=\"https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ\">remplacé sa dépendance à la librairie mgo par des interfaces</a>\npour éviter d’inclure le package a chaque fois et faciliter ses tests. Tu peux\nenvisager de faire la même chose pour découpler tes modèles et la logique métier\n.</p>\n<p>En attendant il ne me reste qu’à te souhaiter une bonne coding night, tu as\ntoutes les armes nécessaires pour gérer mongo dans ton projet revel. ;-)</p>\n","rawBody":"\nTu te sens l’âme d’un rebelle ? Tu veux tester de la techno atypique ? Ça tombe\nbien, aujourd’hui on est là pour ça. On va toucher à un sujet pas forcément\nmajoritaire : le langage Go. Si tu ne connais pas les bases, je t’invite à aller\nsur la [homepage du projet](http://golang.org/) et à parcourir le\n[go-tour anglais](http://tour.golang.org/) ou\n[celui en français](http://go-tour-fr.appspot.com/), c'est un showcase complet du langage\n(et très bien fichu).\nMais si t'es juste curieux et que comprendre chaque pixel de l'article n'est pas\nune obsession pour toi, tu devrais pouvoir voir de quoi on parle. Même\n[Nyalab](/#crew) y est arrivé.\n\nDans cet article on va voir **comment brancher un projet go+revel à une base de\ndonnées mongodb** et obtenir ainsi une base de travail sympa pour explorer le\ndéveloppement web avec Go.\n\n## Les technos utilisées\n\n### [Golang](http://golang.org)\n\nLangage compilé, publié en 2009, communément considéré comme “désorienté objet”,\nc’est une alternative solide au C/C++ qui prône un découpage modulaire (par\n“package”) des applications. Il est prédisposé à une utilisation en\ndéveloppement web grâce à un package natif de gestion des réseaux et du\nprotocole http.\n\n### [Revel](http://robfig.github.io/revel/)\n\nFramework développé en Go et pour Go. Il intègre tout ce qu’il faut pour\ndévelopper une application web : rechargement du code à chaud, gestion des urls\npar routing, parsing des paramètres GET et POST, mécanisme de validation des\ndonnées, gestion de sessions, gestion du cache, framework de tests et même\nmoteur de tâches planifiées cron-likes. Il a pour particularité d’être\ncomplètement découplé sur la partie modèle et ne fourni aucun ORM ou ODM,\njuste un petit module pour gérer des transactions sur des bases sql-like.\n\n### [Mgo](http://labix.org/mgo)\n\nDriver Go complet pour MongoDB, permettant d’établir la connexion et d’envoyer\ndes requêtes. Il dispose d’un mécanisme de mapping des documents mongodb sur les\ntype struct de Go.\n\n### [MongoDB](http://www.mongodb.org/)\n\nBase de données NoSql agile et scalable, les documents sont stockés au format\njson dans des collections. Le requêtage se fait en manipulant des objets et des\nfonctions javascript.\n\n## Attends, attends ... Pourquoi Go ?\nLe premier vrai argument, c'est la **performance**. Sans rentrer dans\nl'explication hyper poussée d'un [benchmark](http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013), on peut\naffirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On\nva pas risquer de vexer les autres membres du crew avec des affirmations\ntrollesques dès le premier post.\n\nOn peut aussi ajouter que Go est un **langage moderne**, qui inclut toutes les\n**petites friandises pour attirer le développeur** curieux et assoiffé de\nqualité. Framework de tests et outil de mise en forme du code sont natifs et\npermettent à la techno d'échapper aux interminables guerres de conventions :\n\n> De toutes façons le no-newline avant \"{\" c'est vraiment pour les pourritures\n> responsables de 99% des maux de la Terre.\n> - Un évangeliste du PSR\n\nTroisième argument de choix en Go : la **simplicité de parallélisation**.\nPersonne ne viendra te dire *\"ça c'est synchrone, sry bro.\"* ou *\"ça c'est\nasynchrone, callback it bitch.\"*. Tout repose sur le mot clef qui a donné son\nnom au langage (ou l'inverse) `go`. Tu peux te faire un `go myFunc()` et paf !\nTout ce qui est appelé dans myFunc() saute sur un thread séparé. Et pour gérer\nla synchronicité entre plusieurs thread il y a un mécanisme de canaux. Ce sont\ndes files FIFO (the First In is the First Out) dont la lecture est bloquante\n(il existe des techniques évoluées pour faire du polling, cf\n[gotour#68](http://tour.golang.org/#68)).\n\nPour finir, cerise sur le gateau, **Go compile vite**, extrêment vite, et ça va\nsauver ton intégrité mentale sur les gros projets. Par contre c'est foutu pour\ntes pauses cafés aux prétextes douteux.\n\n##Let’s Go (#nojoke, siriouz bizness)\nOn va partir du principe que tu as Go et Revel prêts pour la baston. On attaque\ndirect à sec par le classique “revel new” puisqu'on va partir de la structure de\nbase.\n\n```console\n$ revel new github.com/OwlyCode/PutainDeProjet\n```\n\nLà théoriquement, tu te retrouves avec la structure par défaut du boilerplate\nrevel, quelque chose comme ça:\n\n- app\n  - controllers\n  - views\n- conf\n- messages\n- public\n- tests\n\nC’est là qu’on se met au boulot. On a de quoi faire un site complet avec ça mais\n aucune trace de gestion de base de données là dedans. On commence donc par\n créer un dossier `app/modules` et un sous dossier `app/modules/mongo`. C’est\n dans ce dossier que va se trouver notre gestionnaire de connexion à mongoDB.\n En fait ce n’est rien de plus qu’un binding entre Revel et Mgo. La technique\n utilisée pour brancher ce binding côté Revel est celle des\n [interceptors](http://robfig.github.io/revel/manual/interceptors.html).\n\n```go\npackage mongo\n\nimport (\n    \"github.com/robfig/revel\"\n    \"labix.org/v2/mgo\"\n    \"sync\"\n)\n\n// Extension du controlleur.\ntype Mongo struct {\n    *revel.Controller\n    MongoSession  *mgo.Session\n    MongoDatabase *mgo.Database\n}\n\n// Stockage global de la session dont la visibilité est restreinte au package.\nvar session *mgo.Session\n\n// Singleton\nvar dial sync.Once\n\n// Renvoie la session mgo en cours, si aucune n'existe, elle est créée.\nfunc GetSession() *mgo.Session {\n\n    host, _ := revel.Config.String(\"mongo.host\")\n\n    // Grâce au package sync cette fonction n'est appelée\n    // qu'une seule fois et de manière synchrone.\n    dial.Do(func() {\n        var err error\n        session, err = mgo.Dial(host)\n        if err != nil {\n            panic(err)\n        }\n    })\n\n    return session\n}\n\n// Alimente les propriétés affectées au controlleur en clonant la session mongo.\nfunc (c *Mongo) Bind() revel.Result {\n    // Oublie pas de mettre mongo.database dans le app.conf, genre \"localhost\"\n    databaseName, _ := revel.Config.String(\"mongo.database\")\n\n    c.MongoSession = GetSession().Clone()\n    c.MongoDatabase = c.MongoSession.DB(databaseName)\n\n    return nil\n}\n\n// Ferme un clone\nfunc (c *Mongo) Close() revel.Result {\n\n    if c.MongoSession != nil {\n        c.MongoSession.Close()\n    }\n\n    return nil\n}\n\n// Fonction appelée au chargement de l'application.\n// Elle effectue un appel a notre fonction Bind avant\n// chaque execution du controlleur.\nfunc init() {\n    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)\n    revel.InterceptMethod((*Mongo).Close, revel.AFTER)\n    // On veut aussi fermer le clone si le controlleur plante.\n    revel.InterceptMethod((*Mongo).Close, revel.PANIC)\n}\n```\n\nOn a créé notre connexion à mongo, mais maintenant on va aussi l’utiliser. Dans\nle contrôleur, rien de plus simple :\n\n```go\nimport (\n    \"github.com/robfig/revel\"\n    \"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"\n)\n\ntype AppController struct {\n    *revel.Controller\n    mongo.Mongo // Le controlleur doit étendre notre type Mongo.\n}\n\nfunc (c *AppController) Index() revel.Result {\n    usersCollection := c.MongoDatabase.C(\"users\")\n    // tu peux maintenant manipuler ta mgo.Collection.\n    // [ ... ]\n}\n```\n\nMais tu peux aussi l’appeler ailleurs dans le projet, par exemple dans un autre\nmodule :\n\n```go\nimport (\n    \"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"\n)\n\nfunc DoStuff(user *models.User) {\n    session := mongo.GetSession()\n    defer session.Close() // Oublie pas de fermer le robinet à la fin!\n\n    // tu peux maintenant manipuler ta mgo.Session.\n    // [ ... ]\n}\n```\n\n**C'est bien beau de copier coller mais ...**\n\n... tu te demandes certainement pourquoi on a créé un dossier `app/modules`, si\nc’est pour n’y mettre qu’un sous dossier mongo dedans. Et c’est une très bonne\nquestion. En fait, notre dossier mongo représente un module du projet bien\ndélimité. A l’avenir, si tu veux aussi brancher du mysql, et bien y a juste à\ncréer `app/modules/mysql`. Rien ne change pour l’existant et tu ne pollues pas\nla racine de ton projet. L’autre avantage c’est qu’en un coup d’oeil dans ce\ndossier tu as un aperçu direct des features de l’application.\n\nEnfin, l'approche module, c'est aussi un gage de MVC. Admettons qu'on veuille\ncoder une application de facturation, il nous suffit de créer un dossier\n`app/modules/invoicing` et de travailler dans ce dossier sur toute la partie\nmétier. Comme par exemple le calcul des totaux, le calcul de la TVA etc... Grâce\n à cette approche, on garde des contrôleurs très fins et restreints à ce que\n doit être leur rôle premier : faire communiquer le modèle et la vue.\n\n## Modèles globaux, modèles locaux\nJ’ai évoqué plus haut dans la liste des technos une feature hyper sexy de mgo :\nle mapping des documents mongodb en json sur les types struct. Ce qui veut dire\nqu’avec mgo, on peut définir des modèles bien structurés. Certains seront\ncommuns à toute l’application, par exemple un utilisateur, mais d’autres seront\nspécifiques à un module, comme par exemple une facture.\n\nUne bonne pratique est d’approcher le rangement des modèles selon cette\nstructure:\n\n- app\n  - controllers\n  - __models__\n  - modules\n    - invoicing\n      - engine\n      - __models__\n    - mongo\n  - views\n- conf\n- messages\n- public\n- tests\n\nLe but du jeu évidemment c'est d'avoir le moins de modèles globaux possibles.\nIdéalement, si le dossier `app/models` n'existe pas ce n'est pas plus mal. Mais\nattention à ne pas chercher à l'éliminer au prix de la modularité du code. Il\nvaut mieux avoir un modèle explicitement déclaré comme global plutot que de\nl'isoler dans un module et de rendre tous les autres modules du projet\ndépendants de ce dernier.\n\nPourquoi c'est important ? C'est surtout parce que ça pose les bonnes questions\net amène les bonnes remarques. \"Vais-je avoir besoin de ce modèle réellement\nPARTOUT ?\", \"C'est étrange j'ai créé deux modules mais au final je passe mon\ntemps à faire des va-et-vient de l'un à l'autre... Peut être que je devrais les\nfusionner.\" ou encore \"90% de mon projet se trouve dans un seul module, il y a\npeut être un problème.\". Mais au delà de ça, ça te permets d'isoler des modules\nquasi autonomes (deux ou trois coups d'abstraction avec des interfaces et ça\nroule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les\nréutiliser sur un autre (svn include pour les ancêtres, git submodules pour les\nautres).\n\n## Pour aller plus loin\nIsoler distinctement le gestionnaire de connexion, la logique métier et les\nmodèles dans des modules est une première étape vers une architecture propre et\névolutive. Tu peux même pousser ça plus loin en utilisant des interfaces comme\nje l'ai brièvement mentionné un peu plus tôt, c'est même d'ailleurs ce que je te\nconseille. Si tu veux creuser ce sujet là tu trouveras pas mal de monde qui s'y\nintéresse en fouinant sur le\n[groupe de discussion des utilisateurs golang](https://groups.google.com/forum/#!forum/Golang-Nuts).\nTu as par exemple ce gars là qui a\n[remplacé sa dépendance à la librairie mgo par des interfaces](https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ)\npour éviter d'inclure le package a chaque fois et faciliter ses tests. Tu peux\nenvisager de faire la même chose pour découpler tes modèles et la logique métier\n.\n\nEn attendant il ne me reste qu'à te souhaiter une bonne coding night, tu as\ntoutes les armes nécessaires pour gérer mongo dans ton projet revel. ;-)\n","raw":"---\ndate: \"2013-11-11\"\ntitle: Structurer son projet avec Revel et Mgo\ntags:\n  - golang\n  - mongo\n  - revel\n  - mgo\nauthors:\n  - OwlyCode\n---\n\nTu te sens l’âme d’un rebelle ? Tu veux tester de la techno atypique ? Ça tombe\nbien, aujourd’hui on est là pour ça. On va toucher à un sujet pas forcément\nmajoritaire : le langage Go. Si tu ne connais pas les bases, je t’invite à aller\nsur la [homepage du projet](http://golang.org/) et à parcourir le\n[go-tour anglais](http://tour.golang.org/) ou\n[celui en français](http://go-tour-fr.appspot.com/), c'est un showcase complet du langage\n(et très bien fichu).\nMais si t'es juste curieux et que comprendre chaque pixel de l'article n'est pas\nune obsession pour toi, tu devrais pouvoir voir de quoi on parle. Même\n[Nyalab](/#crew) y est arrivé.\n\nDans cet article on va voir **comment brancher un projet go+revel à une base de\ndonnées mongodb** et obtenir ainsi une base de travail sympa pour explorer le\ndéveloppement web avec Go.\n\n## Les technos utilisées\n\n### [Golang](http://golang.org)\n\nLangage compilé, publié en 2009, communément considéré comme “désorienté objet”,\nc’est une alternative solide au C/C++ qui prône un découpage modulaire (par\n“package”) des applications. Il est prédisposé à une utilisation en\ndéveloppement web grâce à un package natif de gestion des réseaux et du\nprotocole http.\n\n### [Revel](http://robfig.github.io/revel/)\n\nFramework développé en Go et pour Go. Il intègre tout ce qu’il faut pour\ndévelopper une application web : rechargement du code à chaud, gestion des urls\npar routing, parsing des paramètres GET et POST, mécanisme de validation des\ndonnées, gestion de sessions, gestion du cache, framework de tests et même\nmoteur de tâches planifiées cron-likes. Il a pour particularité d’être\ncomplètement découplé sur la partie modèle et ne fourni aucun ORM ou ODM,\njuste un petit module pour gérer des transactions sur des bases sql-like.\n\n### [Mgo](http://labix.org/mgo)\n\nDriver Go complet pour MongoDB, permettant d’établir la connexion et d’envoyer\ndes requêtes. Il dispose d’un mécanisme de mapping des documents mongodb sur les\ntype struct de Go.\n\n### [MongoDB](http://www.mongodb.org/)\n\nBase de données NoSql agile et scalable, les documents sont stockés au format\njson dans des collections. Le requêtage se fait en manipulant des objets et des\nfonctions javascript.\n\n## Attends, attends ... Pourquoi Go ?\nLe premier vrai argument, c'est la **performance**. Sans rentrer dans\nl'explication hyper poussée d'un [benchmark](http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013), on peut\naffirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On\nva pas risquer de vexer les autres membres du crew avec des affirmations\ntrollesques dès le premier post.\n\nOn peut aussi ajouter que Go est un **langage moderne**, qui inclut toutes les\n**petites friandises pour attirer le développeur** curieux et assoiffé de\nqualité. Framework de tests et outil de mise en forme du code sont natifs et\npermettent à la techno d'échapper aux interminables guerres de conventions :\n\n> De toutes façons le no-newline avant \"{\" c'est vraiment pour les pourritures\n> responsables de 99% des maux de la Terre.\n> - Un évangeliste du PSR\n\nTroisième argument de choix en Go : la **simplicité de parallélisation**.\nPersonne ne viendra te dire *\"ça c'est synchrone, sry bro.\"* ou *\"ça c'est\nasynchrone, callback it bitch.\"*. Tout repose sur le mot clef qui a donné son\nnom au langage (ou l'inverse) `go`. Tu peux te faire un `go myFunc()` et paf !\nTout ce qui est appelé dans myFunc() saute sur un thread séparé. Et pour gérer\nla synchronicité entre plusieurs thread il y a un mécanisme de canaux. Ce sont\ndes files FIFO (the First In is the First Out) dont la lecture est bloquante\n(il existe des techniques évoluées pour faire du polling, cf\n[gotour#68](http://tour.golang.org/#68)).\n\nPour finir, cerise sur le gateau, **Go compile vite**, extrêment vite, et ça va\nsauver ton intégrité mentale sur les gros projets. Par contre c'est foutu pour\ntes pauses cafés aux prétextes douteux.\n\n##Let’s Go (#nojoke, siriouz bizness)\nOn va partir du principe que tu as Go et Revel prêts pour la baston. On attaque\ndirect à sec par le classique “revel new” puisqu'on va partir de la structure de\nbase.\n\n```console\n$ revel new github.com/OwlyCode/PutainDeProjet\n```\n\nLà théoriquement, tu te retrouves avec la structure par défaut du boilerplate\nrevel, quelque chose comme ça:\n\n- app\n  - controllers\n  - views\n- conf\n- messages\n- public\n- tests\n\nC’est là qu’on se met au boulot. On a de quoi faire un site complet avec ça mais\n aucune trace de gestion de base de données là dedans. On commence donc par\n créer un dossier `app/modules` et un sous dossier `app/modules/mongo`. C’est\n dans ce dossier que va se trouver notre gestionnaire de connexion à mongoDB.\n En fait ce n’est rien de plus qu’un binding entre Revel et Mgo. La technique\n utilisée pour brancher ce binding côté Revel est celle des\n [interceptors](http://robfig.github.io/revel/manual/interceptors.html).\n\n```go\npackage mongo\n\nimport (\n    \"github.com/robfig/revel\"\n    \"labix.org/v2/mgo\"\n    \"sync\"\n)\n\n// Extension du controlleur.\ntype Mongo struct {\n    *revel.Controller\n    MongoSession  *mgo.Session\n    MongoDatabase *mgo.Database\n}\n\n// Stockage global de la session dont la visibilité est restreinte au package.\nvar session *mgo.Session\n\n// Singleton\nvar dial sync.Once\n\n// Renvoie la session mgo en cours, si aucune n'existe, elle est créée.\nfunc GetSession() *mgo.Session {\n\n    host, _ := revel.Config.String(\"mongo.host\")\n\n    // Grâce au package sync cette fonction n'est appelée\n    // qu'une seule fois et de manière synchrone.\n    dial.Do(func() {\n        var err error\n        session, err = mgo.Dial(host)\n        if err != nil {\n            panic(err)\n        }\n    })\n\n    return session\n}\n\n// Alimente les propriétés affectées au controlleur en clonant la session mongo.\nfunc (c *Mongo) Bind() revel.Result {\n    // Oublie pas de mettre mongo.database dans le app.conf, genre \"localhost\"\n    databaseName, _ := revel.Config.String(\"mongo.database\")\n\n    c.MongoSession = GetSession().Clone()\n    c.MongoDatabase = c.MongoSession.DB(databaseName)\n\n    return nil\n}\n\n// Ferme un clone\nfunc (c *Mongo) Close() revel.Result {\n\n    if c.MongoSession != nil {\n        c.MongoSession.Close()\n    }\n\n    return nil\n}\n\n// Fonction appelée au chargement de l'application.\n// Elle effectue un appel a notre fonction Bind avant\n// chaque execution du controlleur.\nfunc init() {\n    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)\n    revel.InterceptMethod((*Mongo).Close, revel.AFTER)\n    // On veut aussi fermer le clone si le controlleur plante.\n    revel.InterceptMethod((*Mongo).Close, revel.PANIC)\n}\n```\n\nOn a créé notre connexion à mongo, mais maintenant on va aussi l’utiliser. Dans\nle contrôleur, rien de plus simple :\n\n```go\nimport (\n    \"github.com/robfig/revel\"\n    \"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"\n)\n\ntype AppController struct {\n    *revel.Controller\n    mongo.Mongo // Le controlleur doit étendre notre type Mongo.\n}\n\nfunc (c *AppController) Index() revel.Result {\n    usersCollection := c.MongoDatabase.C(\"users\")\n    // tu peux maintenant manipuler ta mgo.Collection.\n    // [ ... ]\n}\n```\n\nMais tu peux aussi l’appeler ailleurs dans le projet, par exemple dans un autre\nmodule :\n\n```go\nimport (\n    \"github.com/OwlyCode/PutainDeProjet/app/modules/mongo\"\n)\n\nfunc DoStuff(user *models.User) {\n    session := mongo.GetSession()\n    defer session.Close() // Oublie pas de fermer le robinet à la fin!\n\n    // tu peux maintenant manipuler ta mgo.Session.\n    // [ ... ]\n}\n```\n\n**C'est bien beau de copier coller mais ...**\n\n... tu te demandes certainement pourquoi on a créé un dossier `app/modules`, si\nc’est pour n’y mettre qu’un sous dossier mongo dedans. Et c’est une très bonne\nquestion. En fait, notre dossier mongo représente un module du projet bien\ndélimité. A l’avenir, si tu veux aussi brancher du mysql, et bien y a juste à\ncréer `app/modules/mysql`. Rien ne change pour l’existant et tu ne pollues pas\nla racine de ton projet. L’autre avantage c’est qu’en un coup d’oeil dans ce\ndossier tu as un aperçu direct des features de l’application.\n\nEnfin, l'approche module, c'est aussi un gage de MVC. Admettons qu'on veuille\ncoder une application de facturation, il nous suffit de créer un dossier\n`app/modules/invoicing` et de travailler dans ce dossier sur toute la partie\nmétier. Comme par exemple le calcul des totaux, le calcul de la TVA etc... Grâce\n à cette approche, on garde des contrôleurs très fins et restreints à ce que\n doit être leur rôle premier : faire communiquer le modèle et la vue.\n\n## Modèles globaux, modèles locaux\nJ’ai évoqué plus haut dans la liste des technos une feature hyper sexy de mgo :\nle mapping des documents mongodb en json sur les types struct. Ce qui veut dire\nqu’avec mgo, on peut définir des modèles bien structurés. Certains seront\ncommuns à toute l’application, par exemple un utilisateur, mais d’autres seront\nspécifiques à un module, comme par exemple une facture.\n\nUne bonne pratique est d’approcher le rangement des modèles selon cette\nstructure:\n\n- app\n  - controllers\n  - __models__\n  - modules\n    - invoicing\n      - engine\n      - __models__\n    - mongo\n  - views\n- conf\n- messages\n- public\n- tests\n\nLe but du jeu évidemment c'est d'avoir le moins de modèles globaux possibles.\nIdéalement, si le dossier `app/models` n'existe pas ce n'est pas plus mal. Mais\nattention à ne pas chercher à l'éliminer au prix de la modularité du code. Il\nvaut mieux avoir un modèle explicitement déclaré comme global plutot que de\nl'isoler dans un module et de rendre tous les autres modules du projet\ndépendants de ce dernier.\n\nPourquoi c'est important ? C'est surtout parce que ça pose les bonnes questions\net amène les bonnes remarques. \"Vais-je avoir besoin de ce modèle réellement\nPARTOUT ?\", \"C'est étrange j'ai créé deux modules mais au final je passe mon\ntemps à faire des va-et-vient de l'un à l'autre... Peut être que je devrais les\nfusionner.\" ou encore \"90% de mon projet se trouve dans un seul module, il y a\npeut être un problème.\". Mais au delà de ça, ça te permets d'isoler des modules\nquasi autonomes (deux ou trois coups d'abstraction avec des interfaces et ça\nroule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les\nréutiliser sur un autre (svn include pour les ancêtres, git submodules pour les\nautres).\n\n## Pour aller plus loin\nIsoler distinctement le gestionnaire de connexion, la logique métier et les\nmodèles dans des modules est une première étape vers une architecture propre et\névolutive. Tu peux même pousser ça plus loin en utilisant des interfaces comme\nje l'ai brièvement mentionné un peu plus tôt, c'est même d'ailleurs ce que je te\nconseille. Si tu veux creuser ce sujet là tu trouveras pas mal de monde qui s'y\nintéresse en fouinant sur le\n[groupe de discussion des utilisateurs golang](https://groups.google.com/forum/#!forum/Golang-Nuts).\nTu as par exemple ce gars là qui a\n[remplacé sa dépendance à la librairie mgo par des interfaces](https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ)\npour éviter d'inclure le package a chaque fois et faciliter ses tests. Tu peux\nenvisager de faire la même chose pour découpler tes modèles et la logique métier\n.\n\nEn attendant il ne me reste qu'à te souhaiter une bonne coding night, tu as\ntoutes les armes nécessaires pour gérer mongo dans ton projet revel. ;-)\n","__filename":"fr/articles/go/structure-revel-mgo/index.md","__url":"/fr/articles/go/structure-revel-mgo/","type":"Post"}}}</script><script src="/statinamic-client.js"></script></body></html>