<?xml version="1.0" encoding="utf-8" ?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Putain de code !</title><description></description><link>http://putaindecode.fr</link><!-- generator putaindecode--><lastBuildDate>Tue, 06 May 2014 19:29:40 GMT</lastBuildDate><atom:link href="http://putaindecode.fr/feed.xml" rel="self" type="application/rss+xml"></atom:link><item><title>NPM comme package manager pour le front-end</title><description><![CDATA[[
<p>NPM, le package manager de Node.js, a grandement participÃ© au succÃ¨s de ce dernier.
Il facilite la crÃ©ation, le partage et lâ€™installation de modules.
Il permet aux dÃ©veloppeurs de suivre la <a href="http://www.faqs.org/docs/artu/ch01s06.html">philosophie Unix</a>
oÃ¹ chaque module fait une seule tÃ¢che (Ã©vite la complexitÃ©, facilite la rÃ©utilisation et les tests).</p>
<p>Cependant NPM ne se limite pas aux modules JavaScript. Il est en effet possible
de publier tout type de fichier et câ€™est lÃ  que Ã§a devient intÃ©ressant pour nos
modules front-end, qui peuvent aussi Ãªtre CSS, HTML, fonts, etc.</p>
<h2 id="module-javascript"><a class="putainde-Title-anchor" href="#module-javascript">#</a>Module JavaScript</h2><p>Si vous nâ€™Ãªtes pas familier(e) avec la crÃ©ation dâ€™un module JavaScript, je vous
conseille dâ€™exÃ©cuter la commande <code>npm init</code> qui va vous aider Ã  gÃ©nÃ©rer votre
<code>package.json</code> (fichier de configuration utilisÃ© par NPM). Le champ
â€œ<a href="https://www.npmjs.org/doc/json.html#main">main</a>â€œ dÃ©finit le point dâ€™entrÃ©e de
votre module.</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"putaindemodule"</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"0.0.1"</span></span>,
  "<span class="hljs-attribute">main</span>": <span class="hljs-value"><span class="hljs-string">"index.js"</span>
</span>}
</code></pre>
<p>Dans un article prÃ©cÃ©dent, il vous a Ã©tÃ© prÃ©sentÃ© le dÃ©veloppement dâ€™une application
autour de <a href="/posts/js/browserify-all-the-things/">modules JavaScript avec Browserify</a>.</p>
<h2 id="module-pour-tout-type-de-fichier"><a class="putainde-Title-anchor" href="#module-pour-tout-type-de-fichier">#</a>Module pour tout type de fichier</h2><p>Câ€™est grÃ¢ce au champ â€œ<a href="https://www.npmjs.org/doc/json.html#files">files</a>â€œ que
lâ€™on peut dÃ©finir la liste des fichiers que lâ€™on va publier (autre que les fichiers JavaScript).
Voici un exemple de <code>package.json</code> dâ€™un module pour un systÃ¨me de grille CSS.</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"putaindegrid"</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"0.0.1"</span></span>,
  "<span class="hljs-attribute">files</span>": <span class="hljs-value">[
    <span class="hljs-string">"grid.css"</span>
  ]
</span>}
</code></pre>
<p>Il ne reste de plus quâ€™Ã  le <a href="https://gist.github.com/coolaj86/1318304">publier</a>
et Ã  lâ€™installer (<code>npm install putaindegrid --save</code>) dans vos diffÃ©rents projets
oÃ¹ vous en aurez besoin. Votre fichier <code>grid.css</code> est accessible dans le dossier
<code>node_modules/putaindegrid/grid.css</code>, vous pouvez donc lâ€™inclure dans votre page
HTML. (Ou lâ€™<code>@import</code>er dans votre fichier Sass/Less principal.)</p>
<pre><code class="lang-html">&lt;link href=<span class="hljs-string">"node_modules/putaindegrid/grid.css"</span> rel=<span class="hljs-string">"stylesheet"</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">"text/css"</span>&gt;
</code></pre>
<h2 id="pourquoi-npm-plutot-qu-un-autre-package-manager-"><a class="putainde-Title-anchor" href="#pourquoi-npm-plutot-qu-un-autre-package-manager-">#</a>Pourquoi NPM plutÃ´t quâ€™un autre package manager ?</h2><ul>
<li>Il a dÃ©jÃ  fait ses preuves comme package manager pour Node.js.</li>
<li>Pas besoin dâ€™installer un nouvel outil, NPM Ã©tant installÃ© avec Node.js, ce qui
Ã©vite un lot de bugs et de fichiers de configuration supplÃ©mentaires (un simple <code>package.json</code> suffit).</li>
<li>Et surtout, toutes les dÃ©pendances de votre projet peuvent Ãªtre gÃ©rÃ©es via NPM:
votre tasks runner et ses plugins (<a href="/posts/js/introduction-gulp/">Gulp</a>, <a href="/posts/js/premiers-pas-avec-grunt/">Grunt</a> &amp; co), vos <a href="/posts/js/browserify-all-the-things/">modules JavaScript</a>, vos <a href="/posts/js/introduction-au-testing-js-front/">tests</a>
et comme on vient de le voir, vos fichiers de style.</li>
</ul>
<p>Dans le cas oÃ¹ vous nâ€™auriez pas envie de passer par lâ€™Ã©tape de publication
(<code>npm publish</code>) pour diverses raisons, sachez quâ€™il est possible
dâ€™<a href="https://www.npmjs.org/doc/cli/npm-install.html">installer</a> des packages qui ne
sont pas publiÃ©s. Mon alternative favorite Ã©tant lâ€™utilisation du namespace Github
<code>npm install user/repo --save</code>.<br>Cependant, mÃªme si vous ne publiez pas votre module, lorsque vous en modifiez le
code nâ€™oubliez jamais de mettre Ã  jour sa version suivant la convention
<a href="http://semver.org/">semver</a>. Sinon vous serez susceptible dâ€™inclure des bugs dans
les projets qui lâ€™utilisent. Ce qui implique :</p>
<ul>
<li>Mettre Ã  jour le champ â€œversionâ€ de votre <code>package.json</code> (vous pouvez vous
aider des commandes <code>npm version patch</code>, <code>npm version minor</code> et <code>npm version major</code>).</li>
<li>Ajouter un tag git (<code>git tag -a 0.1.0 -m &quot;Initial release&quot;</code>).</li>
</ul>
<p>NPM est une excellente solution pour gÃ©rer les dÃ©pendences de votre projet, aussi
bien pour vos outils de build, que pour vos assets front-end. Je pense quâ€™il est
important de garder les choses simples, en commenÃ§ant par utiliser un seul
gestionnaire de dÃ©pendances, dans le cas oÃ¹ celui-ci nâ€™intÃ¨gre pas dâ€™autres
fonctionnalitÃ©s que le tÃ©lÃ©chargement de modules.  </p>
<p>Bye bye Bower!</p>

]]></description><pubDate>Tue, 06 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/frontend/npm-comme-package-manager-pour-le-front-end/</link><guid isPermaLink="true">http://putaindecode.fr/posts/frontend/npm-comme-package-manager-pour-le-front-end/</guid></item><item><title>Petite dÃ©finition de BEM</title><description><![CDATA[[
<p><strong><a href="http://bem.info">BEM</a></strong> nâ€™est ni une marque de voiture ni un groupe de musique, et encore moins une onomatopÃ©e (quoique). Câ€™est plutÃ´t une faÃ§on de nommer les classes en CSS, une convention en dâ€™autres termes voire une mÃ©thodologie.</p>
<p>Dans cet article, je ne vous expliquerai pas pourquoi il faut prÃ©fÃ©rer BEM Ã  une autre convention, je vous explique surtout comment lâ€™utiliser.</p>
<p><strong>BEM</strong> apporte une solution Ã  un problÃ¨me majeur en informatique : le nommage.</p>
<p>Il nâ€™y a rien de plus compliquÃ© en informatique que de nommer un objet : besoin dâ€™Ãªtre explicite, ne doit pas Ãªtre trop gÃ©nÃ©rique, ni trop compliquÃ©, ni trop verbeux (Ã§a, Ã§a reste Ã  voir avec BEMâ€¦).</p>
<p>Lorsque lâ€™on nomme un objet, une mÃ©thode, une fonction, une classe, on se doit dâ€™Ãªtre avant tout comprÃ©hensible. Une personne devant lire votre code doit directement comprendre de quoi vous parlez. Cette personne peut trÃ¨s bien Ãªtre vous 6 mois, 1 an aprÃ¨s. Je pense sincÃ¨rement quâ€™un code clair vaut toute la documentation du monde. Je ne dis pas quâ€™il ne faut pas documenter mais un code doit Ãªtre facilement comprÃ©hensible, la documentation doit juste apporter un contexte, une situation particuliÃ¨re.</p>
<p>Bref, <strong>BEM</strong> est le sigle pour <em>Block</em>, <em>Element</em>, <em>Modifier</em>. Quâ€™est-ce que cela veut dire.</p>
<p>Prenons par exemple un site web. Nous avons un ensemble avec dedans deux onglets et en dessous le contenu de chaque onglet.</p>
<p>Nous allons dÃ©finir ce que sont le <em>block</em>, le ou les <em>elements</em> et les <em>modifiers</em>.</p>
<p>Dans ce cas prÃ©cis, le <em>block</em> est le conteneur, lâ€™ensemble, ce qui entoure le tout. Appelons-le â€œWindowâ€.</p>
<p>Nous avons alors aussi les <em>elements</em> suivants : les onglets, que nous allons nommer â€œTabâ€, et le contenu, lÃ  oÃ¹ il y a le texte de chaque onglet â€œContentâ€.</p>
<p>Comment cela se traduit en <strong>BEM</strong> :</p>
<ul>
<li>Notre <em>block</em> sâ€™appelant â€œWindowâ€ sera alors <code>.Window</code></li>
<li>Nos <em>elements</em> â€œTabâ€ seront <code>.Window-tab</code></li>
<li>Notre <em>element</em> â€œContentâ€ sera <code>.Window-content</code></li>
</ul>
<p>Jusque lÃ , cela devrait aller :</p>
<pre><code class="lang-css"><span class="hljs-class">.Window</span> <span class="hljs-rules">{

<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-tab</span> <span class="hljs-rules">{

  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-content</span> <span class="hljs-rules">{

  <span class="hljs-rule">}</span></span>
</code></pre>
<p>Ce qui revient de manÃ¨re gÃ©nÃ©rique Ã  :</p>
<pre><code class="lang-css">.<span class="hljs-keyword">Block</span> <span class="hljs-list">{

}</span>

  .<span class="hljs-keyword">Block</span>-element <span class="hljs-list">{

  }</span>
</code></pre>
<p>Oui, je vous conseille dâ€™indenter votre code afin de grouper vos classes.</p>
<p>Maintenant, nous allons dÃ©finir ce quâ€™est un <em>modifier</em>. Un <em>modifier</em> change lâ€™Ã©tat de lâ€™Ã©lÃ©ment, il peut sâ€™appliquer aussi bien sur un <em>block</em>, quâ€™un <em>element</em>.</p>
<p>Si par exemple je souhaite mettre en actif un onglet (le mettre en avant car sÃ©lÃ©ctionnÃ©), je ferai alors <code>.Window-tab--active</code>, soit :</p>
<pre><code class="lang-css"><span class="hljs-class">.Window</span> <span class="hljs-rules">{

<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-tab</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> gray</span></span>;
  <span class="hljs-rule">}</span></span>

    <span class="hljs-class">.Window-tab--active</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> black</span></span>;
    <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-content</span> <span class="hljs-rules">{

  <span class="hljs-rule">}</span></span>
</code></pre>
<p>Jâ€™aimerais aussi afficher ou non le contenu. Pour cela, je vais lui rajouter un <em>modifier</em></p>
<pre><code class="lang-css"><span class="hljs-class">.Window</span> <span class="hljs-rules">{

<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-tab</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> gray</span></span>;
  <span class="hljs-rule">}</span></span>

    <span class="hljs-class">.Window-tab--active</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> black</span></span>;
    <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-content</span> <span class="hljs-rules">{
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.Window-content--hidden</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
<p>Jâ€™aurais trÃ¨s bien pu inverser et dire que par dÃ©faut le contenu est cachÃ© et je lui rajoute la classe <code>.Window-tab--active</code> pour lâ€™afficher (<code>display: block</code>) mais lorsquâ€™il sâ€™agit de cacher ou de faire appaÃ®tre des Ã©lÃ©ments, je vous conseille vivement de plutÃ´t ajouter un <em>modifier</em> qui cache les Ã©lÃ©ments, car cela Ã©vite de se prendre la tÃªte sur quel <code>display</code> mettre par dÃ©faut. LÃ , vous mettez un <code>display: none</code> et voilÃ , quâ€™importe si celui de base est un <code>inline</code>, <code>inline-block</code>, <code>table-cell</code> ou autre.</p>
<p>Du coup, nous avons maintenant nos diffÃ©rents types de classes. Cela se rÃ©sume de maniÃ¨re gÃ©nÃ©rique Ã  :</p>
<pre><code class="lang-css">.<span class="hljs-keyword">Block</span> <span class="hljs-list">{

}</span>

  .<span class="hljs-keyword">Block</span>--modifier <span class="hljs-list">{

  }</span>

  .<span class="hljs-keyword">Block</span>-element <span class="hljs-list">{

  }</span>

    .<span class="hljs-keyword">Block</span>-element--modifier <span class="hljs-list">{

    }</span>
</code></pre>
<p>Ce qui donne <code>.Block-element--modifier</code> (notre <strong>BEM</strong>).</p>
<p>Parlons maintenant du cas des termes multiples dans chaque partie. Voici comment cela se traduit.</p>
<p><code>.MyBlock-myElement--myModifier</code></p>
<p>Les <em>blocks</em> sont en â€œPascalCaseâ€ (ou UpperCamelCase), les <em>elements</em> et <em>modifiers</em> sont en â€œcamelCaseâ€ (ou lowerCamelCase). Nous sÃ©parons le <em>block</em> de lâ€™Ã©lÃ©ment par â€œ-â€œ et le <em>block</em> ou lâ€™ <em>element</em> dâ€™un <em>modifier</em> par â€œâ€”â€œ.</p>
<p>Maintenant, vous savez tout sur <strong>BEM</strong>. Sachez quâ€™il existe tout de mÃªme plusieurs conventions de <strong>BEM</strong>. Celle que je vous ai apprise lÃ  est la norme de <strong>montage.js</strong> mais il y en a dâ€™autres par exemple qui nâ€™utilisent pas les majuscules et font ce genre de choses : <code>.my-block__my-element--my-modifier</code>. Il sâ€™avÃ¨re que câ€™est la <a href="http://bem.info/method/definitions/#naming-for-independent-css-classes">convention pseudo-officielle</a>.</p>
<p>Lâ€™inconvÃ©nient de ceci est que câ€™est moins lisible au premier abord qui est quoi, et de plus, les <code>_</code> ne permettent pas de sÃ©lectionner facilement un terme en <em>double-cliquant</em> dessus.</p>
<p>Deux petites choses avant de partir.</p>
<p>Dans le but dâ€™Ã©viter de vous faire Ã©craser vos propriÃ©tÃ©s par quelquâ€™un dâ€™autre (une bibliothÃ¨que, un <em>SDK</em>), je vous conseille de rajouter votre organisation.</p>
<p>Typiquement, Ã§a donne <code>.org-Block-element--modifier</code>. Tout en minuscule et si possible ne pas dÃ©passer les 3 lettres car vous allez devoir le rÃ©pÃ©ter Ã  chaque fois et Ã§a peut Ãªtre lourd.</p>
<p>La deuxiÃ¨me chose est la classe qui sert de sÃ©lecteur en JavaScript. PlutÃ´t que <em>binder</em> un Ã©lÃ©ment via sa classe â€œCSSâ€ (Ã  chaque classe sa responsabilitÃ©), il est nettement prÃ©fÃ©rable de crÃ©er une classe spÃ©cifique au JavaScript. Cela donne : <code>.org-js-Block-element--modifier</code>. Il suffit simplement de rajouter <code>-js</code> entre lâ€™organisation et le <em>block</em>.</p>
<p>Nous arrivons Ã  la convention suivante : <code>.org[-js]-Block[-element][--modifier]</code></p>
<p>Certains vous diront quâ€™ils mettent <code>.js-org-</code> mais Ã©tant donnÃ© que je considÃ¨re cela comme un <em>namespace</em> global (autant css que js), je prÃ©fÃ¨re mettre lâ€™ <code>org</code> au dÃ©but.</p>
<p>VoilÃ , voilÃ , câ€™est certes un peu dÃ©routant au dÃ©but, et ca parait trÃ¨s verbeux mais cela vous permettra dâ€™Ã©viter de nooooooombreux soucis de nommage de classes oÃ¹ vous vous emmÃ¨lerez les pinceaux Ã  coup de :</p>
<pre><code class="lang-css"><span class="hljs-class">.footer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value"> underline</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.content</span> <span class="hljs-class">.footer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> black</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value"> none</span></span>; <span class="hljs-comment">/* annule la propriÃ©tÃ© du prÃ©cÃ©dent sÃ©lecteur */</span>
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Ciao les kids.</p>

]]></description><pubDate>Mon, 05 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/petite-definition-bem/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/petite-definition-bem/</guid></item><item><title>Table ronde #3 - Les bonnes pratiques et organisation CSS/HTML</title><description><![CDATA[[
<p>Mardi 29 avril sâ€™est dÃ©roulÃ©e la troisiÃ¨me table ronde qui est finalement la premiÃ¨re sous le nom de <strong>{p!}</strong>. Une petite explication sâ€™impose Ã©tant donnÃ© que nous allons en faire de plus en plus et que je souhaite vraiment vous faire un compte rendu sur chacun de ces Ã©vÃ¨nements.</p>
<h2 id="preambule"><a class="putainde-Title-anchor" href="#preambule">#</a>PrÃ©ambule</h2><p>Partant du constat quâ€™il est difficile dâ€™apprendre et dâ€™Ã©changer en confÃ©rence du fait du manque du niveau assez Ã©levÃ© (trop de gens avec un niveau diffÃ©rent, il faut forcÃ©ment sâ€™aligner) et Ã  sens unique (une personne parle, les autres Ã©coutent), nous avons dÃ©cidÃ© de crÃ©er des tables rondes oÃ¹ un fil conducteur est suivi amenant Ã  dÃ©battre, Ã©changer, affirmer.</p>
<p>Attention, je ne dis pas que les confÃ©rences ne servent Ã  rien mais Ã  mon sens elles sont trop magistrales et parfois trop marketing (coucou WebRTC Paris).</p>
<p>Les premiÃ¨res tables rondes nâ€™Ã©taient pas sous le nom de <strong>p!</strong>, elles Ã©taient plutÃ´t de mon initiative (@_kud) dans le but de rassembler des gens que jâ€™apprÃ©ciais et dont je connaissais le niveau afin de progresser tous ensembles.</p>
<p>Je tiens Ã  vous mettre en garde ici que les propos tenus ne sont pas forcÃ©ment toujours justifiÃ©s, câ€™est un compte rendu qui synthÃ©tise des choix que vous devriez sÃ»rement explorer par vous-mÃªme ou au travers de dâ€™autres articles <strong>p!</strong>.</p>
<p>Bon allez, on y va.</p>
<h2 id="ou-"><a class="putainde-Title-anchor" href="#ou-">#</a>OÃ¹ ?</h2><p>Câ€™est cette fois-ci Altima qui nous a gentillement accueilli dans ses locaux.</p>
<p><a href="http://www.altima.fr">Altima</a> est une agence web composÃ©e de 6 bureaux dans le monde, proposant des expertises notamment dans les domaines du design, UX, SEO, in-store, hosting, et dÃ©veloppement.</p>
<p>On les remercie bien fort, tout Ã©tait nickel.</p>
<h2 id="themes"><a class="putainde-Title-anchor" href="#themes">#</a>ThÃ¨mes</h2><p>Voici le fil conducteur de la soirÃ©e.</p>
<ul>
<li>les resets / normalize, lesquels, pourquoi, quand ?</li>
<li>stratÃ©gie de dossiers / fichiers (architecture)</li>
<li>OOCSS, BEM, SMACSS, Atomique etc.</li>
<li>sÃ©mantique</li>
<li>accessibilitÃ©</li>
<li>les piÃ¨ges de lâ€™intÃ©gration (e.g. display: inline-block)</li>
<li>unitÃ©s px, rem, em, pt</li>
<li>CSS Frameworks ? lesquels ? pourquoi ? quand ?</li>
</ul>
<h2 id="qui-"><a class="putainde-Title-anchor" href="#qui-">#</a>Qui ?</h2><p>Voici les personnes prÃ©sentes. Si vous avez dâ€™ailleurs le moindre problÃ¨me avec ce qui est dit dans cet article, câ€™est Ã  eux que vous devriez vous adresser. ğŸ˜Š</p>
<table>
<thead>
<tr>
<th>Membres</th>
<th style="text-align:center">Statut</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://twitter.com/_kud">_kud</a></td>
<td style="text-align:center">ğŸ‘®</td>
</tr>
<tr>
<td><a href="https://twitter.com/bloodyowl">bloodyowl</a></td>
<td style="text-align:center">ğŸ </td>
</tr>
<tr>
<td><a href="https://twitter.com/yannickc">yannickc</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><a href="https://twitter.com/dhoko_">dhoko_</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><a href="https://twitter.com/philippebarbosa">philippebarbosa</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><a href="https://twitter.com/tchak13">tchak13</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><a href="https://twitter.com/remitbri">remitbri</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><a href="https://twitter.com/dizwix">dizwix</a></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2 id="c-est-parti"><a class="putainde-Title-anchor" href="#c-est-parti">#</a>Câ€™est parti</h2><h3 id="reset-normalize"><a class="putainde-Title-anchor" href="#reset-normalize">#</a>Reset / Normalize</h3><p>Bon, alors, commenÃ§ons. Ce sont Ã©videmment les resets / normalizes qui dÃ©butent Ã©tant donnÃ© que câ€™est la base de toute intÃ©gration.</p>
<p>Pour rappel, la diffÃ©rence entre un normalize et un reset est simple.</p>
<ul>
<li>Le <strong>normalize</strong> fait en sorte que les styles de base se ressemblent sur tous les navigateurs.</li>
<li>Le <strong>reset</strong> va plus loin que Ã§a puisquâ€™il sâ€™occupe dâ€™Ã©craser totalement les styles par dÃ©faut pour finalement nâ€™avoir aucun style sur votre page lorque vous dÃ©butez votre intÃ©gration.</li>
</ul>
<p>Bref, peu ou pas de gens dans cette salle utilisent finalement des resets. Les resets sont uniquement intÃ©ressants lors dâ€™applications trÃ¨s poussÃ©es oÃ¹ le style par dÃ©faut des navigateurs nâ€™est pas du tout pertinent. Mais attention, ceci peut Ãªtre dangereux car il est plus compliquÃ© de retrouver le style par dÃ©faut dâ€™un navigateur que de le supprimer. Dâ€™oÃ¹ lâ€™intÃ©rÃªt du normalize.</p>
<p>Je vous indique tout de mÃªme les plus connus :</p>
<ul>
<li><a href="http://meyerweb.com/eric/tools/css/reset/">Le reset dâ€™Eric Meyer</a></li>
<li><a href="http://necolas.github.io/normalize.css/">Le normalize de Necolas</a></li>
</ul>
<h3 id="strategie-de-fichiers"><a class="putainde-Title-anchor" href="#strategie-de-fichiers">#</a>StratÃ©gie de fichiers</h3><p>Allez, on continue, stratÃ©gie de fichiers, oÃ¹ est ce quâ€™on range tout ce beau monde, comment on sâ€™y retrouve.</p>
<p>On en a discutÃ© un peu, certains prÃ©fÃ¨rent mettre leurs fichiers dans directement dans le <em>root</em> du projet, moi je prÃ©fÃ¨re le mettre dans un dossier <code>/src</code> afin de bien diffÃ©rencier source, sortie, et fichiers de configuration du projet. Ce qui donne ceci :</p>
<pre><code>.
â”œâ”€â”€ README.md
â”œâ”€â”€ bin <span class="hljs-comment">// executables</span>
â”œâ”€â”€ dist <span class="hljs-comment">// fichiers finaux</span>
â”œâ”€â”€ src <span class="hljs-comment">// votre application</span>
â”‚   â”œâ”€â”€ assets <span class="hljs-comment">// fichiers statiques (pas de compilation)</span>
â”‚   â”œâ”€â”€ collections
â”‚   â”œâ”€â”€ events
â”‚   â”œâ”€â”€ glyphicons <span class="hljs-comment">// svg qui seront transformÃ©s en font</span>
â”‚   â”œâ”€â”€ images
â”‚   â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ models
â”‚   â”œâ”€â”€ styles
â”‚   â”‚   â”œâ”€â”€ base
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-keyword">shared</span>
â”‚   â”‚   â”œâ”€â”€ views
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-keyword">import</span>.css
â”‚   â”‚   â””â”€â”€ shame.css <span class="hljs-comment">// hack css oÃ¹ il est obligatoire de commenter pourquoi</span>
â”‚   â”œâ”€â”€ routers
â”‚   â”œâ”€â”€ templates
â”‚   â””â”€â”€ views
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ bootstrap.js
|   â””â”€â”€ <span class="hljs-keyword">import</span>.json
â”œâ”€â”€ gulpfile.js
â”œâ”€â”€ Makefile
â”œâ”€â”€ <span class="hljs-keyword">package</span>.json
</code></pre><h3 id="oocss-bem-smacss-whatever-else"><a class="putainde-Title-anchor" href="#oocss-bem-smacss-whatever-else">#</a>OOCSS, BEM, SMACSS, whatever else</h3><p>Haaaaaaa, grand dÃ©bat ici. Quelle est la meilleure faÃ§on, la meileure maniÃ¨re de maintenir du CSS, de nommer ses classes, dâ€™avoir des conventions de nommage.</p>
<p>Tout dâ€™abord, on sâ€™est tous accordÃ©s sur un point : OOCSS, SMACSS, le reste, Ã§a ne marche pas. Ca marche pas parce que Ã§a casse dans certains cas la sÃ©mantique, dans dâ€™autres cas, Ã§a revient Ã  faire du style inline mais avec des noms de classes style <code>.left</code> pour un <code>float: left</code>. On a tous plus ou moins essayÃ© et Ã§a devient vite le bordel. On sâ€™est aussi accordÃ©s, mais Ã§a câ€™est Ã©vident, quâ€™avoir une convention de nommage est primordiale pour maintenir correctement du style (ou autre dâ€™ailleurs).
Et surtout il nâ€™est plus nÃ©cessaire dâ€™utiliser les IDs. Les IDs doivent servir uniquement dans le cas de la combinaison label/input, mais sinon ils empÃªchent toute gÃ©nÃ©ralisation dâ€™un block.</p>
<p>Il est clair quâ€™aprÃ¨s des annÃ©es dâ€™intÃ©gration, le constat est lÃ , la cascade, ce nâ€™est vraiment pas lâ€™idÃ©al. Cela reste toujours aussi difficile de faire du css generique et/ou maintenable, et câ€™est justement en quoi BEM permet de rÃ©soudre Ã  la fois les problÃ©matiques de cascade mais aussi de nommage.</p>
<p>Il y a de nombreux articles sur BEM, sur ses conventions (oui il peut y avoir plusieurs conventions de nommage, BEM reste plus une mÃ©thologie).</p>
<p>En quelques termes, BEM redÃ©finit la cascade en ne plus lâ€™utilisant comme par exemple : <code>.header .title.is-active</code> mais <code>.header__title--is-active</code>, BEM venant de Block, Element, Modifier. Câ€™est exactement ce que je viens de dÃ©couper en une seule classe plutÃ´t que 3.</p>
<p>Pour ma part, jâ€™utilise la convention de nommage qui se rapproche trÃ¨s fortÃ©ment du framework JavaScript â€œMontage.jsâ€ : <code>.org-(js-)-MyBlock-myElement--myModifier</code>.</p>
<p>Je ne souhaite volontairement pas mâ€™Ã©tendre sur le sujet car je vous invite Ã  lire <a href="/posts/css/petite-definition-bem/">mon article Ã  ce sujet</a>.</p>
<p>Je vous laisse tout de mÃªme deux articles Ã  ce sujet qui prÃ©sentent plutÃ´t bien le principe (ils sont en anglais).</p>
<ul>
<li><a href="http://www.smashingmagazine.com/2012/04/16/a-new-front-end-methodology-bem/">A New Front-End Methodology: BEM</a></li>
<li><a href="http://webdesign.tutsplus.com/articles/an-introduction-to-the-bem-methodology--cms-19403">An Introduction to the BEM Methodology</a></li>
</ul>
<h3 id="semantique"><a class="putainde-Title-anchor" href="#semantique">#</a>SÃ©mantique</h3><p>On est tous dâ€™accord, faire de la sÃ©mantique oui, quand cela ne va pas Ã  lâ€™encontre de la maintenabilitÃ© et de la rÃ©utilisation de code.</p>
<p>Pour ma part, trop de fois je me suis pris la tÃªte sur la sÃ©mantique au point de faire des classes uniques qui ont du sens mais qui <code>@extend</code> (voir prÃ©-processeurs) une classe gÃ©nÃ©rique.</p>
<h3 id="accessibilite"><a class="putainde-Title-anchor" href="#accessibilite">#</a>AccessibilitÃ©</h3><p>Pour Ãªtre franc, lâ€™accessibilitÃ© a un coÃ»t en terme de temps qui nâ€™est jamais nÃ©gligeable et rentre souvent en conflit avec lâ€™UX dâ€™une personne sans handicap.</p>
<p>Typiquement, imaginons que nous avons un formulaire bancaire, comment faire un boucle uniquement sur ce formulaire (pratique dans le cas dâ€™une personne sans handicap) tout en ne contraignant la navigation â€œclassiqueâ€ ?</p>
<p>Le constat est lÃ  aussi, nous sommes tous ici sensibilisÃ©s par lâ€™accessibilitÃ©, nous essayons dâ€™en faire le plus possible (souvent sur notre temps libre ou entre deux tÃ¢ches) mais personne nâ€™administre du temps Ã  cela.</p>
<p>Une Ã©ventuelle solution a Ã©mmergÃ© durant les discussions : pourquoi ne pourrait-on pas connaÃ®tre dâ€™emblÃ©e la situation de lâ€™utilisateur lorsquâ€™il arrive sur le site ?</p>
<p>Un navigateur dÃ©diÃ© Ã  certains handicaps devrait Ãªtre dÃ©tectable dâ€™entÃ©e de jeu et que lâ€™on puisse nous dÃ©veloppeurs faire en consÃ©quence dans ce cas lÃ .</p>
<p>Câ€™est exactement comme lâ€™histoire de rÃ©solution / bande passante. Le w3c nous propose Ã  lâ€™heure actuelle de dÃ©tecter la rÃ©solution pour faire en consÃ©quence sur notre site, or, ce nâ€™est pas du tout le pivot intÃ©ressant, câ€™est surtout la bande passante qui nous permet dâ€™ajuster notre site web.</p>
<p>Bref, comme souvent, le W3C est Ã  la rue, nâ€™avance pas comme le web avance (vite, trÃ¨s vite) et les outils nous font dÃ©faut Ã  lâ€™heure actuelle pour rÃ©pondre Ã  certains besoins. (Note : je ne dis pas quâ€™ils ne font pas un bon boulot ou que ce nâ€™est pas compliquÃ©, je dis simplement quâ€™il y a un grand Ã©cart encore les besoins et les solutions Ã  lâ€™heure actuelle sur plusieurs domaines : lâ€™accessibilitÃ©, la video, la capacitÃ© de fournir un site en fonction de la bande passante plutÃ´t que la rÃ©solution, etc, etc).</p>
<h3 id="les-pieges-de-l-integration-e-g-display-inline-block-"><a class="putainde-Title-anchor" href="#les-pieges-de-l-integration-e-g-display-inline-block-">#</a>Les piÃ¨ges de lâ€™intÃ©gration (e.g. display: inline-block)</h3><p>Certains cas de lâ€™intÃ©gration restent encore du domaine hack plutÃ´t quâ€™une solution propre et faible. On ne dit pas que ces hacks sont difficiles ou laborieux mais quâ€™ils sont encore nÃ©cessaires sur des propriÃ©tÃ©s css trÃ¨s communes en 2014.</p>
<p>Lâ€™inline-block par exemple, il nâ€™y a malheureusement pas le choix de soit coller les balises, soit minifier le html (ou la partie ayant des inline-block), soit de mettre des commentaires.</p>
<p>Les layouts seront toujours aussi pÃ©nibles tant que les flexbox ne sont pas supportÃ©s par la majoritÃ© des navigateurs du marchÃ©. Les 3 solutions principales pour le moment : float, inline-block, table(-cell).</p>
<p>En ce qui concerne le box-sizing, il sauve beaucoup dâ€™intÃ©gration. Il faut juste voir le support des navigateurs que vous supportez. 
Oh et attention, tous les navigateurs ne font pas 16px de base. Je dis Ã§a si vous utilisez les <code>(r)em</code> (qui sont expliquÃ©s juste aprÃ¨s).</p>
<p>Enfin, <code>&lt;input type=&quot;number&quot;&gt;</code> est tout buggÃ© sous Firefox. Par exemple, mettre min=â€1900â€ sur cet input et que vous cliquez sur le â€œ+â€, vous commencerez Ã  â€œ1â€ et non â€œ1900â€â€¦ Je sens que je vais devoir encore faire un ticket. :â€™)</p>
<h3 id="unites-px-rem-em-pt-"><a class="putainde-Title-anchor" href="#unites-px-rem-em-pt-">#</a>UnitÃ©s px, rem, em, pt, %</h3><p>Pour Ãªtre clair, personne nâ€™utilise des <code>pt</code>, les <code>px</code>, faut les oublier de plus en plus, et <code>rem</code> est sÃ»rement le plus simple et le mieux mais dÃ©pend malheureusement de vos supports navigateurs oÃ¹ dans quels cas il faut souvent se rabattre sur les <code>em</code>. Le pourcentage est forcÃ©ment prÃ©conisÃ©.</p>
<h3 id="css-frameworks-lesquels-pourquoi-quand-"><a class="putainde-Title-anchor" href="#css-frameworks-lesquels-pourquoi-quand-">#</a>CSS Frameworks ? lesquels ? pourquoi ? quand ?</h3><p><a href="http://foundation.zurb.com/">Foundation</a>, <a href="http://getbootstrap.com/">Bootstrap</a>, <a href="http://purecss.io/">pure</a> sont les plus connus (et peut-Ãªtre les pires). Il ne vous serviront uniquement que dans le cas dâ€™une <a href="http://fr.wikipedia.org/wiki/Preuve_de_concept">PoC</a> ou une administration de site (<em>back-office</em>).</p>
<p>Par contre, <a href="http://topcoat.io/">topcoat</a> peut se rÃ©vÃ©ler assez intÃ©ressant de par sa haute personnalisation et de son <em>BEM-way</em>. Eventuellement <a href="http://inuitcss.com/">inuit.css</a> sinon.</p>
<h3 id="bonus"><a class="putainde-Title-anchor" href="#bonus">#</a>Bonus</h3><p>Lors de cas de contenus affichÃ©s via de lâ€™ajax, pensez de plus en plus Ã  faire du â€œprerenderâ€, câ€™est Ã  dire que pendant que le contenu se charge, au lieu de mettre des <em>spinners</em>, <em>loaders</em>, <em>toussa</em>, essayez de mettre des visuels qui ressembleront Ã  lâ€™Ã©lÃ©ment final. Câ€™est ce que fait par exemple facebook, et câ€™est pas mal du tout. Tenez :</p>
<p><img src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAIBAQEBAQIBAQECAgICAgQDAgICAgUDBAMEBgUGBgYFBQUGBwkIBgcIBwUFCAsICAkKCgoKBgcLDAsKDAkKCgr/2wBDAQICAgICAgUDAwUKBgUGCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgr/wgARCAFPAfoDASIAAhEBAxEB/8QAHAABAAMBAQEBAQAAAAAAAAAAAAMGBwQFAgEJ/9oACAEBAAAAAP7U+5+gAAAAAAAAA4fPm04AAAAAAAAACt0+bTvO5B6XUAAAAAAAACt0+bTvL4x6nxzADv6QAAAAAAVunzad5fGPU7AAAAAAAAAVunzad5fGPUc4ffogAAAAAABW6fNp3l8Y9Tq+Q/fsAAAAAAAK3T5tO+fkff6AAAAAAAACt0+bTgAAAAAAAAAK3T5tOgiAAAAAAAASzgK3T5tOgiAAAAAAAASzgK3T5tOAAAAAAAAAArdPm07g5gAAAAAAAAd/SK3T5tOAAAAAAAAAArdPm07j5wAADo7AAAAAAK3T5tO+fkAAA+voAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+bTgAAAAAAAAAK3T5tOAAAAAAAAAArdPm04AAAAAAAAACt0+XTwAAAAAAAAAK1UPz8AAAAAAAAAAfX/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAgMB/9oACAECEAAAANZAAAABc87yejnAAADaTkjgAAAbTJIAAABtMAAAAODaYAAAAcG0x0AAABzjaY6AJAAA2nMAAAAG05gAAAA2nMAAAAG05gAAAA2nMAAAAG05gAAAA2nMAAAAG05gAAAA2nMAAAAG05gAAAA2nMAAAAG05gAAAA2SAAAAC//EABYBAQEBAAAAAAAAAAAAAAAAAAACAf/aAAgBAxAAAACdAAAABNTlaDQAACKnK00AAAEVjdAAAAIoAAAA0RQAAABoigAAAA1FAA0AACK0AAAAEVoAAAAIrQAAAARWgAAAAitAAAABFaAAAACK0AAAAEVoAAAAIrQAAAARWgAAAAitAAAABFaAAAACGgAAAAz/xAAjEAABBAIBBAMBAAAAAAAAAAAVBQcQFxRQAwACBCABBjAR/9oACAEBAAECAOPsrquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rquq6rpb+s9J2+c6E6Fjny8vLy0jk2znQnQt+qJ0qfml6tzoToW/VE27nQnQt+qJ0oqJs2bNm+BX17nQnQt+qJ138GJiYmJifHi69zoTo7+DExMTE7OPbOdCdvnOhOjylE2bNmzZs2bNmzZs2bNmzZs2bNmzZs2bNmzZs2bNmzZs2bNmzZs2bNmzZs2b8VR/BzoTo8pOCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBPFTvwc6E7fOdCdCp4QsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixaX4/o50J2+c6E6FFRNmzZs2bNmzZs2bNmzZs2bNmzaco6VzoTo7+DExMTExMTExMTExMTExMTExMTExMTs4NK50J2+c6E7fOdCdvnOhO3znQnb5zoTt850J2+c6E7fOdCdvnOhO3znQnb5zoTt850J2+c6E7fOdCdvnOhO3znQnb5zoTt850J2+c6E7fOdCdvnOhO3znQnb5zoTt850J2+c6OTs/m8+OPr/xAA8EAAAAwQFDAECBQQCAwAAAAAAAQQCA1PRBSV1kbMGEBFQVFaSk5Wi0tMSUWQiJEFzsRQgITETMGFxdP/aAAgBAQADPwBp69YcOy0tPHjLDBfVpoyIivMhlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwGUMdHzm/AZQx0fOb8BlDHR85vwFJ5Punb5e05aZevPgy05bNr8Wgz0HpIv0I7s1bIbQT4rOvqpR2gWE8zVshtBPis5n7pSyy7fNsl8C/wy0ZfqYV7S84zCvaXnGYV7S84zCvaXnGYePUzTTx400f8AyH/lo9P6FreqUdoFhPM1bIbQT4rOb82z+2X8n/b+Va/cP+CC3+oL+m/5fj8P8/DTo06T+gpX7juFK/cdwpX7juFK/cdwpX7juFK/cdwpX7juFK/cdwpX7juFK/cdwUf07X9T8/l8z0fPTp0aC+uq6pR2gWE8zVshtBPis5vzbP7Zfyf9v5Vr9w/4LW9Uo7QLCeZq2Q2gnxWc35tn9sv5P+38q1+4f8EH6R+Tt2yyZGzp/ER/Uwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFL1+w7aYY0NNkR6CP6/wDvWFUo7QLCeZq2Q2gnxWc35tn9sv5P+38q1+4f8EHL0/k8cstH9WmSMJdmd8BBLszvgIJdmd8BBLszvgIJdmd8BBMyZNMp2CMj/wAGTBawqlHaBYTzNWyG0E+KzmcvT+Txyy0f1aZIwl2Z3wEEuzO+Agl2Z3wEEuzO+Ag7dF8XbBMlp/0yWjW9Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZzOUjwnbxlszMtP4SIJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMJYby4phLDeXFMOVbw3btlsjItP4iL/pqlHaBYTzNWyG0E+Kzmcq3hPHjbZGRaPwmQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQSxHl5SCWI8vKQcpHhvHbbZmZaPxGX/TVKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWcylSoJty7+RExo0/Ii/Uwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUwvgd5TC+B3lML4HeUw+Tp2mHzGgzbM9GnT+hf21SjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnM/SPydu2WTI2dP4iP6mFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccwrhu7jmFcN3ccw/VvzdvGWSImdP4SP6lqaqUdoFhPM1bIbQT4rOZy9P5PHLLR/VpkjCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQS7M74CCXZnfAQcuj+Ttyyyf1ZZItTVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZDaCfFZ19VKO0CwnmatkNoJ8VnX1Uo7QLCeZq2Q2gnxWdfVSjtAsJ5mrZEf37jFZ19VKP8A+8sJ5mYesG7eFpZaLQZfUgt/Sn6XL/wVMqfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYF28FL9aU+wLt4KX60p9gXbwUv1pT7Au3gpfrSn2BdvBS/WlPsC7eCl+tKfYHhvCev1yt+0RGTJqlrxR8SP/ej5tHo06C/19M3/8QAHhEAAgMAAwEBAQAAAAAAAAAAAAECERIDMTJAECD/2gAIAQIBAT8AlJo3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3I3Ii20cnYuvx9FFFFFDXzQ8nJ2Lr8fRTMsyxqvoh5OTs0aG7+yHk5OymUymUymUymUymUymUymUymUymUymUymUymUymU/5h5OTstlstlstlstlstlstlstlstlstlstlstlstlstlv+YeTk7NM0zTNM0zTNM0zTNM0zTNM0zTNM0zTNM0zTNM0zTNM0zTG2/wBh5OTstFotFotFotFotFotD+OHk5O/vh5OTv74eTk7++Hk5O/vh5OTv74eTk7++Hk5O/vh5OTv74eTk7++Hk5O/vh5OTv74eTk7++HklGzDMMwzDMMwzDMMwzDMMwzDMMwzDMMwzDMMwzDMMwzDMMwzDMMwyKpH//EAB0RAAMBAQEBAQEBAAAAAAAAAAABEhExAkAQICH/2gAIAQMBAT8AS0lEolEolEolEolEolEolEolEolEolEolEolEolEolEolEofTzwffzz000000T35n088H3889NRSKQnv0Pp54NayRLPsfTzw1Go1Go1Go1Go1Go1Go1Go1Go1Go1Go1Go1Go1Gr+X088MRiMRiMRiMRiMRiMRiMRiMRiMRiMRiMRiMRiMRi/l9PPBrSUSiUSiUSiUSiUSiUSiUSiUSiUSiUSiUSiUSiUShLP19PPDGYzGYzGYzGYzGYzGL43088+99PPPvfTzz73088+99PPPvfTzz73088+99PPPvfTzz73088+99PPPvfTzz730Twoooooooooooooooooooooooooooooof8ArP/Z
"></p>
<p>VoilÃ  pour cette table ronde, jâ€™espÃ¨re que le compte rendu vous a plu. Il est Ã©vident que câ€™est sÃ»rement plus intÃ©ressant en direct, on essayera peut-Ãªtre par la suite de faire du streaming (live) ou du podcast, Ã  voir.</p>
<p>Nâ€™hÃ©sitez pas Ã  continuer le dÃ©bat dans les commentaires.</p>
<p>Pour ma part, jâ€™ai dÃ©jÃ  dâ€™autres articles â€œdans le pipeâ€ (comme disent certains marketeux). Je vous retrouve bientÃ´t ici ou sur Twitter, kiss.</p>

]]></description><pubDate>Mon, 05 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/table-ronde/bonnes-pratiques-et-organisation-css-html/</link><guid isPermaLink="true">http://putaindecode.fr/posts/table-ronde/bonnes-pratiques-et-organisation-css-html/</guid></item><item><title>Introduction au testing js front</title><description><![CDATA[[
<p>Les tests automatisÃ©s en front-end ont longtemps Ã©tÃ© ignorÃ©s,
et le sont encore trop.</p>
<p>Ã‰crire des tests peut paraÃ®tre chiant, mais le temps quâ€™ils rapportent
compense largement celui que lâ€™on passe Ã  les Ã©crire.</p>
<h2 id="ecrire-du-js-testable"><a class="putainde-Title-anchor" href="#ecrire-du-js-testable">#</a>Ã‰crire du js testable</h2><p>Prenons un exemple simple et moche :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//app.js</span>
;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

  <span class="hljs-keyword">var</span> cart = $(<span class="hljs-string">"#cart"</span>)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToCart</span><span class="hljs-params">(id)</span>{</span>
    <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>)
    element.html(catalog[id])
    cart.append(element)
  }

  $(<span class="hljs-string">".js-updateCart"</span>)
    .on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
      addToCart($(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"id"</span>))
    })

})()
</code></pre>
<p>Tester ce code est particuliÃ¨rement lourd, pour plusieurs raisons :</p>
<ul>
<li>les functions Ã  tester ne sont pas accessibles</li>
<li>on doit simuler un <code>click</code> pour tester un comportement logique.</li>
<li>on doit crÃ©er un element et modifier sont <code>data-id</code> Ã  chaque cas souhaitÃ©.</li>
<li>pour tester <code>addToCart</code> on doit aller regarder dans le DOM.</li>
</ul>
<h3 id="1-rendez-accessibles-vos-methodes-au-test-runner"><a class="putainde-Title-anchor" href="#1-rendez-accessibles-vos-methodes-au-test-runner">#</a>1. Rendez accessibles vos mÃ©thodes au test runner</h3><p>Vous pouvez utiliser un namespace adÃ©quat.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> app = window.app = {}
app.cart = {}
app.cart.addToCart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-comment">/* â€¦ */</span> }
</code></pre>
<p>Mais ne souhaitez probablement pas rendre vos mÃ©thodes accessibles Ã  la console.</p>
<p>Utilisez un module-system : <a href="http://browserify.org">browserify</a> ou
<a href="http://requirejs.org">requirejs</a> (si vous nâ€™avez pas besoin de chargement
conditionnel et souhaitez crÃ©er un bundle par build, utilisez browserify qui
possÃ¨de une syntaxe beaucoup plus sympathique et une codebase rÃ©duite, vous
pourrez mÃªme <code>require</code> depuis un module npm
<a href="/posts/js/browserify-all-the-things/">comme on vous lâ€™explique dans un article dÃ©diÃ©</a>).</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>) <span class="hljs-comment">// oh, un module npm</span>

module.exports = {
  element : $(<span class="hljs-string">"#cart"</span>),
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-comment">/* â€¦ */</span>
  }
}
</code></pre>
<p>Vous pourrez ainsi sÃ©parer proprement votre application en modules et les tester individuellement.</p>
<h3 id="2-oui-mais-les-modules-interdependants-alors-"><a class="putainde-Title-anchor" href="#2-oui-mais-les-modules-interdependants-alors-">#</a>2. Oui, mais les modules interdÃ©pendants alors ?</h3><p>LÃ , Ã§a devient un peu plus tricky.
Ce que je conseille Ã  titre personnel câ€™est dâ€™utiliser des events
pour faire communiquer les diffÃ©rentes parties de lâ€™application.</p>
<p>Cela permet dâ€™Ã©viter dâ€™utiliser des mocks dâ€™autres parties de lâ€™application partout.</p>
<p>Par exemple, si je souhaite tester le fait quâ€™un click sur <code>.js-updateCart</code>
dÃ©clanchera bien <code>updateCart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//view.js</span>

<span class="hljs-comment">// view est une petite class qui route les events</span>
<span class="hljs-comment">// en rendant les listeners accessibles aux tests</span>
<span class="hljs-comment">// vous pouvez trÃ¨s facilement en concevoir une</span>
<span class="hljs-comment">// Ã  votre goÃ»t en quelques lignes de code</span>
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/view"</span>)

<span class="hljs-comment">// eventbus est l'event bus de l'application, il orchestre</span>
<span class="hljs-comment">// la communication entre les diffÃ©rents modules</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)

<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

module.exports = view.extend({
  element : document.body,
  events : [
    {
      type : <span class="hljs-string">"click"</span>,
      selector : <span class="hljs-string">".js-addToCart"</span>,
      listener : <span class="hljs-string">"addToCart"</span>
    }
  ],
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-keyword">var</span> target = eventObject.currentTarget
    <span class="hljs-keyword">var</span> id = $(target).data(<span class="hljs-string">"id"</span>)
    eventbus.fire(<span class="hljs-string">"addToCart"</span>, {
      id : id
    })
  }
})
</code></pre>
<p>et je nâ€™aurais quâ€™Ã  Ã©couter cet event depuis <code>cart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.js</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

module.exports = {
  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">this</span>._addToCart = <span class="hljs-keyword">this</span>.addToCart.bind(<span class="hljs-keyword">this</span>)
    eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  release : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    eventbus.stopListening(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-comment">// et on a eventObject.id</span>
    <span class="hljs-keyword">this</span>.products.push(catalog[eventObject.currentTarget.data(<span class="hljs-string">"id"</span>)])
  }
}
</code></pre>
<p>GrÃ¢ce Ã  cette architecture, je vais pouvoir tester individuellement
les deux modules.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// view.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/view"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

tape(<span class="hljs-string">"view"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  test.plan(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>)
  element.data(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>)
  <span class="hljs-comment">// on teste facilement l'envoi</span>
  eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    test.equal(eventObject.id, <span class="hljs-number">1</span>)
  })
  view.addToCart({
    currentTarget : element
  })
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> cart = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/cart"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

tape(<span class="hljs-string">"cart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  cart.initialize()
  eventbus.fireSync(<span class="hljs-string">"addToCart"</span>, {id:<span class="hljs-number">1</span>})
  test.deepEqual(
    cart[<span class="hljs-number">0</span>],
    catalog[<span class="hljs-number">1</span>],
    <span class="hljs-string">"receives addToCart event"</span>
  )
  test.end()
})
</code></pre>
<h2 id="tester-tous-les-cas-possibles"><a class="putainde-Title-anchor" href="#tester-tous-les-cas-possibles">#</a>Tester tous les cas possibles</h2><p>Ce sont souvent les edge-cases qui nous font nous arracher les cheveux.
Pour pallier ces soucis, tester en profondeur est essentiel.</p>
<p>Prenons un exemple, une mÃ©thode qui teste si la valeur quâ€™on lui passe est
une <code>string</code>.</p>
<p>On serait tentÃ© de simplement tester les rÃ©sultats positifs de cette faÃ§on :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.equal(<span class="hljs-built_in">type</span>.isString(<span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>Or, si par mÃ©garde ma mÃ©thode <code>isString</code> se rÃ©vÃ¨le Ãªtre :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">"string"</span>
}
</code></pre>
<p>on ne vÃ©rifie pas le cas <code>type.isString(new String(&quot;&quot;))</code>.</p>
<p>Du coup, des tests complets :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-keyword">function</span>(test){
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-keyword">new</span> String(<span class="hljs-string">""</span>)), <span class="hljs-keyword">false</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>permettent ici dâ€™identifier quâ€™en rÃ©alitÃ© on a besoin de :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(value) == <span class="hljs-string">"[object String]"</span>
}
</code></pre>
<p>Et câ€™est Ã  la force des rÃ©sultats de tests que vous identifierez rapidement
vous familiariserez Ã  tous ces edge-cases.</p>
<p>Ã€ chaque correctif de bug, ajoutez des tests (mais Ã§a, vous le saviez dÃ©jÃ ).</p>
<h2 id="cross-browser-testing"><a class="putainde-Title-anchor" href="#cross-browser-testing">#</a>Cross-browser testing</h2><p>Ã€ lâ€™heure actuelle, oÃ¹ lâ€™on se trouve notamment trÃ¨s souvent avec du
feature testing.
Pour le tester complÃ¨tement, on doit se servir de vrais navigateurs :
un headless (certes, trÃ¨s pratique) comme <a href="http://phantomjs.org">phantomjs</a>
ne permettra pas dâ€™obtenir 100% de coverage.</p>
<pre><code class="lang-javascript">var supportsAnimationFrame =
  !!(
    win.requestAnimationFrame <span class="hljs-string">||</span>
    win.webkitRequestAnimationFrame <span class="hljs-string">||</span>
    win.mozRequestAnimationFrame <span class="hljs-string">||</span>
    win.ORequestAnimationFrame <span class="hljs-string">||</span>
    <span class="hljs-comment">// vous avez fait une faute de frappe,</span>
    <span class="hljs-comment">// et mis un `O` majuscule, seul un</span>
    <span class="hljs-comment">// test sur les version concernÃ©es d'Opera</span>
    <span class="hljs-comment">// vous permettront de l'identifier</span>
    win.msRequestAnimationFrame
  )
</code></pre>
<p>De plus, vous pouvez par habitude Ãªtre tentÃ© dâ€™utiliser un
<code>Array.prototype.forEach</code> alors que votre scope navigateur inclut
IE8; seuls des tests sur un vrai browser vous permettront dâ€™identifier le souci.</p>
<p>Je vous conseille fortement testling, trÃ¨s simple Ã  intÃ©grer dans vos
modules, et gratuit pour tout projet open-source.</p>
<p>Dans le <code>package.json</code> :</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">testling</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">files</span>": <span class="hljs-value"><span class="hljs-string">"test/**/*.js"</span></span>,
    "<span class="hljs-attribute">browsers</span>": <span class="hljs-value">[
      <span class="hljs-string">"ie/9..latest"</span>,
      <span class="hljs-string">"chrome/22..latest"</span>,
      <span class="hljs-string">"firefox/16..latest"</span>,
      <span class="hljs-string">"safari/6..latest"</span>,
      <span class="hljs-string">"opera/11.0..latest"</span>,
      <span class="hljs-string">"iphone/6..latest"</span>,
      <span class="hljs-string">"ipad/6..latest"</span>,
      <span class="hljs-string">"android-browser/latest"</span>
    ]
  </span>}
</span>}
</code></pre>
<p>Et ajouter un webhook dans lâ€™admin de votre repository GitHub pointant vers</p>
<blockquote>
<p><a href="http://git.testling.com">http://git.testling.com</a></p>
</blockquote>
<p>Vous pouvez lâ€™utiliser avec tape (son test harness par dÃ©faut)
Mocha, QUnit et nâ€™importe quelle bibliothÃ¨que
de test supportant <code>TAP</code> comme indiquÃ© sur
<a href="https://ci.testling.com/guide/custom_libraries">le site de testling</a>.</p>
<p>Vous trouverez aussi des alternatives populaires
<a href="http://www.browserstack.com">similaires</a>,
ou ayant <a href="http://karma-runner.github.io">une approche diffÃ©rente</a>.</p>
<p>Par ailleurs, si dans votre code il existe des variations entre les navigateurs,
vous pouvez utiliser du test conditionnel :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">if</span>(typeof {}.__proto__ == <span class="hljs-string">"object"</span>){
  test.equal(<span class="hljs-keyword">list</span>.__proto__ === <span class="hljs-keyword">Array</span>.prototype, <span class="hljs-keyword">false</span>, <span class="hljs-string">"__proto__ isn't Array.prototype"</span>)
} <span class="hljs-keyword">else</span> {
  test.equal(<span class="hljs-keyword">list</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">Array</span>, <span class="hljs-keyword">false</span>, <span class="hljs-string">"Isn't a window Array"</span>)
}
</code></pre>
<p>Happy testing!</p>
<pre><code class="lang-shell">$ testling

TAP version <span class="hljs-number">13</span>
<span class="hljs-preprocessor"># tests</span>
ok <span class="hljs-number">1</span> bisous

<span class="hljs-number">1.</span><span class="hljs-number">.1</span>
<span class="hljs-preprocessor"># tests 1</span>
<span class="hljs-preprocessor"># pass  1</span>

<span class="hljs-preprocessor"># ok</span>
</code></pre>

]]></description><pubDate>Thu, 01 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</guid></item><item><title>Introduction Ã  Gulp</title><description><![CDATA[[
<p>Vous commencez tous Ã  connaitre les <em>tasks runners</em>, ces outils qui permettent
dâ€™automatiser les tÃ¢ches de dÃ©veloppement rÃ©currentes.
Personnellement
 <a href="http://moox.io/slides/2013/grunt-before-after/">je nâ€™ai</a>
 <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">pas arrÃªtÃ©</a>
 <a href="http://moox.io/slides/2014/introduction-gulp/">dâ€™en parler</a>
 depuis que
 <a href="/posts/js/premiers-pas-avec-grunt/">Grunt</a>
 Ã  dÃ©terrÃ© cette vielle problÃ©matique, assez rÃ©cente pour le dÃ©veloppement Web cÃ´tÃ© front end.</p>
<p>Il faut avouer que de par lâ€™Ã©volution du dÃ©veloppement Web, cÃ´tÃ© front end,
on voit beaucoup de personnes qui nâ€™ont pas de vraies bases de dÃ©veloppeur.
Je veux dire par lÃ  non pas que ces personnes sont incompÃ©tentes, mais plutÃ´t
quâ€™il manque parfois la bonne flemme du dÃ©veloppeur, celle qui le pousse Ã  <strong>dÃ©velopper</strong>
des solutions techniques pour mieux dÃ©velopper des produits.
Il manque un peu <a href="http://fr.wiktionary.org/wiki/algorithmie">dâ€™algorithmie</a>
dans les veines, de curiositÃ© et dâ€™amour du risque.
Ce nâ€™est pas en restant dans sa zone de confort quâ€™on va de lâ€™avant. Enfin si vous
avez des exemples contraires, je suis preneur.
Mais tout cela doit provenir du fait que pas mal de mÃ©tiers dans le web sont nouveaux,
dont celui de Â« dÃ©veloppeur Web front end Â» et que du coup, peu de personnes ont
initialement suivi des formations appropriÃ©s (pour ma part je proviens dâ€™une
formation <em>dâ€™analyste-programmeur</em>, conception et dÃ©veloppement software quoi).
Je remarque que niveau back end il y a beaucoup moins de lacunes, du fait que
les problÃ©matiques gÃ©rÃ©es de ce cÃ´tÃ© sont (il me semble) moins nouvelles.</p>
<p>Bref. Je ne vais pas mâ€™Ã©terniser sur une intro du pourquoi on met en place un task
runner, ni faire une comparaison entre Make, Rake, Cake, Jake, Grunt, Brunch
et Broccoli.
Rentrons dans le vif. Parlons Gulp.</p>
<h1 id="pourquoi-gulp"><a class="putainde-Title-anchor" href="#pourquoi-gulp">#</a>Pourquoi Gulp</h1><p>Je vais faire court. Pour faire simple, son point fort rÃ©side dans le fait quâ€™il utilise des
<a href="http://dailyjs.com/2012/09/10/streams/">streams</a> (tl;dr: un flux de donnÃ©es - en mÃ©moire)
et quâ€™il limite au maximum lâ€™utilisation de fichiers.
Au point quâ€™il existe une <a href="https://github.com/godaddy/gulp-header/issues/4#issuecomment-32111457">police Gulp</a>
pour vous dire.
Si vous voulez en savoir plus sur les streams, nâ€™hÃ©sitez pas Ã  lire lâ€™article de
Nicolas Froidure <a href="http://www.insertafter.com/articles-gulp_vs_grunt.html">Gulp remplacera-t-il Grunt ?</a>
qui contient une partie explicative sur les streams.</p>
<p>Dans la pratique cela Ã©vite dâ€™avoir un gruntfile qui, si on imagine une task
sass -&gt; autoprefixer -&gt; csso, passe <a href="/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-grunt">3 fois par des lectures/Ã©critures sur le systÃ¨me
de fichiers</a>.</p>
<figure>
  <img src="http://jaysoo.ca/images/grunt-flow-2.png" alt="">
  <figcaption>Sans stream</figcaption>
</figure>

<p>Et du coup au lieu dâ€™avoir un fichier de conf dâ€™une soixantaine de lignes, on arrive
Ã  avoir <a href="http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-gulp">quelque chose de concis</a>
(une vingtaine de ligne seulement).</p>
<figure>
  <img src="http://jaysoo.ca/images/gulp-flow.png" alt="">
  <figcaption>Avec stream</figcaption>
</figure>

<h2 id="installation"><a class="putainde-Title-anchor" href="#installation">#</a>Installation</h2><p>Pour avoir la commande globale sur le systÃ¨me (comme grunt-cli) :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>npm i -g gulp
</code></pre>
<p>Ensuite dans votre projet :</p>
<pre><code class="lang-shell">$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-WHATEVER</span>
</code></pre>
<p><em>Note : <code>npm i -D</code> == <code>npm install --save-dev</code>, câ€™est cadeau.</em></p>
<p>Bon dans mon exemple jâ€™ai mis un peu nâ€™importe quoi, donc on va faire un mini workflow de hipster hacker.</p>
<h2 id="utilisation"><a class="putainde-Title-anchor" href="#utilisation">#</a>Utilisation</h2><p>On part avec une tÃ¢che trÃ¨s simple : prÃ©-processeur CSS <a href="http://myth.io">Myth</a> et
optimisation avec <a href="https://github.com/css/csso">CSSO</a>.</p>
<pre><code class="lang-shell">$ mkdir putaindegulp <span class="hljs-subst">&amp;&amp;</span> cd putaindegulp
$ npm init
$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-myth</span> gulp<span class="hljs-attribute">-csso</span> minimist
</code></pre>
<pre><code class="lang-js">var gulp = require(<span class="hljs-string">"gulp"</span>)
  , gutil = require(<span class="hljs-string">"gulp-util"</span>)
  , plumber = require(<span class="hljs-string">"gulp-plumber"</span>)
  , myth = require(<span class="hljs-string">"gulp-myth"</span>)
  , csso = require(<span class="hljs-string">"gulp-csso"</span>)
  , options = require(<span class="hljs-string">"minimist"</span>)(process<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.slice</span>(<span class="hljs-number">2</span>))

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"styles"</span>, function() {
  gulp<span class="hljs-preprocessor">.src</span>(<span class="hljs-string">"./src/css/*.css"</span>)
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? plumber() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(myth({sourcemap: !options<span class="hljs-preprocessor">.production</span>}))
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? csso() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(gulp<span class="hljs-preprocessor">.dest</span>(<span class="hljs-string">"./dist/css/"</span>))
})

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], function() {
  gulp<span class="hljs-preprocessor">.watch</span>(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})
</code></pre>
<p>VoilÃ  câ€™est tout. Et heureusement.</p>
<p>Bon, on se refait lâ€™exemple commentÃ© :</p>
<pre><code class="lang-js"><span class="hljs-comment">// bah lÃ  ok, on est obligÃ© d'y passer pour avoir l'API Gulp</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)

  <span class="hljs-comment">// Ã‡a c'est optionnel, c'est pour avoir (entre autres la mÃ©thode noop())</span>
  <span class="hljs-comment">// je reviens dessus aprÃ¨s</span>
  <span class="hljs-comment">// https://github.com/gulpjs/gulp-util</span>
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)

  <span class="hljs-comment">// LÃ  on a Mario le plombier qui fixe la tuyauterie foireuse.</span>
  <span class="hljs-comment">// Ce plugin patch le problÃ¨me de stream avec node.js qui fait que tout le process</span>
  <span class="hljs-comment">// explose Ã  la moindre erreur (pas pratique en cas de watch par exemple)</span>
  <span class="hljs-comment">// en gros, il remplace la mÃ©thode pipe et attrape les erreurs pour les ressortir gentiment</span>
  <span class="hljs-comment">// https://gist.github.com/floatdrop/8269868</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

  <span class="hljs-comment">// Ici, rien de magique, du plugin en veux-tu en voilÃ </span>
  , myth = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-myth"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

  <span class="hljs-comment">// ici on chope les options de la ligne de commande</span>
  <span class="hljs-comment">// exemple: pour avoir options.production Ã  true,</span>
  <span class="hljs-comment">// il suffit de faire `gulp --production`</span>
  , options = <span class="hljs-built_in">require</span>(<span class="hljs-string">"minimist"</span>)(process.argv.slice(<span class="hljs-number">2</span>))

<span class="hljs-comment">// DÃ©finition d'une tÃ¢che, un nom et une fonction.</span>
<span class="hljs-comment">// Ce qui est pratique c'est le fait de pouvoir mettre ce qu'on veut</span>
<span class="hljs-comment">// y compris un console.log() ^^</span>
<span class="hljs-comment">// un autre paramÃ¨tre peut Ãªtre ajoutÃ© avant la fonction, qui permet de prÃ©ciser</span>
<span class="hljs-comment">// les dÃ©pendances (cf task dev plus bas par exemple)</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// Ici on attrape les fichiers (glob classique)</span>
  <span class="hljs-comment">// Ã  la racine (on va considÃ©rer que nos fichiers finaux ne seront pas dans</span>
  <span class="hljs-comment">// des sous dossiers, rÃ©servÃ©s aux partials &amp; co)</span>
  gulp.src(<span class="hljs-string">"./src/css/*.css"</span>)

    <span class="hljs-comment">// On utilise plumber que si on build en dev, sinon faut que Ã§a pÃªte, qu'on</span>
    <span class="hljs-comment">// soit prÃ©venu lors d'un build pour la prod</span>
    .pipe(options.production ? plumber() : gutil.noop())

    <span class="hljs-comment">// Et lÃ  on pipe nos plugins</span>
    <span class="hljs-comment">// toujours en jouant avec les options si besoin</span>
    .pipe(myth({sourcemap: !options.production}))
    .pipe(options.production ? csso() : gutil.noop())

    <span class="hljs-comment">// Super important, on convertit nos streams en fichiers</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
})

<span class="hljs-comment">// Ici on a une tÃ¢che de dev qui lance un watch APRES avoir exÃ©cutÃ© `styles` une fois</span>
gulp.task(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// gulp.watch est natif (pas comme avec grunt)</span>
  <span class="hljs-comment">// vous noterez qu'ici par exemple on va surveiller tous les fichiers</span>
  <span class="hljs-comment">// et non pas ceux juste Ã  la racine par exemple</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})

<span class="hljs-comment">// Comme grunt, `gulp` sans argument lancera la tÃ¢che `default`.</span>
</code></pre>
<p>Bien entendu, vous avez dÃ©jÃ  compris que si vous voulez remplacer Myth par Sass,
câ€™est lâ€™histoire de 4 secondes.</p>
<h2 id="putain-de-code-approuve-gulp-"><a class="putainde-Title-anchor" href="#putain-de-code-approuve-gulp-">#</a>Putain de Code approuve Gulp.</h2><p>Ici on est carrÃ©ment fan de Gulp. Il faut bien avouer que
<a href="https://twitter.com/putaindecode/status/460868992396460032">Ã§a va vite</a>
(encore plus apprÃ©ciable lorsque lâ€™on nâ€™a pas de SSD) et que câ€™est plaisant Ã  Ã©crire.
Pas de configurations pas spÃ©cialement verbeuse et trop espacÃ©e.
Avec Gulp on se sent plus libre, moins contraint.
Du coup, <strong>on a carrÃ©ment fait notre site avec Gulp</strong>
(puis au passage un petit refresh graphique tant quâ€™Ã  faire).</p>
<p>Pour aller plus loin, vous nâ€™avez quâ€™Ã  ouvrir notre <a href="https://github.com/putaindecode/website/blob/master/Gulpfile.js">Gulpfile</a>
et regarder nos <a href="https://github.com/putaindecode/website/tree/master/tasks">tasks</a>
qui vont de <a href="https://github.com/putaindecode/website/blob/master/tasks/clean.js">la plus simple</a>
Ã  <a href="https://github.com/putaindecode/website/blob/master/tasks/contributors.js">la plus compliquÃ©</a>.</p>
<p>Pour voir des tÃ¢ches plus Â« real world example Â» je vous invite Ã  regarder les tasks suivantes :</p>
<ul>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/server.js">server</a>,
le server de dev local avec livereload dedans ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/watch.js">watch</a>,
le classique et si simple watcher ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/publish.js">publish</a>,
la tÃ¢che pour publier le dossier <code>dist/</code> sur les <a href="https://pages.github.com/">gh-pages</a> ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/icons.js">icons</a>,
qui transforme des SVG en fontes dâ€™icones avec le bout de CSS qui va bien ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts-linting.js">scripts-linting</a>,
qui vÃ©rifie la qualitÃ© du code ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts.js">scripts</a>,
du <a href="/posts/js/browserify-all-the-things/">browserify</a> pour nos JS cÃ´tÃ© client ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/stylesheets.js">stylesheets</a>,
notre tÃ¢che qui mÃ©lange (pour lâ€™instant) Stylus et Rework (suite Ã  une rixe Ã  la rÃ©crÃ©, on nâ€™a pas rÃ©ussi Ã  se mettre dâ€™accord, donc chacun Ã  rajoutÃ© son morceau) ;</li>
</ul>
<p>Bien entendu, si vous ne comprenez pas certaines parties, nâ€™hÃ©sitez pas Ã 
<a href="https://github.com/putaindecode/website/issues/new">ouvrir une issue</a>
pour demander des explications.</p>
<h2 id="vous-reprendrez-bien-un-peu-de-gulp-pardon-"><a class="putainde-Title-anchor" href="#vous-reprendrez-bien-un-peu-de-gulp-pardon-">#</a>Vous reprendrez bien un peu deâ€¦ Gulp* ! Pardon.</h2><p>Si vous avez encore envie de dÃ©tails je vous renvoie sur lâ€™article anglais
<a href="http://markgoodyear.com/2014/01/getting-started-with-gulp/">Getting started with gulp</a>
qui dÃ©taille tellement bien chaque point que mÃªme un anglophobe comprendrait.</p>
<p>Vous avez aussi
<a href="https://github.com/gulpjs/gulp/blob/master/docs/README.md">une documentation</a>
trÃ¨s bien faite, qui comporte carrÃ©ment
<a href="https://github.com/gulpjs/gulp/tree/master/docs/recipes">des exemples <em>officiels</em> tout prÃªts</a>.</p>
<p>Comme je vous disais plus tÃ´t, les auteurs de Gulp sont assez carrÃ©s et valident
(ou plutÃ´t <em>invalident</em>) <a href="https://npmjs.org/search?q=gulpplugin">les plugins</a> qui
ne respectent pas les
<a href="https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md">rÃ¨gles</a>.
Je trouve que câ€™est gage de qualitÃ©.</p>
<p>Pour finir quelques liens pour ceux qui en veulent toujours plus :</p>
<ul>
<li><a href="http://www.insertafter.com/articles-retour_experience_gulp.html">Gulp : Retour dâ€™expÃ©rience</a></li>
<li><a href="http://jaysoo.ca/2014/01/27/gruntjs-vs-gulpjs/">Grunt vs. Gulp, au-delÃ  des chiffres</a> (anglais)</li>
</ul>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>gulp bisous
â¯ â™¡ ğŸ˜˜
</code></pre>

]]></description><pubDate>Tue, 29 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-gulp/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-gulp/</guid></item><item><title>Les post-processeurs CSS</title><description><![CDATA[[
<p>Vous avez surement entendu parler des <a href="http://iamvdo.me/blog/les-postprocesseurs-css"><em>post-processeurs CSS</em></a>.
Jâ€™ai personnellement pas mal fait rÃ©fÃ©rence Ã  <del>ce concept</del> cette expression ces derniers temps.
Que ce soit lorsque je vous racontais
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">comment se passer des prÃ©fixes CSS</a>
ou lors
<a href="/posts/css/le-point-sur-les-preprocesseurs/">dâ€™un point sur les prÃ©-processeurs CSS</a>.
Nâ€™y a-t-il rien qui vous a fait tiquer ?</p>
<h2 id="du-post-processing-"><a class="putainde-Title-anchor" href="#du-post-processing-">#</a>Du post-processing ?</h2><p>Bon on va pas jouer sur les mots mais quand mÃªme un peu. <em>Post</em> Ã§a veut dire aprÃ¨s.
Mais aprÃ¨s quoi ? AprÃ¨s du <em>processing</em>. Donc en thÃ©orie aprÃ¨s que la feuille de
style ait Ã©tÃ© traitÃ©e.</p>
<p>Si on revient sur <em>prÃ©-processeurs</em>, on a quelques choses de sensÃ©.
On travaille sur la feuille de style avant quâ€™elle nâ€™ait Ã©tÃ© traitÃ©e.
TraitÃ©e par qui ? Je dirais le navigateur pas vous ?
Dans ce cas le prÃ©-processing est tout Ã  fait logique.</p>
<p>Mais le post-processing ? Du vrai post-processing Ã§a existe ? Oui et Ã§a ressemblerait Ã  Ã§a par exemple :
<a href="http://jsfiddle.net/yyx990803/B5JTg/">Interpolation de CSS avec Vue.js</a> (enfin je crois).
Ici on a un process sur du CSS existant, dÃ©jÃ  traitÃ© par le navigateur.</p>
<p>Bon ok jâ€™avoue que je pinaille un peu. On pourrait considÃ©rer que le â€œprocessâ€,
câ€™est le fait dâ€™amÃ©liorer sa feuille de style et dans ce cas, on pourrait accepter prÃ©- et post-process.
Mais Ã§a reste pas super exact de mon point de vue.</p>
<p>Du coup on appelle Ã§a comment les post-processeurs ?
Devrait-on appeler Ã§a du <em>post-prÃ©-processing</em> ? Je vous le demande.</p>
<p>Assez plaisantÃ©, passons donc Ã  lâ€™explication de ce quâ€™on appelera le <em>post-processing.</em></p>
<h2 id="le-post-processing"><a class="putainde-Title-anchor" href="#le-post-processing">#</a>Le post-processing</h2><p>Quel est la diffÃ©rence avec du prÃ©-processing ? Pour rÃ©pondre Ã  cette question,
il faut bien dÃ©finir ce quâ€™est le prÃ©-processing dans notre contexte.</p>
<h3 id="le-pre-processing-css"><a class="putainde-Title-anchor" href="#le-pre-processing-css">#</a>Le prÃ©-processing CSS</h3><p>Le prÃ©-processing est un prÃ©-traitement avant le traitment final. Dans le cas de feuille de style,
on travaille donc sur des prÃ©-feuilles de style. Ce ne sont donc pas des feuilles de style.
Comment les diffÃ©rencie-t-on ? La syntaxe.</p>
<p>Hola hola, calmez-vous. Jâ€™en entends dÃ©jÃ  chouiner quâ€™avec Sass, Less et Stylus,
on peut coller du CSS valide et Ã‡a Marcheâ„¢. Oui Ã§a marche. Mais seulement dans ce sens.
Si on essaye de faire parser un <code>@foreach</code>, <code>@include</code> ou ce genre de nouveautÃ©s
apportÃ©s par un prÃ©-processeur, votre navigateur il va faire la gueule.</p>
<p>En effet un prÃ©-processeur nâ€™est rien dâ€™autre quâ€™un langage. Un nouveau.
Il ajoute des Ã©lÃ©ments Ã  ce langage, et change mÃªme Ã©ventuellement la syntaxe.
Certes il peut sâ€™appuyer sur un langage existant (par exemple la syntaxe Scss de Sass, ou la syntaxe Less )
mais Ã§a nâ€™est pas obligÃ© (exemple avec lâ€™ancienne syntaxe Sass, ou encore pour changer de registre, CoffeeScript pour du JavaScript).</p>
<h3 id="difference-entre-post-processing-et-pre-processing"><a class="putainde-Title-anchor" href="#difference-entre-post-processing-et-pre-processing">#</a>DiffÃ©rence entre post-processing et prÃ©-processing</h3><p>Avant de parler des diffÃ©rences il nous faut un cas concret pour y voir plus clair.
Autoprefixer est un trÃ¨s bon exemple, mais je vais vous en montrer un encore plus pertinent: les fallbacks REM.
Jâ€™espÃ¨re que vous connaissez le REM (root EM), cette unitÃ© CSS trÃ¨s utile qui permet dâ€™avoir la souplesse de lâ€™unitÃ© EM,
en se basant non sur lâ€™Ã©lement parent, mais lâ€™Ã©lement root (donc le document).
Cette unitÃ© CSS nâ€™est par exemple pas compatible avec IE8, et certain dâ€™entre vous doivent encore le supporter.</p>
<p>On a donc vu pas mal de mixins genre <code>rem2px()</code> pour ajouter un fallback, via des prÃ©-processeurs CSS.
Sauf que lÃ , il semble beaucoup plus pertinent de ne pas alourdir son code (car on y ajoute rien dâ€™intÃ©ressant),
surtout lorsque câ€™est pour supporter de vieux navigateurs.
Et si on pouvait ajouter un petit coup de peinture magique, je dirais mÃªme automatique,
afin dâ€™avoir ce fallback ?</p>
<p>Et bien, on peut. Ã‡a prend 20 secondes, et Ã§a fera les choses bien, sans oubli.
Exemple avec <a href="https://github.com/ctalkington/rework-rem-fallback">rework-rem-fallback</a></p>
<pre><code class="lang-js"><span class="hljs-comment">// il faudrait installer les dÃ©pendances de la faÃ§on suivante</span>
<span class="hljs-comment">// $ npm i rework rework-rem-fallback</span>

<span class="hljs-keyword">var</span> rework = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework'</span>) <span class="hljs-comment">// le moteur rework, je reviens dessus aprÃ¨s</span>
  , remFallback = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework-rem-fallback'</span>) <span class="hljs-comment">// le plugin rework</span>

  <span class="hljs-comment">// lecture du fichier css</span>
  , css = <span class="hljs-keyword">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(<span class="hljs-string">'dist/index.css'</span>, <span class="hljs-string">'utf8'</span>).toString()

  <span class="hljs-comment">// on traite le CSS en indiquant Ã  rework la source, et le plugin Ã  utiliser</span>
  , out = rework(css).<span class="hljs-keyword">use</span>(remFallback()).toString()

  <span class="hljs-comment">// ici on fait la mÃªme chose, mais comme si la font de base Ã©tait en 14px</span>
  , out14 = rework(css).<span class="hljs-keyword">use</span>(remFallback(<span class="hljs-number">14</span>)).toString()
</code></pre>
<p>Avec lâ€™exemple dâ€™avant, et ce bout de CSS:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem </span></span></span>}
</code></pre>
<p>â€¦ On obtiendra le rÃ©sultat suivant:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">80</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Notre exemple nâ€™est pas intÃ©grÃ© dans un
<a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">workflow automatisÃ©</a>,
mais câ€™est juste pour vous montrer que câ€™est lâ€™histoire de 5 lignes de code
et pas autant de lignes que de fois oÃ¹ lâ€™on a <code>rem</code> dans sa feuille de style.</p>
<p>Sexy nâ€™est-ce pas ?</p>
<p>Lâ€™autre grosse diffÃ©rence entre le prÃ©- et le post-processing, câ€™est le langage.
Ce post-processing sâ€™effectue aprÃ¨s du prÃ©-processing. Donc aprÃ¨s que le prÃ©-processeur,
cet autre langage, ait fait son boulot.</p>
<p><strong>Le post-processing sâ€™effectue sur du CSS de maniÃ¨re transparente.</strong></p>
<p><em>Ce processing sâ€™effectue sur du vrai CSS (disons la syntaxe CSS).</em></p>
<p>Cette syntaxe Ã©tant trÃ¨s simple (se rÃ©sumant principalement Ã  <code>selecteur { prop: value }</code> - oui yâ€™a les rÃ¨gles <code>@*</code> en plus je sais),
<a href="https://github.com/reworkcss/css-parse#performance">câ€™est trÃ¨s rapide Ã  parser</a>.</p>
<h2 id="pourquoi-du-post-processing-"><a class="putainde-Title-anchor" href="#pourquoi-du-post-processing-">#</a>Pourquoi du post-processing ?</h2><p>Comme on vient de le voir avec les 2 points prÃ©cÃ©dents, on a dÃ©jÃ  3 bonnes raisons :</p>
<ul>
<li>la simplicitÃ© (pour certains cas de figures, câ€™est plus pertinent, Ã§a Ã©vite trop de code et des
oublis)</li>
<li>la vitesse</li>
<li>le fait de pouvoir brancher ses propres plugins</li>
</ul>
<p>Je sais pas vous mais moi Ã§a me suffit. Et en cherchant mieux, on pourrait sÃ»rement trouver dâ€™autres arguments.
(<em>Rappel : dâ€™ailleurs nâ€™hÃ©sitez pas Ã  modifier cet article si vous en avez</em>).</p>
<h2 id="avec-quoi-doit-on-post-processer-ces-css-"><a class="putainde-Title-anchor" href="#avec-quoi-doit-on-post-processer-ces-css-">#</a>Avec quoi doit-on post-processer ces CSS ?</h2><p>Comme vous avez pu le voir tout Ã  lâ€™heure jâ€™ai pris dans un exemple Rework,
mais il existe aussi PostCSS, plus rÃ©cent.</p>
<h3 id="-a-href-https-github-com-reworkcss-rework-rework-a-"><a class="putainde-Title-anchor" href="#-a-href-https-github-com-reworkcss-rework-rework-a-">#</a><a href="https://github.com/reworkcss/rework">Rework</a></h3><p>Rework a Ã©tÃ© initiÃ© par le grand <a href="https://github.com/visionmedia">TJ Holowaychuck</a>,
cette machine de guerre (<a href="http://www.quora.com/TJ-Holowaychuk-1/How-is-TJ-Holowaychuk-so-insanely-productive">que certains ne pensent mÃªme pas humain</a> pour vous dire).
TJ Ã©tait il fut un temps utilisateur de Sass, il avait donc mÃªme commencÃ© le
portage de <a href="https://github.com/stunti/sass.js">Sass en Node</a>.
Il a dÃ» se rendre compte bien avant nous que ce nâ€™Ã©tait finalement pas forcÃ©ment la meilleure option.
Il a donc dÃ©veloppÃ© <a href="https://github.com/LearnBoost/stylus/">Stylus</a> (si, si, câ€™est bien lui),
le temps de comprendre quâ€™une autre approche Ã©tait possible (pour info, il ne maintient maintenant plus Stylus).</p>
<p>Câ€™est donc <a href="https://github.com/reworkcss/rework/commit/0a7be255bfe753d03f93c7072351266fa636e80a">le 1er Septembre 2012 quâ€™il pousse la premiÃ¨re version de Rework</a>.</p>
<p>Lâ€™objectif de Rework nâ€™est pas spÃ©cialement de gÃ©rer du post-process.
Rework se place comme un manipulateur de CSS, permettant (entre autres) :</p>
<ul>
<li>lâ€™automatisation dâ€™ajout des prÃ©fixes</li>
<li>la crÃ©ation de nouvelles propriÃ©tÃ©s</li>
<li>lâ€™intÃ©gration dâ€™images inline</li>
</ul>
<p>Vous me direz que Ã§a ressemble vachement Ã  un prÃ©-processeur nâ€™est-ce pas ?
Vu lâ€™historique que je viens de vous conter et <a href="https://github.com/reworkcss/rework#plugins">les plugins par dÃ©faut</a>,
vous aurez bien compris que câ€™est lâ€™idÃ©e : faire un moteur de prÃ©-processeur oÃ¹ lâ€™on y branche des plugins pour ajouter nos propres fonctionnalitÃ©s.
Câ€™est grÃ¢ce Ã  ce projet quâ€™Autoprefixer a initialement vu le jour dâ€™ailleurs.</p>
<h3 id="-a-href-https-github-com-ai-postcss-postcss-a-"><a class="putainde-Title-anchor" href="#-a-href-https-github-com-ai-postcss-postcss-a-">#</a><a href="https://github.com/ai/postcss">PostCSS</a></h3><p>Beaucoup plus rÃ©cent, PostCSS a Ã©tÃ© Ã©crit par lâ€™auteur dâ€™Autoprefixer.</p>
<blockquote>
<p>Heu mais quoi ? Tu viens de nous dire que Autoprefixer utilisait Rework ?!</p>
</blockquote>
<p>Oui <em>câ€™Ã©tait</em> le cas. <em>Utilisait</em>. Lâ€™auteur de PostCSS sâ€™explique dans <a href="https://github.com/ai/postcss#rework">son README</a>.
Il y indique que, bien que trÃ¨s similaire, Rework et PostCSS nâ€™ont pas Ã©tÃ© dÃ©veloppÃ© pour les mÃªmes raisons.
Câ€™est ce qui explique les diffÃ©rences au niveau des moteurs.
PostCSS se veut plus prÃ©servateur par rapport Ã  votre source dâ€™origine,
et gÃ¨re donc mieux sourcemap, peut conserver votre espacement et indentation,
parse de maniÃ¨re plus sÃ©curisÃ© (vu que Ã§a se veut mieux gÃ©rer le code legacy).</p>
<p>Dans la pratique je nâ€™ai jamais eu de problÃ¨me avec Rework, me souciant peu de la mise en forme de la sortie CSS.
Mais PostCSS semble avoir une API plus haut niveau et plus souple pour mieux travailler les feuilles de styles.</p>
<h3 id="rework-ou-postcss-"><a class="putainde-Title-anchor" href="#rework-ou-postcss-">#</a>Rework ou PostCSS ?</h3><p>Tout dÃ©pend ce que vous voulez faire. Si vous avez en tÃªte lâ€™idÃ©e de dÃ©velopper un outil,
je pencherais plus vers PostCSS. Mais en temps quâ€™utilisateur, pour lâ€™instant, dÃ©finitivement Rework.</p>
<p>Ce dernier a clairement beaucoup plus de plugins existants. Voyez par vous-mÃªmes :</p>
<ul>
<li><a href="https://www.npmjs.org/search?q=rework">npmjs.org/search?q=rework</a></li>
<li><a href="https://www.npmjs.org/search?q=postcss">npmjs.org/search?q=postcss</a></li>
</ul>
<h2 id="rework-ce-n-est-pas-em-que-em-du-post-processing-"><a class="putainde-Title-anchor" href="#rework-ce-n-est-pas-em-que-em-du-post-processing-">#</a>Rework ce nâ€™est pas <em>que</em> du post-processing ?</h2><p>Oui en effet, comme je le disais avant, câ€™est pas le but. Câ€™est du â€œprocessingâ€.
PrÃ©-, post-â€¦ Quâ€™est-ce que Ã§a change dans le fond hein ?</p>
<p>Lâ€™idÃ©e, en temps que dÃ©veloppeur, est dâ€™amÃ©liorer le confort dâ€™Ã©criture sans contrainte.
Comme je lâ€™ai indiquÃ© <a href="/posts/css/le-point-sur-les-preprocesseurs/#mon-avis-sur-les-pr-processeurs">prÃ©cÃ©demment</a>,
jâ€™ai lachÃ© les prÃ©-processeurs â€œclassiquesâ€ ayant lâ€™impression dâ€™utiliser un tank pour tuer une mouche.
Car au fond pour 90% (si ce nâ€™est plus) dâ€™entres nous,
que nous faut-il pour bien dÃ©velopper des feuilles de styles ?
Un peu dâ€™organisation, des variables et un poil de math ?
Personnellement je me contente de Ã§a. Pour lâ€™organisation, je suis devenu fan de BEM
(on vous en parle bientÃ´t).</p>
<p><strong>Et en attendant de vraiment pouvoir utiliser les variables CSS associÃ© Ã  <code>calc()</code>,
je reste sur du <em>custom prÃ©-processing</em> via Rework avec lequel je peux coder avec la syntaxe des specs (mÃªme si câ€™est en draft), plus future-proof.</strong></p>
<p>Jâ€™aime conserver la syntaxe CSS et avoir un process ultra-rapide et transparent.</p>
<h3 id="prochaine-etape-faire-son-propre-pre-post-processeur-css-c-est-simple"><a class="putainde-Title-anchor" href="#prochaine-etape-faire-son-propre-pre-post-processeur-css-c-est-simple">#</a>Prochaine Ã©tape: faire son propre prÃ©/post-processeur CSS, câ€™est simple</h3><p>Rework ayant un bon petit paquet de plugins dÃ©jÃ  existants, câ€™est assez simple de rÃ©aliser son propre prÃ©-processeur via quelques lignes de code seulement.
La mise en place et lâ€™automatisation feront lâ€™objet dâ€™un prochain article !</p>

]]></description><pubDate>Tue, 08 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/les-post-processeurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/les-post-processeurs/</guid></item><item><title>Le point sur les prÃ©-processeurs CSS</title><description><![CDATA[[
<h2 id="pourquoi-les-pre-processeurs"><a class="putainde-Title-anchor" href="#pourquoi-les-pre-processeurs">#</a>Pourquoi les prÃ©-processeurs</h2><p>VoilÃ  ce que jâ€™ai Ã©crit en 2011 dans
<a href="http://moox.io/blog/utiliser-des-variables-fonctions-css/">mon premier post sur les prÃ©-processeur</a>.
Je venais de dÃ©couvrir cette notion et jâ€™avais donc fait le tour de la question.</p>
<blockquote>
<p>Le langage des CSS nâ€™a pas de cÃ´tÃ© dynamique. Câ€™est lui avec lequel, Ã  chaque
fois quâ€™on intÃ¨gre une maquette graphique, on doit se taper tout de zÃ©ro.
Il a beau exister des CSS Â« Reset Â», des frameworks CSS, tout un tas de
grilles prÃªte Ã  lâ€™emploi, des composants de CSS rÃ©utilisables avec lâ€™approche
objet, je nâ€™ai jamais rÃ©ellement Ã©tait satisfait par ces mÃ©thodes, que ce soit
Ã  cause des contraintes quâ€™impose la syntaxe (devoir mettre des classes Ã  tout
va dans lâ€™HTML Ã§a peut vite devenir chiant dans un CMS), ou par dâ€™Ã©ventuelles
limitations qui obligent Ã  Â« trop Â» modifier la source du document (pas assez
de, ou trop de, ou seulement Ã§a ne me plait pas comment câ€™est fait).</p>
</blockquote>
<p>Jâ€™avais tout dit, mÃªme des trucs quâ€™aujourdâ€™hui je pense Ãªtre des conneries (il
nâ€™y a que les cons qui ne changent pas dâ€™avis + câ€™est en faisant des erreurs
quâ€™on apprend le mieux), mais je reviendrais dessus plus tard.</p>
<p>Du coup on en retire quoi ? Quâ€™utiliser un prÃ©-processeur se justifie par
lâ€™ajout de fonctionnalitÃ©s lorsque vous Ã©crivez des feuilles de style (en tant
que dÃ©veloppeur). En tant quâ€™utilisateur du code produit, cela va permettre
dâ€™ajouter une couche abstraction (ce qui peut poser des problÃ¨mes, je reviendrais
sur ce point plus tard).</p>
<h2 id="principales-fonctionnalites"><a class="putainde-Title-anchor" href="#principales-fonctionnalites">#</a>Principales fonctionnalitÃ©s</h2><ul>
<li>variables</li>
<li>fonctions</li>
<li>mixins (permettant de rÃ©aliser des sorties CSS paramÃ©trables)</li>
<li><code>@import</code> intelligent (pas cÃ´tÃ© client)</li>
<li>nesting (imbrications des sÃ©lecteurs pour Ã©viter la rÃ©pÃ©tition)</li>
<li>optimisation et abstraction poussÃ©e (via les mixins, placeholders et <code>@extend</code>)</li>
</ul>
<p>Anciennement on aurait rajoutÃ© Ã  cette liste la gestion du CSS 3, mais comme
je lâ€™expliquais il y a peu, ce nâ€™est plus nÃ©cessaire, on a une mÃ©thode bien
mieux, rapide et surtout <b>maintenu Ã  jour</b> avec
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">AutoPrefixer</a></p>
<h2 id="les-principaux-pre-processeurs"><a class="putainde-Title-anchor" href="#les-principaux-pre-processeurs">#</a>Les principaux prÃ©-processeurs</h2><h3 id="-a-href-http-sass-lang-com-sass-a-"><a class="putainde-Title-anchor" href="#-a-href-http-sass-lang-com-sass-a-">#</a><a href="http://sass-lang.com/">Sass</a></h3><p>Sass est Ã  mon avis le plus mature des prÃ©-processeurs CSS.
Il possÃ¨de 2 syntaxes (une indentÃ©e et une plus proche de CSS).
Ce projet avance Ã  bon rythme. Niveau fonctionnalitÃ©s, rien Ã  dire si ce nâ€™est que
celui-ci a un petit plus pour avec la feature <code>@content</code> qui permet pour le coup de
passer tout un bloc de propriÃ©tÃ©s en paramÃ¨tre Ã  des mixins. Ce qui est super
pratique lorsque lâ€™on Ã©crit pas mal de media queries.
(AprÃ¨s, venez pas me dire quâ€™on a plein de fois les media-queries qui se
rÃ©pÃ¨tent et que ce nâ€™est pas bien pour la taille du fichier, gzip se chargera de Ã§a -
<small><a href="https://twitter.com/kaelig/status/412909849207644160">exemple similaire</a>)</small>.</p>
<p>Le langage Sass possÃ¨de une implÃ©mentation dâ€™origine en Ruby mais aussi depuis
quelques temps une implÃ©mentation C qui se veut beaucoup plus rapide et portable:
<a href="http://libsass.org/">libsass</a> mais qui est encore un peu en retard niveau
fonctionnalitÃ© (affaire Ã  suivre). Surtout depuis la version 3.3 qui possÃ¨de de
nouvelles fonctionnalitÃ©s (comme les maps, entre autres).</p>
<p>Avec ce prÃ©-processeur, on peut sâ€™Ã©loigner pas mal du CSS natif, que ce soit avec
la syntaxe ou lâ€™aspect programmation (il nâ€™y a quâ€™Ã  voir des trucs comme
<a href="https://github.com/Team-Sass/modular-scale">modular-scale</a> ou
<a href="https://github.com/HugoGiraudel/SassyMatrix">SassyMatrix</a>).</p>
<p>BibliotÃ¨ques construites sur Sass :</p>
<ul>
<li><a href="http://compass-style.org/">Compass</a>, solide, basÃ© sur Ruby (incompatible libsass),</li>
<li><a href="http://bourbon.io/">Bourbon</a>, plus light mais plus rapide.</li>
</ul>
<h3 id="-a-href-http-lesscss-org-less-a-"><a class="putainde-Title-anchor" href="#-a-href-http-lesscss-org-less-a-">#</a><a href="http://lesscss.org/">LESS</a></h3><p>Je nâ€™ai pas trop envie de parler de ce prÃ©-processeur assez classique, qui a fait un
choix assez Ã©trange pour les variables par exemple (oui, <code>@</code> est un caractÃ¨re
spÃ©cial en CSS, câ€™est assez Ã©trange de rajouter une couche avec pour les variables
avec ce dernier).
Jâ€™espÃ¨re seulement que ceux qui lâ€™utilisent aujourdâ€™hui nâ€™utilise pas le script cÃ´tÃ© client
(ce qui provoquerait un affichage sans CSS si le client nâ€™a pas JavaScript activÃ©).
Bien quâ€™il soit populaire, le repository sur GitHub nâ€™est pas signe de bonne santÃ©
Ã  mes yeux. Voir des pull-requests qui traÃ®nent vielles de plusieurs
<del>mois</del> <ins>annÃ©es</ins> me laissent dubitatifâ€¦
Puis il nâ€™y a quâ€™Ã  voir lâ€™exemple sur la homepage du site avec les box-shadow,
pour voir que ce prÃ©-processeur est assez dÃ©prÃ©ciÃ©.</p>
<p>Ajoutons Ã  cela le fait que Twitter Boostrap a (enfin) une version Sassâ€¦</p>
<p>CÃ´tÃ© fonctionnalitÃ©s, lâ€™aspect programmation est assez laborieux avec la faÃ§on dont
sont gÃ©rÃ©s les mixins conditionnels. Je passe sur ce point gerbant.</p>
<p>BibliotÃ¨ques construites sur Less :</p>
<ul>
<li><a href="http://lesshat.madebysource.com/">LESS Hat</a>,</li>
<li><a href="http://lesselements.com/">LESS Elements</a>.</li>
</ul>
<h3 id="-a-href-http-learnboost-github-io-stylus-stylus-a-"><a class="putainde-Title-anchor" href="#-a-href-http-learnboost-github-io-stylus-stylus-a-">#</a><a href="http://learnboost.github.io/stylus/">Stylus</a></h3><p>Stylus se veut plus transparent que les autres prÃ©-processeurs. Câ€™est un point
rÃ©ussi puisquâ€™il permet dâ€™avoir des mixins transparents au niveau Ã©criture.
Cela peut par contre bien entendu rendre la maintenance et la comprÃ©hension plus
difficile si on en abuse.
Il permet aussi de coder sans <code>{}</code> ni <code>:</code> ni <code>;</code> (bien que tout cela soit optionnel)</p>
<p>Niveau fonctionnalitÃ©s cela ne vaut pas Sass. Ici pas de <code>@content</code> ou de maps.</p>
<p>BibliotÃ¨que construite sur Stylus :</p>
<ul>
<li><a href="http://visionmedia.github.io/nib/">Nib</a></li>
</ul>
<h3 id="alternatives"><a class="putainde-Title-anchor" href="#alternatives">#</a>Alternatives</h3><p>On peut sâ€™amuser Ã  faire un prÃ©-processeur CSS avec nâ€™importe quel langage câ€™est
Ã©vident.
Mais <a href="http://www.alsacreations.com/astuce/lire/1433-utiliser-php-pour-gerer-vos-styles-css.html">les enfants, ne faites pas Ã§a.</a>
Ã€ moins que vous souhaitiez alourdir vos CSS plus que vous y gagnerez.
Puis si câ€™est juste pour ajouter des variables, il existe dâ€™autres solutionsâ€¦</p>
<p><em>Note: si vous avez dâ€™autres prÃ©-processeurs intÃ©ressants, je me ferais un plaisir
de les ajouter ici. Mais bon <a href="https://github.com/putaindecode/website/blob/master/pages/posts/css/le-point-sur-les-preprocesseurs/index.md">vous pouvez aussi le faire tout seul comme un
grand</a>.</em></p>
<h2 id="les-pre-processeurs-sont-ils-vraiment-necessaire-"><a class="putainde-Title-anchor" href="#les-pre-processeurs-sont-ils-vraiment-necessaire-">#</a>Les prÃ©-processeurs sont-ils vraiment nÃ©cessaire ?</h2><blockquote>
<p>Oula. Le mec vient de nous poser un post pour nous parler des prÃ©-processeurs,
et il nous sort une question comme Ã§a ? Il est oÃ¹ le piÃ¨ge ?</p>
</blockquote>
<p>Si je pose la question câ€™est que jâ€™ai une petite rÃ©ponse par lÃ . Et elle ne va
peut-Ãªtre pas vous plaire.</p>
<p>Je vais revenir sur certains points qui peuvent poser problÃ¨me avec les prÃ©-processeurs.</p>
<h3 id="le-nesting-cay-mal"><a class="putainde-Title-anchor" href="#le-nesting-cay-mal">#</a>Le nesting cay mal</h3><p>Ahhâ€¦ Le nesting, câ€™est bien pratique lorsque lâ€™on travaille sur un CMS
(ou nâ€™importe quoi ayant un code HTML quâ€™on ne maitrise pas facilement)
de pouvoir utiliser le nesting pour pouvoir rapidement produire les sÃ©lecteurs adÃ©quats.
Mais en terme de maintenance et surtout de rÃ©utilisation, câ€™est vraiment Ã  chier.
Faut dire ce qui est.</p>
<pre><code class="lang-scss">.widget {
 <span class="hljs-comment"> // titre</span>
  h3 { }

 <span class="hljs-comment"> // widget body</span>
  &gt; <span class="hljs-operator">div</span> {

   <span class="hljs-comment"> // liste</span>
    ul {

    }
  }
}
</code></pre>
<p>Cet exemple est parfait pour dÃ©montrer les limites du nesting.
Comment faire si, sur un widget donnÃ©e, nous avons comme titre un h2 ou h4 ?
Il faut alourdir la CSS. Pareillement, si notre fameuse liste dans le corps nâ€™est
pas dans la mÃªme arborescence que celle dÃ©crite, il faut Ã  nouveau alourdir notre CSS.
Sans rentrer dans ces solutions solides (nous parlerons de BEM trÃ¨s bientÃ´t),
cette solution serait bien plus Ã©lÃ©gante pour la rÃ©utilisation :</p>
<pre><code class="lang-css"><span class="hljs-class">.widget</span> <span class="hljs-rules">{<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-title</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-body</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

    <span class="hljs-class">.widget-body-list</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>
</code></pre>
<p>Vous remarquerez que jâ€™ai un code ici beaucoup plus comprÃ©hensible par un nouveau,
mais aussi bien mieux rÃ©utilisable et surtout, point trÃ¨s important, non couplÃ©
(non dÃ©pendant) Ã  notre arborescence HTML (coucou le DOM).
De plus, utiliser le nesting provoque des sÃ©lecteurs Ã  rallonges, aprÃ¨s câ€™est la
course Ã  la longueur (et au poids) des sÃ©lecteurs quand il faut surcharger une
rÃ¨gle hÃ©ritÃ©e.
Avec de simple sÃ©lecteurs, pas de souci de ce genre lÃ .</p>
<p><em>ProTipâ„¢ : vous remarquerez que jâ€™indente mon CSS Ã  lâ€™image des composants, Ã§a mange
pas de pain, est cela facilite la lecture, moins linÃ©aire.</em></p>
<p>Donc je reviens sur ce que je disais, il faut utiliser pleins de classes dans lâ€™HTML.
Ã‡a sert Ã  Ã§a. Votre CSS produit de cette faÃ§on sera bien plus rÃ©utilisable.</p>
<h3 id="l-abstraction-cay-dangereux"><a class="putainde-Title-anchor" href="#l-abstraction-cay-dangereux">#</a>Lâ€™abstraction cay dangereux</h3><p>On en revient Ã  la magie. Lorsquâ€™on a trop de couche qui cache ce quâ€™il y a
rÃ©ellement sous le capot, <a href="http://linuxfr.org/news/encore-un-exemple-de-code-spaghetti-toyota">on peut vite perdre le contrÃ´le</a>.</p>
<p>Et voici <a href="https://github.com/MoOx/compass-recipes/issues/104">un parfait exemple</a>
oÃ¹ un utilisateur de ma bibliothÃ¨que <a href="https://github.com/MoOx/compass-recipes">Compass Recipes</a>
avait un problÃ¨me lorsquâ€™il utilisait 2 mixins qui cachaient trop de code.
Dans  notre cas corners-tucked (version coin scotchÃ©) et background-noise (bruit visuel).
Il en a perdu des choses simples et avait passÃ© beaucoup de temps Ã  se prendre la tÃªte
alors que la solution Ã©tait trÃ¨s (trop) simple (une histoire entre <code>background-image</code>
et le shorthand <code>background</code>).</p>
<p>Je me laisse souvent attirer par la magie dâ€™un code, mais mon expÃ©rience mâ€™indique
aujourdâ€™hui quâ€™il ne faut pas abuser de cette partie mystÃ©rieuse oÃ¹ lâ€™on ne sait
plus ce qui se passe.</p>
<p>Je vous laisse imaginer du nesting cachÃ© dans des mixins qui utilisent dâ€™autres mixins
qui font des @extends de placeholdersâ€¦</p>
<blockquote>
<p>Un grand pouvoir implique de grandes responsabilitÃ©s.</p>
</blockquote>
<p>Tout est dit. Il faut faire attention. TrÃ¨s attention.</p>
<h2 id="mon-avis-sur-les-pre-processeurs"><a class="putainde-Title-anchor" href="#mon-avis-sur-les-pre-processeurs">#</a>Mon avis sur les prÃ©-processeurs</h2><p>Je pense que les prÃ©-processeurs restent utiles mais seulement pour des projets
de trÃ¨s grosse envergure, qui possÃ¨de Ã©normÃ©ment de code CSS et/ou extrÃªmement dynamique.
Ou que vous utilisez de solutions comme <a href="http://getbootstrap.com/">Bootstrap</a> ou
<a href="http://foundation.zurb.com/">Foundation</a>, chose que je dÃ©conseille pour autre chose que des prototypes.</p>
<p>De part mon expÃ©rience et mon recul (si si jâ€™en prends je vous jure), je pense que
jâ€™aurais pu mâ€™en passer bien plus souvent que jâ€™ai voulu lâ€™admettre par le passÃ©.
Mais bon comme je dis souvent, quel plaisir de se planter quand ce nâ€™est pas dans un platane !</p>
<p>Ce quâ€™il faut retenir clairement câ€™est que ce ne sont pas les prÃ©-processeurs qui
vont vous faire Ã©crire des meilleurs feuilles de styles. Câ€™est plus un travail sur
une mÃ©thodologie et  une organisation adaptÃ© Ã  vos besoins qui amÃ©lioreront
votre quotidien de webdesigner (oui quoi, dÃ¨s quâ€™on code du CSS, on peut
utiliser lâ€™appellation webdesigner sur son CV, Ã§a en jete).</p>
<p>Jâ€™ai donc longtemps apprÃ©ciÃ© les prÃ©-processeurs CSS, mais aujourdâ€™hui je commence
Ã  leur tourner le dos du fait que je nâ€™utilise que trop peu de leurs fonctionnalitÃ©s.
Jâ€™Ã©vite lâ€™overkill quoi.</p>
<p>Quand on voit que des <em>grands</em> de lâ€™HTML / CSS comme <a href="http://nicolasgallagher.com/">@necolas</a>
nâ€™utilise pas de prÃ©-processeur, on a de quoi se poser des questions.
Avec une bonne bibliothÃ¨que comme <a href="https://github.com/suitcss/suit/">SUIT CSS</a>,
on sâ€™en retrouve Ã  ne manquer que des petites choses.</p>
<p>Que lâ€™on peut combler.</p>
<p>Avec les post-processeurs par exemple.</p>
<p>Jâ€™ai donc Ã  ce jour moi aussi conservÃ© une couche pour ajouter le minimum vital en tant que dÃ©veloppeur.</p>
<p>Mais ne voulant pas alourdir ce post consacrÃ© aux prÃ©-processeurs CSS,
vous pourrez continuer la lecture au prochain Ã©pisode qui sera consacrÃ© aux post-processeursâ€¦</p>
<p><small>(Mamam, tâ€™as vu ce cliffhanger digne des sÃ©ries US !)</small></p>
<p>Bon promis la prochain fois je vous en parle des post-processeurs. Pour de vrai.</p>

]]></description><pubDate>Tue, 11 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</guid></item><item><title>Mise en place dâ€™autoprefixer</title><description><![CDATA[[
<p>Suite Ã  mon prÃ©cÃ©dent article <a href="/posts/css/comment-en-finir-avec-les-prefixes/">Comment en finir avec les prÃ©fixes CSS</a>,
certains sont restÃ©s sur leur faim.
Voici donc de rapides exemples de mise en place de cette solution.</p>
<h2 id="installation-d-autoprefixer"><a class="putainde-Title-anchor" href="#installation-d-autoprefixer">#</a>Installation dâ€™autoprefixer</h2><p>Il vous faudra <a href="http://nodejs.org/">Node.js</a> (qui embarque maintenant <a href="https://www.npmjs.org/">Npm</a>) afin de pouvoir
installer ce nouveau joujou.</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on install autoprefixer via npm en global</span>
$ <span class="hljs-built_in">npm</span> install --<span class="hljs-built_in">global</span> autoprefixer
<span class="hljs-comment"># ou pour les fainÃ©ants</span>
$ <span class="hljs-built_in">npm</span> i -g autoprefixer
</code></pre>
<p>Une fois ceci fait, vous devriez avoir la commande <code>autoprefixer</code> disponible.
On vÃ©rifie de suite avec <code>autoprefixer -v</code>.</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -v
autoprefixer <span class="hljs-number">1.0</span>.<span class="hljs-number">20140203</span>
</code></pre>
<p>Vous remarquerez que le numÃ©ro de version est un peu spÃ©cial : il contient une
date en place dâ€™un numÃ©ro de patch. Cette date correspond Ã  la derniÃ¨re mise Ã 
jour de la base de donnÃ©es de <em>Can I Use</em>.</p>
<h2 id="utilisation-d-autoprefixer"><a class="putainde-Title-anchor" href="#utilisation-d-autoprefixer">#</a>Utilisation dâ€™autoprefixer</h2><pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer *.css
</code></pre>
<p>Câ€™est aussi simple que Ã§a.</p>
<p>En fait non je plaisante, câ€™est un tout petit peu plus long car par dÃ©faut,
comme beaucoup de commandes, vous allez avoir la sortie crachÃ©e en plein visage.</p>
<p>Pour voir les options, comme dâ€™habitude <code>--help</code> ou <code>-h</code> :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -h
</code></pre>
<p>On y apprend lâ€™existance des options suivantes :</p>
<pre><code>Options:
  -<span class="ruby">b, --browsers <span class="hljs-constant">BROWSERS</span>  add prefixes <span class="hljs-keyword">for</span> selected browsers
</span>  -<span class="ruby">o, --output <span class="hljs-constant">FILE</span>        set output file
</span>  -<span class="ruby">d, --dir <span class="hljs-constant">DIR</span>            set output dir
</span>  -<span class="ruby">m, --map                generate source map
</span>  -<span class="ruby">i, --info               show selected browsers <span class="hljs-keyword">and</span> properties
</span>  -<span class="ruby">h, --help               show help text
</span>  -<span class="ruby">v, --version            print program version</span>
</code></pre><p>Du coup si on veut faire un coup de commande bien personnalisÃ©e on pourra faire :</p>
<pre><code class="lang-shell">$ autoprefixer -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span> index<span class="hljs-preprocessor">.css</span>
</code></pre>
<p>Il va par contre nous falloir un fichier css pour tester :</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on met un peu de CSS dans index.css maniÃ¨re de tester le bouzin</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">"* { box-sizing:border-box}"</span> &gt; index.css
</code></pre>
<p>On peut donc essayer notre commande plus haut qui va remplir le fichier <code>prefixed.css</code></p>
<p>Pour vÃ©rifier :</p>
<pre><code class="lang-shell">$ cat prefixed<span class="hljs-built_in">.</span>css
<span class="hljs-subst">*</span> { <span class="hljs-attribute">-webkit</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; <span class="hljs-attribute">-moz</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; box<span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>}
</code></pre>
<p>On a bien eu des prÃ©fixes ajoutÃ©s en fonction de notre demande (bon rien pour IE
qui nâ€™est pas passÃ© par une version prÃ©fixÃ©)</p>
<p>Par dÃ©faut, <em>autoprefixer</em> utilise <code>&gt; 1%, last 2 versions, Firefox ESR, Opera 12.1</code> pour les navigateurs.
Je pense que pour la plupart dâ€™entre vous voudront ajouter â€œExplorer 8â€ Ã  la liste, mais Ã§a
nâ€™est en thÃ©orie pas nÃ©cessaire vu le permier argument qui demande de prÃ©fixer tous les navigateurs
dont lâ€™usage global est supÃ©rieur Ã  1%. Peut-Ãªtre Explorer 7 pour certains ?
Faites un tour sur la <a href="http://caniuse.com/usage_table.php">page dÃ©diÃ© aux statistiques globales sur CanIUse.com</a> pour avoir une idÃ©e.</p>
<p>Sinon, pour du petit one shot, un plugin dans votre Ã©diteur suffira:</p>
<ul>
<li><a href="https://github.com/sindresorhus/atom-autoprefixer">plugin autoprefixer pour Atom</a></li>
<li><a href="https://github.com/sindresorhus/sublime-autoprefixer">plugin autoprefixer pour Sublime Text</a></li>
<li><a href="https://github.com/mikaeljorhult/brackets-autoprefixer">plugin autoprefixer pour Brackets</a></li>
</ul>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>IntÃ©gration dans Sublime Text</figcaption>
</figure>

<h2 id="automatisation-d-autoprefixer-autoception-"><a class="putainde-Title-anchor" href="#automatisation-d-autoprefixer-autoception-">#</a>Automatisation dâ€™autoprefixer (autoception)</h2><p>Bien entendu on va pas se taper la commande Ã  la main tout le temps heinâ€¦
Il nous faut automatiser nos processus. Sans quoi on perd du temps, et
<a href="http://deboutlesgens.com/blog/jai-pas-le-temps-la-pire-excuse-qui-soit/">le tempsâ€¦ Câ€™est du temps !</a></p>
<p>Donc, comme je lâ€™ai dit prÃ©cÃ©demment, on peut utiliser <em>autoprefixer</em> avec les solutions
suivantes:</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec lâ€™application <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu)</li>
</ul>
<p>Si vous avez besoin, je pense que vous trouverez sans trop de problÃ¨me dâ€™autres
implÃ©mentations.</p>
<p>Cela dit, je vais vous montrer quelques cas dâ€™utilisations:</p>
<h3 id="make"><a class="putainde-Title-anchor" href="#make">#</a>Make</h3><p>LÃ  câ€™est facile, tout bon dÃ©veloppeur doit avoir <code>make</code> sur sa machine (sinon
câ€™est que tâ€™es pas dÃ©veloppeur, je sais pas trop ce que tu fais ici du coup).</p>
<p>On peut tout simplement crÃ©er un fichier <code>Makefile</code> avec la commande prÃ©cÃ©dente:</p>
<pre><code class="lang-shell"><span class="hljs-comment"># crÃ©ation dâ€™un dossier pour notre popote (puis on va dedans...)</span>
<span class="hljs-variable">$ </span>mkdir autoprefixer-test &amp;&amp; cd autoprefixer-test

<span class="hljs-comment"># On crÃ©er un makefile avec une tÃ¢che `css` (crÃ©ation/Ã©crasement via &gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"css:"</span> &gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On vÃ©rifie quâ€™on a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>

<span class="hljs-comment">## On ajoute notre commande au fichier (ajout au fichier existant via &gt;&gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"\tautoprefixer index.css -b \"last 2 versions, &gt; 1%, Explorer 7, Android 2\" -o prefixed.css"</span> &gt;&gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On vÃ©rifie quâ€™on a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>
</code></pre>
<p>VoilÃ  votre Makefile doit Ãªtre bien rempli. Pour tester la commande <code>css</code>:</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>make css
</code></pre>
<p>Vous remarquerez que la commande <em>autoprefixer</em> sâ€™affiche, si Ã§a vous embÃªte, rajoutez
<code>@</code> devant. Vous pouvez modifier votre Makefile dans ce sens:</p>
<pre><code><span class="hljs-label">css:</span>
    echo <span class="hljs-string">"â¯ Autoprefixage magique."</span>
    @autoprefixer index<span class="hljs-preprocessor">.css</span> -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span>
</code></pre><p><em>Attention : Les Makefiles utilisent des tabulations uniquement ! Sans quoi cela
ne va pas marcher comme prÃ©vu.</em></p>
<p>Vous avez donc maintenant un exemple assez simpliste qui peut Ãªtre utilisÃ© si
vous nâ€™avez pas encore <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">automatisÃ© votre workflow</a>
via des outils comme <a href="http://gulpjs.com/">Gulp</a> ou <a href="http://gruntjs.com/">Grunt</a>.</p>
<p>Passons justement Ã  ces solutions plus sÃ©rieuses.</p>
<h3 id="autoprefixer-avec-gulp"><a class="putainde-Title-anchor" href="#autoprefixer-avec-gulp">#</a>Autoprefixer avec Gulp</h3><p>Je ne vais pas trop rentrer dans les dÃ©tails de Gulp (ce nâ€™est pas le sujet ici).
Voici cependant une exemple assez bref et comprÃ©hensible pour commencer, avec
une seule Ã©criture sur le systÃ¨me de fichier (contrairement Ã  la solution Grunt).</p>
<pre><code class="lang-js"><span class="hljs-comment">// gulp stuff</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)
  <span class="hljs-comment">// le plombier ajuste les fuites des tuyaux (erreur de pipe)</span>
  <span class="hljs-comment">// ceci est conseillÃ© pour Ã©viter que chaque erreur "casse" tout le process</span>
  <span class="hljs-comment">// dÃ¨s quâ€™une erreur est remontÃ© par un plugin</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

<span class="hljs-comment">// css stuff</span>
<span class="hljs-keyword">var</span> sass = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-ruby-sass"</span>)
  , autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-autoprefixer"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

<span class="hljs-comment">// css task: sass, autoprefixer et csso si --production</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.src(<span class="hljs-string">"./src/css/*.scss"</span>)
    <span class="hljs-comment">// itâ€™s me, Mario</span>
    .pipe(plumber())

    .pipe(sass({style: <span class="hljs-string">"expanded"</span>}))

    <span class="hljs-comment">// Autoprefixer \\</span>
    <span class="hljs-comment">// vous remarquerez que ici chaque option est un paramÃ¨tre</span>
    <span class="hljs-comment">// pas comme pour lâ€™appel en ligne de commande.</span>
    .pipe(autoprefixer(<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>))

    <span class="hljs-comment">// optimisation CSS pour la prod uniquement</span>
    .pipe(gulp.env.production ? csso() : gutil.noop())

    <span class="hljs-comment">// unique Ã©criture sur disque</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
    <span class="hljs-comment">// je passe sur cette partie Ã  configurer, mais ici on peut imaginer un</span>
    <span class="hljs-comment">// livereload en plus, il faudra dÃ©finir livereload et livereloadServer</span>
    <span class="hljs-comment">// cette partie dÃ©pend un peu de votre serveur durant le dÃ©v.</span>
    <span class="hljs-comment">// ca fera lâ€™objet dâ€™un post tiens...</span>
    <span class="hljs-comment">//.pipe(livereload(livereloadServer))</span>
})

gulp.task(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    gulp.run(<span class="hljs-string">"styles"</span>)
  })
})

<span class="hljs-comment">// TÃ¢ches disponibles :</span>

<span class="hljs-comment">// - pour gÃ©nÃ©rer les feuilles de styles</span>
<span class="hljs-comment">//   (pour optimiser pour la prod, utiliser lâ€™option)</span>
<span class="hljs-comment">// $ gulp styles [--production]</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la tÃ¢che `styles` dÃ¨s que nÃ©cessaire</span>
<span class="hljs-comment">// $ gulp dev</span>
</code></pre>
<h3 id="autoprefixer-avec-grunt"><a class="putainde-Title-anchor" href="#autoprefixer-avec-grunt">#</a>Autoprefixer avec Grunt</h3><p>Voici un petit Gruntfile avec la mÃªme configuration que ci dessus</p>
<pre><code class="lang-js">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>
<span class="hljs-pi">  "use strict"</span>;

  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-sass"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-autoprefixer"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-csso"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-watch"</span>)

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">"expanded"</span>
        }
      , files: [{
          expand: <span class="hljs-literal">true</span>
        , flatten: <span class="hljs-literal">true</span>
        , cwd: <span class="hljs-string">"./src/css"</span>
        , src: [<span class="hljs-string">"*.scss"</span>]
        , dest: <span class="hljs-string">"./dist/css"</span>
        , ext: <span class="hljs-string">".css"</span>
        }]
      }
    }
  , autoprefixer: {
      options: {
        browsers: [<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>]
      }
    , dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }
  , csso: {
      dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css/"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }

  , watch: {
      styles: {
        files: [<span class="hljs-string">"./src/css/**/*.scss"</span>]
      , tasks: [<span class="hljs-string">"styles"</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">"styles"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>])
  grunt.registerTask(<span class="hljs-string">"styles:production"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>, <span class="hljs-string">"csso"</span>])
  grunt.registerTask(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"watch"</span>])
}

<span class="hljs-comment">// TÃ¢ches disponibles :</span>

<span class="hljs-comment">// - pour gÃ©nÃ©rer les feuilles de styles</span>
<span class="hljs-comment">// $ grunt styles</span>

<span class="hljs-comment">// - pareil, mais optimiser pour la prod</span>
<span class="hljs-comment">// $ grunt styles:production</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la tÃ¢che `styles` dÃ¨s que nÃ©cessaire</span>
<span class="hljs-comment">// $ grunt watch</span>
</code></pre>
<p>Comme vous pouvez le voir, la version Grunt est un peu plus volumineuse (bien quâ€™espacÃ©e).
Personnellement jâ€™aime la concision de gulp.
De plus la version Grunt sera plus longue car nous aurons 3 lectures / Ã©critures sur le disque.</p>
<p><em>Notez que bien entendu dans notre exemple prÃ©cÃ©dent, nous pouvons remplacer Sass
par un autre prÃ© / post-processeur.</em></p>
<h3 id="autoprefixer-avec-stylus"><a class="putainde-Title-anchor" href="#autoprefixer-avec-stylus">#</a>Autoprefixer avec Stylus</h3><p>Dans les exemples prÃ©cÃ©dents, jâ€™ai montrÃ© une solution classique avec Sass.
Mais voici complÃ¨tement autre chose: <em>autoprefixer</em> peut sâ€™utiliser en â€œpluginâ€ Stylus.</p>
<p>Câ€™est assez simple il suffit dâ€™utiliser lâ€™option <code>use</code> (<code>-u</code> en cli).
VoilÃ  ce quâ€™on aurait en cli :</p>
<pre><code class="lang-shell">$ npm install <span class="hljs-attribute">-g</span> stylus autoprefixer<span class="hljs-attribute">-stylus</span>
$ stylus <span class="hljs-attribute">-u</span> autoprefixer<span class="hljs-attribute">-stylus</span> <span class="hljs-attribute">-o</span> index<span class="hljs-built_in">.</span>css index<span class="hljs-built_in">.</span>styl
</code></pre>
<h4 id="avec-grunt"><a class="putainde-Title-anchor" href="#avec-grunt">#</a>Avec Grunt</h4><p>Il suffira dâ€™utiliser donc lâ€™option <code>use</code> dans votre configuration.</p>
<h4 id="-del-avec-gulp-del-"><a class="putainde-Title-anchor" href="#-del-avec-gulp-del-">#</a><del>Avec Gulp</del></h4><p>La faÃ§on de faire de gulp, via des streams pour Ã©viter la lecture / Ã©criture multiple fait que le plugin
<em>autoprefixer-stylus</em> est vide de sens.
Vous pouvez donc utiliser <em>autoprefixer</em> normalement, aprÃ¨s lâ€™appel du prÃ©-processeur.</p>
<hr>
<p>VoilÃ  jâ€™espÃ¨re que cette fois-ci vous Ãªtes rassasiÃ©(e) afin de ne plus avoir envie de manger des prÃ©fixes CSS !</p>

]]></description><pubDate>Tue, 04 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</guid></item><item><title>Git, boutez les bugs, domptez votre historique!</title><description><![CDATA[[
<p>Vous viendez de lire lâ€™<a href="/posts/git/versionner-avec-git/">article de madx</a> sur le gestionnaire
de version Git et vous vous dites que vous aimeriez en dÃ©couvrir plus! Vous lâ€™utilisez dÃ©jÃ  mais Ãªtes
en quÃªte de quelques nouvelles (ou pas) astuces Ã  vous mettre sous la dent! Bienvenue!</p>
<p>Si vous dÃ©sirez vous servir de cet article comme dâ€™un tutoriel il est recommandÃ© dâ€™avoir quelques
bases concernant lâ€™utilisation et le fonctionnement de Git (commits/branches/etcâ€¦).</p>
<p>Allez, je ne vous fais pas plus attendre, voici ma liste des fonctionnalitÃ©s Git dont je ne
saurais plus me passer:</p>
<h2 id="git-lg-l-alias-qui-vous-parle-d-histoire"><a class="putainde-Title-anchor" href="#git-lg-l-alias-qui-vous-parle-d-histoire">#</a>git lg, lâ€™alias qui vous parle dâ€™Histoire</h2><p>Ã€ lâ€™aide, Ã  lâ€™aide je ne comprends plus rien Ã  lâ€™historique de mon dÃ©pÃ´t Git!
Jâ€™ai crÃ©Ã© un monstreâ€¦ Pas de panique! Jâ€™ai pour vous lâ€™alias quâ€™il vous faut,
honteusement pompÃ© de <a href="https://coderwall.com/p/euwpig">ce site</a>, mais
comme jâ€™ai pas dâ€™honneurâ€¦ Pour le mettre en place il suffit dâ€™entrer la commande
suivante dans votre terminal prÃ©fÃ©rÃ©:</p>
<pre><code class="lang-bash">$ git config --global alias.lg <span class="hljs-string">"log --color --graph --pretty=format:'<span class="hljs-variable">%Cred</span><span class="hljs-variable">%h</span><span class="hljs-variable">%Creset</span> -<span class="hljs-variable">%C</span>(yellow)<span class="hljs-variable">%d</span><span class="hljs-variable">%Creset</span> <span class="hljs-variable">%s</span> <span class="hljs-variable">%Cgreen</span>(<span class="hljs-variable">%cr</span>) <span class="hljs-variable">%C</span>(bold blue)&lt;<span class="hljs-variable">%an</span>&gt;<span class="hljs-variable">%Creset</span>' --abbrev-commit"</span>
</code></pre>
<p>Au cas oÃ¹ vous ne seriez pas Ã  lâ€™aise avec ce genre de choses, sachez simplement que la commande
<code>git config --global alias.lg</code> permet dâ€™inscrire Ã  votre configuration gÃ©nÃ©rale un nouvel alias (
ici lg). Le reste est ce que doit faire cet alias, Ã  savoir afficher un historique reformatÃ© de votre
dÃ©pÃ´t Git.</p>
<p>Allez, je vous met au dÃ©fi dâ€™oser taper un coup de <code>git lg</code> dans votre terminal
maintenant (dans un dÃ©pÃ´t Git bien entendu banane). Pour lâ€™exemple, je lâ€™ai rÃ©alisÃ© dans le dÃ©pÃ´t
de Putain De Code:</p>
<figure>
  <img src="../../../images/posts/git/boutez-les-bugs-domptez-votre-historique/omagad-history.png" alt="capture historique">
  <figcaption>Le pouvoir de lâ€™arc en ciel</figcaption>
</figure>

<p>Eh oui, sous vos yeux Ã©bahis se dessine maintenant lâ€™historique de votre dÃ©pÃ´t!
Tout y est: crÃ©ations de branches, commits, merges, les miaouOnesâ€¦ VoilÃ , vous ne pourrez plus
dire que vous nâ€™y comprenez rien, vous seriez un fieffÃ© menteur.</p>
<h2 id="git-bisect-trouver-et-punir"><a class="putainde-Title-anchor" href="#git-bisect-trouver-et-punir">#</a>git bisect, trouver et punir</h2><p>Sâ€™il y a bien quelque chose dâ€™agaÃ§ant dans lâ€™activitÃ© de dÃ©veloppement, câ€™est que bien
souvent on est amenÃ© Ã  travailler en Ã©quipe, et Ã©videmment, il y en a toujours
un pour introduire des Putain De Bugs. Alors câ€™est parti on sort le dÃ©bugger pour
lâ€™autre ingrat, on place les <code>console.log</code> et autres <code>var_dump()</code> pour trouver dâ€™oÃ¹
peut bien venir ce fichu problÃ¨me, et on se coule un cafÃ© parce quâ€™entre nous, Ã§a peut
prendre du temps.</p>
<p>Heureusement pour nous, lÃ  aussi Git est au rendez-vous avec sa fonctionnalitÃ© de <em>bisecting</em>. Je vous vois dÃ©jÃ  en
train de baver devant votre Ã©cran, mais non, Git ne va pas corriger vos bugs bien Ã©videmment, il va vous aider
Ã  trouver le changement dans le code qui lâ€™a fait apparaÃ®tre et ceci grÃ¢ce Ã  la commande <code>git bisect</code>.</p>
<p>Pour lancer une <em>bisection</em> par Git il suffit dâ€™entrer <code>git bisect start</code> dans votre terminal prÃ©fÃ©rÃ©
et le tour est jouÃ©!</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git bisect start
$
</code></pre>
<figure>
    <figcaption> Capitaine, regardez il nâ€™y a rien </figcaption>
</figure>

<p>Oui bon dâ€™accord, il va falloir sâ€™investir un peu plus pour parvenir Ã  nos fins. Pour lâ€™instant Git est
passÃ© en mode <em>bisection</em>, maintenant il a besoin dâ€™informations pour sâ€™exÃ©cuter:</p>
<ul>
<li>Un commit oÃ¹ le bug est prÃ©sent</li>
<li>Un commit oÃ¹ le bug est absent</li>
</ul>
<p>Imaginons que le commit sur lequel nous sommes comporte le bug, nous allons donc le signaler Ã  Git avec
<code>git bisect bad</code>. Nous allons ensuite nous dÃ©placer sur un commit plus ancien qui ne comporte pas le bug et
le signaler Ã  son tour: <code>git bisect good</code>.</p>
<p>Git va alors se mettre en route et vous dÃ©placer automatiquement de commit en commit. Pour chacun dâ€™eux vous nâ€™aurez
quâ€™Ã  le dÃ©clarer bon ou mauvais comme expliquÃ© au dessus, jusquâ€™Ã  ce que Git vous fournisse le premier commit
comportant le bug, celui dont le changement a rÃ©vÃ©lÃ© le disfonctionnement.</p>
<pre><code class="lang-bash">$ git bisect bad
1082351d9157e98aed1bbee8b9ad6deedca1288f is the first bad <span class="hljs-operator"><span class="hljs-keyword">commit</span>
<span class="hljs-keyword">commit</span> <span class="hljs-number">1082351</span>d9157e98aed1bbee8b9ad6deedca1288f
Author: Maxime Thirouin &lt;m@***.io&gt;
<span class="hljs-keyword">Date</span>:   Fri Jan <span class="hljs-number">17</span> <span class="hljs-number">08</span>:<span class="hljs-number">19</span>:<span class="hljs-number">46</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Â¯\_(ãƒ„)_/Â¯ Fix shit bring <span class="hljs-keyword">in</span> <span class="hljs-number">34</span>a44c98048f2b74fc2dd20f0be807c1e23e8b58

:<span class="hljs-number">040000</span> <span class="hljs-number">040000</span> <span class="hljs-number">7</span>a5d5010f0aaa052ffdc0747b182dc6178a346db d3562872efd1b9d662a89825a3070d64f860cc34 M  src</span>
</code></pre>
<figure>
    <figcaption>1, 2, 3, Soleil!</figcaption>
</figure>

<p>Et voilÃ , le tour est jouÃ©, en plus Git vous a positionnÃ© sur ce commit, il ne manque plus quâ€™un petit coup de
<code>git show</code> et vous savez tout. Pour revenir Ã  votre travail, un simple <code>git bisect reset</code> fera lâ€™affaire!
Il ne vous reste plus quâ€™Ã  punir la personne fautive, mais pour Ã§a je vous laisse avec votre imagination,
je suis sÃ»r que vous trouverez.</p>
<p>Pour les fanatiques de lâ€™efficacitÃ© et de lâ€™automatisation, sachez que Git en a encore dans le ventre. Si vous
connaissez dÃ©jÃ  un bon et un mauvais commit, vous pouvez tout simplement lancer la <em>bissection</em> Ã  grand coup de
<code>git bisect start MAUVAIS_COMMIT BON_COMMIT</code> et si, cerise sur le gÃ¢teau, vous Ãªtes en possession dâ€™une suite de tests
unitaires (oui non je sais faut pas dÃ©conner), <code>git bisect run &lt;votre_script&gt;</code> vous permettra de la lancer et la
recherche du premier commit dÃ©fectueux se fera alors toute seule!</p>
<h2 id="git-rebase-du-pur-story-telling"><a class="putainde-Title-anchor" href="#git-rebase-du-pur-story-telling">#</a>git rebase, du pur story-telling</h2><p>Je ne sais pas sâ€™il vous est dÃ©jÃ  arrivÃ© de naviguer dans les dÃ©pÃ´ts Git de projets libres, mais souvent on y trouve que trÃ¨s
peu de commits poubelles, ces commits avec comme message â€œstepâ€ ou autre â€œstuffâ€. Chaque commit correspond Ã  une fonctionnalitÃ©,
un bug fix, une unitÃ© logique cohÃ©rente. Je ne sais pas pour vous, mais personnellement un <em>git log</em> ne ressemble pas Ã 
Ã§a chez moi!</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><figure>
    <figcaption>best git log, ever</figcaption>
</figure>

<p>Bien que lâ€™on essaye de nous faire croire que les logiciels libres sont codÃ©s par des rockstars, ce qui permet de justifier le
mythe du <em>1 commit = 1 fonctionnalitÃ©</em>, vous nâ€™Ãªtes pas dupes; lâ€™historique Git de ces dÃ©pÃ´ts est bel et bien retravaillÃ©, et ceci dans
le but de maintenir sa cohÃ©rence et de permettre Ã  tous les contributeurs de le comprendre. Si cela sâ€™applique particuliÃ¨rement
dans le cadre des logiciels libres, il nâ€™en est pas moins satisfaisant dâ€™avoir Ã©galement un historique clair sur ses propres dÃ©pÃ´ts.</p>
<p>Pour cela, lâ€™arme de choix sâ€™appelle <code>git rebase</code>. Cette fonctionnalitÃ© permet de rÃ©Ã©crire lâ€™historique de vos dÃ©pÃ´ts, de
rÃ©organiser les commits, dâ€™en supprimer, de changer leur message associÃ© etcâ€¦ La fonctionnalitÃ© est assez simple Ã  utiliser, nous allons
prendre exemple sur lâ€™historique prÃ©sentÃ© ci-dessus: je voudrais supprimer le commit dont le message est â€˜stuffâ€™ parce que finalement il
sâ€™avÃ¨re inutile. Je veux Ã©galement fusionner le commit â€˜miscâ€™ avec le commit â€˜Now my new functionality finally worksâ€™ et renommer ce dernier
pour quâ€™il soit plus explicite et fasse rÃ©fÃ©rence Ã  ma User Story correspondante dans mon outil de tracking prÃ©fÃ©rÃ©.</p>
<p>Pour commencer, il faut dire jusquâ€™Ã  quel commit on souhaite effectuer cette rÃ©Ã©criture; pour cela, dans mon cas, deux solutions:</p>
<ul>
<li>Faire rÃ©fÃ©rence Ã  partir de HEAD (lâ€™Ã©tiquette courante), ici: HEAD~3 (je veux rÃ©Ã©crire jusquâ€™au commit avant â€˜stuffâ€™)</li>
<li>Fournir le SHA1 du commit avant â€˜stuffâ€™ (ici 2645b1cdbdd72bea6c392c011320556997327761)</li>
</ul>
<p>Je vais utiliser la premiÃ¨re mÃ©thode (le choix nâ€™influe en rien sur la suite), et donc lancer la rÃ©Ã©criture en invoquant la commande: <code>git rebase -i HEAD~3</code>
( -i voulant dire de lancer un <em>rebase</em> en mode intÃ©ractif). Voici ce qui mâ€™est alors prÃ©sentÃ©:</p>
<pre><code>pick <span class="hljs-number">9</span>db49a3 stuff
pick <span class="hljs-number">551</span>b243 misc
pick e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><p>Git mâ€™affiche tous les commits concernÃ©s par lâ€™opÃ©ration (en ordre inverse), devant chacun dâ€™eux, la mention <em>pick</em>, et une lÃ©gende en bas.
<em>pick</em>, comme lâ€™indique la lÃ©gende, signifie que ce commit sera conservÃ©, mais je peux remplacer cette mention par les suivantes:</p>
<ul>
<li>reword : modifier le message de commit.</li>
<li>edit : utiliser le commit mais me laisser le modifier avec un <code>git commit --amend</code> qui permet de commiter lâ€™Ã©tat courant de la copie de travail en
lâ€™incorporant au commit prÃ©cÃ©dent.</li>
<li>squash : utiliser le commit en le fusionnant avec le commit prÃ©cÃ©dent.</li>
<li>fixup : utiliser le commit en le fusionnant avec le commit prÃ©cÃ©dent et ne pas utiliser son message associÃ©.</li>
<li>exec : exÃ©cuter une commande sur ce commit.</li>
</ul>
<p>En plus de ces diffÃ©rentes mentions, je peux Ã©galement effectuer deux autres actions:</p>
<ul>
<li>dÃ©placer un commit, ce qui aura pour effet final de le dÃ©placer dans lâ€™historique.</li>
<li>supprimer un commit, ce qui aura comme rÃ©sultat de le faire disparaÃ®tre de lâ€™historique.</li>
</ul>
<p>Pour ma part, je vais:</p>
<ul>
<li>supprimer la premiÃ¨re ligne parce que jâ€™ai dÃ©cidÃ© que le commit â€˜stuffâ€™ ne me servait Ã  rien.</li>
<li>mettre la mention reword devant le commit â€˜miscâ€™, car je vais fusionner le dernier commit avec celui-ci et mettre un nouveau message.</li>
<li>mettre la mention fixup devant le commit â€˜Now my new functionality finally worksâ€™ car je vais le fusionner au prÃ©cÃ©dent et abandonner son message.</li>
</ul>
<p>Ce qui nous donne le rÃ©sultat suivant:</p>
<pre><code>reword <span class="hljs-number">551</span>b243 misc
fixup e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><figure>
    <figcaption>Attention chÃ©rie, Ã§a va trancher</figcaption>
</figure>

<p>Il nâ€™y a plus quâ€™Ã  sauvegarder et quitter (:x dans vim) pour que la machine se mette en route. Si certaines actions que vous avez effectuÃ©es, notamment
le dÃ©placement de commits, provoquent des conflits, Git va vous demander de les rÃ©soudre au fur et Ã  mesure; il suffit pour cela dâ€™Ã©diter vos fichiers, puis
de les marquer comme rÃ©solus au moyen de la commande <code>git add &lt;lefichier&gt;</code> avant de reprendre avec la commande <code>git rebase --continue</code>. Comme convenu,
Git vous demande dâ€™Ã©diter le message du commit marquÃ© en <em>reword</em>:</p>
<pre><code>Story #<span class="hljs-number">34</span> - Poker cards now have a real back picture

<span class="hljs-preprocessor"># Please enter the commit message for your changes. Lines starting</span>
<span class="hljs-preprocessor"># with '#' will be ignored, and an empty message aborts the commit.</span>
<span class="hljs-preprocessor"># HEAD detached at ca4ff95</span>
<span class="hljs-preprocessor"># You are currently rebasing branch 'master' on 'ca4ff95'.</span>
<span class="hljs-preprocessor">#   (all conflicts fixed: run "git rebase --continue")</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Changes to be committed:</span>
<span class="hljs-preprocessor">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># modified:   README.txt</span>
<span class="hljs-preprocessor">#</span>
</code></pre><figure>
    <figcaption>Un commit quâ€™il est mieux pour le relire</figcaption>
</figure>

<p>Lâ€™opÃ©ration va continuer puis Git va vous rendre la main. Il vous suffit alors de faire un <code>git log</code> pour apprÃ©cier le rÃ©sultat:</p>
<pre><code>commit <span class="hljs-number">481</span>b4dccf4fedf4ed9d7f4e83ae5c19a07f7e12e
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Story <span class="hljs-preprocessor">#34 - Poker cards now have a real back picture</span>
</code></pre><figure>
    <figcaption>Et câ€™est le succÃ¨Ã¨Ã¨Ã¨Ã¨Ã¨Ã¨s</figcaption>
</figure>

<p>Vous nâ€™avez plus quâ€™un seul commit tout beau tout propre! Vous pouvez maintenant le pousser sur votre dÃ©pÃ´t et vous vanter dâ€™avoir un bel historique, parce
que vous aussi, vous Ãªtes une rockstar :).</p>
<p>Pour ceux qui dÃ©sirent aller encore plus loin dans lâ€™automatisation de ce processus de rebase, je vous conseille dâ€™aller jeter un Å“il Ã  lâ€™utilisation
de lâ€™option <a href="http://madx.me/articles/git_rebase_autosquash.html">â€”autosquash</a>.</p>
<h2 id="git-reflog-la-commande-de-celui-qui-a-fait-n-importe-quoi"><a class="putainde-Title-anchor" href="#git-reflog-la-commande-de-celui-qui-a-fait-n-importe-quoi">#</a>git reflog, la commande de celui qui a fait nâ€™importe quoi</h2><p>Voici venu le temps <del>des rires et des chants</del> de la deniÃ¨re commande que je souhaitais vous prÃ©senter, jâ€™ai nommÃ© <code>git reflog</code>. Cette commande
câ€™est votre <em>joker</em>, elle assure votre survie, notamment si vous avez Ã©tÃ© assez zinzins pour suivre les exemples donnÃ©s dans cet article, parce
que honnÃªtementâ€¦</p>
<figure>
    <img src="http://i1.kym-cdn.com/photos/images/newsfeed/000/305/224/3e1.jpg" alt="I have no idea what I&#39;m doing">
</figure>

<p>Vous ne le savez peut Ãªtre pas, mais Git, dans sa grande bontÃ©, garde une rÃ©fÃ©rence de toutes vos actions, de tous les endroits oÃ¹ vous vous Ãªtes dÃ©placez.
Ce registre, câ€™est le <em>references log</em>, et en plus on peut y accÃ©der simplement grÃ¢ce Ã  la commande <code>git reflog</code> (sans dÃ©conner). Faisons un petit tour
dans le miens:</p>
<pre><code><span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">0</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
<span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">1</span>}: rebase -i (fixup): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
<span class="hljs-number">8</span>fd5835 HEAD@{<span class="hljs-number">2</span>}: rebase -i (<span class="hljs-keyword">continue</span>): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
ca4ff95 HEAD@{<span class="hljs-number">3</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> ca4ff952310d6246216e83f49309b32b2d2fa010
e739e7c HEAD@{<span class="hljs-number">4</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">5</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">6</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">7</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">8</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">9</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">10</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">11</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">12</span>}: commit: Now <span class="hljs-keyword">my</span> new functionality finally works
<span class="hljs-number">551</span>b243 HEAD@{<span class="hljs-number">13</span>}: commit: misc
<span class="hljs-number">9</span>db49a3 HEAD@{<span class="hljs-number">14</span>}: commit (amend): stuff
af7fc36 HEAD@{<span class="hljs-number">15</span>}: commit: misc
ca4ff95 HEAD@{<span class="hljs-number">16</span>}: commit (initial): <span class="hljs-keyword">first</span> commit
</code></pre><figure>
    <figcaption>Il est beau mon reflog, il est frais</figcaption>
</figure>

<p>On voit ici lâ€™ensemble de mes opÃ©rations apparaÃ®tre comme le <em>rebase</em> effectuÃ© prÃ©cÃ©demment (bon dâ€™accord il apparaÃ®t plusieurs fois parce que jâ€™ai
fait quelques tests avant dâ€™Ã©crire cette partie de lâ€™article). Chaque opÃ©ration possÃ¨de un SHA1 qui est en fait une rÃ©fÃ©rence vers le commit concernÃ©, dans lâ€™Ã©tat
dans lequel il Ã©tait au moment de lâ€™opÃ©ration. Bien, imaginons que jâ€™ai fait nâ€™importe quoi avec le rebase et que je veuille retrouver mon Ã©tat prÃ©cÃ©dent, et bien
il me suffira ici de faire un <code>git checkout e739e7c</code> (dans votre cas la ligne sera probablement plus simple Ã  trouver). Et lÃ  si je refais un <code>git log</code>, miracle:</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><p>Vous voilÃ  retombÃ©s sur vos pieds! Vous nâ€™avez plus quâ€™Ã  reconnecter votre branche Ã  ce commit si jamais vous en aviez une et vous Ãªtes reparti pour de nouvelles
aventures.</p>
<p>Sachez tout de mÃªme que ce <em>references log</em> peut Ãªtre effacÃ©, et il est mÃªme conseillÃ© de le faire rÃ©guliÃ¨rement pour des problÃ©matiques de performance de Git sur
votre dÃ©pÃ´t; conserver tous ces commits peut devenir coÃ»teux Ã  la longue. La commande <code>git gc</code> pour <em>garbage collector</em> sâ€™occupera de faire le mÃ©nage
pour vous.</p>
<p>VoilÃ , on arrive au bout de notre aventure, jâ€™espÃ¨re que vous avez appris quelque chose et que Git vous fait maintenant moins peur.</p>
<p>Amike,</p>

]]></description><pubDate>Thu, 27 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</link><guid isPermaLink="true">http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</guid></item><item><title>Twitter comme lecteur de flux</title><description><![CDATA[[
<p><em>(Note : dans cet article, jâ€™ai volontairement pris comme exemple la version Web afin que tout le monde puisse profiter de lâ€™expÃ©rience mais il est Ã©vident que vous puissiez le faire avec votre application twitter favorite).</em></p>
<p>Bien avant la fin de Google Reader, je me posais dÃ©jÃ  la question de lâ€™intÃ©rÃªt dâ€™un lecteur de flux {rss|atom}. En effet, il mâ€™Ã©tait pÃ©nible dâ€™organiser les flux que je souhaitais lire : les ranger par catÃ©gorie, supprimer les sites morts ou ceux qui ne mâ€™intÃ©ressaient plus; de plus, je nâ€™ai jamais rÃ©ellement utilisÃ© les fonctionnalitÃ©s dâ€™un lecteur de flux comme le systÃ¨me de marquage, savoir si le flux a Ã©tÃ© lu ou non, lire lâ€™article dans le lecteur (je le lis toujours sur le site, jamais dans lâ€™application). Et puis câ€™est parfois pÃ©nible de trouver un lecteur de flux simple, multi-OS et gratuit.</p>
<p>Jâ€™ai Ã©tÃ© un grand fan Ã  lâ€™Ã©poque de Netvibes puis je lâ€™ai dÃ©laissÃ© pour Google Reader et nous voilÃ  quelques temps aprÃ¨s, sans rÃ©elle solution Ã  mon sens pour lire agrÃ©ablement des flux tel que je le concois.</p>
<p>Jâ€™expÃ©rimente pourtant une solution depuis quelques mois qui me sied bien. Jâ€™utilise en effet Twitter en tant que lecteur de flux. Oui, car cela a plusieurs avantages :</p>
<ul>
<li><p>Il existe une application pour <a href="https://play.google.com/store/apps/details?id=com.twitter.android&amp;hl=fr">Android</a>, <a href="https://about.twitter.com/products/iphone">iOS</a> ainsi que <a href="https://itunes.apple.com/fr/app/twitter/id409789998?mt=12">Mac</a>; mais aussi la <a href="https://twitter.com/">version Web</a> et <a href="https://tweetdeck.twitter.com/">Tweetdeck</a> est disponible sur tous les environnements.</p>
</li>
<li><p>Je fais ma veille majoritairement via Twitter; jâ€™Ã©crÃ¨me au fil de la journÃ©e ce qui mâ€™intÃ©resse ou non. Si câ€™est rapide Ã  lire alors je le lis, sinon je <em>bookmark</em> lâ€™article en â€œRead laterâ€ sur mon navigateur. Cela permet de trier rapidement lâ€™information et de lire plus paisiblement cela au moment opportun.
De plus, Ã©tant donnÃ© que lâ€™information est donnÃ©e par mes <em>following</em> et que je suis les personnes qui mâ€™intÃ©ressent vraiment, lâ€™information est alors souvent pertinente. Encore faut-il avoir la bonne TL.
Et  si jâ€™ai besoin dâ€™aller chercher une information prÃ©cise, jâ€™irai la trouver Ã  travers un moteur de rechercheâ€¦ donc aucune problÃ©matique de â€œneutralitÃ©â€ de lâ€™information.</p>
</li>
<li><p>De plus, Ã©tant donnÃ© que je fais justement cette veille via Twitter, cela me permet dâ€™avoir quâ€™un seul outil. Cela mâ€™ennuie au plus haut point de collectionner les outils. Je suis certes partisant dâ€™utiliser le bon outil pour chaque tÃ¢che plutÃ´t quâ€™un couteau-suisse, mais finalement Twitter et un lecteur de flux ne sont pas si Ã©loignÃ©s.</p>
</li>
<li><p>Enfin, la majoritÃ© des blogs / sites que jâ€™apprÃ©cie ont leur propre compte twitter qui postent lâ€™url de leurs articles, il suffit alors de les suivre. Et si ce nâ€™est pas le cas, je vous montrerai une petite astuce pour que Ã§a le soit.</p>
</li>
</ul>
<p>Vous vous sentez chaud(e) pour commencer ? TrÃ¨s bien, câ€™est parti !</p>
<h2 id="creer-une-liste-twitter"><a class="putainde-Title-anchor" href="#creer-une-liste-twitter">#</a>CrÃ©er une liste Twitter</h2><p>Pour crÃ©er une liste, aucun problÃ¨me, vous allez dans â€œMeâ€ dans le <em>header</em> puis â€œListâ€ dans la colonne de gauche pour vous retrouver ici :</p>
<p><img src="../../../images/posts/twitter/twitter-list.jpg" alt=""></p>
<p>Puis vous cliquez sur <code>Create list</code> et vous rentrez les informations que vous souhaitez :</p>
<p><img src="../../../images/posts/twitter/create-list.png" alt=""></p>
<p>Nous voilÃ  avec notre belle liste. Il nâ€™y a plus quâ€™Ã  la remplir de jolis <em>following</em>.</p>
<p>Prenons par exemple <code>@nodenpm</code>, un beau <em>bot</em> tweetant les nouveaux packages node.js ou/et les updates de ces packages.</p>
<p><img src="../../../images/posts/twitter/nodenpm.jpg" alt=""></p>
<p>Ajoutons-le Ã  notre liste.</p>
<p><img src="../../../images/posts/twitter/add-in-list.png" alt=""></p>
<p>Nous voilÃ  maintenant avec notre liste comprenant un <em>following</em>. Ce qui en ayant ajoutÃ© quelques comptes donnera quelque chose comme ceci :</p>
<p><img src="../../../images/posts/twitter/twitter-list-read.jpg" alt=""></p>
<p>Vous pouvez maintenant apprÃ©cier votre lecteur de flux.</p>
<p>Oh mais ! Câ€™est lÃ  que vous constatez quâ€™un de vos sites prÃ©fÃ©rÃ©s nâ€™a pas de compte Twitter ! Que faire ? Haha, et si on utilisait la puissance de IFTTT pour se crÃ©er un bot twitter qui tweet chaque nouvel article dâ€™un des sites que vous apprÃ©ciez ?! Mais ouais !</p>
<h2 id="ifttt-la-solution-pour-parfaire-notre-lecteur"><a class="putainde-Title-anchor" href="#ifttt-la-solution-pour-parfaire-notre-lecteur">#</a>IFTTT, la solution pour parfaire notre lecteur</h2><p>Mais avant tout, crÃ©ons notre compte twitter â€œbotâ€ qui va tweeter ce quâ€™on souhaite.</p>
<h3 id="compte-twitter-bot-"><a class="putainde-Title-anchor" href="#compte-twitter-bot-">#</a>Compte twitter â€œbotâ€</h3><ul>
<li>DÃ©connectez-vous</li>
<li>Inscrivez-vous Ã  nouveau sur Twitter (le mien sâ€™appelle <a href="https://twitter.com/kud_feeds">@kud_feeds</a> par exemple)</li>
<li>Mettez-lui une belle bio, un bel avatar</li>
<li>DÃ©connectez-vous Ã  nouveau</li>
<li>Connectez-vous avec votre vrai compte</li>
<li>Ajoutez votre â€œbotâ€ Ã  la liste que vous venez de crÃ©er prÃ©cÃ©demment</li>
</ul>
<p>â€¦ et voilÃ  !</p>
<h3 id="ifttt"><a class="putainde-Title-anchor" href="#ifttt">#</a>IFTTT</h3><p><img src="../../../images/posts/ifttt.png" alt=""></p>
<p>Maintenant, IFTTT.</p>
<blockquote>
<p>IFTTT (â€œIf This Then Thatâ€) est un service qui permet aux utilisateurs de connecter diffÃ©rentes applications ensemble Ã  travers de simples conditions nommÃ©es â€œrecettesâ€.</p>
</blockquote>
<p>IFTTT va vous permettre dâ€™aller pomper les flux {rss|atom} de vos sites prÃ©fÃ©rÃ©s puis ayant accÃ¨s Ã  votre <em>bot</em> va permettre de tweeter le contenu des flux ! Câ€™est pas beau Ã§a hein ?! =)</p>
<ul>
<li>Allez sur <a href="https://ifttt.com">ifttt.com</a></li>
<li>CrÃ©ez-vous un compte (je vous conseille de crÃ©er un compte spÃ©cialement pour le <em>bot</em> car IFTTT ne propose de relier quâ€™un seul compte twitter. Du coup, si comme moi vous apprÃ©ciez IFTTT et que vous souhaitez autant utiliser IFTTT pour votre compte twitter principal que votre compte <em>bot</em>, je vous conseille de vous crÃ©er deux comptes IFTTT)</li>
<li>CrÃ©ez une nouvelle recette en cliquant sur <code>Create</code></li>
<li>Cliquez sur <code>this</code></li>
<li>Puis <code>feed</code></li>
<li>Choissisez le <em>trigger</em> (â€œdÃ©clencheurâ€) que vous souhaitez, moi je prends plutÃ´t le premier <code>New feed item</code> (le plus simple)</li>
<li>Indiquez lâ€™url du flux de votre site, par exemple <code>http://dribbble.com/_kud/shots/following.rss</code></li>
<li>Puis <code>then</code></li>
<li>Twitter</li>
<li><code>Post a tweet</code></li>
<li>Laissez tel quel le <em>template</em> de base pour le moment (vous pourrez le changer quand vous serez Ã  lâ€™aise avec IFTTT)</li>
<li>Mettez la description qui va bien</li>
</ul>
<p>Et on est bon.</p>
<p>Vous avez maintenant une nouvelle recette qui dÃ¨s quâ€™un article sortira, un tweet de votre <em>bot</em> apparaitra. Vous pouvez dâ€™ailleurs vÃ©rifier que tout marche bien en cliquant sur la flÃ¨che <em>Check Recipe Now</em>.</p>
<p>Vous nâ€™aurez plus quâ€™Ã  crÃ©er une nouvelle recette en dupliquant cette recette Ã  chaque fois que vous voudrez suivre un nouveau flux. Certes Ã©ventuellement plus contraignant quâ€™un vrai lecteur de flux mais vous y gagnerez largement par la suite ;)</p>
<p>Et voilÃ , nous avons maintenant une belle liste Twitter qui reprÃ©sentre votre lecteur de flux. Voici la mienne : <a href="https://twitter.com/_kud/lists/feeds">https://twitter.com/_kud/lists/feeds</a></p>
<p>Vous pouvez mÃªme pousser le vice en crÃ©ant plusieurs listes par catÃ©gorie mais Ã§a sous-entend aussi de crÃ©er des <em>bots</em> et donc des comptes IFTTT par catÃ©gorie. Heureusement que jâ€™en ai quâ€™une. ;)</p>
<p>Enjoy!</p>

]]></description><pubDate>Wed, 26 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</link><guid isPermaLink="true">http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</guid></item><item><title>Comment en finir avec les prÃ©fixes CSS</title><description><![CDATA[[
<p>En mettant de cÃ´tÃ© le dÃ©bat trollesque <em>faut-il ou pas des prÃ©fixes CSS ?</em>
(car avouons-le, ils sont lÃ , il faut faire avec), on ne va pas se le cacher,
les prÃ©fixes CSS Ã§a nous brise tous lesâ€¦ touches du clavier.
Eh bien oui, sans automatisation on est obligÃ© de se taper des caractÃ¨res en plus.
MÃªme avec un IDE correct, on peut faire Ã§a rapidement, mais Ã§a nÃ©cessite
presque Ã  chaque fois une action de notre part.</p>
<h2 id="prefixer-via-des-outils-en-ligne"><a class="putainde-Title-anchor" href="#prefixer-via-des-outils-en-ligne">#</a>PrÃ©fixer via des outils en ligne</h2><p>Les Ã©lÃ¨ves au fond de la classe me montreront de suite des solutions comme
<a href="http://prefixmycss.com/">prefixmycss.com</a> ou lâ€™ancien prefixr.
InopinÃ©ment, un moche â€œMourrez moi sile vou plerâ€ sort de mon corps.
Non, sÃ©rieusement, ce nâ€™est pas une faÃ§on de faire Ã§a. Aller sur une web app Ã 
chaque fois que je veux prÃ©fixer mes CSS ? SÃ©rieusement ?
Vous avez quâ€™Ã  aussi faire un service postal oÃ¹ jâ€™envoie mes fichiers CSS dans
une clÃ© USB et quâ€™on me renvoie sous 48h avec les prÃ©fixes ajoutÃ©s.
Super pratique.</p>
<h2 id="prefixer-via-javascript"><a class="putainde-Title-anchor" href="#prefixer-via-javascript">#</a>PrÃ©fixer via JavaScript</h2><p>Une autre solution serait <a href="http://leaverou.github.io/prefixfree/">prefix-free</a>,
mais je ne vais mÃªme pas en parler tellement lâ€™idÃ©e de dÃ©pendre de JavaScript pour
avoir un <code>border-radius</code> ou une <code>transition</code> CSS me donne une migraine.
Je vous passe les dÃ©tails niveau performance. Selon les cas, on pourrait mÃªme avoir
un petit flash visuel sans les propriÃ©tÃ©s prÃ©fixÃ©es.
Non mais flÃ»te. On ne fait pas Ã§a. On nâ€™alourdit pas une page web avec du JavaScript
pour parser la feuille de style et rÃ©intÃ©grer des prÃ©fixes quoi. Au secours.</p>
<h2 id="prefixer-via-les-pre-processeurs-css"><a class="putainde-Title-anchor" href="#prefixer-via-les-pre-processeurs-css">#</a>PrÃ©fixer via les prÃ©-processeurs CSS</h2><p>Alors lÃ , jâ€™en entends dÃ©jÃ  qui parle Ã  voix haute au milieu de la classe :</p>
<blockquote>
<p>Bah lui câ€™est clair ilâ€™connait pas les prÃ©-processeurs CSS le noube</p>
</blockquote>
<p>Sans rentrer dans un dÃ©bat trollesque (encore un), Ã  part peut-Ãªtre avec <em>Stylus</em> et ces
mixins transparent (coucou <em><a href="http://visionmedia.github.io/nib/">Nib</a></em>),
on est obligÃ© de rajouter du code.
Avec <em>Sass</em> il faudra (en scss) rajouter <code>@include</code> et un couple de parenthÃ¨se (et
au passage avoir <em>Compass</em> si on ne veut pas coder les mixins Ã  la main).
Avec <em>Less</em> il faudra aussi une librairie <em>Less Hat</em> si on nâ€™a pas envie de se taper
du mixin qui donne de la nausÃ©e comme on peut voir sur la
<a href="http://lesscss.org/">page dâ€™accueil</a>.</p>
<h2 id="les-prefixes-c-est-comme-le-lait-a-tourne"><a class="putainde-Title-anchor" href="#les-prefixes-c-est-comme-le-lait-a-tourne">#</a>Les prÃ©fixes, câ€™est comme le lait, Ã§a tourne</h2><p>Dâ€™ailleurs, parlons en vite fait de cette page dâ€™accueil qui au jour oÃ¹ jâ€™Ã©cris
se post, comporte <b>en premier exemple</b> un mixin pour <code>box-shadow</code>
(hashtag ohlol).</p>
<p>Certaines propriÃ©tÃ©s comme <code>box-shadow</code>, ou encore <code>border-radius</code>, sont
aujourdâ€™hui prÃ©fixÃ©es Ã  tort, car comme on peut le voir sur le site de
<a href="http://caniuse.com/">CanIUse.com</a>, elles nâ€™ont plus vraiment besoin dâ€™Ãªtre prÃ©fixÃ©es, Ã 
moins que vous supportiez encore Firefox 3.6, Safari iOS 3 ou Android 2â€¦
Je vous renvoie rapidement sur ce (vieil) article de Chris Coyier
<a href="http://css-tricks.com/do-we-need-box-shadow-prefixes/">Do we need box-shadow or border-radius prefixes anymore?</a>
en guise de mÃ©mo :)</p>
<p>Sans Ãªtre de mauvaise foi, on va vite avouer quâ€™on ne peut pas forcÃ©ment tout savoir.
Donc on ne peut pas Ãªtre au top pour connaÃ®tre quand il faut ou quand il nâ€™y a plus
besoin de prÃ©fixer x ou y (oui bon x et y ne sont pas des propriÃ©tÃ©s CSS, câ€™est
pour lâ€™exemple).
Qui sait quâ€™on peut enfin arrÃªter de prÃ©fixer box-sizing dans Firefox depuis la 29 ?
Ou la 30 je ne sais plusâ€¦</p>
<p>Bon mais alors comment faire ? Jâ€™entends les fayots du premier rang parler dâ€™autoâ€¦
autoâ€¦ AUTOPREFIXER ?!</p>
<p>MAIS Câ€™EST POSSIBLE Ã‡A ?</p>
<p>Bon allons Ã  lâ€™essentiel, assez trollÃ©.</p>
<h1 id="autoprefixer"><a class="putainde-Title-anchor" href="#autoprefixer">#</a>Autoprefixer</h1><p>Ce magnifique outil, basÃ© sur une solide base de donnÃ©es (au hasard, CanIUse.com),
permet de prÃ©fixer automatiquement vos CSS, et ce, de maniÃ¨re intelligente.
Vous pouvez en effet configurer autoprefixer, afin de lui prÃ©ciser quel
navigateur vous voulez utiliser.
Vous pouvez au choix lui demander de supporter X versions en arriÃ¨re, les versions
qui ont un usage global &gt; Ã  Y% de trafic, ou encore une version minimale donnÃ©e.</p>
<p>Voici quelques exemples de configuration.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Je supporte une version en arriÃ¨re et les navigateurs qui ont plus de 1% de trafic ainsi qu'Internet Explorer 7</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 1 version"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;

<span class="hljs-comment">// Je supporte 2 versions en arriÃ¨re, et minimum BlackBerry 10 et Android 4</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 2 version"</span>, <span class="hljs-string">"BlackBerry 10"</span>, <span class="hljs-string">"Android 4"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;
</code></pre>
<p>Dans ces lignes de code JavaScriptâ€¦ Quoi attendez câ€™est en JavaScript ? Oh le
fourbe, il nous recale sa techno de front-end de mes deux.
Bon faites pas les relous, que vous soyez front-end ou back-end, vous avez Node.js hein ?</p>
<p>Donc aucune inquiÃ©tude, il existe une commande pour que vous puissiez faire Ã§a rapidement :</p>
<pre><code class="lang-shell"><span class="hljs-preprocessor"># on install autoprefixer via npm en global</span>
npm install --global autoprefixer
<span class="hljs-preprocessor"># ou pour les fainÃ©ants</span>
npm i -g autoprefixer

<span class="hljs-preprocessor"># on prefixe !</span>
autoprefixer *.css
</code></pre>
<p>LÃ  bon de suite, rÃ©flexe, vous me sautez dessus Ã  la gorge en me criant:</p>
<blockquote>
<p>NON MAIS Tâ€™AS CRU QUE Jâ€™ALLAIS TAPER LA COMMANDE Ã€ CHAQUE FOIS TOCARD ?</p>
</blockquote>
<p>No problem, comme tout outil bien foutu, il yâ€™a une multitudes de faÃ§on de
lâ€™utiliser :</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec lâ€™application <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu),</li>
</ul>
<p>Bien entendu, parfois, lorsquâ€™on fait un petit bout de CSS standalone,
vous avez aussi Ã  dispo des plugins pour
<a href="https://github.com/sindresorhus/sublime-autoprefixer">Sublime Text</a>
 ou <a href="https://github.com/mikaeljorhult/brackets-autoprefixer">Brackets</a>
 afin de ne pas forcÃ©ment avoir Ã  utiliser les app ou process citÃ©s juste avant.</p>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>IntÃ©gration dans Sublime Text</figcaption>
</figure>

<p>Cet outil est maintenant basÃ© sur <a href="https://github.com/ai/postcss">PostCSS</a>,
un post-processeur CSS. Vous pouvez donc lâ€™utiliser en plugin pour ce post-procÃ©sseur.</p>
<p>Attends attends, un WAT ? Un <strong>POST</strong>-processeur ? Oui tu as bien lu car les
prÃ©-processeurs câ€™est so 2000.
Mais Ã§a, je vous en parle la prochaine fois ;)</p>
<p>Tout plein de -moz-bisous.</p>
<hr />

<p>PS: Convaincu par cette solution ? Tant mieux, elle est simple Ã  mettre en place.
Tout Ã§a est dÃ©crit dans la <a href="/posts/css/mise-en-place-autoprefixer/">mise en place dâ€™autoprefixer</a>
avec des exemples concrets pour ajouter Ã§a dans un workflow existant.</p>

]]></description><pubDate>Tue, 25 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</guid></item><item><title>La puissance de dnsmasq</title><description><![CDATA[[
<p>DerniÃ¨rement, jâ€™ai voulu accÃ©der avec mon Smartphone Ã  ma machine virtuelle (<em>VM</em>) de dÃ©veloppement qui se trouve sur mon poste de travail (<em>machine ou poste hÃ´te</em>). Ma machine virtuelle me permet de reproduire Ã  lâ€™identique la production afin dâ€™avoir le moins de marge dâ€™erreur possible entre la phase de dÃ©veloppement et la phase de mise en production.</p>
<p>A ce moment lÃ , jâ€™accÃ©dais Ã  ma machine virtuelle Ã  partir de mon poste via le fichier <em>hosts</em> comprenant ceci :</p>
<pre><code><span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span> monsite<span class="hljs-preprocessor">.dev</span>
</code></pre><p>Le problÃ¨me est que seul mon poste est au courant de la rÃ©solution du nom de domaine de par cette mÃ©thode.</p>
<p>Ã‰tant donnÃ© quâ€™il est laborieux de changer des <em>hosts</em> sur un appareil comme un tÃ©lÃ©phone et que je nâ€™ai pas non plus envie de dupliquer cette modification sur chaque appareil, il me fallait trouver une solution gÃ©nÃ©ralisÃ©e.</p>
<p>Câ€™est lÃ  que <strong><a href="http://fr.wikipedia.org/wiki/Dnsmasq">dnsmasq</a></strong> entre en jeu.</p>
<blockquote>
<p>Dnsmasq est un serveur lÃ©ger pour fournir les services DNS, DHCP, Bootstrap Protocol et TFTP pour un petit rÃ©seau, voire pour un poste de travail. Il permet dâ€™offrir un service de nommage des machines du rÃ©seau interne non intÃ©grÃ©es au service de nommage global (i.e. le service DNS dâ€™Internet). Le service de nommage est associÃ© au service dâ€™adressage de telle maniÃ¨re que les machines dont le bail DHCP est fourni par Dnsmasq peuvent avoir automatiquement un nom DNS sur le rÃ©seau interne. Le logiciel offre un service DHCP statique ou dynamique.</p>
</blockquote>
<h2 id="dnsmasq-le-serveur-dns-tout-petit"><a class="putainde-Title-anchor" href="#dnsmasq-le-serveur-dns-tout-petit">#</a>dnsmasq, le serveur dns tout petit</h2><p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>
<ul>
<li>accÃ©lÃ©rer la rÃ©solution dns</li>
<li>ne pas polluer le rÃ©seau interne de la boite avec des rÃ©solutions de domaines propre Ã  votre poste (imaginez que vous soyez plusieurs Ã  avoir <em>monsite.dev</em> (ce qui est le cas dans notre boite)); une rÃ©solution se ferait uniquement vers un seul poste donc impossible de faire sans si vous Ãªtes plusieurs</li>
<li>ne pas dupliquer sur chacun appareil la rÃ©solution dns</li>
<li>rÃ©ussir Ã  rÃ©soudre un nom de domaine sur un appareil oÃ¹ le fichier <em>hosts</em> est difficile voire impossible dâ€™accÃ¨s</li>
</ul>
<p>Cependant, tout nâ€™est pas si rose, je vais vous montrer pourquoi aprÃ¨s.</p>
<h3 id="partage-de-connexion"><a class="putainde-Title-anchor" href="#partage-de-connexion">#</a>Partage de connexion</h3><p>Je vous propose dans un premier temps de partager votre connexion via le Wifi sous Mac OS X afin :</p>
<ul>
<li>dâ€™avoir constamment un dÃ©bit stable et performant; Ã©tant donnÃ© que vous Ãªtes souvent devant votre poste pour tester sur diffÃ©rents appareils, en partageant votre connexion via Wifi, vous vous assurez dâ€™avoir un excellent dÃ©bit, chose qui nâ€™est pas toujours Ã©vidente quand le wifi de votre boite est un peu / souvent trop loin</li>
<li>dâ€™utiliser le serveur dns (dnsmasq) que vous allez monter</li>
</ul>
<p>Pour cela, il suffit de faire : <code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en source, et <code>Wifi</code> en sortie. (Je vous conseille dâ€™ailleurs de protÃ©ger votre Wifi avec une clÃ© WPA2).</p>
<figure><img src="../../../images/posts/macosx-network-sharing.png" alt=""></figure>

<p><em>Ici, câ€™est USB Ethernet en source car je suis sur un Mac Book Air donc aucun port ethernet natif mais choisissez Ethernet si possible.</em></p>
<p>Une fois que le partage de connexion via Wifi est activÃ©, vous pouvez vous y connecter avec votre smartphone (ou tablette).</p>
<p>Cela crÃ©e alors un nouveau rÃ©seau privÃ© entre votre machine hÃ´te et votre tÃ©lÃ©phone avec des adresses comme <code>192.168.2.x</code>. La machine hÃ´te aura sÃ»rement lâ€™adresse <code>192.168.2.1</code> et votre tÃ©lÃ©phone trÃ¨s probablement <code>192.168.2.2</code>.</p>
<p>Câ€™est alors un autre rÃ©seau que le rÃ©seau interne Ã  la boite en <code>192.168.1.x</code>.</p>
<p>Notez aussi que la machine hÃ´te, faisant bridge, donne les informations en cascade aux appareils connectÃ©s. Ce que vous spÃ©cifiez comme serveurs dns sur la machine hÃ´te sera alors ceux utilisÃ©s par les appareils Ã©tant connectÃ©s Ã  votre partage de rÃ©seau.</p>
<h3 id="aaaah-dnsmasq-"><a class="putainde-Title-anchor" href="#aaaah-dnsmasq-">#</a>Aaaah dnsmasq !</h3><p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via <strong>homebrew</strong>.</p>
<h4 id="dnsmasq-via-homebrew"><a class="putainde-Title-anchor" href="#dnsmasq-via-homebrew">#</a>dnsmasq via homebrew</h4><pre><code><span class="hljs-variable">$ </span>brew install dnsmasq
</code></pre><h4 id="configuration-de-dnsmasq"><a class="putainde-Title-anchor" href="#configuration-de-dnsmasq">#</a>configuration de dnsmasq</h4><p>Une fois installÃ©, on copie la configuration :</p>
<pre><code>$ <span class="hljs-keyword">cp</span> /usr/local/opt/dnsmasq/dnsmasq<span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.example</span> /usr/local/etc/dnsmasq<span class="hljs-preprocessor">.conf</span>
</code></pre><p>puis on Ã©dite le comme ceci :</p>
<pre><code><span class="hljs-preprocessor"># Add domains which you want to force to an IP address here.</span>
<span class="hljs-preprocessor"># The example below send any host in double-click.net to a local</span>
<span class="hljs-preprocessor"># web-server.</span>
<span class="hljs-preprocessor">#address=/double-click.net/127.0.0.1</span>
address=/monsite.dev/<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span>

<span class="hljs-preprocessor"># If you want dnsmasq to listen for DHCP and DNS requests only on</span>
<span class="hljs-preprocessor"># specified interfaces (and the loopback) give the name of the</span>
<span class="hljs-preprocessor"># interface (eg eth0) here.</span>
<span class="hljs-preprocessor"># Repeat the line for more than one interface.</span>
<span class="hljs-preprocessor">#interface=</span>
<span class="hljs-preprocessor"># Or you can specify which interface _not_ to listen on</span>
<span class="hljs-preprocessor">#except-interface=</span>
<span class="hljs-preprocessor"># Or which to listen on by address (remember to include 127.0.0.1 if</span>
<span class="hljs-preprocessor"># you use this.)</span>
listen-address=<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-preprocessor"># If you don't want dnsmasq to read /etc/hosts, uncomment the</span>
<span class="hljs-preprocessor"># following line.</span>
no-hosts
</code></pre><p>Nous prÃ©cisons dans un premier temps la rÃ©solution du nom de domaine <code>monsite.dev</code> (notez que câ€™est du wildcard, donc pas besoin de prÃ©ciser les sous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs de la machine hÃ´te et enfin nous indiquons que nous ne voulons pas prendre en compte le fichier <code>/etc/hosts</code> vu quâ€™on spÃ©cifie les rÃ©solutions via <code>address</code>.</p>
<p>Cela permettra Ã  terme de ne plus gÃ©rer le fichier <code>/etc/hosts</code> et de tout spÃ©cifier dans <code>dnsmasq.conf</code>.</p>
<h4 id="lancer-dnsmasq-au-demarrage-de-la-machine"><a class="putainde-Title-anchor" href="#lancer-dnsmasq-au-demarrage-de-la-machine">#</a>lancer dnsmasq au dÃ©marrage de la machine</h4><p>On copie le fichier de dÃ©mon dans le dossier qui va bien puis on lance le dÃ©mon.</p>
<pre><code>$ <span class="hljs-built_in">sudo</span> cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons
$ <span class="hljs-built_in">sudo</span> launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre><h4 id="utiliser-le-serveur-dnsmasq"><a class="putainde-Title-anchor" href="#utiliser-le-serveur-dnsmasq">#</a>utiliser le serveur dnsmasq</h4><p>Etant donnÃ© que vous partagez votre connexion et que votre poste fait hÃ´te, le serveur dns utilisÃ© sera celui installÃ© sur votre poste, donc rien Ã  faire.</p>
<p>Sinon :</p>
<ul>
<li><p>vous pouvez changer le serveur dns de la machine hÃ´te dans <code>network</code> et dans ce cas, que ce soit sur vos appareils connectÃ©s au wifi ou votre machine principale, vous utiliserez <strong>dnsmasq</strong> mais je vous le dÃ©conseile car jâ€™ai constatÃ© que jâ€™atteignais trop facilement le nombre de connexions maximum.</p>
</li>
<li><p>vous pouvez aussi modifier le serveur dns de lâ€™appareil connectÃ© au wifi partagÃ© :</p>
</li>
</ul>
<p><em>(Sous Android)</em></p>
<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>
<figure><img src="../../../images/posts/android-network-advanced.jpg" alt=""></figure>

<p>Mais quel intÃ©rÃªt car vous devrez faire cela sur tous vos appareils connectÃ©s</p>
<ul>
<li>vous pouvez aussi Ã©diter le fichier <code>/etc/bootpd.plist</code> qui dÃ©finit toute votre configuration de partage de connexion :</li>
</ul>
<pre><code>$ <span class="hljs-built_in">sudo</span> <span class="hljs-variable">$EDITOR</span> /etc/bootpd.plist
</code></pre><pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">plist</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>Subnets<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>_creator<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>com.apple.InternetSharing<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>allocate<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_domain_name_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_router<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_max<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_min<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2/24<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_address<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_mask<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>255.255.255.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_range<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.2<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.254<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>bootp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>detect_other_dhcp_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>bridge100<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>use_server_config_for_dhcp_options<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">plist</span>&gt;</span>
</code></pre>
<p><code>192.168.2.1</code> est lâ€™adresse de votre machine hÃ´te dans le rÃ©seau de partage.</p>
<h2 id="oh-oui-j-oubliais-mac-os-x-peut-etre-lourd-parfois"><a class="putainde-Title-anchor" href="#oh-oui-j-oubliais-mac-os-x-peut-etre-lourd-parfois">#</a>Oh oui, jâ€™oubliais, Mac OS X peut Ãªtre lourd parfois</h2><p>Oui, quand vous crÃ©ez un partage de connexion sur Mac OS X, il lance son propre serveur dns sâ€™appelant <strong>_mdnsresponder</strong>. Câ€™est le systÃ¨me <em>Bonjour</em> de iOS/Mac OS X permettant Ã  nâ€™importe quel appareil Apple de communiquer entre eux. Le problÃ¨me câ€™est quâ€™il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>
<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez Ã©ventuellement voir que <strong>_mdnsresponder</strong> est lancÃ© aussi bien en ipv6 quâ€™en ipv4 sur le port 53. Cela vous empÃªchera de lancer <strong>dnsmasq</strong>.</p>
<p>Ce que je vous propose dans ces cas lÃ , câ€™est de couper votre partage de connexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de le <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de connexion. Comme Ã§a <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>
<p>Autre point, Ã©vitez, mais vraiment, de nommer vos noms de domaines personnels en <code>.local</code>. En effet, ceux-ci sont plutÃ´t rÃ©servÃ©s Ã  lâ€™environnement Mac OS X. Ils sont dâ€™ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent Ã  nâ€™importe quel produit Apple sur le rÃ©seau de se connecter Ã  dâ€™autres postes Apple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors sâ€™emmÃ©ler entre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>
<p>Happy coding !</p>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</link><guid isPermaLink="true">http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</guid></item><item><title>Sublime Text en tant qu'Ã©diteur Markdown</title><description><![CDATA[[
<p>La vie de dÃ©veloppeur nâ€™est jamais facile. Tu souhaites faire quelque chose de prÃ©cis et tu te retrouves Ã  faire totalement autre chose, <em>patchant</em> ci ou tu as dÃ©couvert Ã§a.</p>
<p>Typiquement, jâ€™Ã©tais tranquillement en train dâ€™Ã©crire un article pour <strong>p!</strong> qui nâ€™avait rien Ã  voir avec celui actuel, et je me retrouve Ã  personnaliser mon Sublime Text pour Markdown car ne souhaitant plus utiliser autre chose que celui-ci pour lâ€™Ã©criture.</p>
<p>Il y a certes le trÃ¨s bon <a href="http://mouapp.com/">Mou.app</a> (<code>$ brew cask install mou</code>) sur Mac OS X mais comme indiquÃ©, il nâ€™est que pour Mac, or il mâ€™arrive parfois dâ€™Ãªtre sur Windows.
De plus, les Ã©diteurs en ligne comme <a href="https://stackedit.io/">stackedit.io</a> ou <a href="http://dillinger.io/">dillinger.io</a> sont pratiques mais comme jâ€™ai tendance Ã  stocker mes brouillons sur <a href="https://db.tt/nTkiSUb">dropbox</a>, ces outils vous demandent lâ€™accÃ¨s de toute votre dropbox, chose que je nâ€™aime pas spÃ©cialement.</p>
<p>Bref, tout Ã§a pour dire que tout centraliser sur Sublime Text et utiliser dropbox pour Ã©crire des articles me semble une pratique plutÃ´t agrÃ©able.</p>
<p>Pour cela, quittez totalement vos Ã©diteurs Markdown et installez les plugins Sublime Text qui vont bien.</p>
<h2 id="markdownediting"><a class="putainde-Title-anchor" href="#markdownediting">#</a>MarkdownEditing</h2><p>PremiÃ¨rement, <a href="http://ttscoff.github.io/MarkdownEditing/">MarkdownEditing</a>, ce petit plugin est votre parfait compagnon qui vous permettra dâ€™avoir la bonne coloration syntaxique de votre Markdown. Il vous permettra de mettre en Ã©vidence les liens, le code, et tout le reste. Du bonheur donc.</p>
<p><img src="../../../images/posts/preview-markdownediting.png" alt=""></p>
<p>Oui alors, jâ€™ai fait quelques configurations car Ã  la base, ca ressemble plutÃ´t Ã  Ã§a :</p>
<p><img src="../../../images/posts/preview-markdownediting-light.png" alt=""></p>
<p>Si vous souhaitez modifier Sublime Text mais uniquement pour le format Markdown, faites : <code>Preferences &gt; Browse Packages...</code> puis aller dans <code>User</code> et crÃ©ez un fichier <code>Markdown.sublime-settings</code>. Celui-ci sera lu et appliquÃ© Ã  chaque fois que vous Ã©diterez un fichier Markdown.</p>
<p>Voici ce que jâ€™ai pour le moment :</p>
<pre><code>{
  "<span class="hljs-attribute">color_scheme</span>": <span class="hljs-value"><span class="hljs-string">"Packages/MarkdownEditing/MarkdownEditor-Dark.tmTheme"</span></span>,
  "<span class="hljs-attribute">enable_table_editor</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  "<span class="hljs-attribute">table_editor_syntax</span>": <span class="hljs-value"><span class="hljs-string">"Auto"</span></span>,
  "<span class="hljs-attribute">tab_size</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
  "<span class="hljs-attribute">extensions</span>":
  <span class="hljs-value">[
    <span class="hljs-string">"mdown"</span>,
    <span class="hljs-string">"txt"</span>,
    <span class="hljs-string">"md"</span>
  ]
</span>}
</code></pre><p>Le thÃ¨me <code>dark</code> pour pas se niquer les yeux (coucou <a href="https://twitter.com/bloodyowl">@bloodyowl</a>), jâ€™active aussi dâ€™autres plugins dont je vais vous parler dâ€™ici peu, jâ€™affecte le spacing Ã  <code>2</code>, et je dÃ©clare que jâ€™utiliserai lâ€™Ã©diteur Markdown pour ce genre de fichiers : <code>.mdown</code>, <code>.txt</code>, <code>.md</code>.</p>
<p>Bien, passons Ã  la suite.</p>
<h2 id="markdown-preview"><a class="putainde-Title-anchor" href="#markdown-preview">#</a>Markdown Preview</h2><p>Notre cher <a href="https://twitter.com/revolunet">@revolunet</a> a fait un excellent plugin Markdown pour Sublime Text: <a href="https://github.com/revolunet/sublimetext-markdown-preview">Sublime Text Markdown Preview</a>. Celui-ci permet dâ€™avoir un rendu de votre Markdown en <code>.html</code>. Vous pouvez soit compiler votre Markdown pour crÃ©er un fichier HTML, soit lâ€™ouvrir directement dans votre navigateur.</p>
<p>DiffÃ©rents formats disponibles :</p>
<ul>
<li>Python Markdown</li>
<li>Github Flavored Markdown</li>
</ul>
<p>Un autre parfait compagnon en somme, qui quant Ã  lui sâ€™occupera de digÃ©rer lâ€™excellent article que vous Ãªtes en train dâ€™Ã©crire.</p>
<p>Je vous parlerai Ã©ventuellement un jour de <a href="http://johnmacfarlane.net/pandoc/">pandoc</a> qui permet de faire ce genre de choses mais en un peu plus complet et gÃ©nÃ©rique (Sublime Text nâ€™est pas nÃ©cessaire) mais câ€™est un poil plus complexe. Jettez-y un Å“il tout de mÃªme.</p>
<h2 id="smartmarkdown"><a class="putainde-Title-anchor" href="#smartmarkdown">#</a>SmartMarkdown</h2><p><a href="https://github.com/demon386/SmartMarkdown">Petit plugin</a> intÃ©ressant qui vous permettra de cacher des parties de votre texte en le repliant. Par exemple, vous vous mettez devant un titre du style <code>##</code> et vous appuyez sur <code>tab</code>, cela repliera votre texte. PlutÃ´t pratique pour se focaliser.</p>
<p><img src="../../../images/posts/preview-smartmarkdown.png" alt=""></p>
<h2 id="sublimetableeditor"><a class="putainde-Title-anchor" href="#sublimetableeditor">#</a>SublimeTableEditor</h2><p>PrÃ©cÃ©demment dans ma configuration Markdown, vous avez pu voir ceci :</p>
<pre><code>  <span class="hljs-string">"enable_table_editor"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"table_editor_syntax"</span>: <span class="hljs-string">"Auto"</span>,
</code></pre><p>Cela permet de configurer <a href="https://github.com/vkocubinsky/SublimeTableEditor">SublimeTableEditor</a> qui vous permettra de correctement aligner vos tableaux dans Markdown.</p>
<p>Et voilÃ . Avec tout ceci, vous Ãªtes parÃ©(e) Ã  Ã©crire votre Markdown dans de bonnes conditions. Plus quâ€™Ã  mettre du Jazz et vous prÃ©parer une tasse de thÃ© et câ€™est parti.</p>
<h2 id="bonus-markdown-extended"><a class="putainde-Title-anchor" href="#bonus-markdown-extended">#</a>Bonus : Markdown Extended</h2><p>Il est possible que vous nâ€™aimiez pas forcÃ©ment MarkdownEditing, et dans ce cas je vous propose un autre plugin pas inintÃ©ressant non plus sâ€™appelant <a href="https://github.com/jonschlinkert/sublime-markdown-extended">Markdown Extended</a>. Il vous permettra dâ€™avoir la bonne coloration syntaxique lorsque vous Ã©crivez du code dans votre Ã©diteur.</p>
<h4 id="avant"><a class="putainde-Title-anchor" href="#avant">#</a>Avant</h4><p><img src="../../../images/posts/preview-markdownextended-before.png" alt=""></p>
<h4 id="apres"><a class="putainde-Title-anchor" href="#apres">#</a>AprÃ¨s</h4><p><img src="../../../images/posts/preview-markdownextended-after.png" alt=""></p>
<p>Oh et jâ€™oubliais, voici quelques documentations sur Markdown histoire de bien lâ€™utiliser :</p>
<ul>
<li><a href="http://daringfireball.net/projects/markdown/syntax">Documentation officielle</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown Cheatsheet</a></li>
<li><a href="http://warpedvisions.org/projects/markdown-cheat-sheet.md">Another Markdown Cheatsheet</a></li>
</ul>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</link><guid isPermaLink="true">http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</guid></item><item><title>BROWSERIFY ALL THE THINGS</title><description><![CDATA[[
<p>Alors que je prends goÃ»t Ã  me passer de frameworks (principalement Ã  cause des
courbes dâ€™apprentissage et des Ã©ventuelles lourdeurs et/ou restrictions que cela
impose, mais câ€™est une autre histoire),
je cherchais la meilleure faÃ§on dâ€™Ã©crire des micro composants rÃ©utilisables.</p>
<p>Pour le JavaScript, jâ€™ai commencÃ© il y a bien longtemps par des extensions/plugins
<a href="http://prototypejs.org/">Prototype</a>, puis peu de temps aprÃ¨s, du plugins
<a href="http://plugins.jquery.com/">jQuery</a> Ã  la pelle.
Souvent Ã  tord puisque jâ€™utilisais peut Ãªtre 1% de la librairie en dÃ©pendance -
exemple avec mon <a href="https://github.com/MoOx/jQuery.Loading-Indicator/">indicateur de chargement avec sÃ©maphore</a>
ou encore mon <a href="https://github.com/MoOx/jQuery.External-Links/">plugin qui ouvre les liens externes avec du target blank automatique</a>.</p>
<p><b>Je ne ferais plus jamais Ã§a pour la simple raison du ratio â€œpoids / % dâ€™utilisationâ€ de la dÃ©pendance.</b></p>
<p>Alors oui, utiliser jQuery a peut-Ãªtre du bon. Mais sâ€™en passer aussi.
<a href="/posts/js/de-jquery-a-vanillajs/">Câ€™est faisable pour pleins de petites choses</a>.
<a href="/posts/js/comment-se-passer-de-libraries-frameworks-javascript/">Et câ€™est pas forcÃ©ment difficile</a>.</p>
<p>Car si je veux utiliser mon petit script qui ajoute des targets blank automatiquement,
 devoir inclure jQuery pour si peu, Ã§a fait mal Ã  mes kilobites.</p>
<p>En attendant <a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">
la gestion de modules via ES6</a>, il nous faut gÃ©rer aujourdâ€™hui nos composants
et dÃ©pendances Ã  la main.
Encore quâ€™on pourrait faire un transpiler pour utiliser cette syntaxe (Ã§a existe
dÃ©jÃ , il nâ€™y a quâ€™Ã  voir sur GitHub), mais lÃ  on ne ferait que crÃ©er une nouvelle
dÃ©finition de module.</p>
<p>CÃ´tÃ© back-end, on a dÃ©jÃ  ce quâ€™il faut en JavaScript avec la gestion
<a href="http://nodejs.org/api/modules.html">des modules en Node</a>.
Un simple <code>require(&#39;module&#39;)</code> va tenter de rÃ©cupÃ©rer un module avec ce nom.
Un module nâ€™est rien dâ€™autre quâ€™un fichier JavaScript. Node va essayer de loader
un <code>.js</code>, puis <code>.json</code> et enfin <code>.node</code> si besoin), qui lui mÃªme peut
Ã©ventuellement charger dâ€™autres dÃ©pendances (les dÃ©pendances sont gÃ©rÃ©es localement)
tout en prenant en compte les packages NPM.
MÃªme si <a href="http://nodejs.org/">Node</a> nâ€™implÃ©mente pas totalement
<a href="http://wiki.commonjs.org/wiki/CommonJS">CommonJS</a>, un projet de dÃ©veloppement dâ€™une API pour
Ã©crire des programmes en JavaScript ailleurs que dans le navigateur,
la faÃ§on de faire est assez proche.</p>
<figure><img src="../../../images/posts/browserify.png" alt=""></figure>

<p>Lâ€™idÃ©e de <a href="http://browserify.org/">Browserify</a> est dâ€™amener cette faÃ§on de faire
dans le navigateur.</p>
<p>Ã€ cÃ´tÃ© de Ã§a, vous me direz quâ€™on a dÃ©jÃ  <a href="http://requirejs.org/">RequireJS</a>
pour un rÃ©sultat similaire.</p>
<p>RequireJS implÃ©mente lâ€™API AMD  (Asynchronous Module Definition),
diffÃ©rent de lâ€™API CommonJS.
Cette API, dÃ©rivÃ©e de CommonJS, se veut adaptÃ©e au navigateur. Son principal atout
Ã©tant le chargement des modules de maniÃ¨re asynchrone.
En thÃ©orie, câ€™est super.</p>
<p>Sauf que dans la pratique (du moins quelque chose de simple et classique,
disons pour lâ€™exemple du petit JavaScript pour amÃ©liorer une page web, ou encore
une simple <em>single page webapp</em> (SPA)) ce nâ€™est pas forcÃ©ment pertinent.</p>
<p>En effet charger des modules de maniÃ¨res asynchrones nâ€™est forcÃ©ment pas optimisÃ©
lorsquâ€™il sâ€™agit de faire des pages qui se chargent rapidement.
Il suffit de penser aux problÃ©matiques de dÃ©bits selon la vitesse de la connexion
au rÃ©seau (Edge, faible 3Gâ€¦) et donc nombre de requÃªtes HTTP qui peuvent nous
faire souffrir de gros ralentissement pour se rendre compte que cela peut poser
problÃ¨me.</p>
<p>En plus de cela, je trouve personnellement dÃ©gueulasse  la faÃ§on de dÃ©clarer les
modules AMD, mais Ã§a ce nâ€™est quâ€™un dÃ©tail.</p>
<p>Comparons les diffÃ©rentes mÃ©thodes comme on nous les montre sur le site de
<a href="http://requirejs.org/docs/whyamd.html">RequireJS</a> :</p>
<p>Le web aujourdâ€™hui:</p>
<pre><code class="lang-js">(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> $ = <span class="hljs-keyword">this</span>.jQuery;

    <span class="hljs-keyword">this</span>.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
}());
</code></pre>
<p>AMD:</p>
<pre><code class="lang-js">define([<span class="hljs-string">'jquery'</span>] , <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
});
</code></pre>
<p>CommonJS:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
exports.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
</code></pre>
<p>AMD et CommonJS utilisent tout les deux une identification par chaÃ®ne de caractÃ¨res.
Il faut bien que ces chaÃ®nes soient dÃ©clarÃ©es quelque part.</p>
<p>CÃ´tÃ© RequireJS (AMD), on doit Ã©ventuellement mapper toutes ces chaÃ®nes Ã  la main,
dans le fichier configuration.
De plus la dÃ©claration des dÃ©pendances se faisant dans lâ€™entÃªte du module, Ã§a peut
devenir lourd :</p>
<pre><code class="lang-js">define([ <span class="hljs-string">"require"</span>, <span class="hljs-string">"jquery"</span>, <span class="hljs-string">"blade/object"</span>, <span class="hljs-string">"blade/fn"</span>, <span class="hljs-string">"rdapi"</span>,
         <span class="hljs-string">"oauth"</span>, <span class="hljs-string">"blade/jig"</span>, <span class="hljs-string">"blade/url"</span>, <span class="hljs-string">"dispatch"</span>, <span class="hljs-string">"accounts"</span>,
         <span class="hljs-string">"storage"</span>, <span class="hljs-string">"services"</span>, <span class="hljs-string">"widgets/AccountPanel"</span>, <span class="hljs-string">"widgets/TabButton"</span>,
         <span class="hljs-string">"widgets/AddAccount"</span>, <span class="hljs-string">"less"</span>, <span class="hljs-string">"osTheme"</span>, <span class="hljs-string">"jquery-ui-1.8.7.min"</span>,
         <span class="hljs-string">"jquery.textOverflow"</span>],
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(require,   $,        object,         fn,         rdapi,
          oauth,   jig,         url,         dispatch,   accounts,
          storage,   services,   AccountPanel,           TabButton,
          AddAccount,           less,   osTheme)</span> {</span>
  <span class="hljs-comment">// ici le corps de la fonction</span>
});
</code></pre>
<p>Bon vous me direz que si un module a autant de dÃ©pendances, il y a peut Ãªtre un
problÃ¨me en amont et vous nâ€™aurez pas tort.</p>
<p>CÃ´tÃ© Browserify (CommonJS like), les dÃ©pendances externes proviennent (Ã  la base)
de NPM.
On a donc rien Ã  mapper nul part. Puis pour avoir un module local, il suffit de
faire un <code>require(&#39;./mon/module&#39;)</code>, et Browserify se chargera de rÃ©gler la
dÃ©pendance (et je vous montre encore mieux aprÃ¨s).</p>
<p>RequireJS propose un â€œoptimizerâ€, qui au final ne fait que supprimer son point fort:
le cÃ´tÃ© asynchrone du tÃ©lÃ©chargement des modules.
Du coup on se retrouve avec tout RequireJS dans la source ET toutes les dÃ©pendances avec le mapping.
Il y a bien une faÃ§on de vraiment optimiser par bundle quand on cherche un peu
dans la doc, mais
<a href="http://requirejs.org/docs/optimization.html#wholemultipage">Ã§a nâ€™est pas vraiment mis en avant</a>.
Il existe aussi <a href="https://github.com/jrburke/almond">Almond.js</a> qui se veut Ãªtre
plus lÃ©ger, mais du coup, utiliser RequireJS pour optimiser avec Almond, je ne
trouve pas Ã§a cohÃ©rent.</p>
<p>Si jusque lÃ , Browserify vous intÃ©resse (plus car les autres solutions ne vous
intÃ©ressent pas), attaquons le corps du sujet.</p>
<h2>Installation de Browserify</h2>

<p>Si vous souhaitez accÃ©der Ã  la commande via le terminal, la chose la plus simple
Ã  faire est dâ€™installer le paquet en global.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>npm install -g browserify
</code></pre>
<p>Si vous ne lâ€™installez pas en global (sans lâ€™option <code>-g</code>, vous aurez la commande
accessible dans <code>./node_modules/.bin/browserify</code>).
Mais selon votre workflow, vous pouvez lâ€™utiliser via une tÃ¢che
<a href="https://www.npmjs.org/package/grunt-browserify">grunt-browserify</a>
ou <a href="https://www.npmjs.org/package/gulp-browserify">gulp-browserify</a>.</p>
<h2>Utilisation de Browserify</h2>

<p>Partons dâ€™un simple fichier <code>main.js</code>:</p>
<pre><code class="lang-js"><span class="hljs-function">alert(<span class="hljs-string">'Hello world !'</span>)</span>;
</code></pre>
<p>Sans aucune dÃ©pendance, Ã§a nâ€™a que peu de sens, mais câ€™est plus pour montrer un
dernier point intÃ©ressant.</p>
<p>Je le compile avec la commande suivante:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> -o bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>Jâ€™obtiens le fichier suivant.</p>
<pre><code class="lang-js">(function e(t,n,r){function s(o,u){if(!n[<span class="hljs-link_label">o</span>]){if(!t[<span class="hljs-link_label">o</span>]){var a=typeof require=="function"&amp;&amp;require;if(!u&amp;&amp;a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[<span class="hljs-link_label">o</span>]={exports:{}};t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">0</span>].call(f.exports,function(e){var n=t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">1</span>][<span class="hljs-link_label">e</span>];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&amp;&amp;require;for(var o=0;o<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">r.length;o++)s(r[o]);return</span> <span class="hljs-attribute">s</span>})({<span class="hljs-attribute">1:</span>[<span class="hljs-attribute">function</span>(<span class="hljs-attribute">require</span>,<span class="hljs-attribute">module</span>,<span class="hljs-attribute">exports</span>){
<span class="hljs-attribute">alert</span>('<span class="hljs-attribute">Hello</span> <span class="hljs-attribute">world</span> !');


},{}]},{},[<span class="hljs-attribute">1</span>])</span></span>
</code></pre>
<p>On reconnaÃ®t notre ligne en plein milieu. Avec un ajout consÃ©quent. Ã‡a peut paraÃ®tre
beaucoup, mais câ€™est rien comparÃ© Ã  la
<a href="http://requirejs.org/docs/release/2.1.10/minified/require.js">source de RequireJS</a></p>
<p>Bon du coup partons avec un exemple peut Ãªtre plus reprÃ©sentatif quâ€™on peut voir
sur la homepage de Browserify.</p>
<pre><code class="lang-js"><span class="hljs-reserved">var</span> foo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./foo'</span>);
<span class="hljs-reserved">var</span> gamma = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gamma'</span>);

<span class="hljs-reserved">var</span> n = gamma(foo(<span class="hljs-number">5</span>) * <span class="hljs-number">3</span>);
<span class="hljs-reserved">var</span> txt = <span class="hljs-built_in">document</span>.createTextNode(n);
<span class="hljs-built_in">document</span>.body.appendChild(txt);
</code></pre>
<p>Ici on aura en plus <code>foo.js</code></p>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span></span> { <span class="hljs-keyword">return</span> n * <span class="hljs-number">11</span> }
</code></pre>
<p>Et le module <code>gamma</code> quâ€™on a installÃ© depuis NPM</p>
<pre><code class="lang-bash">$ npm <span class="hljs-built_in">i</span> <span class="hljs-built_in">gamma</span>
</code></pre>
<p><small><i><code>i</code> est lâ€™alias de <code>install</code>.</i></small></p>
<p>Avec la mÃªme commande que prÃ©cÃ©dement (et donc le mÃªme ajout), Browserify va parser
lâ€™arbre syntaxique abstrait (AST) des appels Ã  <code>require()</code> et va crÃ©er un graph
des dÃ©pendances du projet.<br>Un fois ceci fait, il va simplement ajuster les chemins et dÃ©clarer les fonctions
mappÃ©es dans un object par leur identifiant. Lorsquâ€™une fonction appelle <code>require</code>,
le petit bout de script ajoutÃ© va se charger de retourner la dÃ©pendance.</p>
<p>Notez quâ€™on peut aussi simplement utiliser une redirection de sortie de commande
pour gÃ©rer le fichier final:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> &gt; bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>Du coup on a plus quâ€™Ã  utiliser une simple balise <code>&lt;script&gt;</code> pour incorporer Ã§a
dans nos pages web.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"bundle.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2>Les transformations avec Browserify</h2>

<p>Tant quâ€™Ã  utiliser un outil, autant lâ€™exploiter jusquâ€™au bout. Car pour lâ€™instant
je nâ€™ai parlÃ© que de NPM.
Que faire si mon module nâ€™est pas sur NPM ?
Bon dÃ©jÃ  je double check, car maintenant la plupart des librairies y sont
(jQuery, Backbone et Jean passe).
Si ce nâ€™est pas le cas, je pourrais toujours faire <code>npm i https//adresse.git</code>
mais si le paquet nâ€™a pas de <code>package.json</code> avec le <code>main</code> bien rempli, Ã§a ne va
pas forcÃ©ment Ãªtre le mieux.</p>
<p>Cela dit, si mon paquet est prÃ©vu pour Bower par exemple, il existe une <i>transformation</i>
prÃ©vue pour aider Browserify Ã  rÃ©soudre les rÃ©fÃ©rences aux paquets pour les
consommer depuis Bower: <code>debowerify</code>.
Dans le mÃªme esprit, on va retrouver de nombreuses transformations telles que :</p>
<ul>
<li><code>decomponentify</code>: pour consommer des <a href="https://github.com/component/component">component</a>s,</li>
<li><code>deamdify</code>:  pour consommer des modules AMD,</li>
<li><code>deglobalify</code>: pour consommer des modules qui utilisent des variables globales,</li>
<li><code>jadeify</code>: pour consommer des fichiers de templates jade,</li>
<li><code>hbsify</code>: pour consommer des fichiers de templates handlebars,</li>
<li><code>es6ify</code>: pour Ã©crire du JavaScript ES6 (compilÃ© en ES5),</li>
<li><code>uglifyify</code>: appliquer uglify.</li>
</ul>
<p>Il existe plein <a href="https://www.npmjs.org/browse/keyword/browserify">dâ€™autres transformations</a>
qui sâ€™adapteront sÃ»rement Ã  vos besoins.</p>
<p>Du coup la ligne ultime pour consommer a peu prÃ¨s nâ€™importe quel module :</p>
<pre><code class="lang-bash">browserify <span class="hljs-attribute">-t</span> debowerify <span class="hljs-attribute">-t</span> decomponentify <span class="hljs-attribute">-t</span> deamdify <span class="hljs-attribute">-t</span> deglobalify <span class="hljs-attribute">-t</span> es6ify main<span class="hljs-built_in">.</span>js <span class="hljs-subst">&gt;</span> bundle<span class="hljs-built_in">.</span>js
</code></pre>
<p>Lâ€™Ã©quivalent avec les tÃ¢ches Grunt ou Gulp sera tout aussi simple via un tableau.
Pensez bien Ã  installer ces dÃ©pendances avant:</p>
<pre><code class="lang-bash"><span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">debowerify</span> <span class="hljs-comment">decomponentify</span> <span class="hljs-comment">deamdify</span> <span class="hljs-comment">deglobalify</span> <span class="hljs-comment">es6ify</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span>
</code></pre>
<h2>Ecrire un module pour Browserify (mais pas que)</h2>

<p>Consommer câ€™est bien, mais faire câ€™est <del>mieux</del> bien aussi.</p>
<figure><img src="../../../images/posts/browserify-potter.png" alt=""></figure>

<p>Tout droit sorti de <a href="https://github.com/umdjs/umd">UMD</a> (Universal Module Definition),
voici un wrapper qui vous permettra de crÃ©er votre module compatible avec CommonJS,
AMD et pour les projets old school !</p>
<pre><code class="lang-js"><span class="hljs-list">(<span class="hljs-title">function</span> <span class="hljs-list">(<span class="hljs-title">root</span>, factory)</span> <span class="hljs-collection">{
  if <span class="hljs-list">(<span class="hljs-title">typeof</span> exports === 'object')</span> <span class="hljs-collection">{
    // CommonJS
    module.exports = factory<span class="hljs-list">(<span class="hljs-title">require</span><span class="hljs-list">(<span class="hljs-title">'b'</span>)</span>)</span><span class="hljs-comment">;</span>
  }</span> else if <span class="hljs-list">(<span class="hljs-title">typeof</span> define === 'function' &amp;&amp; define.amd)</span> <span class="hljs-collection">{
    // AMD
    define<span class="hljs-list">(<span class="hljs-collection">['b']</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{
      return <span class="hljs-list">(<span class="hljs-title">root.returnExportsGlobal</span> = factory<span class="hljs-list">(<span class="hljs-title">b</span>)</span>)</span><span class="hljs-comment">;</span>
    }</span>)</span><span class="hljs-comment">;</span>
  }</span> else <span class="hljs-collection">{
    // Global Variables
    root.returnExportsGlobal = factory<span class="hljs-list">(<span class="hljs-title">root.b</span>)</span><span class="hljs-comment">;</span>
  }</span>
}</span><span class="hljs-list">(<span class="hljs-title">this</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{

  // Ici votre module <span class="hljs-list">(<span class="hljs-title">fonction</span>, objet, whatever...)</span>
  return <span class="hljs-collection">{}</span><span class="hljs-comment">;</span>
}</span>)</span>)</span><span class="hljs-comment">;</span>
</code></pre>
<p>Il existe bien sur <a href="https://github.com/umdjs/umd#variations">plusieurs faÃ§ons de faire</a>
selon vos critÃ¨res. Ã€ vous de choisir.</p>
<p>Maintenant vous aller pouvoir consommer et Ã©crire des modules facilement, et
sans vous prendre la tÃªte.</p>
<p>Bisous.</p>

]]></description><pubDate>Wed, 15 Jan 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/browserify-all-the-things/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/browserify-all-the-things/</guid></item><item><title>Responsive webdesign et structure du DOM</title><description><![CDATA[[
<p>Bien, commenÃ§ons par le commencement, si tu veux bien. Le <strong>responsive
webdesign</strong>, Ã§a te dit quelque chose ? Oui ? Bon. Dans ce cas, tu as peut-Ãªtre
comme moi dÃ©jÃ  Ã©tÃ© confrontÃ© Ã  un cas de figure plutÃ´t ennuyeux. Que tu sois
adepte du <em>mobile-first</em> ou irrÃ©ductible dÃ©gradateur progressiste, il est
forcÃ©ment arrivÃ© un moment oÃ¹ tu tâ€™es dit cette chose toute bÃªte :</p>
<blockquote>
<p>Ce serait quand mÃªme pas mal si cet Ã©lÃ©ment Ã©tait ici plutÃ´t que lÃ . Sauf que
non.</p>
</blockquote>
<p>Le cas typique est celui dâ€™un menu un minimum complexe, dont on rÃ©ordonnerait
volontiers les Ã©lÃ©ments un chouÃ¯a au dessus ou en deÃ§Ã  dâ€™une certaine taille
dâ€™Ã©cran. Et lÃ , il faut bien avouer quâ€™il nâ€™existe pas vraiment de solution
miracle.</p>
<p>Jâ€™entends dÃ©jÃ  les plus teigneux vocifÃ©rer quâ€™avec une meilleure rÃ©flexion en
amont, le <em>markup</em> aurait Ã©tÃ© mieux conÃ§u et on nâ€™en serait pas lÃ . Bien quâ€™un
peu facile, cette rÃ©ponse peut sâ€™avÃ©rer vraie dans un certain nombre de cas
(admire la phrase du mec qui ne se mouille pas). Mais quoi quâ€™il en soit, si tu
en es au stade de ce type de questionnement, câ€™est quâ€™il est de toute faÃ§on trop
tard pour faire machine arriÃ¨re.</p>
<p>Au train oÃ¹ va lâ€™innovation dans notre branche, surtout pour tout ce qui touche
au mobile en gÃ©nÃ©ral et Ã  la conception web en particulier, il nâ€™est pas exclu
que les bouts de ficelle que je vais tâ€™exposer ici soient obsolÃ¨tes dans six
mois, et que cet article fasse un comeback incroyable sur Twitter, les RT
moquant gentiment les techniques prÃ©colombiennes auxquelles nous Ã©tions rÃ©duits
il nâ€™y a encore pas si longtemps. Va savoir, je pourrais bien faire lâ€™objet
dâ€™une cÃ©lÃ©britÃ© paradoxalement dÃ©cadente Ã  la Rick Astley. En attendant, il
sâ€™agit des seules solutions que je connais pour ce type de cas. Si tu as mieux Ã 
proposer, je te recommande chaudement de lâ€™ouvrir dans les commentaires pour
quâ€™on en bÃ©nÃ©ficie tous. Câ€™est bon, on y va ? Je tâ€™attends, moi !</p>
<h2 id="a-l-ancienne-do-repeat-yourself"><a class="putainde-Title-anchor" href="#a-l-ancienne-do-repeat-yourself">#</a>Ã€ lâ€™ancienne : Do Repeat Yourself</h2><p>Imagine une page de blog, oÃ¹ apparaissent consÃ©cutivement le titre de lâ€™article,
la photo lâ€™illustrant, et enfin le texte. Comme une photo, selon la qualitÃ© de
ta connexion, Ã§a peut Ãªtre un peu galÃ¨re Ã  charger sur mobile (et que la
question des images en responsive design
<a href="http://css-tricks.com/responsive-images-hard/">est encore un sacrÃ© bordel</a>), tu
prends la dÃ©cision de passer la photo en dessous du contenu textuel pour que tes
visiteurs puissent lire leur article peinards mÃªme si la photo nâ€™a pas fini de
charger - et tu vas mÃªme en profiter pour la remplacer par une version plus
light.</p>
<p>Dans un tel cas, la meilleure solution peut encore Ãªtre de dupliquer ta balise
<code>img</code>, et de masquer lâ€™une ou lâ€™autre avec CSS en fonction de la taille dâ€™Ã©cran,
grÃ¢ce Ã  une <code>media query</code>. VoilÃ  un exemple rudimentaire :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>LÃ¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* Par dÃ©faut, l'image desktop est cachÃ©e */</span>
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-comment">/* Si on est sur "grand" Ã©cran, on affiche l'image desktop... */</span>
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-comment">/* ...et on masque l'image mobile */</span>
  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>Ã‰videmment, le gros inconvÃ©nient de ce type de solution est que qui dit
duplication de contenu dit augmentation du poids total. Dans le cas dâ€™un contenu
purement textuel, selon sa taille, cela peut Ãªtre nÃ©gligeable. Jâ€™ai ici
volontairement pris lâ€™exemple le moins adaptÃ© : une image, quâ€™il ne faut
absolument pas faire charger deux fois Ã  nos visiteurs. On va tricher un peu
avec JavaScript :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Ces images ne seront pas chargÃ©es car elles n'ont pas d'attribut src --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>LÃ¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Cette image ne sera chargÃ©e que si le visiteur n'a pas activÃ© le JS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile img-noscript"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}

<span class="hljs-class">.img-noscript</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* On surcharge le style desktop pour s'assurer
     que cette image s'affiche quelle que soit la taille de l'Ã©cran */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> handleImages = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// On charge les images ayant l'attribut data-src,</span>
  <span class="hljs-comment">// non encore chargÃ©es (attribut src indÃ©fini)</span>
  <span class="hljs-comment">// et non masquÃ©es par CSS</span>

  [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img[data-src]:not([src])'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">if</span> (window.getComputedStyle(el).display != <span class="hljs-string">'none'</span>) {
      el.src = el.getAttribute(<span class="hljs-string">'data-src'</span>);
    }
  });
};

window.addEventListener(<span class="hljs-string">'load'</span>, handleImages);
window.addEventListener(<span class="hljs-string">'resize'</span>, handleImages);
</code></pre>
<p>Ainsi, seules les images nÃ©cessaires seront chargÃ©es avec la page. Jâ€™applique
Ã©galement le mÃªme traitement au <code>resize</code> ; câ€™est un peu bourrin, je te
lâ€™accorde, on pourrait probablement faire plus fin avec <code>matchMedia</code>.</p>
<p>Dans le cas dâ€™un visiteur naviguant sans JavaScript, seule lâ€™image mobile est
chargÃ©e : je pars du principe quâ€™Ã©tant donnÃ© quâ€™on ne peut pas dÃ©finir laquelle
des deux versions de lâ€™image est la mieux adaptÃ©e pour lui, autant lui envoyer
la plus lÃ©gÃ¨re.</p>
<h2 id="js-powa-enquire-js"><a class="putainde-Title-anchor" href="#js-powa-enquire-js">#</a>JS powa : enquire.js</h2><p>La seconde solution peut tout Ã  fait Ãªtre rÃ©alisÃ©e â€œÃ  la mainâ€, mais je vais te
parler dâ€™une petite librairie que jâ€™aime beaucoup et que jâ€™ai dÃ©jÃ  utilisÃ©e dans
ce genre de cas. Elle se nomme <a href="http://wicky.nillia.ms/enquire.js/">enquire.js</a>
et permet tout simplement dâ€™affecter des callbacks Ã  des media queries :</p>
<pre><code class="lang-javascript">enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, {
  match: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// L'Ã©cran fait 768px de large ou plus...</span>
  },

  unmatch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// ...et ici, 767px de large ou moins.</span>
    <span class="hljs-comment">// La librairie repose sur matchMedia et matchMedia.addListener</span>
  }
});
</code></pre>
<p>PlutÃ´t sympa, non ? Pour reprendre notre exemple de tout Ã  lâ€™heure (le CSS nâ€™est
plus nÃ©cessaire) :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">data-mobile-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>LÃ¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> content = document.querySelector(<span class="hljs-string">'p'</span>),

  switchImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(isMobile)</span> {</span>
    <span class="hljs-keyword">var</span> attr = isMobile ? <span class="hljs-string">'data-mobile-src'</span> : <span class="hljs-string">'data-src'</span>;

    [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img['</span> + attr + <span class="hljs-string">']'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
      <span class="hljs-comment">// On affecte l'une ou l'autre source Ã  notre image,</span>
      <span class="hljs-comment">// entraÃ®nant son chargement si nÃ©cessaire.</span>
      el.src = el.getAttribute(attr);

      <span class="hljs-comment">// On en profite pour la bouger avant ou aprÃ¨s le contenu</span>
      content.parentNode.insertBefore(el, isMobile ? content.nextSibling : content);
    });
  };

enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">false</span>);
});

enquire.register(<span class="hljs-string">'screen and (max-width: 767px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">true</span>);
});
</code></pre>
<p>On peut ainsi gÃ©rer facilement le chargement de lâ€™image, ainsi que son
emplacement. Jâ€™utilise ici deux handlers distincts pour mâ€™assurer quâ€™enquire
fait bien son boulot au chargement aussi, dans tous les cas (les callbacks
<code>unmatch</code> ne sont appelÃ©s quâ€™au redimensionnement, semble-t-il : avec un seul
handler, lâ€™image nâ€™arrive donc jamais si on charge la page avec un Ã©cran dâ€™une
largeur infÃ©rieure Ã  768px).</p>
<h2 id="that-s-all-you-ve-got-bitch-"><a class="putainde-Title-anchor" href="#that-s-all-you-ve-got-bitch-">#</a>Thatâ€™s all youâ€™ve got, bitch?</h2><p>On peut Ã©galement, puisque tu y tiens tant, Ã©voquer dâ€™autres solutions plus
marginales mais qui mÃ©ritent dâ€™Ãªtre citÃ©es.</p>
<h3 id="foundation"><a class="putainde-Title-anchor" href="#foundation">#</a>Foundation</h3><p><a href="http://foundation.zurb.com/">Foundation</a> propose, dans sa version 5 (et
peut-Ãªtre mÃªme avant, jâ€™ai pas vÃ©rifiÃ©) un peu de sucre syntaxique HTML
permettant de switcher (via JS, Å“uf corse) simplement entre diffÃ©rents contenus
pour lâ€™Ã©lÃ©ment sur lequel on lâ€™utilise.</p>
<p>Câ€™est pas mal. Ã‡a donne Ã§a (tirÃ© de <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>) :</p>
<blockquote>
<p>We use the data-interchange attribute on a markup container (probably a div)
to do this. Hereâ€™s an example which loads up a small, static map on mobile, a
larger static map for medium-sized devices, and a full interactive Google map
on large display devices.</p>
</blockquote>
<pre><code class="lang-html">&lt;<span class="hljs-keyword">div</span> data-interchange=<span class="hljs-string">"[../examples/interchange/default.html, (small)],
                       [../examples/interchange/medium.html, (medium)],
                       [../examples/interchange/large.html, (large)]"</span>&gt;
  &lt;<span class="hljs-keyword">div</span> data-alert <span class="hljs-type">class</span>=<span class="hljs-string">"alert-box secondary radius"</span>&gt;
    This <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> default content.
    &lt;a href=<span class="hljs-string">"#"</span> <span class="hljs-type">class</span>=<span class="hljs-string">"close"</span>&gt;&amp;<span class="hljs-keyword">times</span>;&lt;/a&gt;
  &lt;/<span class="hljs-keyword">div</span>&gt;
&lt;/<span class="hljs-keyword">div</span>&gt;
</code></pre>
<p><code>small</code>, <code>medium</code> et <code>large</code> Ã©tant des raccourcis pour des media queries donnÃ©es
(câ€™est dans <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>,
toujours. Jâ€™insiste.)</p>
<h3 id="flexbox-pas-toi-david-"><a class="putainde-Title-anchor" href="#flexbox-pas-toi-david-">#</a>Flexbox (pas toi, David)</h3><p>On peut Ã©galement, comme lâ€™a trÃ¨s justement soulignÃ© <a href="/#crew">lionelB</a>, se
pencher (mais pas trop) sur le cas de Flexbox, qui est un nouveau type de
positionnement introduit en CSS3. La <a href="http://caniuse.com/#search=flexbox">compatibilitÃ©</a>
nâ€™est pas encore au top (surtout grÃ¢ce Ã  IE, qui lâ€™eÃ»t cru) mais autant se tenir
prÃªts ! Pour ceux qui ont dormi, en gros, tu dÃ©finis un conteneur :</p>
<pre><code class="lang-css"><span class="hljs-class">.flex-container</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;

  <span class="hljs-comment">/* ou bien */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-flex</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>â€¦et tu donnes des numÃ©ros Ã  ses enfants, comme Ã  Bangkok :</p>
<pre><code class="lang-css"><span class="hljs-class">.title</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.content</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.image</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
Bien sÃ»r, tu as Ã©tÃ© assez malin pour mettre ton image en dernier dans le DOM...
...n'est-ce pas ?
*/</span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.content</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.image</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>Et voilÃ , pas besoin dâ€™avoir fait Pollypocket pour percevoir Ã  quel point la
flexibilitÃ© et la propretÃ© du code que cette technique nous permet dâ€™Ã©crire
rÃ©solvent notre problÃ¨me en deux secondes douze. Ce nâ€™est Ã©videmment ici que la
partie Ã©mergÃ©e du flexberg ; il y a des tas de bonnes ressources qui vous
expliqueront Ã§a en long, en large et en travers bien mieux que moi, notamment
<a href="http://www.adobe.com/devnet/html5/articles/working-with-flexbox-the-new-spec.html">cet article</a>
sur lequel jâ€™ai honteusement pompÃ© les snippets de cette partie.</p>
<h2 id="conclusion"><a class="putainde-Title-anchor" href="#conclusion">#</a>Conclusion</h2><p>Comme tu lâ€™as vu, rien de ce que je tâ€™ai montrÃ© nâ€™est rÃ©ellement satisfaisant :
pour pouvoir contrÃ´ler le positionnement dâ€™un Ã©lÃ©ment dans le DOM dans le cadre
dâ€™un webdesign responsive, tu dois soit le dupliquer et jouer Ã  cache-cache,
soit le dÃ©placer avec JavaScript. Aussi, je serais ravi que tu partages ton
opinion, tes idÃ©es ou tes retours dâ€™XP Ã  ce sujet. Ã‡a me fera de la lecture pour
passer le temps, et toi tu feras quelque chose de constructif !</p>
<p>Il est temps pour moi de te laisser reprendre le cours de ta vie. Peut-Ãªtre nos
routes se croiseront-elles de nouveau. Dans lâ€™intervalle, va, vis, et code !</p>

]]></description><pubDate>Thu, 26 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/html/responsive-dom/</link><guid isPermaLink="true">http://putaindecode.fr/posts/html/responsive-dom/</guid></item><item><title>Comment se passer de libraries/frameworks JavaScript</title><description><![CDATA[[
<p><strong> Petite note prÃ©alable </strong> : Ã‰videmment que Ã§a ne marche pas sous les vieux navigateurs, cet article sâ€™adresse principalement Ã  toi pour te faire comprendre comment les choses marchent.</p>
<p>De plus en plus, le besoin de lÃ©gÃ¨retÃ© se fait sentir sur les pages. En dÃ©pit dâ€™un web plus rapide sur desktop, on a maintenant beaucoup de devices connectÃ©s via 3G ou Edge (un petit coucou au mÃ©tro parisien). Du coup, tu te rendras vite compte quâ€™embarquer jQuery + jQuery Mobile + jQuery UI et un tas dâ€™autres plug-ins grapillÃ©s sur le web, Ã§a commence Ã  peser.</p>
<h2 id="pour-la-selection-d-elements"><a class="putainde-Title-anchor" href="#pour-la-selection-d-elements">#</a>Pour la sÃ©lection dâ€™Ã©lements</h2><p>Pour remplacer ton bon vieux <code>$</code> magique, <code>document.querySelectorAll</code> semble faire lâ€™affaire. En revanche, il retourne une instance de <code>NodeList</code>, pas dâ€™<code>Array</code>, ce qui ne nous arrange pas des masses.</p>
<p>Du coup, on peut Ã©crire une petite function toute con, qui nous retourne un <code>Array</code> et ses mÃ©thodes bien utiles.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> nativeSlice = [].slice <span class="hljs-comment">// la mÃ©thode de conversion</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> list = document.querySelectorAll(selector)
  <span class="hljs-keyword">return</span> nativeSlice.call(list)
}
</code></pre>
<p>Alternativement, tu peux utiliser <code>Array.apply(null, list)</code> plutÃ´t que <code>nativeSlice.call(list)</code>, si vraiment Ã§a te fait plaisir.</p>
<p>Une troisiÃ¨me solution, un peu plus chiante au quotidien (et terriblement laide), câ€™est dâ€™utiliser directement les mÃ©thodes qui tâ€™intÃ©ressent (ex. <code>[].forEach</code>) de cette faÃ§on :</p>
<pre><code class="lang-javascript">;[].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(selector), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<p>Pour en revenir Ã  notre petite mÃ©thode <code>$</code>, on peut du coup faire :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// prends bien l'habitude de garder</span>
<span class="hljs-comment">// tes nodeLists si tu les rÃ©utilises</span>

<span class="hljs-keyword">var</span> elements = $(<span class="hljs-string">".my-elements-className"</span>)

elements.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<h3 id="pour-l-event-delegation"><a class="putainde-Title-anchor" href="#pour-l-event-delegation">#</a>Pour lâ€™event delegation</h3><p>Lâ€™event delegation, câ€™est bien, mangez-en. Ã‡a permet entre autres de ne pas attacher 150 listeners uniques Ã  150 elements diffÃ©rents, mais Ã  attacher un seul listener sur un parent commun, et analyser les sources des Ã©venements Ã  lâ€™intÃ©rieur en se basant sur le bubbling (remontÃ©e dâ€™Ã©venement de la source au plus haut parent) ou capturing (descente dâ€™Ã©venement du plus haut parent Ã  la source, avant mÃªme que la source ne le reÃ§oive).</p>
<p>Pour faire de la dÃ©lÃ©gation, on va procÃ©der en trois temps :</p>
<ul>
<li>Choper <code>event.target</code></li>
<li>VÃ©rifier que le sÃ©lecteur qui nous intÃ©resse correspond bien Ã  <code>event.target</code> ou un de ses parents (dans le cas oÃ¹ lâ€™on clique sur le <code>.icon-Arrow</code> dans <code>.js-Button-action</code>)</li>
<li>Si Ã§a match, on garde lâ€™Ã©lement correspondant au sÃ©lecteur, sinon, exit</li>
</ul>
<p>Les browsers relativement rÃ©cents possÃ¨dent une mÃ©thode : <code>matchesSelector</code> (et tous ses alias prÃ©fixÃ©s). Ce quâ€™on peut donc faire, câ€™est ceci :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> docEl = document.documentElement
    <span class="hljs-comment">// si c'est dans docEl, c'est que c'est dispo</span>
  , nativeMatchesSelector =
      docEl.matchesSelector ||
      docEl.webkitMatchesSelector ||
      docEl.mozMatchesSelector ||
      docEl.oMatchesSelector ||
      docEl.msMatchesSelector
  , matchesSelector = nativeMatchesSelector || matchesPolyfill

<span class="hljs-comment">// le polyfill utilise querySelectorAll</span>
<span class="hljs-comment">// et cherche dans le parent de l'Ã©lement</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchesPolyfill</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> node = this
    , <span class="hljs-keyword">parent</span> = node.parentNode
    , query, index, length
  <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">parent</span> || <span class="hljs-keyword">parent</span>.nodeType != <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
  }
  query = <span class="hljs-keyword">parent</span>.querySelectorAll(selector)
  index = -<span class="hljs-number">1</span>
  length = query.length
  <span class="hljs-keyword">while</span>(++index &lt; length) {
    <span class="hljs-keyword">if</span>(query[index] == node) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentTarget</span><span class="hljs-params">(node, selector)</span>{</span>
  <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  <span class="hljs-keyword">while</span>(node = node.parentNode) {
    <span class="hljs-keyword">if</span>(node.nodeType != <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}
</code></pre>
<p>DÃ¨s lors, dans nos listeners, on pourra directement procÃ©der ainsi :</p>
<pre><code class="lang-javascript">element.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  <span class="hljs-keyword">var</span> currentTarget = getCurrentTarget(evt.target, <span class="hljs-string">".Button-action"</span>)
  <span class="hljs-keyword">if</span>(!currentTarget) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">// all good with currentTarget</span>
})
</code></pre>
<h3 id="pour-l-ajax"><a class="putainde-Title-anchor" href="#pour-l-ajax">#</a>Pour lâ€™Ajax</h3><p>Pourquoi est-ce que lâ€™on appelle Ã§a encore Ajax, dâ€™ailleurs ? Bref.</p>
<p>Simple comme bonjour :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSuccessStatus</span><span class="hljs-params">(status)</span>{</span>
  <span class="hljs-keyword">return</span> status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span> || status == <span class="hljs-number">304</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ajax</span><span class="hljs-params">(options)</span>{</span>
  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
    , done = <span class="hljs-literal">false</span>
    , async = options.hasOwnProperty(<span class="hljs-string">"async"</span>) ? options.async : <span class="hljs-literal">true</span>

  xhr.open(options.method || <span class="hljs-string">"GET"</span>, options.url, async)

  xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">if</span>(done) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.readyState != <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>
    done = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">if</span>(isSuccessStatus(<span class="hljs-keyword">this</span>.status)) {
      <span class="hljs-keyword">if</span>(options.success) {
        options.success.call(<span class="hljs-keyword">this</span>)
      }
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span>(options.error) {
      options.error.call(<span class="hljs-keyword">this</span>)
    }
  }
  <span class="hljs-built_in">Object</span>.keys(options.headers || {})
    .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      xhr.setRequestHeader(key, options.headers[key])
    })
  xhr.send(options.data || <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">return</span> xhr
}
</code></pre>
<p>Cette fonction offre un support basique de XHR :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myXHR = ajax({
    url : <span class="hljs-string">"api/users"</span>
  , success : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      doStuff(<span class="hljs-keyword">this</span>.responseText)
    }
  , error : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      showError(<span class="hljs-keyword">this</span>.status)
    }
})
</code></pre>
<h3 id="es5-magic"><a class="putainde-Title-anchor" href="#es5-magic">#</a>ES5 magic</h3><p>EcmaScript 5 dÃ©livre des petites mÃ©thodes trÃ¨s intÃ©ressantes pour se simplifier la vie, fortement inspirÃ©es par ce quâ€™on a lâ€™habitude de trouver dans les bibliothÃ¨ques ayant connu lâ€™Ã¢ge dâ€™or, comme <a href="http://prototypejs.org">PrototypeJS</a> ou <a href="http://mootools.net">MooTools</a>.</p>
<p>DÃ¨s lors, plutÃ´t quâ€™un ennuyeux :</p>
<pre><code class="lang-javascript">var key, <span class="hljs-keyword">item</span>
<span class="hljs-keyword">for</span>(key <span class="hljs-operator">in</span> myObject) {
  <span class="hljs-keyword">if</span>(myObject.hasOwnProperty(key)) {
    <span class="hljs-keyword">item</span> = myObject[key]
   <span class="hljs-comment"> // do something</span>
  }
}
</code></pre>
<p>on peut se contenter dâ€™un :</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">Object</span>.keys(myObject)
  .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
    <span class="hljs-keyword">var</span> item = myObject[i]
    <span class="hljs-comment">// do something</span>
  })
</code></pre>
<p>De mÃªme, on bÃ©nÃ©ficie de mÃ©thodes sâ€™avÃ©rant trÃ¨s utiles, comme
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype"><code>Array.prototype.map</code>, <code>Array.prototype.reduce</code>, <code>Array.prototype.filter</code></a>,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object.create</code>, <code>Object.getPrototypeOf</code>, <code>Object.getOwnPropertyNames</code>, <code>Object.defineProperty</code></a>
dont je tâ€™invite, si cela tâ€™intÃ©resse, Ã  te renseigner sur ces mÃ©thodes.
Et si tu veux avoir plus de dÃ©tails, read the fucking manual :
<a href="http://es5.github.io">http://es5.github.io</a>.</p>
<h3 id="des-petits-details-cools-du-cote-des-events"><a class="putainde-Title-anchor" href="#des-petits-details-cools-du-cote-des-events">#</a>Des petits dÃ©tails cools du cÃ´tÃ© des events</h3><p>Avec <code>addEventListener</code>, on peut aussi passer un objet comme listener, avec <code>handleEvent</code> pour interface :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myElementClickEvents = {
    element : myElement
  , callbacks : []
  , handleEvent : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
      <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = this
      this.callbacks.<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item)</span>{</span>
        item.call(<span class="hljs-keyword">self</span>.element, evt)
      })
    }
}
myElement.addEventListener(<span class="hljs-string">"click"</span>, myElementClickEvents)

myElementClickEvents.callbacks.push(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  console.log(evt)
})
</code></pre>
<p>Avec Ã§a, on peut facilement garder une trace de ce quâ€™on passÃ© comme listeners.</p>
<h3 id="du-type-checking-"><a class="putainde-Title-anchor" href="#du-type-checking-">#</a>Du type checking ?</h3><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> getClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span>{</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(o) }
  , someString = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">"foo"</span>)

<span class="hljs-keyword">typeof</span> someString <span class="hljs-comment">// "object"</span>
getClass(someString) <span class="hljs-comment">// "[object String]", sounds more reasonable</span>
</code></pre>
<h3 id="petit-bonus"><a class="putainde-Title-anchor" href="#petit-bonus">#</a>Petit bonus</h3><p>Un petit bonus rien que pour toi : pour avoir une syntaxe plus sympathique et plus claire que les prototypes.</p>
<p>En principe, on fait comme Ã§a :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span><span class="hljs-params">(name)</span>{</span>
  <span class="hljs-keyword">this</span>.name = name
}

Animal.prototype.getName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cat</span><span class="hljs-params">(name)</span>{</span>
  Animal.call(<span class="hljs-keyword">this</span>, name)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">K</span><span class="hljs-params">()</span>{</span>}
K.prototype = Animal.prototype

Cat.prototype = <span class="hljs-keyword">new</span> K
Cat.prototype.constructor = Cat
Cat.prototype.type = <span class="hljs-string">"cat"</span>

<span class="hljs-keyword">var</span> myAnimal = <span class="hljs-keyword">new</span> Animal(<span class="hljs-string">"Foo"</span>)
  , myCat = <span class="hljs-keyword">new</span> Cat(<span class="hljs-string">"Bar"</span>)

myCat <span class="hljs-keyword">instanceof</span> Cat <span class="hljs-comment">// true</span>
myCat <span class="hljs-keyword">instanceof</span> Animal <span class="hljs-comment">// true</span>
</code></pre>
<p>Maintenant, Ã  lâ€™aide de deux petites mÃ©thodes :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// wow</span>
<span class="hljs-comment">//         many magic</span>
<span class="hljs-comment">//   very es5</span>
<span class="hljs-comment">//            wow</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extend</span><span class="hljs-params">(object)</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(!object) <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
  Object.keys(object)
    .<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      <span class="hljs-keyword">self</span>[key] = object[key]
    })
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(typeof <span class="hljs-keyword">self</span>.constructor == <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">self</span>.constructor.apply(<span class="hljs-keyword">self</span>, arguments)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-keyword">var</span> klass = {
    create : create
  , extend : extend
}
</code></pre>
<p>Tu peux faire Ã§a :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> animal = klass.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      <span class="hljs-keyword">this</span>.name = name
    }
  , getName : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
    }
})

<span class="hljs-keyword">var</span> cat = animal.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      animal.constructor.call(<span class="hljs-keyword">this</span>, name)
    }
  , type : <span class="hljs-string">"cat"</span>
})

<span class="hljs-keyword">var</span> myAnimal = animal.create(<span class="hljs-string">"Foo"</span>)
  , myCat = cat.create(<span class="hljs-string">"Bar"</span>)

cat.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
animal.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
</code></pre>
<p>VoilÃ , jâ€™espÃ¨re que cela a pu attiser ta curiositÃ© dâ€™en apprendre plus sur le langage lui-mÃªme et le DOM.</p>

]]></description><pubDate>Fri, 06 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</guid></item><item><title>ExternalInterface.call() de Flash (et Backbone), toute une histoire</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/occupyflash.png" alt=""></figure>

<p>Je voulais vous parler dâ€™un bug qui mâ€™a bien emmerdÃ© rÃ©cemment et comme jâ€™aimerais que vous ne perdiez pas de temps avec cela, un article sâ€™imposait.</p>
<p><em>Note de la direction : jâ€™y connais rien en Flash (et je ne crois pas avoir trop envie de connaÃ®tre en fait).</em></p>
<p>Dans la boite oÃ¹ je travaille, nous utilisons Flash en tant que lecteur vidÃ©o Ã©tant donnÃ© quâ€™il est pour le moment trÃ¨s difficile de faire lire sur toutes les plateformes des vidÃ©os au format <em>H.264</em> et/ou passant par du <em>HLS</em>. Longue histoire qui fera office dâ€™un autre article. (Je dis Ã§a Ã  chaque fois, haha).</p>
<h2 id="le-pitch"><a class="putainde-Title-anchor" href="#le-pitch">#</a>Le pitch</h2><p>Avec notre <em>flasheur</em> attitrÃ©, nous nous sommes mis en tÃªte de crÃ©er un objet <em>event</em> qui permettrait au Flash de dÃ©clencher des Ã©vÃ¨nements lorsquâ€™il le souhaite afin de communiquer avec lâ€™application JavaScript et que celui-ci fasse en consÃ©quence. Cet objet, nous lâ€™avons appelÃ© <code>App.FlashManager</code> et plus prÃ©cisemment <code>App.FlashManager.Events</code> dans le cas des Ã©vÃ¨nements. Nous utilisons <strong>Backbone.js</strong> pour gÃ©rer ce principe dâ€™Ã©vÃ¨nement mais vous en avez dâ€™<a href="http://microjs.com/#event">autres</a> de disponible. En pratique, voilÃ  ce que Ã§a donne :</p>
<pre><code class="lang-javascript"> // on crÃ©e un objet vide
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// on lui ajoute les fonctionnalitÃ©s des events Backbone
_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)
</code></pre>
<p>En soi, pas de souci, tout se passe bien Ã  ce moment, nous avons un <a href="http://backbonejs.org/#Events">objet dâ€™Ã©vÃ¨nement faÃ§on Backbone</a>. Il pourra alors sâ€™Ã©couter lui-mÃªme, Ã©couter un autre objet, mais aussi dÃ©clencher des Ã©vÃ¨nements.</p>
<h2 id="cote-flash"><a class="putainde-Title-anchor" href="#cote-flash">#</a>CÃ´tÃ© Flash</h2><p>La base est en place, maintenant on souhaite que le Flash dÃ©clenche un Ã©vÃ¨nement. On passe par lâ€™objet <code>ExternalInterface</code> :</p>
<pre><code class="lang-javascript">ExternalInterface<span class="hljs-preprocessor">.call</span>(<span class="hljs-string">"window.App.FlashManager.Events.trigger"</span>, <span class="hljs-string">"my-event"</span>)
// http://help<span class="hljs-preprocessor">.adobe</span><span class="hljs-preprocessor">.com</span>/en_US/FlashPlatform/reference/actionscript/<span class="hljs-number">3</span>/flash/external/ExternalInterface<span class="hljs-preprocessor">.html</span><span class="hljs-preprocessor">#call</span>
</code></pre>
<p>Et lÃ , bug.</p>
<h2 id="pourquoi-bug-"><a class="putainde-Title-anchor" href="#pourquoi-bug-">#</a>Pourquoi bug ?</h2><p>Pour le moment, je ne sais pas vraiment. Je me pencherai plus sur le sujet dÃ¨s que jâ€™ai un peu de temps, mais ce que je sais, câ€™est que <code>ExtercalInterface.call()</code> ne sâ€™attend pas Ã  recevoir ce que <strong>Backbone.js</strong> lui propose. Lorsque vous faites <code>.trigger()</code>, <strong>Backbone.js</strong> renvoie lâ€™<a href="https://github.com/jashkenas/backbone/blob/master/backbone.js#L144-L153">objet en cours</a>, ce qui provoque un Ã©nooooorme bug dans le plugin Flash de votre navigateur.</p>
<h2 id="la-solution-cote-javascript"><a class="putainde-Title-anchor" href="#la-solution-cote-javascript">#</a>La solution cÃ´tÃ© JavaScript</h2><p>Pour contrer cela, je vous propose la solution suivante qui est de ne pas utiliser directement lâ€™objet <code>Backbone.Events|View</code> mais plutÃ´t de passer par une interface, un objet proxy.</p>
<p>Voici le schÃ©ma :</p>
<ul>
<li>CrÃ©er un objet simple qui contient les mÃªmes noms de mÃ©thodes que les objets Ã©vÃ¨nements <strong>Backbone.js</strong> (en gros, se mapper sur lâ€™API Backbone)</li>
<li>Utiliser <strong>Backbone.js</strong> dans les mÃ©thodes de cet objet <em>Proxy</em></li>
</ul>
<p>Exemple :</p>
<pre><code class="lang-javascript">// Bridge between flash <span class="hljs-keyword">and</span> js
App<span class="hljs-preprocessor">.FlashManager</span> = {}
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// Backbone events used for Flash
App<span class="hljs-preprocessor">.InternalFlashManager</span> = {}
App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)

App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span> = function(name, opts) {
    App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span>(name, opts)

    // Must return nothing not to loop JavaScript engine, important!
    return
}
</code></pre>
<h2 id="oh-et-"><a class="putainde-Title-anchor" href="#oh-et-">#</a>Oh etâ€¦</h2><p>â€¦il existe une version ayant plus ou moins le mÃªme souci que moi disponible lÃ  : <a href="https://coderwall.com/p/e-8niw">ExternalInterface#call in a deadly loop (<strong>flash</strong>toXML)</a>.</p>
<h2 id="conclusion"><a class="putainde-Title-anchor" href="#conclusion">#</a>Conclusion</h2><p>De maniÃ¨re gÃ©nÃ©rale (hors <strong>Backbone.js</strong>), lorsque vous utilisez <code>ExtercalInterface.call()</code>, faites en sorte que votre JavaScript retourne quelque chose de simple (un objet ayant que des atributs, pas de fonctions, ou encore un boulÃ©en ou un <em>integer</em>).</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</guid></item><item><title>De jQuery Ã  Vanilla JS</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/jquery-die.jpg" alt=""></figure>

<p>Oui alors jQuery, câ€™est sÃ»rement trÃ¨s bien, Ã§a simplifie pas mal de choses et le <em>chaining</em> est intÃ©ressant mais eeeest-ce que vous connaissez lâ€™Ã©quivalent en <em>pur</em> JavaScript ? Pas sÃ»r hein.</p>
<p>Ce petit article vous propose de quoi peut-Ãªtre vous faire changer dâ€™avis sur la bibliothÃ¨que qui pÃ¨se tout de mÃªme environ ~80ko.</p>
<p><em>Note : <a href="http://vanilla-js.com/">Vanilla JS</a> nâ€™est pas un framework mais veut simplement dire â€œÃ  nuâ€, câ€™est du JavaScript sans bibliothÃ¨que.</em></p>
<p>Câ€™est parti !</p>
<h2 id="table-des-matieres"><a class="putainde-Title-anchor" href="#table-des-matieres">#</a>Table des matiÃ¨res</h2><ol>
<li><a href="/posts/js/de-jquery-a-vanillajs/#-v-nements">Ã‰vÃ¨nements</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#s-lecteurs">SÃ©lecteurs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#attributs">Attributs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#classes">Classes</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#manipulation">Manipulation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#navigation">Navigation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#ajax">AJAX</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#jsonp">JSONP</a></li>
</ol>
<h2 id="evenements"><a class="putainde-Title-anchor" href="#evenements">#</a>Ã‰vÃ¨nements</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
document.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'a'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// codeâ€¦</span>
})

<span class="hljs-comment">// Vanilla</span>
[].forEach.call(document.querySelectorAll(<span class="hljs-string">'a'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
  el.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// codeâ€¦</span>
  })
})
</code></pre>
<h2 id="selecteurs"><a class="putainde-Title-anchor" href="#selecteurs">#</a>SÃ©lecteurs</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> divs = $(<span class="hljs-string">'div'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> divs = document.querySelectorAll(<span class="hljs-string">'div'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> newDiv = $(<span class="hljs-string">'&lt;div/&gt;'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> newDiv = document.createElement(<span class="hljs-string">'div'</span>)
</code></pre>
<h2 id="attributs"><a class="putainde-Title-anchor" href="#attributs">#</a>Attributs</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-variable">$(</span><span class="hljs-string">'img'</span>).<span class="hljs-keyword">filter</span>(<span class="hljs-string">':first'</span>).attr(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)

<span class="hljs-comment">// Vanilla</span>
document.querySelector(<span class="hljs-string">'img'</span>).setAttribute(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)
</code></pre>
<h2 id="classes"><a class="putainde-Title-anchor" href="#classes">#</a>Classes</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.addClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">add</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.toggleClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">toggle</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<h2 id="manipulation"><a class="putainde-Title-anchor" href="#manipulation">#</a>Manipulation</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'body'</span>).append($(<span class="hljs-string">'&lt;p/&gt;'</span>))

<span class="hljs-comment">// Vanilla</span>
document.body.appendChild(document.createElement(<span class="hljs-string">'p'</span>))
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> clonedElement = $(<span class="hljs-string">'#about'</span>).clone()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> clonedElement = document.getElementById(<span class="hljs-string">'about'</span>).cloneNode(<span class="hljs-literal">true</span>)
</code></pre>
<pre><code class="lang-javascript">// jQuery
$(<span class="hljs-string">'#wrap'</span>).<span class="hljs-constant">empty</span>()
<span class="hljs-comment">
// Vanilla</span>
var <span class="hljs-operator">wrap</span> = document.getElementById(<span class="hljs-string">'wrap'</span>)
<span class="hljs-keyword">while</span>(<span class="hljs-operator">wrap</span>.firstChild) <span class="hljs-operator">wrap</span>.removeChild(<span class="hljs-operator">wrap</span>.firstChild)
</code></pre>
<h2 id="navigation"><a class="putainde-Title-anchor" href="#navigation">#</a>Navigation</h2><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = $(<span class="hljs-string">'#about'</span>).<span class="hljs-keyword">parent</span>()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = document.getElementById(<span class="hljs-string">'about'</span>).parentNode
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">if</span>($(<span class="hljs-string">'#wrap'</span>).<span class="hljs-keyword">is</span>(<span class="hljs-string">':empty'</span>))

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">if</span>(!document.getElementById(<span class="hljs-string">'wrap'</span>).hasChildNodes())
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> nextElement = $(<span class="hljs-string">'#wrap'</span>).next()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> nextElement = document.getElementById(<span class="hljs-string">'wrap'</span>).nextSibling
</code></pre>
<h2 id="ajax"><a class="putainde-Title-anchor" href="#ajax">#</a>AJAX</h2><h3 id="get"><a class="putainde-Title-anchor" href="#get">#</a>GET</h3><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.get(<span class="hljs-string">'//example.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.open(<span class="hljs-string">'GET'</span>, url)
httpRequest.send()
</code></pre>
<h3 id="post"><a class="putainde-Title-anchor" href="#post">#</a>POST</h3><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.post(<span class="hljs-string">'//example.com'</span>, { username: username }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>)
httpRequest.open(<span class="hljs-string">'POST'</span>, url)
httpRequest.send(<span class="hljs-string">'username='</span> + <span class="hljs-built_in">encodeURIComponent</span>(username))
</code></pre>
<h3 id="jsonp"><a class="putainde-Title-anchor" href="#jsonp">#</a>JSONP</h3><pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.getJSON(<span class="hljs-string">'//openexchangerates.org/latest.json?callback=?'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
<span class="hljs-keyword">var</span> scr = document.createElement(<span class="hljs-string">'script'</span>)
scr.src = <span class="hljs-string">'//openexchangerates.org/latest.json?callback=formatCurrency'</span>
document.body.appendChild(scr)
</code></pre>
<p>Cela vous parait-il encore difficile de vous passer de jQuery ? :)</p>
<p>Un grand merci Ã  <a href="http://playground.deaxon.com/js/vanilla-js/">@deaxon</a> qui est Ã  lâ€™origine de cet Ã©claircissement.</p>
<h2 id="a-creuser"><a class="putainde-Title-anchor" href="#a-creuser">#</a>A creuser</h2><p>Il existe une version minimaliste de jQuery basÃ©e sur la mÃªme API mais beaucoup plus lÃ©gÃ¨re sâ€™appelant <a href="http://zeptojs.com/">Zepto</a>. Il est actuellement utilisÃ© en production sur le site mobile de ma boite.</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</guid></item><item><title>Premiers pas avec Grunt</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/gruntjs.png" alt=""></figure>

<p>Vous avez sÃ»rement dÃ©jÃ  entendu parler de <strong>Grunt</strong> Ã  droite Ã  gauche, en confÃ©rence, voire votre boite lâ€™utilise dÃ©jÃ  mais vous ne savez toujours pas trop ce qui se cache derriÃ¨re ce terme saugrenu digne dâ€™un personnage de Warcraft. Soit, ce nâ€™est pas bien grave. <strong>Grunt</strong> est simplement un <em>JavaScript Task Runner</em>, un outil vous permettant de crÃ©er des tÃ¢ches automatisÃ©es en JavaScript. ForcÃ©ment ce nâ€™est pas trÃ¨s parlant mais câ€™est tout lâ€™intÃ©rÃªt de cet article, vous expliquer ce quâ€™est <strong>Grunt</strong> et pourquoi il peut vous Ãªtre utile dans un <em>workflow</em> de front-end dev.</p>
<h1 id="commen-ons"><a class="putainde-Title-anchor" href="#commen-ons">#</a>CommenÃ§ons</h1><p>Vous est-il dÃ©jÃ  arrivÃ©(e) de devoir rÃ©guliÃ¨rement lancer, lancer et relancer des processus tels que <em>Sass</em>, <em>LESS</em>, <em>uglify</em> - en somme des prÃ©processeurs ou des minifiers - rÃ©guliÃ¨rement Ã  la main ? Nâ€™est-ce pas pÃ©nible ? Nâ€™est-ce pas aussi pÃ©nible de devoir indiquer Ã  tous ses collÃ¨gues comment ils doivent bosser pour que vous soyez tous cohÃ©rents ? Oui ? <strong>Grunt</strong> permet de rÃ©soudre ce genre de choses : respecter un putain de <em>workflow</em> en sâ€™assurant que le parcours soit le mÃªme pour tout le monde et dâ€™exÃ©cuter tout Ã§a en lanÃ§ant une seule commande. Nâ€™est-ce pas fucking aweeeeesome dude ? Bref.</p>
<p>Voici un <em>workflow</em> assez classique :</p>
<ul>
<li>Compiler mes <code>.scss</code> en <code>.css</code>;</li>
<li>ConcatÃ©ner mes <code>*.js</code> en un seul fichier;</li>
<li>Minifier (avec <em>uglify</em> par exemple) la rÃ©sultante de lâ€™action prÃ©cÃ©dente.</li>
</ul>
<p>Voyons maintenant comment lâ€™on peut mettre en place ceci via <strong>Grunt</strong>.</p>
<h2 id="installation"><a class="putainde-Title-anchor" href="#installation">#</a>Installation</h2><p>Tout dâ€™abord, installons <strong>Grunt</strong>. Notez que <strong>Grunt</strong> est en <em>nodejs</em> et que je considÃ¨re que vous avez dÃ©jÃ  <em>nodejs</em> dâ€™installÃ©. Dâ€™autre part, nous allons crÃ©er un nouveau projet <strong>npm</strong> afin dâ€™enregistrer tous les packages que vous allez installer. Je vous explique par la suite pourquoi nous faisons Ã§a.</p>
<pre><code class="lang-bash">$ npm init <span class="hljs-comment">// puis plusieurs fois entrÃ©e</span>
</code></pre>
<p>En premier lieu, il faut installer le <em>package</em> qui permet de gÃ©rer <strong>Grunt</strong> en ligne de commande. Câ€™est le <em>commander</em> de <strong>Grunt</strong> en gros.</p>
<pre><code class="lang-bash">$ npm install <span class="hljs-attribute">-g</span> grunt<span class="hljs-attribute">-cli</span>
</code></pre>
<p>Une fois cela fait, installez <strong>Grunt</strong> en local dans votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-comment">$</span> <span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">grunt</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span><span class="hljs-literal">-</span><span class="hljs-comment">dev</span>
</code></pre>
<p>Ni plus ni moins, <strong>Grunt</strong> est enfin installÃ© dans votre projet.</p>
<h2 id="initialisation"><a class="putainde-Title-anchor" href="#initialisation">#</a>Initialisation</h2><p>Maintenant, il est nÃ©cessaire de crÃ©er un fichier de configuration <strong>Grunt</strong>. Pour cela, nous allons crÃ©er un fichier nommÃ© <code>Gruntfile.js</code> Ã  la racine de votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>touch <span class="hljs-constant">Gruntfile</span>.js
</code></pre>
<p>Fait ? Voici maintenant Ã  quoi doit ressembler la base dâ€™une configuration <strong>Grunt</strong>.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  <span class="hljs-comment">// Configuration de Grunt</span>
  grunt.initConfig({})

  <span class="hljs-comment">// DÃ©finition des tÃ¢ches Grunt</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, <span class="hljs-string">''</span>)

}
</code></pre>
<p>Nous avons maintenant tout le nÃ©cessaire pour dÃ©buter notre projet. Nous allons enfin pouvoir attaquer les choses sÃ©rieuses. Revenons un peu en arriÃ¨re oÃ¹ nous expliquions que nous voulons en tout premier lieu compiler nos <code>.scss</code> en <code>.css</code>.</p>
<h2 id="creer-sa-premiere-t-che"><a class="putainde-Title-anchor" href="#creer-sa-premiere-t-che">#</a>CrÃ©er sa premiÃ¨re tÃ¢che</h2><p>Une petite recherche sur votre moteur de recherche prÃ©fÃ©rÃ© en tapant <code>grunt sass</code> et vous trouverez le projet <a href="https://github.com/gruntjs/grunt-contrib-sass"><code>grunt-contrib-sass</code></a>.</p>
<p>Toute documentation pour installer une tÃ¢che <strong>Grunt</strong> est indiquÃ©e sur chaque <code>README.md</code> du projet mais pour un souci de clartÃ© et de comprÃ©hension, je vais tout de mÃªme vous expliquer ici comment faire.</p>
<p>Dâ€™abord, installons le package pour <em>Sass</em>.</p>
<pre><code class="lang-bash">$ npm install grunt<span class="hljs-attribute">-contrib</span><span class="hljs-attribute">-sass</span> <span class="hljs-subst">--</span>save<span class="hljs-attribute">-dev</span>
</code></pre>
<p>Ceci va installer le <em>package</em> <code>grunt-contrib-sass</code> dans votre dossier <code>node_modules</code> oÃ¹ vous pourrez lâ€™utiliser en lâ€™important dans votre <code>Gruntfile.js</code>.</p>
<p>Un exemple dâ€™utilisation :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {                              <span class="hljs-comment">// Nom de la tÃ¢che</span>
      dist: {                            <span class="hljs-comment">// Nom de la sous-tÃ¢che</span>
        options: {                       <span class="hljs-comment">// Options</span>
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {                         <span class="hljs-comment">// Liste des fichiers</span>
          <span class="hljs-string">'main.css'</span>: <span class="hljs-string">'main.scss'</span>,       <span class="hljs-comment">// 'destination': 'source'</span>
          <span class="hljs-string">'widgets.css'</span>: <span class="hljs-string">'widgets.scss'</span>
        }
      }
    }
  })

  <span class="hljs-comment">// Import du package</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  <span class="hljs-comment">// RedÃ©finition de la tÃ¢che `default` qui est la tÃ¢che lancÃ©e dÃ¨s que vous lancez Grunt sans rien spÃ©cifier.</span>
  <span class="hljs-comment">// Note : ici, nous dÃ©finissons sass comme une tÃ¢che Ã  lancer si on lance la tÃ¢che `default`.</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Nous avons maintenant tout le nÃ©cessaire pour pouvoir compiler nos <code>.scss</code> en  <code>.css</code>.</p>
<p>Vous vous demandez peut-Ãªtre comment vous pouvez gÃ©nÃ©raliser vos sources plutÃ´t que les dÃ©finir une par une. Pas de souci.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: { <span class="hljs-comment">// C'est ici que l'on dÃ©finit le dossier que l'on souhaite importer</span>
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<h2 id="deuxieme-t-che-concatener-ses-fichiers-javascript"><a class="putainde-Title-anchor" href="#deuxieme-t-che-concatener-ses-fichiers-javascript">#</a>DeuxiÃ¨me tÃ¢che : concatÃ©ner ses fichiers JavaScript</h2><p>Passons maintenant Ã  la concatÃ©nation des fichiers JavaScripts.</p>
<p>Comme pour la majoritÃ© des tÃ¢ches que vous aurez besoin avec <strong>Grunt</strong>, un <em>package</em> <strong>Grunt</strong> existe dÃ©jÃ  pour ce travail demandÃ©.</p>
<p>-&gt; <a href="https://github.com/gruntjs/grunt-contrib-concat"><code>grunt-contrib-concat</code></a></p>
<p>Installation : <code>npm install grunt-contrib-concat --save-dev</code> (<code>--save-dev</code> permet de sauvegarder le package dans <code>package.json</code> pour pouvoir Ã  tout moment le rÃ©installer en faisant <code>npm install</code>)</p>
<p>On ajoute alors Ã  notre configuration <strong>Grunt</strong> lâ€™importation de <code>grunt-contrib-concat</code> :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>); <span class="hljs-comment">// VoilÃ  l'ajout.</span>

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Puis on ajoute notre tÃ¢che :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concatÃ©nÃ©.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Ne pas oublier dâ€™ajouter la tÃ¢che de concatÃ©nation Ã  notre tÃ¢che par dÃ©faut :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concatÃ©nÃ©.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// ici mÃªme.</span>
}
</code></pre>
<h2 id="compressons-le-tout-"><a class="putainde-Title-anchor" href="#compressons-le-tout-">#</a>Compressons le tout !</h2><p>Pour finir, compressons nos fichiers JavaScript ! Pour cela : <a href="https://github.com/gruntjs/grunt-contrib-uglify"><code>grunt-contrib-uglify</code></a> fera lâ€™affaire.</p>
<p>Je vous passe les dÃ©tails pour lâ€™installer, si vous avez bien suivi cet article, vous ne devriez avoir aucun problÃ¨me pour lâ€™installer.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
}
</code></pre>
<p>Ne constatez vous pas un souci ici ? Oui, nous ne voulons sÃ»rement pas Ã  la fois concatÃ©ner nos fichiers et les compresser. Alors comment faire ? Pas dâ€™inquiÃ¨tude, il suffit de crÃ©er des tÃ¢ches dâ€™environnement ou de contexte. On pourrait par exemple crÃ©er une tÃ¢che dÃ©veloppement et une tÃ¢che de production, quâ€™en pensez-vous ? Pas mal non ? :)</p>
<h2 id="optimisons-"><a class="putainde-Title-anchor" href="#optimisons-">#</a>Optimisons !</h2><p>Supprimons alors dans un premier temps notre tÃ¢che par dÃ©faut et crÃ©ons deux tÃ¢ches : <code>dev</code> et <code>dist</code>.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [])
}
</code></pre>
<p>Sauf que comme Ã§a, vous le voyez, cela ne va pas faire grand chose, voire rien du tout. AgrÃ©mentons alors nos deux tÃ¢ches par ce quâ€™on souhaite faire.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// C'est pas chouette Ã§a ?</span>
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>]) <span class="hljs-comment">// Et hop, je compresse si je lance $ grunt dist</span>
}
</code></pre>
<p>Ha ! Nous y voilÃ  ! Nous avons alors deux tÃ¢ches <code>grunt dev</code> et <code>grunt dist</code> qui nous permettent dans tous les cas de gÃ©nÃ©rer nos css et dans un cas concatÃ©ner nos js, dans lâ€™autre les compresser (la compression fait aussi la concatÃ©nation implicitement).</p>
<p>Sauf que comme tout bon(ne) dÃ©veloppeur/euse, vous Ãªtes une grosse feignasse et compiler Ã  chaque fois que vous faites des modifications sur vos fichiers va vite Ãªtre saoulant.</p>
<p>Pour cela, une tÃ¢che existe, elle sâ€™appelle <code>watch</code> (via le package <a href="https://github.com/gruntjs/grunt-contrib-watch/"><code>grunt-contrib-watch</code></a>).</p>
<h2 id="regarde-ce-fichier-que-je-ne-euh-bref-"><a class="putainde-Title-anchor" href="#regarde-ce-fichier-que-je-ne-euh-bref-">#</a>Regarde ce fichier que je neâ€¦ euh bref.</h2><p>TrÃ¨s simple, <code>watch</code> va vous permettre de â€œregarderâ€ vos fichiers, savoir lesquels ont changÃ© et donc lancer une action en fonction du type de fichiers.</p>
<p>Imaginons que lâ€™on veut par exemple compiler nos css Ã  chaque fois que lâ€™on change un fichier <em>Sass</em>. Ou encore que lâ€™on concatÃ¨ne nos fichiers JavaScript dÃ¨s que lâ€™on touche Ã  lâ€™un dâ€™entre eux.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>Maintenant, vous Ãªtes capable Ã  tout moment de compiler automatiquement vos fichiers en lanÃ§ant simplement <code>$ grunt watch</code>.</p>
<p>Oui, comprenez bien que lorsque vous ajoutez une tÃ¢che dans la dÃ©finition de la configuration de <strong>Grunt</strong>, elle est appelable directement. Typiquement, vous pouvez faire <code>$ grunt premier-niveau:deuxieme-niveau</code> soit par exemple <code>$ grunt sass:dist</code>. Vous nâ€™Ãªtes pas obligÃ©(e) de (re)dÃ©finir chaque tÃ¢che via <code>grunt.registerTask()</code>.</p>
<p>Je ne sais pas si vous vous rappelez mais nous avions crÃ©e une tÃ¢che de base sâ€™appelant <code>default</code>. Cette tÃ¢che se lance dÃ¨s que vous ne passez aucun paramÃ¨tre Ã  <strong>Grunt</strong> soit <code>$ grunt</code>. Vous pouvez aussi lâ€™appeler via <code>$ grunt default</code> mais aucun intÃ©rÃªt.</p>
<p>Tout Ã§a pour dire quâ€™il est serait sÃ»rement intÃ©ressant de lancer la tÃ¢che <code>watch</code> dÃ¨s quâ€™on souhaite lancer <strong>Grunt</strong> Ã©tant donnÃ© que câ€™est sÃ»rement la tÃ¢che la plus rÃ©currente que vous utiliserez.</p>
<p>Câ€™est parti !</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])<span class="hljs-comment"> // Oui, je conseille de toujours compiler une fois avant de lancer watch.</span>
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>Thatâ€™s it. Nous avons maintenant tout le nÃ©cessaire pour compiler des css, du js, lâ€™optimiser, ainsi quâ€™avoir une commande de dÃ©veloppement avec compilation automatique.</p>
<p>Et puisque je suis maniaque, nous allons ranger un peu :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

 <span class="hljs-comment"> // Je prÃ©fÃ¨re dÃ©finir mes imports tout en haut</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  var jsSrc = [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
    , jsDist = <span class="hljs-string">'dist/built.js'</span>

 <span class="hljs-comment"> // Configuration de Grunt</span>
  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      },
      dev: {}<span class="hljs-comment"> // A vous de le faire ! vous verrez que certaines options Sass sont plus intÃ©ressantes en mode dev que d'autres.</span>
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {<span class="hljs-comment"> // On renomme vu qu'on a pas de mode dev/dist. Dist Ã©tant une autre tÃ¢che : uglify</span>
        src: jsSrc,<span class="hljs-comment"> // Vu qu'on doit l'utiliser deux fois, autant en faire une variable.</span>
        dest: jsDist<span class="hljs-comment"> // Il existe des hacks plus intÃ©ressants mais ce n'est pas le sujet du post.</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {
        src: jsSrc,
        dest: jsDist
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,
        tasks: [<span class="hljs-string">'scripts:dev'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,
        tasks: [<span class="hljs-string">'styles:dev'</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'styles:dev'</span>, <span class="hljs-string">'scripts:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'styles:dist'</span>, <span class="hljs-string">'scripts:dist'</span>])

 <span class="hljs-comment"> // J'aime bien avoir des noms gÃ©nÃ©riques</span>
  grunt.registerTask(<span class="hljs-string">'scripts:dev'</span>, [<span class="hljs-string">'concat:compile'</span>])
  grunt.registerTask(<span class="hljs-string">'scripts:dist'</span>, [<span class="hljs-string">'uglify:compile'</span>])

  grunt.registerTask(<span class="hljs-string">'styles:dev'</span>, [<span class="hljs-string">'sass:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'styles:dist'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Avec Ã§a, je pense quâ€™on est pas trop mal. Il reste des optimisations Ã©ventuelles Ã  faire et nombreuses autres tÃ¢ches intÃ©ressantes peuvent Ãªtre ajoutÃ©es comme <a href="https://github.com/gruntjs/grunt-contrib-jshint/">jshint</a>. Cela fera probablement office dâ€™un autre article.</p>
<p>Jâ€™espÃ¨re que vous y voyez maintenant un peu plus clair dans <strong>Grunt</strong> ainsi que dans la compilation cÃ´tÃ© front-end. <strong>Grunt</strong> est un excellent produit, avec une communautÃ© rÃ©active et il est rare quâ€™une tÃ¢che que vous souhaitiez mettre en place nâ€™existe pas.</p>
<p>Bon workflow !</p>

]]></description><pubDate>Sat, 16 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</guid></item><item><title>Structurer son projet avec Revel et Mgo</title><description><![CDATA[[
<p>Tu te sens lâ€™Ã¢me dâ€™un rebelle ? Tu veux tester de la techno atypique ? Ã‡a tombe
bien, aujourdâ€™hui on est lÃ  pour Ã§a. On va toucher Ã  un sujet pas forcÃ©ment
majoritaire : le langage Go. Si tu ne connais pas les bases, je tâ€™invite Ã  aller
sur la <a href="http://golang.org/">homepage du projet</a> et Ã  parcourir le
<a href="http://tour.golang.org/">go-tour anglais</a> ou
<a href="http://go-tour-fr.appspot.com/">celui en franÃ§ais</a>, câ€™est un showcase complet du langage
(et trÃ¨s bien fichu).
Mais si tâ€™es juste curieux et que comprendre chaque pixel de lâ€™article nâ€™est pas
une obsession pour toi, tu devrais pouvoir voir de quoi on parle. MÃªme
<a href="/#crew">Nyalab</a> y est arrivÃ©.</p>
<p>Dans cet article on va voir <strong>comment brancher un projet go+revel Ã  une base de
donnÃ©es mongodb</strong> et obtenir ainsi une base de travail sympa pour explorer le
dÃ©veloppement web avec Go.</p>
<h2 id="les-technos-utilisees"><a class="putainde-Title-anchor" href="#les-technos-utilisees">#</a>Les technos utilisÃ©es</h2><h3 id="-a-href-http-golang-org-golang-a-"><a class="putainde-Title-anchor" href="#-a-href-http-golang-org-golang-a-">#</a><a href="http://golang.org">Golang</a></h3><p>Langage compilÃ©, publiÃ© en 2009, communÃ©ment considÃ©rÃ© comme â€œdÃ©sorientÃ© objetâ€,
câ€™est une alternative solide au C/C++ qui prÃ´ne un dÃ©coupage modulaire (par
â€œpackageâ€) des applications. Il est prÃ©disposÃ© Ã  une utilisation en
dÃ©veloppement web grÃ¢ce Ã  un package natif de gestion des rÃ©seaux et du
protocole http.</p>
<h3 id="-a-href-http-robfig-github-io-revel-revel-a-"><a class="putainde-Title-anchor" href="#-a-href-http-robfig-github-io-revel-revel-a-">#</a><a href="http://robfig.github.io/revel/">Revel</a></h3><p>Framework dÃ©veloppÃ© en Go et pour Go. Il intÃ¨gre tout ce quâ€™il faut pour
dÃ©velopper une application web : rechargement du code Ã  chaud, gestion des urls
par routing, parsing des paramÃ¨tres GET et POST, mÃ©canisme de validation des
donnÃ©es, gestion de sessions, gestion du cache, framework de tests et mÃªme
moteur de tÃ¢ches planifiÃ©es cron-likes. Il a pour particularitÃ© dâ€™Ãªtre
complÃ¨tement dÃ©couplÃ© sur la partie modÃ¨le et ne fourni aucun ORM ou ODM,
juste un petit module pour gÃ©rer des transactions sur des bases sql-like.</p>
<h3 id="-a-href-http-labix-org-mgo-mgo-a-"><a class="putainde-Title-anchor" href="#-a-href-http-labix-org-mgo-mgo-a-">#</a><a href="http://labix.org/mgo">Mgo</a></h3><p>Driver Go complet pour MongoDB, permettant dâ€™Ã©tablir la connexion et dâ€™envoyer
des requÃªtes. Il dispose dâ€™un mÃ©canisme de mapping des documents mongodb sur les
type struct de Go.</p>
<h3 id="-a-href-http-www-mongodb-org-mongodb-a-"><a class="putainde-Title-anchor" href="#-a-href-http-www-mongodb-org-mongodb-a-">#</a><a href="http://www.mongodb.org/">MongoDB</a></h3><p>Base de donnÃ©es NoSql agile et scalable, les documents sont stockÃ©s au format
json dans des collections. Le requÃªtage se fait en manipulant des objets et des
fonctions javascript.</p>
<h2 id="attends-attends-pourquoi-go-"><a class="putainde-Title-anchor" href="#attends-attends-pourquoi-go-">#</a>Attends, attends â€¦ Pourquoi Go ?</h2><p>Le premier vrai argument, câ€™est la <strong>performance</strong>. Sans rentrer dans
lâ€™explication hyper poussÃ©e dâ€™un <a href="http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013">benchmark</a>, on peut
affirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On
va pas risquer de vexer les autres membres du crew avec des affirmations
trollesques dÃ¨s le premier post.</p>
<p>On peut aussi ajouter que Go est un <strong>langage moderne</strong>, qui inclut toutes les
<strong>petites friandises pour attirer le dÃ©veloppeur</strong> curieux et assoiffÃ© de
qualitÃ©. Framework de tests et outil de mise en forme du code sont natifs et
permettent Ã  la techno dâ€™Ã©chapper aux interminables guerres de conventions :</p>
<blockquote>
<p>De toutes faÃ§ons le no-newline avant â€œ{â€œ câ€™est vraiment pour les pourritures
responsables de 99% des maux de la Terre.</p>
<ul>
<li><cite>Un Ã©vangeliste du PSR</cite></li>
</ul>
</blockquote>
<p>TroisiÃ¨me argument de choix en Go : la <strong>simplicitÃ© de parallÃ©lisation</strong>.
Personne ne viendra te dire <em>â€œÃ§a câ€™est synchrone, sry bro.â€</em> ou <em>â€œÃ§a câ€™est
asynchrone, callback it bitch.â€</em>. Tout repose sur le mot clef qui a donnÃ© son
nom au langage (ou lâ€™inverse) <code>go</code>. Tu peux te faire un <code>go myFunc()</code> et paf !
Tout ce qui est appelÃ© dans myFunc() saute sur un thread sÃ©parÃ©. Et pour gÃ©rer
la synchronicitÃ© entre plusieurs thread il y a un mÃ©canisme de canaux. Ce sont
des files FIFO (the First In is the First Out) dont la lecture est bloquante
(il existe des techniques Ã©voluÃ©es pour faire du polling, cf
<a href="http://tour.golang.org/#68">gotour#68</a>).</p>
<p>Pour finir, cerise sur le gateau, <strong>Go compile vite</strong>, extrÃªment vite, et Ã§a va
sauver ton intÃ©gritÃ© mentale sur les gros projets. Par contre câ€™est foutu pour
tes pauses cafÃ©s aux prÃ©textes douteux.</p>
<h2 id="let-s-go-nojoke-siriouz-bizness-"><a class="putainde-Title-anchor" href="#let-s-go-nojoke-siriouz-bizness-">#</a>Letâ€™s Go (#nojoke, siriouz bizness)</h2><p>On va partir du principe que tu as Go et Revel prÃªts pour la baston. On attaque
direct Ã  sec par le classique â€œrevel newâ€ puisquâ€™on va partir de la structure de
base.</p>
<pre><code class="lang-shell">$ revel <span class="hljs-keyword">new</span> github.com/OwlyCode/PutainDeProjet
</code></pre>
<p>LÃ  thÃ©oriquement, tu te retrouves avec la structure par dÃ©faut du boilerplate
revel, quelque chose comme Ã§a:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>Câ€™est lÃ  quâ€™on se met au boulot. On a de quoi faire un site complet avec Ã§a mais
 aucune trace de gestion de base de donnÃ©es lÃ  dedans. On commence donc par
 crÃ©er un dossier <code>app/modules</code> et un sous dossier <code>app/modules/mongo</code>. Câ€™est
 dans ce dossier que va se trouver notre gestionnaire de connexion Ã  mongoDB.
 En fait ce nâ€™est rien de plus quâ€™un binding entre Revel et Mgo. La technique
 utilisÃ©e pour brancher ce binding cÃ´tÃ© Revel est celle des
 <a href="http://robfig.github.io/revel/manual/interceptors.html">interceptors</a>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> mongo

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"labix.org/v2/mgo"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-comment">// Extension du controlleur.</span>
<span class="hljs-keyword">type</span> Mongo <span class="hljs-keyword">struct</span> {
    *revel.Controller
    MongoSession  *mgo.Session
    MongoDatabase *mgo.Database
}

<span class="hljs-comment">// Stockage global de la session dont la visibilitÃ© est restreinte au package.</span>
<span class="hljs-keyword">var</span> session *mgo.Session

<span class="hljs-comment">// Singleton</span>
<span class="hljs-keyword">var</span> dial sync.Once

<span class="hljs-comment">// Renvoie la session mgo en cours, si aucune n'existe, elle est crÃ©Ã©e.</span>
<span class="hljs-keyword">func</span> GetSession() *mgo.Session {

    host, _ := revel.Config.String(<span class="hljs-string">"mongo.host"</span>)

    <span class="hljs-comment">// GrÃ¢ce au package sync cette fonction n'est appelÃ©e</span>
    <span class="hljs-comment">// qu'une seule fois et de maniÃ¨re synchrone.</span>
    dial.Do(<span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">var</span> err error
        session, err = mgo.Dial(host)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
    })

    <span class="hljs-keyword">return</span> session
}

<span class="hljs-comment">// Alimente les propriÃ©tÃ©s affectÃ©es au controlleur en clonant la session mongo.</span>
<span class="hljs-keyword">func</span> (c *Mongo) Bind() revel.Result {
    <span class="hljs-comment">// Oublie pas de mettre mongo.database dans le app.conf, genre "localhost"</span>
    databaseName, _ := revel.Config.String(<span class="hljs-string">"mongo.database"</span>)

    c.MongoSession = GetSession().Clone()
    c.MongoDatabase = c.MongoSession.DB(databaseName)

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Ferme un clone</span>
<span class="hljs-keyword">func</span> (c *Mongo) Close() revel.Result {

    <span class="hljs-keyword">if</span> c.MongoSession != <span class="hljs-constant">nil</span> {
        c.MongoSession.Close()
    }

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Fonction appelÃ©e au chargement de l'application.</span>
<span class="hljs-comment">// Elle effectue un appel a notre fonction Bind avant</span>
<span class="hljs-comment">// chaque execution du controlleur.</span>
<span class="hljs-keyword">func</span> init() {
    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)
    revel.InterceptMethod((*Mongo).Close, revel.AFTER)
    <span class="hljs-comment">// On veut aussi fermer le clone si le controlleur plante.</span>
    revel.InterceptMethod((*Mongo).Close, revel.PANIC)
}
</code></pre>
<p>On a crÃ©Ã© notre connexion Ã  mongo, mais maintenant on va aussi lâ€™utiliser. Dans
le contrÃ´leur, rien de plus simple :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

type AppController struct {
    *revel.Controller
    mongo.Mongo // Le controlleur doit Ã©tendre notre type Mongo.
}

func (c *AppController) Index() revel.Result {
    usersCollection := c.MongoDatabase.C(<span class="hljs-string">"users"</span>)
    // tu peux maintenant manipuler ta mgo.Collection.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p>Mais tu peux aussi lâ€™appeler ailleurs dans le projet, par exemple dans un autre
module :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

func DoStuff(user *models.User) {
    session := mongo.GetSession()
    defer session.Close() // Oublie pas de fermer le robinet Ã  la fin!

    // tu peux maintenant manipuler ta mgo.Session.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p><strong>Câ€™est bien beau de copier coller mais â€¦</strong></p>
<p>â€¦ tu te demandes certainement pourquoi on a crÃ©Ã© un dossier <code>app/modules</code>, si
câ€™est pour nâ€™y mettre quâ€™un sous dossier mongo dedans. Et câ€™est une trÃ¨s bonne
question. En fait, notre dossier mongo reprÃ©sente un module du projet bien
dÃ©limitÃ©. A lâ€™avenir, si tu veux aussi brancher du mysql, et bien y a juste Ã 
crÃ©er <code>app/modules/mysql</code>. Rien ne change pour lâ€™existant et tu ne pollues pas
la racine de ton projet. Lâ€™autre avantage câ€™est quâ€™en un coup dâ€™oeil dans ce
dossier tu as un aperÃ§u direct des features de lâ€™application.</p>
<p>Enfin, lâ€™approche module, câ€™est aussi un gage de MVC. Admettons quâ€™on veuille
coder une application de facturation, il nous suffit de crÃ©er un dossier
<code>app/modules/invoicing</code> et de travailler dans ce dossier sur toute la partie
mÃ©tier. Comme par exemple le calcul des totaux, le calcul de la TVA etcâ€¦ GrÃ¢ce
 Ã  cette approche, on garde des contrÃ´leurs trÃ¨s fins et restreints Ã  ce que
 doit Ãªtre leur rÃ´le premier : faire communiquer le modÃ¨le et la vue.</p>
<h2 id="modeles-globaux-modeles-locaux"><a class="putainde-Title-anchor" href="#modeles-globaux-modeles-locaux">#</a>ModÃ¨les globaux, modÃ¨les locaux</h2><p>Jâ€™ai Ã©voquÃ© plus haut dans la liste des technos une feature hyper sexy de mgo :
le mapping des documents mongodb en json sur les types struct. Ce qui veut dire
quâ€™avec mgo, on peut dÃ©finir des modÃ¨les bien structurÃ©s. Certains seront
communs Ã  toute lâ€™application, par exemple un utilisateur, mais dâ€™autres seront
spÃ©cifiques Ã  un module, comme par exemple une facture.</p>
<p>Une bonne pratique est dâ€™approcher le rangement des modÃ¨les selon cette
structure:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li><strong>models</strong></li>
<li>modules<ul>
<li>invoicing<ul>
<li>engine</li>
<li><strong>models</strong></li>
</ul>
</li>
<li>mongo</li>
</ul>
</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>Le but du jeu Ã©videmment câ€™est dâ€™avoir le moins de modÃ¨les globaux possibles.
IdÃ©alement, si le dossier <code>app/models</code> nâ€™existe pas ce nâ€™est pas plus mal. Mais
attention Ã  ne pas chercher Ã  lâ€™Ã©liminer au prix de la modularitÃ© du code. Il
vaut mieux avoir un modÃ¨le explicitement dÃ©clarÃ© comme global plutot que de
lâ€™isoler dans un module et de rendre tous les autres modules du projet
dÃ©pendants de ce dernier.</p>
<p>Pourquoi câ€™est important ? Câ€™est surtout parce que Ã§a pose les bonnes questions
et amÃ¨ne les bonnes remarques. â€œVais-je avoir besoin de ce modÃ¨le rÃ©ellement
PARTOUT ?â€, â€œCâ€™est Ã©trange jâ€™ai crÃ©Ã© deux modules mais au final je passe mon
temps Ã  faire des va-et-vient de lâ€™un Ã  lâ€™autreâ€¦ Peut Ãªtre que je devrais les
fusionner.â€ ou encore â€œ90% de mon projet se trouve dans un seul module, il y a
peut Ãªtre un problÃ¨me.â€. Mais au delÃ  de Ã§a, Ã§a te permets dâ€™isoler des modules
quasi autonomes (deux ou trois coups dâ€™abstraction avec des interfaces et Ã§a
roule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les
rÃ©utiliser sur un autre (svn include pour les ancÃªtres, git submodules pour les
autres).</p>
<h2 id="pour-aller-plus-loin"><a class="putainde-Title-anchor" href="#pour-aller-plus-loin">#</a>Pour aller plus loin</h2><p>Isoler distinctement le gestionnaire de connexion, la logique mÃ©tier et les
modÃ¨les dans des modules est une premiÃ¨re Ã©tape vers une architecture propre et
Ã©volutive. Tu peux mÃªme pousser Ã§a plus loin en utilisant des interfaces comme
je lâ€™ai briÃ¨vement mentionnÃ© un peu plus tÃ´t, câ€™est mÃªme dâ€™ailleurs ce que je te
conseille. Si tu veux creuser ce sujet lÃ  tu trouveras pas mal de monde qui sâ€™y
intÃ©resse en fouinant sur le
<a href="https://groups.google.com/forum/#!forum/Golang-Nuts">groupe de discussion des utilisateurs golang</a>.
Tu as par exemple ce gars lÃ  qui a
<a href="https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ">remplacÃ© sa dÃ©pendance Ã  la librairie mgo par des interfaces</a>
pour Ã©viter dâ€™inclure le package a chaque fois et faciliter ses tests. Tu peux
envisager de faire la mÃªme chose pour dÃ©coupler tes modÃ¨les et la logique mÃ©tier
.</p>
<p>En attendant il ne me reste quâ€™Ã  te souhaiter une bonne coding night, tu as
toutes les armes nÃ©cessaires pour gÃ©rer mongo dans ton projet revel. ;-)</p>

]]></description><pubDate>Mon, 11 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</link><guid isPermaLink="true">http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</guid></item></channel></rss>