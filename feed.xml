<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title><![CDATA[Putain de code !]]></title>
        <description><![CDATA[Putain de code !]]></description>
        <link>http://putaindecode.fr</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Wed, 29 Jul 2015 17:58:40 GMT</lastBuildDate>
        <atom:link href="http://putaindecode.fr/feed.xml" rel="self" type="application/rss+xml"/>
        <language><![CDATA[fr]]></language>
        <category><![CDATA[code]]></category>
        <item>
            <title><![CDATA[Premier exemple d'utilisation de Webpack]]></title>
            <description><![CDATA[<p>Si vous √™tes int√©ress√© par
<a href="/posts/webpack" >les probl√©matiques que peut r√©soudre Webpack</a>,
vous serez s√ªrement int√©ress√© par cette petite configuration d√©taill√©e, qui vous
permettra de faire vos premiers pas avec cet outil.</p>
<p>Nous allons mettre en place une configuration assez basique qui
va permettre :</p>
<ul>
<li>d‚Äôavoir une partie JavaScript pour votre application/site web,</li>
<li>de consommer vos CSS en tant que modules,</li>
<li>de consommer les assets de vos CSS en tant que module (images, fonts‚Ä¶),</li>
<li>d‚Äôavoir un fichier JS, un fichier CSS et vos assets √† c√¥t√©.</li>
</ul>
<p><em>Note: si vous √™tes sur une application JavaScript, vous ne serez pas oblig√©
d‚Äôutiliser la partie pour l‚Äôextraction de la CSS en fichier.
En effet, Webpack consomme tout ce qui est possible en JavaScript.
Les styles peuvent √™tre introduit via des balises <code>&lt;styles&gt;</code> dynamiquement
(via le <code>style-loader</code>).
L‚Äôextraction prend du sens si vous avez un rendu serveur et que vous souhaitez
avoir des styles au plus t√¥t, via une CSS dedi√©e.</em></p>
<p>La configuration de Webpack se fait via un fichier JavaScript.
Par d√©faut, il doit √™tre nomm√© <code>webpack.config.js</code>.
Ne tournons pas autour du pot et voyons un fichier de configuration
correspondant √† ce que nous venons de d√©crire.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)
<span class="hljs-keyword">var</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack"</span>)
<span class="hljs-keyword">var</span> ExtractTextPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"extract-text-webpack-plugin"</span>)

<span class="hljs-comment">// on peut passer √† notre commande de build l'option --production</span>
<span class="hljs-comment">// on r√©cup√®re sa valeur ici en tant que bool√©en</span>
<span class="hljs-keyword">var</span> production = process.argv.indexOf(<span class="hljs-string">"--production"</span>) &gt; -<span class="hljs-number">1</span>

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-comment">// nos points d'entr√©e, par cl√©</span>
  <span class="hljs-comment">// (on peut en d√©finir plusieurs)</span>
  entry: {
    index: [
      <span class="hljs-string">"./src/index.js"</span>,
    ],
  },

  <span class="hljs-comment">// description de nos sorties</span>
  output: {
    <span class="hljs-comment">// ./dist</span>
    path: path.join(__dirname, <span class="hljs-string">"dist"</span>),
    <span class="hljs-comment">// nous aurons (vu notre point d'entr√©e)</span>
    <span class="hljs-comment">// - dist/index.js</span>
    filename: <span class="hljs-string">"[name].js"</span>,
    <span class="hljs-comment">// notre base url</span>
    publicPath: <span class="hljs-string">"/"</span>,
  },

  resolve: {
    <span class="hljs-comment">// ici, on peut ajouter nos extensions √† r√©soudre lors d'un require()</span>
    <span class="hljs-comment">// on va rester simple en n'autorisant rien, ou .js(on) (comme en nodejs et</span>
    <span class="hljs-comment">// browserify)</span>
    extensions: [
      <span class="hljs-string">""</span>,
      <span class="hljs-string">".js"</span>,
      <span class="hljs-string">".json"</span>,
    ],
  },

  <span class="hljs-built_in">module</span>: {
    <span class="hljs-comment">// liste de nos loaders</span>
    <span class="hljs-comment">// ! \\ √† noter que les loaders sont ex√©cut√©s en ordre inverse</span>
    <span class="hljs-comment">// les premiers en dernier, en utilisant la sortie du suivant</span>
    loaders: [
      {
        <span class="hljs-comment">// pour tous les fichiers qui finissent par .js</span>
        test: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-comment">// ... en prenant bien soin d'exclure les node_modules</span>
        exclude: <span class="hljs-regexp">/node_modules/</span>,

        <span class="hljs-comment">// on ajoute les loaders babel et eslint</span>
        <span class="hljs-comment">// √† vous de voir ce que vous aurez besoin</span>
        <span class="hljs-comment">// ("rien" est une option tout √† fait valable si vous codez en ES5</span>
        <span class="hljs-comment">// sans linter)</span>
        loaders: [
          <span class="hljs-string">"babel"</span>,
          <span class="hljs-string">"eslint"</span>,
        ],

        <span class="hljs-comment">// √† noter que l'on peut d√©finir les loaders de cette fa√ßon</span>
        <span class="hljs-comment">// loader: "babel!eslint",</span>

        <span class="hljs-comment">// √† noter aussi, Webpack va tenter de loader des modules ayant dans</span>
        <span class="hljs-comment">// leur nom "-loader". Si ce n'√©tait pas le cas, ou que votre loader</span>
        <span class="hljs-comment">// ne comporte pas -loader, vous pouvez sp√©cifier le nom entier :</span>
        <span class="hljs-comment">// loader: "babel-loader!eslint-loader",</span>
      },
      <span class="hljs-comment">// √† l'inverse de node et browserify, Webpack ne g√®re pas les json</span>
      <span class="hljs-comment">// nativement, il faut donc un loader pour que cela soit transparent</span>
      {
        test: <span class="hljs-regexp">/\.json$/</span>,
        loaders: [
          <span class="hljs-string">"json"</span>,
        ],
      },
      {
        <span class="hljs-comment">// pour nos CSS, on va utiliser un plugin un peu particulier</span>
        <span class="hljs-comment">// qui va nous permettre de require() nos CSS comme un module</span>
        <span class="hljs-comment">// mais qui va tout de m√™me permettre de sortir tout cela dans un seul</span>
        <span class="hljs-comment">// fichier .css pour la production</span>
        <span class="hljs-comment">// (selon un param√®tre qu'on d√©finira ci-dessous)</span>
        test: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-comment">// cette m√©thode poss√®de 2 param√®tres :</span>
        <span class="hljs-comment">// + loaders √† utiliser si ce module est d√©sactiv√©</span>
        <span class="hljs-comment">// + loaders √† utiliser dans tous les cas en amont</span>
        loader: ExtractTextPlugin.extract(
          <span class="hljs-comment">// si on extract pas, on utilisera le loader suivant</span>
          <span class="hljs-comment">// (ce module chargera les styles dans des tags &lt;style&gt;, suffisant</span>
          <span class="hljs-comment">// en mode d√©v)</span>
          <span class="hljs-comment">// en production vous devrez vous charger d'utiliser un</span>
          <span class="hljs-comment">// &lt;link rel="stylesheet" ...</span>
          <span class="hljs-string">"style"</span>,
          <span class="hljs-comment">// dans tous les cas, on utilisera cssnext ainsi que le loader CSS</span>
          <span class="hljs-comment">// de base (celui-ci permet de g√©rer les ressources dans le CSS</span>
          <span class="hljs-comment">// en temps que modules: images, font etc)</span>
          <span class="hljs-string">"css!cssnext"</span>
        ),
        <span class="hljs-comment">// Si vous n'avez pas besoin d'avoir une CSS √† part, vous pouvez</span>
        <span class="hljs-comment">// simplement supprimer la partie "loader" ci-dessus et utiliser plut√¥t</span>
        <span class="hljs-comment">// loaders: [</span>
        <span class="hljs-comment">//  "style",</span>
        <span class="hljs-comment">//  "css",</span>
        <span class="hljs-comment">//  "cssnext",</span>
        <span class="hljs-comment">// ],</span>
        <span class="hljs-comment">// √Ä noter que dans ce cas, il vous faudra supprimer le plugin</span>
        <span class="hljs-comment">// ExtractTextPlugin dans la liste plus bas</span>
      },
      <span class="hljs-comment">// pour la suite, on va rester simple :</span>
      <span class="hljs-comment">// un require() en utilisant le file-loader retournera une string avec</span>
      <span class="hljs-comment">// le nom du fichier et (le plus important) copiera le fichier suivant</span>
      <span class="hljs-comment">// le param√®tre "name" dans l'output.path que nous avons d√©fini tout</span>
      <span class="hljs-comment">// au d√©but de notre configuration.</span>
      <span class="hljs-comment">// Notez qu'il d√©gagera la partie context du nom lors du retour en string</span>
      <span class="hljs-comment">// et la remplacera par le l'output.path d√©fini pour la copie.</span>
      {
        <span class="hljs-comment">// on chargera tous les formats d'images qui nous int√©ressent en tant</span>
        <span class="hljs-comment">// que fichiers.</span>
        test: <span class="hljs-regexp">/\.(ico|jpe?g|png|gif)$/</span>,
        loaders: [
          <span class="hljs-string">"file?name=[path][name].[ext]&amp;context=./src"</span>,
          <span class="hljs-comment">// Vous remarquerez ici la m√©thode utilis√©e pour d√©finir</span>
          <span class="hljs-comment">// des options pour les loaders. Il en existe d'autres avec les</span>
          <span class="hljs-comment">// versions les plus r√©centes en utilisant la cl√© "query"</span>
        ],
      },
      {
        <span class="hljs-comment">// idem pour les fonts</span>
        test: <span class="hljs-regexp">/\.(woff|ttf|otf|eot\?#.+|svg#.+)$/</span>,
        loaders: [
          <span class="hljs-string">"file?name=[path][name].[ext]&amp;context=./src"</span>,
        ],
      },
      {
        <span class="hljs-comment">// ici on se permet de loader des fichiers html et txt tels quels</span>
        test: <span class="hljs-regexp">/\.(html|txt)$/</span>,
        loaders: [
          <span class="hljs-string">"file?name=[path][name].[ext]&amp;context=./src"</span>,
        ],
      },
    ],
  },

  <span class="hljs-comment">// en plus des loaders, qui premettent eux de modifier et/ou d'exploiter le</span>
  <span class="hljs-comment">// contenu des modules, nous avons des plugins, plus globaux au processus</span>
  plugins: (
    [
      <span class="hljs-comment">// une partie importante dans notre cas : on active l'extraction CSS (en</span>
      <span class="hljs-comment">// production seulement)</span>
      <span class="hljs-keyword">new</span> ExtractTextPlugin(<span class="hljs-string">"[name].css"</span>, {disable: !production}),

      <span class="hljs-comment">// ce plugin permet de transformer les cl√©s pass√©s en dur dans les</span>
      <span class="hljs-comment">// modules ainsi vous pourrez faire dans votre code js</span>
      <span class="hljs-comment">// if (__PROD__) { ... }</span>
      <span class="hljs-keyword">new</span> webpack.DefinePlugin({
        __PROD__: production
      }),
    ]
    <span class="hljs-comment">// en production, on peut rajouter des plugins pour optimiser</span>
    .concat(
      production
      ? [
        <span class="hljs-comment">// ici on rajoute uglify.js pour compresser nos sorties</span>
        <span class="hljs-comment">// (vous remarquerez que certain plugins sont directement livr√©s dans</span>
        <span class="hljs-comment">// le package webpack).</span>
        <span class="hljs-keyword">new</span> webpack.optimize.UglifyJsPlugin({
          compress: {
            warnings: <span class="hljs-literal">false</span>,
          },
        }),
      ]
      : []
    )
  ),

  <span class="hljs-comment">// certains modules permettent de d√©finir des options en dehors de la</span>
  <span class="hljs-comment">// d√©finition des loaders</span>
  cssnext: {
    sourcemap: !production,
    compress: production,
  },
}
</code></pre>
<p><em>Ce fichier est √† peu pr√®s ce que nous utilisons pour notre site √† l‚Äôheure o√π
est √©crit cet article.</em></p>
<p>Une fois Webpack mis en place, vous aurez bien moins l‚Äôimpression de bricoler
surtout quand il s‚Äôagit de consommer des assets de modules tiers (par exemple
Font Awesome).</p>
<p>Sachez que vous pouvez tr√®s facilement √©crire vos propres loaders pour wrapper
l‚Äôutilisation d‚Äôun outil qui n‚Äôaurait pas encore de loader.
<a href="https://github.com/cssnext/cssnext-loader/blob/master/index.js" >Exemple du loader cssnext</a>.</p>
<h2 id="utilisation">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/premier-exemple/#utilisation">#</a>
      Utilisation
    </h2><p>Il y a plusieurs fa√ßon d‚Äôutiliser maintenant notre configuration, la plus simple
√©tant surement via CLI :</p>
<pre><code class="lang-console"><span class="hljs-variable">$ </span>npm install webpack
<span class="hljs-variable">$ </span>webpack
</code></pre>
<p>Cela devrait suffire √† s‚Äôoccuper de notre configuration. Cette commande comporte
bien entendu tout un tas d‚Äôoptions qui correspondent souvent √† ce que nous
avons d√©fini juste avant.
Cela √©tant dit, il parait plus maintenable de g√©rer une fichier plut√¥t qu‚Äôune
ligne de commande de 3 km.</p>
<p>Vous devriez avoir ainsi tout le r√©sultat dans <code>dist/</code>.</p>
<p><em>Note: Si vous rencontrez des erreurs du type
<code>Error: Cannot resolve module &#39;file&#39;</code>, c‚Äôest tout simplement que vous n‚Äôavez pas
install√© les loaders n√©cessaire. En l‚Äôoccurence il faudrait installer le
<code>file-loader</code>.</em></p>
<p>Pour avoir tous les loaders n√©cessaires comme dans l‚Äôexemple ci-dessus:</p>
<pre><code class="lang-console">$ npm <span class="hljs-tag">i</span> -D babel-loader eslint-loader babel-eslint
$ npm <span class="hljs-tag">i</span> -D json-loader
$ npm <span class="hljs-tag">i</span> -D style-loader css-loader cssnext-loader
$ npm <span class="hljs-tag">i</span> -D file-loader
</code></pre>
<p><em>Note √† propos de babel et eslint: pour le moment, il vous faudra sp√©cifier dans
votre configuration eslint: <code>parser: babel-eslint</code>.</em></p>
<p>Il y a tout un tas de fa√ßon d‚Äôutiliser Webpack via une tripot√©e de plugins
(Gulp, Grunt, etc.) mais nous allons voir justement ici comment ne pas avoir
recours √† ces solutions, ce qui nous permettra ainsi de s‚Äôall√©ger.</p>
<h3 id="utilisation-en-developpment">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/premier-exemple/#utilisation-en-developpment">#</a>
      Utilisation en d√©veloppment
    </h3><p>Webpack CLI poss√®de une option <code>--watch</code> qui va surveiller les sources et mettre
√† jour tout le n√©cessaire √† la moindre modification.
√Ä la diff√©rence de browserify, cette fonctionnalit√© est dans le core et tr√®s
bien int√©gr√©.
De plus, le cache de Webpack est plut√¥t bien foutu. La premi√®re compilation peut
para√Ætre un peu lente, mais la suite est vraiment au top.</p>
<pre><code class="lang-console">$ webpack <span class="hljs-comment">--watch -d</span>
</code></pre>
<p>L‚Äôoption <code>-d</code> permet d‚Äôactiver les source maps.</p>
<p>√Ä c√¥t√© de ces options, Webpack va plus loin.</p>
<p>En d√©veloppement, nous avons besoin de servir toutes les ressources que notre
processus va g√©rer.
Plut√¥t que d‚Äôutiliser le syst√®me de fichier classique, abus√© par Grunt et tout
de m√™me utilis√© par Gulp &amp; co, Webpack fournit un <code>webpack-dev-server</code>.</p>
<p>Ce petit serveur local permettra de servir tout ce dont nous avons besoin
(nos JS, CSS, images, etc.) sans avoir recours au syst√®me de fichiers.</p>
<p>Comme pour la commande <code>webpack</code>, le serveur de d√©veloppement propose aussi
une CLI bas√©e sur l‚Äôoption <code>--watch</code> mais sans l‚Äôinconv√©nient de l‚Äô√©criture sur
disque :</p>
<pre><code class="lang-console">$ webpack-dev-server <span class="hljs-comment">--content-base dist/</span>
</code></pre>
<p><em>Source: <a href="http://webpack.github.io/docs/webpack-dev-server.html" >http://webpack.github.io/docs/webpack-dev-server.html</a></em></p>
<p>Une fois que votre serveur est d√©marr√©, pourrez tester que votre point d‚Äôentr√©e
marche avec <code>http://localhost:8080/index.js</code>.</p>
<p>Il existe bien entendu une API, que nous utilisons √† l‚Äôheure actuelle sur notre
site, afin d‚Äôajuster notre configuration Webpack en d√©veloppement, pour
d‚Äôajouter des fonctionnalit√©s comme le ‚Äúhot loading‚Äù.</p>
<p>Vous avez √† votre disposition
<a href="https://github.com/putaindecode/putaindecode.fr/blob/2c1a8f23ec05768960617625f592ea30ed6e2062/scripts/webpack-dev-server.js" >notre script dev-server</a>
(√©crit en ES6/7), ainsi que son utilisation
<a href="https://github.com/putaindecode/putaindecode.fr/blob/2c1a8f23ec05768960617625f592ea30ed6e2062/scripts/build.js#L154-L159" >dans notre build</a>.</p>
<p><em>Note : pour avoir une √©ventuelle version plus √† jour, regardez l‚Äôhistorique de
ces fichiers au cas o√π nous ayons pouss√© des ajustements (ou remplacer le hash
par ‚Äúmaster‚Äù dans l‚Äôurl et priez).</em></p>
<h4 id="hot-re-loading">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/premier-exemple/#hot-re-loading">#</a>
      Hot (re)loading
    </h4><p>Ce serveur poss√®de bien entendu des fonctionnalit√©s similaires au classique
‚Äúlivereload‚Äù, appel√© <em>hot mode</em> (ou hot loading).</p>
<p>Tout comme pour le livereload, il faut int√©grer dans sa page un script
particulier. Il y a plusieurs fa√ßons de faire :</p>
<ul>
<li>int√©grer <code>http://localhost:8080/webpack-dev-server.js</code> via un tag script</li>
<li>ajouter <code>webpack/hot/dev-server</code> dans les tableaux des points d‚Äôentr√©es</li>
</ul>
<p><em>Source: <a href="http://webpack.github.io/docs/webpack-dev-server.html#hot-mode" >http://webpack.github.io/docs/webpack-dev-server.html#hot-mode</a></em></p>
<p>Notre script dev-server r√©f√©renc√© juste avant s‚Äôoccupe d‚Äôajouter la ressource
automatiquement en mode dev.</p>
<p>√Ä la diff√©rence d‚Äôun simple livereload, ce hot loading permet des choses qu‚Äôon
aurait jusqu‚Äôalors pas vraiment imagin√©es, comme du hot reload de JavaScript de
composant React (sans rafraichissment complet de page, donc sans perte d‚Äô√©tat).</p>
<p><strong>Vous √™tes invit√© √† regarder la vid√©o que vous trouverez sur la page du
<a href="https://github.com/gaearon/react-hot-loader" >react-hot-loader</a>.</strong></p>
<p>Nous n‚Äôirons pas plus loin sur ce hot mode, car il n√©cessiterait un articl√© d√©di√©
(non pas que ce soit compliqu√© mais plus parce que c‚Äôest un sujet √† part).</p>
<h3 id="utilisation-en-production">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/premier-exemple/#utilisation-en-production">#</a>
      Utilisation en production
    </h3><pre><code class="lang-console">$ webpack <span class="hljs-comment">--production</span>
</code></pre>
<p>Notre configuration d√©tecte l‚Äôoption <code>--production</code> et ajuste d√©j√† en
cons√©quence.
Il faut √©ventuellement utiliser la variable pr√©vue pour ajuster vos loaders s‚Äôil
propose des options d‚Äôoptimisation.</p>
<p>Maintenant, il n‚Äôy aura plus qu‚Äô√† voir tout le r√©sultat dans <code>dist/</code>.</p>
<hr>
<p>Nous avons vu ici un exemple assez simple qui peut √™tre utilis√© pour un site web
ou une appplication simple.</p>
<p>Une question se pose alors :</p>
<blockquote>
<p>√Ä la vue de ce que peut g√©rer Webpack et ses loaders, est-il pertinent de
continuer √† utiliser des task runners pour nos assets et compagnie ?</p>
</blockquote>
<p><strong>La r√©ponse est non.</strong> üò±</p>
<p>Vous verrez assez rapidement que vous devriez pourvoir tout jeter √† la poubelle.
Sans trop de regrets, puisque Webpack va vous permettre de consommer tout ce que
nous avions l‚Äôhabitude de bricoler / copier / ajuster‚Ä¶</p>
<p>Nous l‚Äôavons fait pour notre site, pourquoi pas vous ?</p>
<p>Et notre interface n‚Äôas pas chang√© d‚Äôun poil puisque nous utilisons toujours les
m√™mes commandes via les
<a href="https://docs.npmjs.com/misc/scripts" >npm scripts</a>:</p>
<ul>
<li><code>npm start</code> pour d√©v</li>
<li><code>npm run build --production</code> avant de d√©ployer en production.</li>
</ul>
<p>Il existe encore beaucoup de leviers √† toucher dans le cas
d‚Äôapplications full JavaScript afin d‚Äôam√©liorer bien des points.</p>
<p>Vous trouverez facilement tout un tas de
<a href="https://duckduckgo.com/?q=webpack+boilerplate" >boilerplates Webpack</a>
avec des am√©liorations diverses et vari√©es selon vos besoins.</p>
<p>Soyez curieux !</p>
]]></description>
            <link>http://putaindecode.fr/posts/webpack/premier-exemple/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/webpack/premier-exemple/</guid>
            <pubDate>Tue, 21 Jul 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Webpack]]></title>
            <description><![CDATA[<h1 id="pourquoi-webpack">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/#pourquoi-webpack">#</a>
      Pourquoi Webpack ?
    </h1><p>Webpack a pour objectif de vous faciliter la vie, notamment en vous aidant √†
organiser <a href="/posts/js/etat-lieux-js-modulaire-front/" >votre application JS en modules</a>.
Le projet est d√©j√† tr√®s populaire, particuli√®rement dans la communaut√© React, ce qui
parait logique vu qu‚Äôil s‚Äôagit de d√©velopper des composants.</p>
<p>Webpack apporte √† ce niveau des fonctionnalit√©s int√©ressantes :</p>
<ul>
<li>disposer de toutes les ressources statiques (CSS, images, fontes) en tant que
module,</li>
<li>int√©grer et consommer des biblioth√®ques tierces tr√®s simplement en tant
que module,</li>
<li>s√©parer votre <code>build</code> en plusieurs morceaux, charg√©s √† la demande,</li>
<li>garder un chargement initial tr√®s rapide si besoin,</li>
<li>personnaliser la plupart des √©tapes du processus,</li>
<li>adapt√© pour les gros projets.</li>
</ul>
<p>Avant Webpack, nous avions beau avoir des super task-runners comme
<a href="/posts/js/premiers-pas-avec-grunt" >Grunt</a>
ou
<a href="/posts/js/introduction-gulp" >Gulp</a>,
il faut avouer qu‚Äôon bricolait quand m√™me pas mal.</p>
<p>Et vous avez s√ªrement mieux √† faire que de devoir modifier des configurations ou
des d√©finitions de t√¢ches pour ajuster les copies d‚Äôimages ou de fontes, ou
encore ajuster des URL g√©n√©r√©es.
Il y avait avec ces solutions une grande partie de rafistolage, o√π l‚Äôon se
devait de faire tr√®s attention √† la moindre r√©organisation de code, sous peine
de casser une partie du rendu.</p>
<p>Prenons par exemple une image de fond d√©clar√©e en CSS via un
<code>background: url(...)</code>.
Qui vous pr√©viendra lorsque celle-ci aura √©t√© supprim√©e ou d√©plac√©e,
et que la r√©f√©rence n‚Äôest donc plus bonne ?
Peut-√™tre vos logs de serveur web ? En recherchant les erreurs HTTP 404‚Ä¶</p>
<p>Vous avez la responsabilit√© de g√©rer vos t√¢ches et leurs r√©sultats tout en vous
assurant du bon fonctionnement car vous √™tes la glu entre tous ces morceaux.</p>
<h1 id="qu-est-ce-que-webpack">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/#qu-est-ce-que-webpack">#</a>
      Qu‚Äôest-ce que Webpack ?
    </h1><p>Pas besoin de s‚Äôappeler Einstein pour comprendre les intentions de Webpack en
interpr√©tant le nom : web + pack. Faire un pack pr√™t pour le web.</p>
<p>Nativement, Webpack s‚Äôoccupe uniquement de ressources JavaScript.
Webpack propose un syst√®me de <em>loader</em> qui permet de transformer tout et
n‚Äôimporte quoi en JavaScript (mais pas que).
Ainsi, tout est consommable en tant que module.</p>
<p>Webpack prend √† charge la fonction <code>require()</code> (connue et utilis√©e dans node.js et
browserify) et permet de d√©finir des nouveaux comportements.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> myModule = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-module.js"</span>)
<span class="hljs-comment">// "classique" pour ceux qui utilisent node.js/browserify</span>

<span class="hljs-comment">// nouveaut√© avec Webpack</span>
<span class="hljs-keyword">var</span> myStyles = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-module.css"</span>)
<span class="hljs-comment">// si vous utilisez le css-loader par exemple, toutes les directives url()</span>
<span class="hljs-comment">// se comporteront comme des require(), ainsi, vous pourrez appliquer</span>
<span class="hljs-comment">// des loaders sur tous vos assets et vous aurez des erreurs √† la compilation</span>
<span class="hljs-comment">// si une ressource est manquante.</span>

<span class="hljs-comment">// vous pourrez aussi consommer des SVG en tant que cha√Ænes (eg: raw-loader)</span>
<span class="hljs-keyword">var</span> mySVG = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-module.svg"</span>)

<span class="hljs-comment">// ou inclure des fichiers dans votre build (via file-loader)</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">"index.html"</span>)
</code></pre>
<p>C‚Äôest cette partie qui est aujourd‚Äôhui la plus int√©ressante et la plus flexible.</p>
<figure>
  <img src="http://putaindecode.fr/posts/webpack/index.jpg" alt="">
  <figcaption>
    Webpack transforme une multitude de fichiers en lots par responsabilit√©
  </figcaption>
</figure>

<p>Webpack va donc pouvoir s‚Äôoccuper aussi bien de vos modules JavaScript
(CommonJS, AMD, UMD‚Ä¶),
mais aussi de <a href="https://github.com/css-modules/css-modules" >vos modules CSS</a>,
de vos fichiers SVG, gif, png, etc. ainsi que potentiellement n‚Äôimporte quel
type de fichier pour peu que vous preniez le temps d‚Äô√©crire un <em>loader</em>
(rassurez-vous, il existe d√©j√† un loader pour tous les fichiers que vous
manipulez couramment).</p>
<p>En plus de cela, il a √©t√© pens√© afin de permettre la s√©paration de votre pack
(votre gros fichier JavaScript compil√©) en plusieurs morceaux, selon vos
besoins : vous pourrez ainsi ajuster la balance entre performance et lazy
loading.</p>
<p>Avec les solutions existantes, il est actuellement tr√®s difficile d‚Äôarriver
facilement √† ce que propose Webpack, pour ne pas dire impossible.</p>
<p>Il est possible d‚Äôavoir l‚Äô√©quivalent avec
<a href="/posts/js/browserify-all-the-things" >browserify</a> comme l‚Äôa indiqu√© son auteur
dans un article
<a href="https://gist.github.com/substack/68f8d502be42d5cd4942" >browserify for Webpack users</a>
(qui est une r√©ponse √† la ressource
<a href="https://github.com/webpack/docs/wiki/webpack-for-browserify-users" >Webpack for browserify users</a>
).</p>
<p>Il est clair que cela n‚Äôest pas aussi simple qu‚Äôavec Webpack qui est beaucoup
plus flexible de par sa conception et ses objectifs initiaux.</p>
<p>Par exemple, browserify pourra appliquer d‚Äô√©ventuelles transformations
uniquement au code local et donc pas dans <code>node_modules/*</code>.
Cela peut √™tre probl√©matique et nous conduit forc√©ment √† finir par du
bricolage si on veut consommer des assets de modules de mani√®re transparente.</p>
<p>Ne parlons pas du
<a href="http://webpack.github.io/docs/hot-module-replacement-with-webpack.html" >hot loading</a>
(remplacement de code √† la vol√©e)
qui n‚Äôest pas du tout facile √† mettre en place (pour le moment) avec
autre chose que Webpack.</p>
<h1 id="comment-integrer-webpack-dans-votre-workflow">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/#comment-integrer-webpack-dans-votre-workflow">#</a>
      Comment int√©grer Webpack dans votre workflow ?
    </h1><p>Dans un premier temps vous pourrez facilement int√©grer Webpack en remplacement de
<a href="/posts/js/browserify-all-the-things/" >browserify</a> ou d‚Äôune √©ventuelle
concat√©nation via des plugins Gulp, Grunt, etc.</p>
<p>Dans un second temps, vous pourrez tr√®s certainement remplacer une partie de vos
autres t√¢ches pour ajuster/copier/d√©placer vos assets (CSS, images‚Ä¶) et
ainsi r√©duire le code d√©di√© √† votre workflow. Il se pourrait alors que votre
utilisation d‚Äôun task-runner soit maintenant si r√©duite que vous pourriez vous
en passez en utilisant simplement
<a href="http://blog.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/" >des scripts npm</a>.</p>
<p>Si jamais vous √™tes limit√©, <a href="/posts/shell/utilitaires-ligne-commande/" >vous pourrez bien entendu cr√©er votre propre
 commande</a>, qui sera r√©utilisable dans
n‚Äôimporte quel contexte.</p>
<h1 id="webpack-en-pratique">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/webpack/#webpack-en-pratique">#</a>
      Webpack en pratique
    </h1><p>Quelques ressources pour vous y mettre :</p>
<ul>
<li>Un premier <a href="/posts/webpack/premier-exemple" >exemple d√©taill√© de configuration et d‚Äôutilisation</a>
bas√© sur notre retour d‚Äôexp√©rience.</li>
</ul>
<p>En anglais :</p>
<ul>
<li><a href="http://webpack.github.io/docs/tutorials/getting-started/" >Tutoriel officiel</a></li>
<li><a href="http://okonet.ru/viennajs-webpack-introduction/" >Slides d‚Äôintroduction</a></li>
<li><a href="https://github.com/petehunt/webpack-howto" >‚ÄúHow to‚Äù webpack</a></li>
</ul>
<p><a href="http://webpack.github.io/docs" >Webpack poss√®de une documentation</a>
assez fournie, mais pas vraiment facile √† aborder lorsqu‚Äôon d√©couvre le projet.
Aussi, n‚Äôh√©sitez pas √† nous poser vos questions en commentaires.</p>
]]></description>
            <link>http://putaindecode.fr/posts/webpack/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/webpack/</guid>
            <pubDate>Mon, 20 Jul 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Les Dockerfiles]]></title>
            <description><![CDATA[<p>Dans <a href="/posts/docker/introduction-a-docker" >l‚Äôarticle pr√©c√©dent</a>, je vous ai
pr√©sent√© le fonctionnement de base de Docker. Mais cela vous limitait √†
l‚Äôusage des images que vous pouviez trouver sur le <a href="https://registry.hub.docker.com/" >Docker
Hub</a>. Afin de vraiment pouvoir utiliser
Docker au maximum, il serait appr√©ciable de pouvoir cr√©er des images adapt√©es √†
nos projets et c‚Äôest l√† l‚Äôutilit√© des Dockerfiles.</p>
<h1 id="les-dockerfiles">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/les-dockerfiles/#les-dockerfiles">#</a>
      Les Dockerfiles
    </h1><p>Les Dockerfiles sont des fichiers qui permettent de construire une image Docker
adapt√©e √† nos besoins, √©tape par √©tape. Rentrons dans le vif du sujet en cr√©ant
une image permettant de lancer un projet JavaScript.</p>
<p>Pour commencer, cr√©ez un nouveau fichier <code>Dockerfile</code> √† la racine de votre
projet.</p>
<p>La premi√®re chose √† faire dans un Dockerfile est de d√©finir de quelle image
vous h√©ritez. Pour cet exemple, je vous propose d‚Äôutiliser une image de Debian
comme base (ce qui est une bonne pratique, car cette image
est plut√¥t l√©g√®re en comparaison avec celle d‚ÄôUbuntu par exemple).</p>
<pre><code><span class="hljs-tag">FROM</span> <span class="hljs-rule"><span class="hljs-attribute">debian</span>:<span class="hljs-value">jessie</span></span>
</code></pre><p><code>FROM</code> permet de d√©finir notre image de base, vous pouvez l‚Äôutiliser uniquement
une fois dans un Dockerfile.</p>
<p>Comme nous voulons cr√©er une image pour une application JavaScript full-stack,
nous devons commencer par installer Node.js. Pour ce faire, on va t√©l√©charger
l‚Äôarchive Node.js directement depuis le site officiel √† l‚Äôaide de curl que nous
allons aussi devoir installer.</p>
<pre><code><span class="hljs-built_in">RUN</span> <span class="bash">apt-get update \
&amp;&amp; apt-get install -y curl \
&amp;&amp; rm -rf /var/lib/apt/lists/*
</span>
<span class="hljs-built_in">RUN</span> <span class="bash">curl -LO <span class="hljs-string">"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz"</span> \
&amp;&amp; tar -xzf node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz -C /usr/<span class="hljs-built_in">local</span> --strip-components=<span class="hljs-number">1</span> \
&amp;&amp; rm node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz</span>
</code></pre><p><code>RUN</code> permet d‚Äôex√©cuter une commande √† l‚Äôint√©rieur de votre image comme si vous
√©tiez devant un shell unix. </p>
<p>La premi√®re commande nous permet d‚Äôinstaller curl et de nettoyer ensuite le
gestionnaire de paquets afin que notre image soit un peu plus l√©g√®re.</p>
<p>Avec la deuxi√®me commande, nous t√©l√©chargeons le binaire de Node.js que nous
installons ensuite √† √ßa place, et on n‚Äôoublie pas de supprimer l‚Äôarchive
ensuite.</p>
<p>Vous pouvez vous demander pourquoi j‚Äôex√©cute plusieurs commandes sur une m√™me
instruction <code>RUN</code> ? Eh bien, cela permet simplement de limiter le nombre
d‚Äôinstructions dans votre Dockerfile ce qui rendra votre image finale plus
l√©g√®re.</p>
<p>Maintenant, nous allons ajouter les sources de notre projet dans l‚Äôimage et
t√©l√©charger nos d√©pendances.</p>
<pre><code><span class="hljs-built_in">ADD</span> <span class="bash">package.json /app/
</span>
<span class="hljs-built_in">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-built_in">RUN</span> <span class="bash">npm install
</span>
<span class="hljs-built_in">ADD</span> <span class="bash">. /app/</span>
</code></pre><p><code>ADD</code> permet d‚Äôajouter des fichiers locaux ou distants √† l‚Äôint√©rieur de votre
image, il est le plus souvent utilis√© pour importer les sources de votre projet
ou des fichiers de configuration.</p>
<p><code>WORKDIR</code> permet de changer le r√©pertoire courant de votre image, toutes les
commandes qui suivront seront ex√©cut√©es √† partir de ce r√©pertoire.</p>
<p>Avec la derni√®re instruction, nous ajoutons les sources de notre projet √†
l‚Äôint√©rieur de l‚Äôimage, mais vous allez vous demander pourquoi nous ne l‚Äôavons
pas fait en m√™me temps que l‚Äôajout des fichiers de d√©pendances. Eh bien, cela
nous permet d‚Äô√©conomiser beaucoup de temps ! </p>
<p>Quand Docker cr√©e une nouvelle image √† partir d‚Äôun Dockerfile, il ex√©cute chaque
instruction dans un conteneur, et le r√©sultat de cette instruction est
sauvegard√© sous forme de couche. Au final, une image est un assemblage de
plusieurs couches (une par instruction). Et donc, quand vous reconstruisez une
image pour la seconde fois, les instructions qui n‚Äôimpliquent pas de changements
ne sont pas r√©ex√©cut√©es, car la couche est r√©cup√©r√©e depuis l‚Äôimage pr√©c√©dente. Par
contre, si l‚Äôinstruction implique un changement quelconque, elle est r√©ex√©cut√©e
ainsi que toutes les instructions suivantes.</p>
<p>Dans notre cas, les sources auront tendance √† beaucoup changer, et donc ne pas
ret√©l√©charger les d√©pendances √† chaque changement dans le code est un r√©el gain
de temps !</p>
<p>Maintenant, nous allons indiquer quel port et dossier nous souhaitons partager
avec l‚Äôext√©rieur du conteneur.</p>
<pre><code>EXPOSE 3000

<span class="hljs-title">VOLUME /app/log</span>
</code></pre><p><code>EXPOSE</code> et <code>VOLUME</code> permettent respectivement d‚Äôindiquer quel port et quel
dossier nous souhaitons partager.</p>
<p>Et pour finir, nous pouvons indiquer quelle instruction doit s‚Äôex√©cuter au
lancement de votre conteneur gr√¢ce √† l‚Äôinstruction <code>CMD</code>.</p>
<pre><code><span class="hljs-built_in">CMD</span> <span class="bash">node server.js</span>
</code></pre><p>Voici un r√©sum√© de notre Dockerfile :</p>
<pre><code><span class="hljs-comment"># Image de base</span>
<span class="hljs-built_in">FROM</span> debian:jessie

<span class="hljs-comment"># Installation de curl avec apt-get</span>
<span class="hljs-built_in">RUN</span> <span class="bash">apt-get update \
&amp;&amp; apt-get install -y curl \
&amp;&amp; rm -rf /var/lib/apt/lists/*
</span>
<span class="hljs-comment"># Installation de Node.js √† partir du site officiel</span>
<span class="hljs-built_in">RUN</span> <span class="bash">curl -LO <span class="hljs-string">"https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz"</span> \
&amp;&amp; tar -xzf node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz -C /usr/<span class="hljs-built_in">local</span> --strip-components=<span class="hljs-number">1</span> \
&amp;&amp; rm node-v0.<span class="hljs-number">12.5</span>-linux-x64.tar.gz
</span>
<span class="hljs-comment"># Ajout du fichier de d√©pendances package.json </span>
<span class="hljs-built_in">ADD</span> <span class="bash">package.json /app/
</span>
<span class="hljs-comment"># Changement du repertoire courant</span>
<span class="hljs-built_in">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-comment"># Installation des d√©pendances</span>
<span class="hljs-built_in">RUN</span> <span class="bash">npm install
</span>
<span class="hljs-comment"># Ajout des sources</span>
<span class="hljs-built_in">ADD</span> <span class="bash">. /app/
</span>
<span class="hljs-comment"># On expose le port 3000</span>
<span class="hljs-built_in">EXPOSE</span> <span class="hljs-number">3000</span>

<span class="hljs-comment"># On partage un dossier de log</span>
<span class="hljs-built_in">VOLUME</span> <span class="bash">/app/<span class="hljs-built_in">log</span>
</span>
<span class="hljs-comment"># On lance le serveur quand on d√©marre le conteneur</span>
<span class="hljs-built_in">CMD</span> <span class="bash">node server.js</span>
</code></pre><p>Avant de transformer ce Dockerfile en une image, vous devez cr√©er un fichier de
plus, le <code>.dockerignore</code>, ce fichier permet comme un <code>.gitignore</code> de ne pas
inclure certain fichiers dans votre image Docker, et c‚Äôest tr√®s important afin
d‚Äô√©viter d‚Äôinclure les d√©pendances de votre projet dans votre image
(<code>node_modules</code> dans notre cas) qui sont propres √† votre
syst√®me, mais pas au syst√®me du conteneur. Voici √† quoi votre <code>.dockerignore</code>
doit ressembler :</p>
<pre><code><span class="hljs-tag">node_modules</span>
<span class="hljs-class">.git</span>
</code></pre><p>Pour transformer ce Dockerfile en une image Docker, vous devez utiliser cette
commande :</p>
<pre><code class="lang-console">$ docker build -t fullstack-js .
Sending build context to Docker daemon 4.381 MB
Sending build context to Docker daemon
Step 0 : FROM debian:jessie
 -<span class="ruby">--&gt; bf84c1d84a8f
</span>Step 1 : RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">93258459</span>a279
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">4</span>fffcf3749a2
</span>Removing intermediate container 93258459a279
Step 2 : RUN curl -LO "https://nodejs.org/dist/v0.12.5/node-v0.12.5-linux-x64.tar.gz" &amp;&amp; tar -xzf node-v0.12.5-linux-x64.tar.gz -C /usr/local --strip-components=1 &amp;&amp; rm node-v0.12.5-linux-x64.tar.gz
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> a3a17d584bae
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">4</span>eaa62ace8de
</span>Removing intermediate container a3a17d584bae
Step 3 : ADD *.json /app/
 -<span class="ruby">--&gt; <span class="hljs-number">1</span>e8ffd7e10a8
</span>Removing intermediate container 5db20e8b8ed2
Step 4 : WORKDIR /app
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">7</span>b84b06642b1
</span> -<span class="ruby">--&gt; <span class="hljs-number">9</span>c0e2287c34d
</span>Removing intermediate container 7b84b06642b1
Step 5 : RUN npm install
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0523</span>df6e9aac
</span>...
 -<span class="ruby">--&gt; <span class="hljs-number">6</span>d7327ebee3<span class="hljs-number">0</span>
</span>Removing intermediate container 0523df6e9aac
Step 6 : ADD . /app
 -<span class="ruby">--&gt; <span class="hljs-number">13</span>bdbe70c6fa
</span>Removing intermediate container 3c83d82c1d53
Step 7 : EXPOSE 3000
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">51</span>e252173b12
</span> -<span class="ruby">--&gt; <span class="hljs-number">6</span>c62eb1197e2
</span>Removing intermediate container 51e252173b12
Step 8 : VOLUME /app/log
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">4</span>af0bb73307b
</span> -<span class="ruby">--&gt; <span class="hljs-number">15</span>b6190de473
</span>Removing intermediate container 4af0bb73307b
Step 9 : CMD node server.js
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">9522</span>c6b9bf95
</span> -<span class="ruby">--&gt; aaf20fb25dac
</span>Removing intermediate container 9522c6b9bf95
Successfully built aaf20fb25dac
</code></pre>
<p>L‚Äôoption <code>-t</code> permet de nommer votre image docker, ce qui vous servira lorsque
vous voudrez lancer votre conteneur. Et le <code>.</code> est le repertoire o√π se trouve
le Dockerfile, dans notre cas le dossier courant.</p>
<p>Maintenant, vous pouvez lancer votre conteneur de cette mani√®re :</p>
<pre><code class="lang-console">$ docker <span class="hljs-keyword">run</span> -<span class="hljs-keyword">d</span> -p 3000:3000 -v $(<span class="hljs-keyword">pwd</span>)/<span class="hljs-keyword">log</span>:/<span class="hljs-keyword">app</span>/<span class="hljs-keyword">log</span> fullstack-js
</code></pre>
<p>Cette commande permet de lancer notre image en partageant le port et un dossier
avec votre ordinateur, si vous voulez plus de d√©tails sur le fonctionnement du
client Docker, je vous invite √† lire mon <a href="/posts/docker/introduction-a-docker" >article
pr√©c√©dent</a>.</p>
<hr>
<p>Dans cet article, vous avez pu voir comment cr√©er votre propre Dockerfile,
maintenant vous pouvez cr√©er des images Docker parfaitement adapt√©es √† votre
projet, et m√™me plus. En cherchant sur Internet, vous pourrez trouver des images
Docker pour tout et n‚Äôimporte quoi, comme des images pour lancer Chrome dans un
conteneur par exemple. Pour en savoir plus, je vous redirige vers le
blog de <a href="https://blog.jessfraz.com/post/docker-containers-on-the-desktop/" >Jessie
Frazelle</a>.</p>
<p>Dans le prochain article, je vous parlerai de docker-compose, un outil qui
permet de lancer des applications multi-conteneurs facilement.</p>
]]></description>
            <link>http://putaindecode.fr/posts/docker/les-dockerfiles/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/docker/les-dockerfiles/</guid>
            <pubDate>Thu, 02 Jul 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[SemVer, c'est quoi ?]]></title>
            <description><![CDATA[<p>_Ce post a √©t√© largement inspir√© de la mauvaise exp√©rience que j‚Äôai pu avoir
avec l‚Äô√©volution de <a href="http://backbonejs.org/" >Backbone.js</a> qui, ne respectant pas SemVer, m‚Äôa pos√© des
probl√®mes lors de mise √† jour de versions. Les node<em>modules (d√©pendances de
d√©pendances) sont aussi en question.</em></p>
<p>Depuis quelques temps, vous devez entendre le terme <strong>SemVer</strong> par-ci par-l√†
mais peut-√™tre que vous ne savez pas ce que c‚Äôest ou que vous ne savez pas
comment l‚Äôappliquer. Et je vous comprends, j‚Äôai mis un peu de temps √† maitriser
le sujet.</p>
<p>Pour faire simple, <strong>SemVer</strong> (voulant dire <em>Semantic Versioning</em>) est une
gestion s√©mantique des versions. En d‚Äôautres termes, une fa√ßon de num√©roter les
versions de mani√®re logique, coh√©rente, parlante, ayant du sens. Ce n‚Äôest
cependant pas forc√©ment une norme, vous n‚Äô√™tes pas oblig√©(e) de la respecter
mais ce serait vraiment, vraiment dommage car il tend justement √† l‚Äô√™tre.</p>
<p>Mais tout d‚Äôabord, posons les bases, qu‚Äôest-ce qu‚Äôune version ?</p>
<p>Une version s‚Äôapplique √† un produit, une application, une biblioth√®que, un OS,
tout ce qui a une progression en informatique. Cela permet de d√©finir
l‚Äôavancement du produit. La majorit√© du temps (sauf pour quelques h√©r√©tiques),
cela s‚Äô√©crit de cette fa√ßon : <code>X.Y.Z</code> o√π <code>X</code>, <code>Y</code> et <code>Z</code> sont des entiers (pas
forc√©ment des chiffres d‚Äôailleurs, cela peut √™tre sup√©rieur √† 9) soit <code>1.0.10</code>
par exemple. Il est possible que vous voyiez cette forme <code>vX.Y.Z</code> comme <code>v1.0.10</code>
mais en toute franchise, je ne l‚Äôappr√©cie pas. J‚Äôaime que mon tag √©quivaille √†
ma version en elle-m√™me. Purement personnel.</p>
<p>Maintenant que nous savons ce qu‚Äôest une version, voyons voir ce qu‚Äôest
r√©ellement <strong>SemVer</strong>.</p>
<p><strong>SemVer</strong> est un moyen coh√©rent, pertinent de nommer ses versions afin de
savoir rapidement quelles modifications ont √©t√© apport√©es √† votre projet.</p>
<p>Voyons voir ce que dit la documentation officielle de
<a href="http://semver.org/lang/fr/" >SemVer</a></p>
<blockquote>
<p>√âtant donn√© un num√©ro de version MAJEUR.MINEUR.CORRECTIF, il faut incr√©menter :</p>
<p>le num√©ro de version MAJEUR quand il y a des changements
r√©tro-incompatibles,<br>
le num√©ro de version MINEUR quand il y a des changements r√©tro-compatibles,<br>
le num√©ro de version de CORRECTIF quand il y a des corrections d‚Äôanomalies
r√©tro-compatibles</p>
<p>Des libell√©s suppl√©mentaires peuvent √™tre ajout√©s pour les versions de
pr√©-livraison et pour des m√©ta-donn√©es de construction sous forme d‚Äôextension du
format MAJEURE.MINEURE.CORRECTIF.</p>
</blockquote>
<p>On comprend effectivement l‚Äôid√©e de <strong>SemVer</strong> (et la suite du site explique
comment l‚Äôappliquer) mais je trouve que l‚Äôon peut mieux expliquer.</p>
<p>Pour comprendre <strong>SemVer</strong>, il faut se mettre dans la peau de l‚Äôutilisateur qui
va se servir de votre production.</p>
<p>En effet, <strong>SemVer</strong> est un contrat que vous signez avec vos utilisateurs, une
forme de respect qui leur permet d‚Äôadapter leur code ou non en fonction des
versions que vous proposez.</p>
<p>Si je devais d√©finir √† quelqu‚Äôun ce qu‚Äôest <strong>SemVer</strong>, je lui dirais ceci :</p>
<blockquote>
<p>SemVer s‚Äô√©crit de cette fa√ßon : <code>X.Y.Z</code> o√π <code>X</code> est ‚Äúmajeur‚Äù, <code>Y</code> est ‚Äúmineur‚Äù,
<code>Z</code> est ‚Äúpatch‚Äù.</p>
<p>Qu‚Äôest-ce que cela veut dire. Cela veut dire que si vous avez corrig√© un bug
dans votre lib et que cela n‚Äôaffecte en rien le code √©crit par votre
utilisateur, alors incr√©mentez <code>Z</code> (+0.0.1).</p>
<p>Si vous avez fait des ajouts dans votre app qui peuvent √™tre int√©ressants pour
l‚Äôutilisateur et m√©rite une certaine attention afin d‚Äôam√©liorer le code qui
utilise votre lib, alors incr√©mentez <code>Y</code> (+0.1.0).</p>
<p>Si en revanche, vous avez cass√© ne serait-ce qu‚Äôune partie de l‚ÄôAPI (‚Äúbreaking
changes‚Äù), que vous avez <em>juste</em> chang√© des noms de m√©thodes / fonctions d√©j√†
existantes (et donc s√ªrement utilis√©es par quelqu‚Äôun d‚Äôautre), que finalement
cela n√©cessite <strong>forc√©ment</strong> une modification de la part de l‚Äôutilisateur sous
peine que sa propre app ne fonctionne plus, alors incr√©mentez <code>X</code> (+1.0.0).</p>
</blockquote>
<p>C‚Äôest vraiment une question de respect envers qui vous proposez votre lib. Par
<strong>SemVer</strong>, je vous informe des potentielles modifications ou lectures de
documentation que vous devez faire. Il ne faut vraiment pas voir √ßa comme une
√©volution de votre propre code.</p>
<p>Par exemple, vous avez refactoris√© tout votre code mais l‚ÄôAPI n‚Äôa pas chang√©.
Alors <code>Z</code> suffit. Et si vous avez ajoutez des m√©thodes, c‚Äôest plut√¥t <code>Y</code>.
Pourtant il y a eu une quantit√© ph√©nom√©nale de code modifi√©. Des lignes et des
lignes. Est-ce pour autant que vous devez incr√©mentez <code>X</code> ? Non. Surtout lorsque
les tests automatis√©s n‚Äôont pas √©t√© modifi√©s et passent toujours.</p>
<p>En revanche, vous ne faites qu‚Äôune petite modification de nom de m√©thode qui ne
vous semble pas appropri√©e, √ßa ne vous prend qu‚Äôune ligne de modification, vous
pourriez croire que c‚Äôest uniquement <code>Z</code> √† changer ? Non plus. L√†, vous modifiez
le contrat que l‚Äôutilisateur a acquiesc√© en utilisant votre lib ; vous avez
alors la responsabilit√© de lui indiquer que son code doit absolument changer
sinon celui-ci ne marchera plus correctement.</p>
<p>En bref, ne voyez pas l‚Äô√©volution de votre projet avec <strong>SemVer</strong> mais le
contrat que vous signez implicitement avec vos utilisateurs.</p>
<p>Oh et oui, surtout, surtout, ce n‚Äôest pas parce que vous √™tes arriv√©(e) √† <code>9</code>
dans <code>Y</code> ou <code>Z</code> que le nombre le pr√©c√©dant doit augmenter. Par exemple <em>mineur</em>
sur <code>1.9.0</code> ? Alors <code>1.10.0</code> et non <code>2.0.0</code>.</p>
<p>J‚Äôesp√®re qu‚Äôavec ceci, vous vous sentirez plus √† l‚Äôaise.</p>
<h2 id="tips-npm">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/env/semver-c-est-quoi/#tips-npm">#</a>
      Tips npm
    </h2><p>Avec npm, il est possible de mettre √† jour rapidement son <code>package.json</code> et tag
git en utilisant la commande <code>$ npm version</code>. Comme ceci :</p>
<pre><code class="lang-console">$ npm version (major|<span class="hljs-string">minor</span>|<span class="hljs-string">patch)</span>
</code></pre>
<p>Cela vous incr√©mentera le <code>package.json</code>  et vous fera un beau commit + tag dans
git tel que :</p>
<pre><code class="lang-console">* b474d9c (HEAD -&gt; master, tag: <span class="hljs-number">1.5</span><span class="hljs-number">.3</span>, origin/master) <span class="hljs-number">1.5</span><span class="hljs-number">.3</span>`.
</code></pre>
<p>Et pour √©viter d‚Äôavoir le ‚Äúv‚Äù dans les tags git qui est par d√©faut dans npm,
faites :</p>
<pre><code class="lang-console">$ npm config <span class="hljs-keyword">set</span> <span class="hljs-keyword">tag</span>-<span class="hljs-keyword">version</span>-prefix <span class="hljs-string">""</span>
</code></pre>
<h2 id="changelog">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/env/semver-c-est-quoi/#changelog">#</a>
      Changelog
    </h2><p><strong>SemVer</strong> va de pair avec les <a href="http://keepachangelog.com/" >changelog</a>. Mettre √†
jour le changelog vous permet d‚Äôindiquer tr√®s rapidement ce qui a √©t√© modifi√©
sans que l‚Äôutilisateur ait forc√©ment √† regarder votre code. Il est surtout tr√®s
important lors d‚Äôajouts de fonctionnalit√©s ou de modifications (majeures et
mineures) afin de voir directement les m√©thodes / fonctions affect√©es mais aussi
dans le cas d‚Äôun patch de voir le gain obtenu de cette nouvelle mise √† jour. √Ä
ajouter directement dans le <code>README.md</code> √† la fin ou carr√©ment dans un fichier ou
des fichiers d√©di√©s √† √ßa.
Voici un <a href="https://github.com/cssnext/cssnext/blob/master/CHANGELOG.md" >exemple</a>.</p>
<hr>
<p>Stay safe, use <strong>SemVer</strong>.</p>
<p>Ressources :</p>
<ul>
<li><a href="http://semver.org/" >site officiel</a></li>
<li><a href="http://semver-ftw.org/" >semver-ftw</a></li>
</ul>
]]></description>
            <link>http://putaindecode.fr/posts/env/semver-c-est-quoi/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/env/semver-c-est-quoi/</guid>
            <pubDate>Tue, 16 Jun 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Introduction √† Docker]]></title>
            <description><![CDATA[<p>Avant de vous parler de Docker je vais vous raconter une histoire que tout
d√©veloppeur a v√©cu au moins une fois.</p>
<p>Il √©tait une fois un jeune d√©veloppeur qui codait tranquillement sur son
ordinateur. Il √©tait press√© car comme tout √©tudiant qui se
respecte il devait pr√©senter son travail le lendemain matin. Apr√®s des heures de
travail, l‚Äôapplication √©tait l√†, et elle fonctionnait √† merveille ! Le
lendemain, notre codeur arriva tout fier pour sa pr√©sentation, avec son projet
sur une cl√© usb. Il le transf√®re sur l‚Äôordinateur de son pote et l√†, √ßa
ne fonctionne pas !</p>
<h2 id="quel-est-le-probleme">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#quel-est-le-probleme">#</a>
      Quel est le probl√®me ?
    </h2><p>L‚Äôapplication de notre jeune d√©veloppeur ne fonctionne pas sur l‚Äôordinateur de son ami √† cause d‚Äôun probl√®me d‚Äôenvironnement. Entre deux syst√®mes, il
peut y avoir des diff√©rences de version sur les d√©pendances ou encore des
biblioth√®ques manquantes.</p>
<p>Ici, notre probl√®me se limite √† 2 syst√®mes, mais imaginez une √©quipe de 10
personnes avec des ordinateurs sous OS X, Linux ou m√™me Windows, un serveur de
test sous Ubuntu 12.04, et un serveur de production sous CentOS 7.
S‚Äôassurer que leur application fonctionne bien sur tous ces environnements peut
s‚Äôav√©rer √™tre un vrai cauchemar !</p>
<p>Mais il existe des solutions et parmi l‚Äôune d‚Äôentre elles nous avons‚Ä¶</p>
<h2 id="docker">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#docker">#</a>
      Docker
    </h2><h3 id="c-est-quoi-docker">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#c-est-quoi-docker">#</a>
      C‚Äôest quoi Docker ?
    </h3><p>Docker est une plateforme qui va vous permettre d‚Äôex√©cuter votre code √†
l‚Äôint√©rieur d‚Äôun conteneur ind√©pendamment de la machine sur laquelle vous √™tes !
Un conteneur ressemble √† une machine virtuelle sauf qu‚Äôil n‚Äôembarque pas tout un
syst√®me d‚Äôexploitation avec lui ce qui lui permet de s‚Äôex√©cuter en quelque
secondes et d‚Äô√™tre beaucoup plus l√©ger.</p>
<p>Docker peut donc r√©soudre notre probl√®me d‚Äôenvironnement, car quelle que soit la
machine que nous utiliserons, le code s‚Äôex√©cutera de la m√™me mani√®re.</p>
<p>La plateforme Docker est compos√©e de deux √©l√©ments :</p>
<ul>
<li>Le d√©mon Docker qui s‚Äôex√©cute en arri√®re-plan et qui s‚Äôoccupe de g√©rer vos
conteneurs</li>
<li>Le client Docker qui vous permet d‚Äôinteragir avec le d√©mon par l‚Äôinterm√©diaire
d‚Äôun outil en ligne de commande</li>
</ul>
<p>Si vous voulez plus d‚Äôinformations sur le fonctionnement interne de Docker je
vous redirige vers l‚Äôarticle du site officiel : <a href="https://docs.docker.com/introduction/understanding-docker" >Understanding
Docker</a></p>
<h3 id="comment-l-installer">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#comment-l-installer">#</a>
      Comment l‚Äôinstaller ?
    </h3><p>Le client Docker fonctionne sur tous les syst√®mes d‚Äôexploitation. En revanche,
le d√©mon Docker utilise des fonctionnalit√©s du noyau Linux afin de g√©rer
les conteneurs. Il ne fonctionne donc que sur Linux. Heureusement la majorit√© des
serveurs utilise Linux, et pour vos ordinateurs sous OS X, ou m√™me Windows, il
existe une solution.</p>
<p>Si vous utilisez une machine avec une distribution Linux vous pourrez lancer le
d√©mon Docker directement sur cette derni√®re, par contre avec Windows ou OS X
vous devrez lancer le d√©mon dans une machine virtuelle, mais rassurez-vous,
c‚Äôest tr√®s simple !</p>
<p>Pour le guide d‚Äôinstallation de Docker en fonction de votre syst√®me je vous
redirige de nouveau vers le site officiel : <a href="https://docs.docker.com/installation/#installation" >Guide
d‚Äôinstallation</a></p>
<h3 id="un-premier-exemple">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#un-premier-exemple">#</a>
      Un premier exemple
    </h3><p>Avant de commencer, vous allez devoir t√©l√©charger une image Docker qui servira
de base √† vos prochains conteneurs.</p>
<p>Pour cet exemple, on va partir d‚Äôune image Ubuntu :</p>
<pre><code class="lang-console">$ docker pull <span class="hljs-string">ubuntu:</span>trusty
<span class="hljs-string">trusty:</span> Pulling from ubuntu
<span class="hljs-string">e9e06b06e14c:</span> Pull complete
<span class="hljs-string">a82efea989f9:</span> Pull complete
<span class="hljs-number">37</span><span class="hljs-string">bea4ee0c81:</span> Pull complete
<span class="hljs-number">07</span><span class="hljs-string">f8e8c5e660:</span> Already exists
<span class="hljs-string">ubuntu:</span><span class="hljs-string">trusty:</span> The image you are pulling has been verified. <span class="hljs-string">Important:</span> image verification is a tech preview feature and should not be relied on to provide security.
<span class="hljs-string">Digest:</span> <span class="hljs-string">sha256:</span><span class="hljs-number">014</span>fa1d5b72b4fe0ec2b4642610fbbfdd52f502da8e14e80de07bd1dd774e4ef
<span class="hljs-string">Status:</span> Downloaded newer image <span class="hljs-keyword">for</span> <span class="hljs-string">ubuntu:</span>trusty
</code></pre>
<p>Cette commande va t√©l√©charger depuis le Docker Hub l‚Äôimage de la version 14.04
(trusty) d‚ÄôUbuntu. Il existe bien d‚Äôautres images que vous pourrez trouver
<a href="https://registry.hub.docker.com" >sur le registry Docker</a>.</p>
<p>Pour voir les images que vous avez t√©l√©charg√©es, utilisez cette commande :</p>
<pre><code class="lang-console">$ docker images
REPOSITORY    TAG       IMAGE ID        CREATED       VIRTUAL SIZE
ubuntu        trusty    <span class="hljs-number">07f</span>8e8c5e660    <span class="hljs-number">4</span> weeks ago   <span class="hljs-number">188.3</span> MB
</code></pre>
<p>Sur ma machine, l‚Äôimage d‚ÄôUbuntu fais 188.3 MB, je vous avais dit que c‚Äô√©tait
l√©ger en comparaison √† une machine virtuelle !</p>
<p>Maintenant, nous allons lancer un conteneur et rentrer √† l‚Äôint√©rieur :</p>
<pre><code class="lang-console"><span class="hljs-variable">$ </span>docker run -it <span class="hljs-symbol">ubuntu:</span>trusty bash
root<span class="hljs-variable">@2cdceb5ff771</span><span class="hljs-symbol">:/</span><span class="hljs-comment">#</span>
</code></pre>
<p>Cette commande cr√©e un conteneur √† partir de l‚Äôimage <code>ubuntu:trusty</code>, y lance le
programme <code>bash</code> et y attache votre shell gr√¢ce aux options <code>-it</code></p>
<p>Vous pouvez maintenant ex√©cuter les commandes que vous voulez, elle
s‚Äôex√©cuteront √† l‚Äôint√©rieur du conteneur, par exemple :</p>
<pre><code class="lang-console">root@<span class="hljs-number">2</span>cdceb5ff771:/<span class="hljs-comment">#</span>
$ apt-<span class="hljs-keyword">get</span> moo
                 (__)
                 (oo)
           /<span class="hljs-comment">------\/</span>
          / |    ||
         *  /\<span class="hljs-comment">---/\</span>
            ~~   ~~
...<span class="hljs-string">"Have you mooed today?"</span>...
</code></pre>
<p>Vous pouvez quitter le conteneur en faisant un <code>Ctrl-d</code></p>
<p>Maintenant que vous √™tes retourn√© sur votre machine, vous pouvez afficher la
liste des conteneurs lanc√©s avec cette commande :</p>
<pre><code class="lang-console"><span class="hljs-variable">$ </span>docker ps
<span class="hljs-constant">CONTAINER ID </span>   <span class="hljs-constant">IMAGE </span>  <span class="hljs-constant">COMMAND </span>  <span class="hljs-constant">CREATED </span>  <span class="hljs-constant">STATUS </span>   <span class="hljs-constant">PORTS </span>  <span class="hljs-constant">NAMES</span>
</code></pre>
<p>Il n‚Äôy a rien ? C‚Äôest normal ! En quittant le conteneur ce dernier s‚Äôest arr√™t√©
aussi. Pour l‚Äôafficher quand m√™me, il suffit d‚Äôentrer cette commande :</p>
<pre><code class="lang-console">$ docker ps -a
CONTAINER ID    IMAGE           COMMAND   CREATED         STATUS                    PORTS   NAMES
<span class="hljs-number">2</span>cdceb5ff771    ubuntu:trusty   <span class="hljs-string">"bash"</span>    <span class="hljs-number">12</span> <span class="hljs-function">minutes ago  <span class="hljs-title">Exited</span> <span class="hljs-params">(<span class="hljs-number">0</span>)</span> 2 minutes ago          loving_newton</span>
</code></pre>
<p>Et pour supprimer ce conteneur ?</p>
<pre><code class="lang-console">$ docker rm <span class="hljs-number">2</span>cdc
<span class="hljs-number">2</span>cdc
</code></pre>
<p>√âvidemment, remplacez ‚Äò2cdc‚Äô par le <code>CONTAINER ID</code> appropri√©.</p>
<p>Passons maintenant √† un deuxi√®me exemple plus concret avec une application web.</p>
<h2 id="un-deuxieme-exemple-avec-node-js">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/docker/introduction-a-docker/#un-deuxieme-exemple-avec-node-js">#</a>
      Un deuxi√®me exemple avec Node.js
    </h2><p>Pour commencer, vous allez r√©cup√©rer l‚Äôimage docker officiel de Node.js en
faisant :</p>
<pre><code class="lang-console">$ docker pull node:<span class="hljs-operator">0.<span class="hljs-number">12.4</span>
<span class="hljs-number">0.12</span><span class="hljs-number">.4</span>: Pulling <span class="hljs-keyword">from</span> node
<span class="hljs-number">7711</span>db4bb553: Pull <span class="hljs-keyword">complete</span>
d1744e6e9471: Pull <span class="hljs-keyword">complete</span>
<span class="hljs-number">9332645</span>b03a3: Pull <span class="hljs-keyword">complete</span>
a52a290821b3: Pull <span class="hljs-keyword">complete</span>
<span class="hljs-number">3575</span>f1347ce7: Already <span class="hljs-keyword">exists</span>
<span class="hljs-number">39</span>bb80489af7: Already <span class="hljs-keyword">exists</span>
df2a0347c9d0: Already <span class="hljs-keyword">exists</span>
<span class="hljs-number">7</span>a3871ba15f8: Already <span class="hljs-keyword">exists</span>
a2703ed272d7: Already <span class="hljs-keyword">exists</span>
c9e3effdd23a: Already <span class="hljs-keyword">exists</span>
node:<span class="hljs-number">0.12</span><span class="hljs-number">.4</span>: The image you <span class="hljs-keyword">are</span> pulling has been verified. Important: image verification <span class="hljs-keyword">is</span> a tech preview feature <span class="hljs-keyword">and</span> should <span class="hljs-keyword">not</span> be relied <span class="hljs-keyword">on</span> <span class="hljs-keyword">to</span> provide <span class="hljs-keyword">security</span>.
Digest: sha256:<span class="hljs-number">81</span>fb0812dd5e81f768773a121c8a6daced36893210c5ed50b504c4abcb04e10c
<span class="hljs-keyword">Status</span>: Downloaded newer image <span class="hljs-keyword">for</span> node:<span class="hljs-number">0.12</span><span class="hljs-number">.4</span></span>
</code></pre>
<p>Puis cr√©ez un fichier <code>server.js</code> avec le contenu suivant :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  res.end(<span class="hljs-string">'Coucou depuis Docker'</span>)
});

server.listen(<span class="hljs-number">3000</span>)
</code></pre>
<p>Et maintenant, pour lancer notre application √† l‚Äôint√©rieur d‚Äôun conteneur, vous
devez faire :</p>
<pre><code class="lang-console">$ docker <span class="hljs-keyword">run</span> -<span class="hljs-keyword">d</span> --name node-<span class="hljs-keyword">app</span> -p 3000:3000 -v $(<span class="hljs-keyword">pwd</span>):/<span class="hljs-keyword">app</span> node:0.12.4 node /<span class="hljs-keyword">app</span>/server.js
e9ca3cd8f90b8554ca99ec8ba15a039f827005bd8fecbf80d72ce7267006a6df
</code></pre>
<p>Si vous vous rendez sur <code>localhost:3000</code> (ou l‚ÄôIP de la VM si √™tes sur Windows
ou Mac), vous verrez : ‚ÄòCoucou depuis Docker‚Äô</p>
<p>C‚Äôest beau, mais comment √ßa marche ? Examinons les options une par une :</p>
<ul>
<li><code>-d</code> : cette option permet de lancer le conteneur en mode d√©mon et donc de
tourner en t√¢che de fond √† la diff√©rence de <code>-it</code> qui lan√ßait le conteneur au
premier plan et nous donnait un acc√®s direct au conteneur.</li>
<li><code>--name node-app</code> : cette option permet simplement de nommer notre conteneur,
ce qui peut servir pour l‚Äôarr√™ter et le relancer plus simplement (et √† d‚Äôautres
choses plus complexes dont je parlerai dans un prochain article).</li>
<li><code>-p 3000:3000</code> : cette option permet de partager le port de votre machine avec
le port du conteneur. Le premier nombre est le port de votre machine et le
deuxi√®me le port dans le conteneur.</li>
<li><code>-v $(pwd):/app</code> : cette option permet de partager un dossier avec votre
conteneur, ici, nous partageons le dossier courant (o√π se trouve notre fichier
<code>server.js</code>) avec le dossier <code>/app</code> dans le conteneur (attention si vous √™tes
sur Mac ou Windows uniquement votre ‚Äòhome‚Äô est partag√©).</li>
<li><code>node:0.12.4</code> : l‚Äôimage Docker que vous voulez utiliser.</li>
<li><code>node /app/server.js</code> : la commande √† ex√©cuter dans le conteneur.</li>
</ul>
<p>Et maintenant ? Vous pouvez afficher le conteneur en faisant : <code>docker ps</code>, l‚Äôarr√™ter
avec : <code>docker stop node-app</code> et le supprimer avec <code>docker rm node-app</code>.</p>
<hr>
<p>Dans cet article, nous avons vu comment r√©cup√©rer des images Docker depuis le
Docker Hub et comment les instancier afin de cr√©er des conteneurs. Mais pour aller
plus loin, ce serait bien si nous pouvions cr√©er nos propres images, c‚Äôest ce que
nous apprendrons √† faire √† l‚Äôaide des Dockerfile dans le prochain article.</p>
]]></description>
            <link>http://putaindecode.fr/posts/docker/introduction-a-docker/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/docker/introduction-a-docker/</guid>
            <pubDate>Thu, 11 Jun 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Les webhooks GitHub]]></title>
            <description><![CDATA[<p>Vous avez pu lire r√©cemment une <a href="/posts/ci/le-deploiement-continu/" >introduction sur l‚Äôint√©gration
continue</a> qui m√®ne vers <a href="/posts/ci/introduction/" >le d√©ploiement
continu</a>. Si vous utilisez GitHub pour h√©berger vos
sources et que vous cherchez un moyen tr√®s simple (peut-√™tre un peu trop) de
mettre en place le d√©ploiement continu <em>sans serveur d‚Äôint√©gration continue
d√©di√©</em>, alors les webhooks peuvent r√©pondre parfaitement √† votre besoin.</p>
<h2 id="les-quoi">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/webhooks-github/#les-quoi">#</a>
      Les quoi ?
    </h2><p>Les webhooks permettent de lancer une action de fa√ßon automatique par
l‚Äôinterm√©diaire d‚Äôun ou plusieurs √©v√©nements depuis un d√©p√¥t
<a href="http://github.com" >GitHub</a>. Concr√®tement, il va √™tre possible de d√©ployer son
projet sur un serveur de production, sauvegarder son site Internet, ou m√™me
mettre √† jour des stats d√®s qu‚Äôun commit sera envoy√© ou m√™me une issue ouverte.
Il est possible de faire tout ce que l‚Äôon veut dans la limite de son imagination
comme l‚Äôexplique GitHub.</p>
<h2 id="comment-ca-marche">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/webhooks-github/#comment-ca-marche">#</a>
      Comment √ßa marche ?
    </h2><p>Le fonctionnement est on ne peut plus simple, un √©v√©nement (merge, push, release
etc.) va d√©clencher une requ√™te HTTP POST vers l‚ÄôURL que vous avez configur√©e.
Le reste de l‚Äôex√©cution se fera sur le serveur o√π pointe l‚ÄôURL, libre √† vous
d‚Äô√©crire le script que vous voulez pour effectuer les op√©rations que vous
souhaitez.</p>
<p>Il faut cependant √™tre conscient que la simplification a un co√ªt, √† savoir que
m√™me si une PR ou un commit venaient √† rendre inop√©rant votre projet l‚Äô√©v√©nement
se lancerait quand m√™me.</p>
<h2 id="la-mise-en-place">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/webhooks-github/#la-mise-en-place">#</a>
      La mise en place
    </h2><p>Seul le propri√©taire d‚Äôun d√©p√¥t dispose des droits n√©cessaires pour configurer
un webhook. Il suffit pour cela de se rendre dans <code>Settings</code> puis <code>Webhooks &amp;
Services</code> :</p>
<p><img src="http://putaindecode.fr/posts/ci/webhooks-github/setting_webhook.jpg" alt="Settings Webhooks GitHub"></p>
<p>Un petit clic sur <code>Add webhook</code> et vous obtenez une interface encore une fois
tr√®s simple :</p>
<p><img src="http://putaindecode.fr/posts/ci/webhooks-github/configuration_webhook.jpg" alt="Configuration Webhooks GitHub"></p>
<p>Cette interface se compose de trois parties :</p>
<ol>
<li>l‚ÄôURL vers laquelle votre requ√™te sera lanc√©e</li>
<li>une secret key pour s√©curiser votre requ√™te</li>
<li>l‚Äô√©v√©nement qui va d√©clencher votre requ√™te</li>
</ol>
<p>La partie √©v√©nement est relativement compl√®te et l√† encore vous disposez de
trois possibilit√©s :</p>
<ol>
<li>se d√©clenche au push</li>
<li>se d√©clenche √† chaque √©v√©nement</li>
<li>√† vous de choisir les √©v√©nements (un ou plusieurs) qui vous conviennent</li>
</ol>
<p>Une fois le <em>Webhook</em> activ√© un premier test ou plus exactement un <code>ping</code> va se
lancer. Il permettra de d√©tecter que votre serveur r√©pond bien √† la requ√™te :</p>
<p><img src="http://putaindecode.fr/posts/ci/webhooks-github/test_webhook.jpg" alt="Test Webhooks request GitHub"></p>
<p>La requ√™te envoy√©e est tr√®s basique et embarque un JSON sur les informations de
votre d√©p√¥t (description, URL) et une liste des API mises √† disposition. Le
reste du travail doit se faire sur votre serveur par l‚Äôinterm√©diaire de votre
API/script, etc.</p>
<p>Voici un petit exemple utilisant <code>express</code> :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>)
<span class="hljs-keyword">var</span> app = express()
<span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">"body-parser"</span>)
<span class="hljs-keyword">var</span> xhub = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express-x-hub"</span>)

<span class="hljs-comment">//Const</span>
<span class="hljs-keyword">var</span> xhubSecret = <span class="hljs-string">"MySecretKey"</span>
<span class="hljs-keyword">var</span> port = <span class="hljs-string">"8085"</span>
<span class="hljs-keyword">var</span> host = <span class="hljs-string">"localhost"</span>

<span class="hljs-comment">//Secret key</span>
app.use(xhub({ algorithm: <span class="hljs-string">"sha1"</span>, secret: xhubSecret }))

<span class="hljs-comment">// Configure express json</span>
app.use(bodyParser.json())

<span class="hljs-comment">// Main : Start the express http server</span>
<span class="hljs-keyword">var</span> server = app.listen(port, host, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(
    <span class="hljs-string">"App listening at http://%s:%s"</span>,
    server.address().address,
    server.address().port
  )
})

<span class="hljs-comment">// Add default route</span>
app.post(<span class="hljs-string">"/webhook"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">if</span>(!req.isXHubValid()){
    res.status(<span class="hljs-number">400</span>).send(<span class="hljs-string">'Invalid X-Hub Request'</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Secret key is invalid"</span>)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">var</span> command = req.headers[<span class="hljs-string">"x-github-event"</span>]

  <span class="hljs-keyword">switch</span>(command) {

    <span class="hljs-comment">//Event create (Branch, or tag created)</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"create"</span>:
      res.send(<span class="hljs-string">"Event create trigger"</span>)
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Create event"</span>)
      <span class="hljs-keyword">break</span>

    <span class="hljs-comment">//Event release (Release published in a repository)</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"release"</span>:
      res.send(<span class="hljs-string">"Event release trigger"</span>)
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Release Event"</span>)
      <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">default</span>:
      res.status(<span class="hljs-number">400</span>).send(<span class="hljs-string">"Event not supported : "</span> + command)
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Event not supported : "</span> + req.headers[<span class="hljs-string">"X-Github-Event"</span>])
  }
})
</code></pre>
<p>Pour vous donner une id√©e de ce que peut envoyer GitHub, voici deux gists :</p>
<ul>
<li><a href="http://putaindecode.fr/posts/ci/webhooks-github/header.txt" >Headers</a></li>
<li><a href="http://putaindecode.fr/posts/ci/webhooks-github/payload.json" >Payload</a></li>
</ul>
<h2 id="this-is-just-the-beginning">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/webhooks-github/#this-is-just-the-beginning">#</a>
      This is just the beginning
    </h2><p>Cette solution est un d√©but de piste pour le d√©ploiement continu, mais elle ne
doit pas se faire sans une solution de test que ce soit cot√© GitHub ou cot√©
serveur.</p>
<p>Si vous souhaitez plus d‚Äôinformations ou m√™me pousser un peu plus la mise en
place des webhooks, GitHub a comme √† son habitude publi√© un
<a href="https://developer.github.com/webhooks/" >guide</a> tr√®s bien d√©taill√© et complet.</p>
]]></description>
            <link>http://putaindecode.fr/posts/ci/webhooks-github/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/ci/webhooks-github/</guid>
            <pubDate>Tue, 09 Jun 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Introduction √† cssnext]]></title>
            <description><![CDATA[<p>D‚Äôapr√®s le <a href="http://cssnext.io/" >site officiel</a>:</p>
<blockquote>
<p><strong>cssnext</strong> est un transpileur CSS qui vous permet d‚Äôutiliser d√®s aujourd‚Äôhui la syntaxe CSS de demain. Il transforme les sp√©cifications CSS qui ne sont pas encore mises en ≈ìuvre sur les navigateurs les plus populaires en CSS compatible.</p>
</blockquote>
<h2 id="ca-veut-dire-quoi-exactement">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#ca-veut-dire-quoi-exactement">#</a>
      √áa veut dire quoi exactement ?
    </h2><p>Depuis CSS3, vous avez savez sans doute que CSS est divis√© en plusieurs documents ind√©pendants appel√©s ‚Äúmodules‚Äù. Ces modules peuvent avoir diff√©rents niveaux de stabilit√© et diff√©rents <a href="http://www.w3.org/Style/CSS/current-work#legend" >statuts</a>. La mise en ≈ìuvre de ces modules par les navigateurs peut prendre un certain temps et encore plus pour que le W3C les approuve comme <a href="http://www.w3.org/2005/10/Process-20051014/tr#RecsW3C" >Recommandation</a>.</p>
<p>Avec <strong>cssnext</strong>, vous pouvez utiliser la syntaxe des <a href="http://www.xanthir.com/b4Ko0" >nouveaux modules CSS</a> tels que les <em>propri√©t√©s personnalis√©es (custom properties level 1)</em> ou les <em>media queries personnalis√©es (custom media queries level 1)</em>. <strong>cssnext</strong> va transformer ces nouvelles et √©tranges syntaxes en du CSS compr√©hensible par les navigateurs que vous voulez supporter.</p>
<p>En clair, il vous donne un <strong>avant-go√ªt du futur</strong>.</p>
<p>Je ne sais pas vous mais √©tant quelqu‚Äôun qui aime exp√©rimenter avec les derni√®res technologies de pointe, je trouve √ßa plut√¥t cool !</p>
<p>Je vous conseille de jeter un oeil √† la <a href="http://cssnext.io/features/" >liste des fonctionnalit√©s</a>.</p>
<h3 id="quid-de-mon-preprocesseur-actuel">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#quid-de-mon-preprocesseur-actuel">#</a>
      Quid de mon pr√©processeur actuel ?
    </h3><p>Oubliez les risques li√©s √† une abstraction trop √©lev√©e des CSS par les pr√©-processeurs actuels ; certes caus√©s par une (sur-|mauvaise) utilisation de ces outils mais quand m√™me.</p>
<p>Devinez quoi, vous n‚Äôen avez pas forc√©ment besoin.</p>
<p>Essayez <strong>cssnext</strong> et retournez √† ce bon <del>vieux</del> nouveau CSS. Et avec un zeste de <a href="/posts/css/petite-definition-bem/" >m√©thodologie BEM</a>, vous vous sentirez revivre.</p>
<h2 id="exemples">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#exemples">#</a>
      Exemples
    </h2><p>Voyons voir quelles sont les fonctionnalit√©s offertes par <strong>cssnext</strong> pour le moment.</p>
<p>Avant toute chose, vous devriez aller faire un tour sur le <a href="http://cssnext.io/playground/" >playground du site officiel</a>.</p>
<h3 id="prefixes-proprietaires-automatiques">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#prefixes-proprietaires-automatiques">#</a>
      Pr√©fixes propri√©taires automatiques
    </h3><pre><code class="lang-css"><span class="hljs-class">.h1</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">transform</span>:<span class="hljs-value"> <span class="hljs-function">skewX</span>(<span class="hljs-number">25deg</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">transition</span>:<span class="hljs-value"> transform <span class="hljs-number">1s</span></span></span>;
}</span>
</code></pre>
<p>Cela va √™tre transform√© par <strong>cssnext</strong> via Autoprefixer en :</p>
<pre><code class="lang-css"><span class="hljs-class">.h1</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">-webkit-transform</span>:<span class="hljs-value"> <span class="hljs-function">skewX</span>(<span class="hljs-number">25deg</span>)</span></span>;
      <span class="hljs-rule"><span class="hljs-attribute">-ms-transform</span>:<span class="hljs-value"> <span class="hljs-function">skewX</span>(<span class="hljs-number">25deg</span>)</span></span>;
          <span class="hljs-rule"><span class="hljs-attribute">transform</span>:<span class="hljs-value"> <span class="hljs-function">skewX</span>(<span class="hljs-number">25deg</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">-webkit-transition</span>:<span class="hljs-value"> -webkit-transform <span class="hljs-number">1s</span></span></span>;
          <span class="hljs-rule"><span class="hljs-attribute">transition</span>:<span class="hljs-value"> transform <span class="hljs-number">1s</span></span></span>;
}</span>
</code></pre>
<h3 id="proprietes-personnalisees-et-var-limite-a-root">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#proprietes-personnalisees-et-var-limite-a-root">#</a>
      Propri√©t√©s personnalis√©es et var() limit√© √† <code>:root</code>
    </h3><p>Aussi connues sous le nom des tr√®s attendues <a href="http://www.w3.org/TR/css-variables/" >variables CSS</a>.</p>
<pre><code class="lang-css"><span class="hljs-pseudo">:root</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">--primary-Color</span>:<span class="hljs-value">                 <span class="hljs-hexcolor">#E86100</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--secondary-Color</span>:<span class="hljs-value">               <span class="hljs-hexcolor">#2c3e50</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">--r-Grid-baseFontSize</span>:<span class="hljs-value">           <span class="hljs-number">1rem</span></span></span>;
}</span>
</code></pre>
<p>√Ä utiliser de cette fa√ßon :</p>
<pre><code class="lang-css"><span class="hljs-class">.h1</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">var</span>(--primary-Color)</span></span>;
}</span>
<span class="hljs-class">.h1</span><span class="hljs-pseudo">:hover</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">var</span>(--secondary-Color)</span></span>;
}</span>
<span class="hljs-tag">body</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-function">var</span>(--r-Grid-baseFontSize)</span></span>;
}</span>
</code></pre>
<h3 id="media-queries-personnalisees">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#media-queries-personnalisees">#</a>
      Media Queries personnalis√©es
    </h3><p>Pour cr√©er des alias s√©mantiques, clairs et simples (<a href="http://dev.w3.org/csswg/mediaqueries/#custom-mq" >lisez la doc‚Äô</a>).</p>
<pre><code class="lang-css"><span class="hljs-at_rule">@<span class="hljs-keyword">custom-media</span> --viewport-medium (width &lt;= <span class="hljs-number">40rem</span>)</span>;
<span class="hljs-at_rule">@<span class="hljs-keyword">custom-media</span> --viewport-large (max-width: <span class="hljs-number">50em</span>)</span>;
</code></pre>
<p>Prenons par exemple :</p>
<pre><code class="lang-css"><span class="hljs-pseudo">:root</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">--fontSize</span>:<span class="hljs-value"> <span class="hljs-number">1.2rem</span></span></span>;
}</span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> (--viewport-medium) </span>{
  <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-function">calc</span>(<span class="hljs-function">var</span>(--fontSize) * <span class="hljs-number">1.2</span>)</span></span>; }</span>
}
<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> (--viewport-large) </span>{
  <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-function">calc</span>(<span class="hljs-function">var</span>(--fontSize) * <span class="hljs-number">1.4</span>)</span></span>; }</span>
}
</code></pre>
<p>Le code g√©n√©r√© sera alors :</p>
<pre><code class="lang-css"><span class="hljs-at_rule">@<span class="hljs-keyword">media</span> (max-width: <span class="hljs-number">40rem</span>) </span>{
  <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1.44rem</span></span></span>; }</span>
}
<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> (max-width: <span class="hljs-number">50em</span>) </span>{
  <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1.68rem</span></span></span>; }</span>
}
</code></pre>
<h3 id="selecteurs-personnalises">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#selecteurs-personnalises">#</a>
      S√©lecteurs personnalis√©s
    </h3><p>Encore une fois, un petit tour sur les <a href="http://dev.w3.org/csswg/css-extensions/#custom-selectors" >specs</a> pour commencer. Disons qu‚Äôon veuille appliquer des styles √† toutes les balises de titre.</p>
<pre><code class="lang-css"><span class="hljs-at_rule">@<span class="hljs-keyword">custom-selector</span> :--heading h1, h2, h3, h4, h5, h6</span>;

<span class="hljs-pseudo">:--heading</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
}</span>
</code></pre>
<p>Ce qui va g√©n√©rer le code suivant :</p>
<pre><code class="lang-css">h1,
h2,
h3,
h4,
h5,
h6 { margin-top; 0; }
</code></pre>
<h3 id="color">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#color">#</a>
      <code>color()</code>
    </h3><p>Une simple <a href="http://dev.w3.org/csswg/css-color/#modifying-colors" >fonction color</a> qui sert √† appliquer des <em>r√©glages couleur</em> (teinte, luminosit√©, entre autres) √† une couleur de base.</p>
<p>Exemples :</p>
<pre><code class="lang-css"><span class="hljs-class">.class</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span> <span class="hljs-function">red</span>(+<span class="hljs-number">30</span>) <span class="hljs-function">green</span>(-<span class="hljs-number">50</span>) <span class="hljs-function">blue</span>(<span class="hljs-number">6%</span>) <span class="hljs-function">alpha</span>(.<span class="hljs-number">65</span>))</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-top-color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span> <span class="hljs-function">saturation</span>(-<span class="hljs-number">8%</span>) <span class="hljs-function">whiteness</span>(+<span class="hljs-number">50%</span>))</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-right-color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span> <span class="hljs-function">lightness</span>(<span class="hljs-number">5%</span>) <span class="hljs-function">blackness</span>(-<span class="hljs-number">25%</span>))</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-bottom-color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span> <span class="hljs-function">tint</span>(<span class="hljs-number">80%</span>))</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-left-color</span>:<span class="hljs-value"> <span class="hljs-function">color</span>(<span class="hljs-hexcolor">#2B88E6</span> <span class="hljs-function">shade</span>(<span class="hljs-number">75%</span>))</span></span>;
}</span>
</code></pre>
<p>Le code ci-dessus sera transform√© en‚Ä¶</p>
<pre><code class="lang-css"><span class="hljs-class">.class</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">43</span>, <span class="hljs-number">136</span>, <span class="hljs-number">230</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">rgba</span>(<span class="hljs-number">73</span>, <span class="hljs-number">86</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0.65</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-top-color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">181</span>, <span class="hljs-number">201</span>, <span class="hljs-number">222</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-right-color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">3</span>, <span class="hljs-number">45</span>, <span class="hljs-number">87</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-bottom-color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">213</span>, <span class="hljs-number">231</span>, <span class="hljs-number">250</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-left-color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">11</span>, <span class="hljs-number">34</span>, <span class="hljs-number">58</span>)</span></span>;
}</span>
</code></pre>
<p><strong>cssnext</strong> propose aussi les fonctionalit√©s suivantes li√©es √† la couleur.</p>
<h4 id="hwb">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#hwb">#</a>
      hwb()
    </h4><p>D‚Äôapr√®s les <a href="http://dev.w3.org/csswg/css-color/#the-hwb-notation" >sp√©cifications</a>, HWB (Hue-Whiteness-Blackness) est similaire √† la notation HSL mais plus facile √† utiliser pour les humains.</p>
<pre><code class="lang-css"><span class="hljs-class">.title</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">hwb</span>(<span class="hljs-number">125</span>, <span class="hljs-number">32%</span>, <span class="hljs-number">47%</span>)</span></span>;
}</span>
</code></pre>
<p>Rendu :</p>
<pre><code class="lang-css"><span class="hljs-class">.title</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">rgb</span>(<span class="hljs-number">33</span>, <span class="hljs-number">135</span>, <span class="hljs-number">42</span>)</span></span>;
}</span>
</code></pre>
<h4 id="gray">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#gray">#</a>
      gray()
    </h4><p>Les gris sont <a href="http://dev.w3.org/csswg/css-color/#grays" >tellement cool</a> qu‚Äôils ont une fonction rien que pour eux.</p>
<pre><code class="lang-css"><span class="hljs-class">.section</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-function">gray</span>(<span class="hljs-number">120</span>, <span class="hljs-number">50%</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-color</span>:<span class="hljs-value"> <span class="hljs-function">gray</span>(<span class="hljs-number">17%</span>, <span class="hljs-number">25%</span>)</span></span>;
}</span>
</code></pre>
<p>Ce qui donnera :</p>
<pre><code class="lang-css"><span class="hljs-class">.section</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-function">rgba</span>(<span class="hljs-number">120</span>, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>, <span class="hljs-number">0.5</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">border-color</span>:<span class="hljs-value"> <span class="hljs-function">rgba</span>(<span class="hljs-number">43</span>, <span class="hljs-number">43</span>, <span class="hljs-number">43</span>, <span class="hljs-number">0.25</span>)</span></span>;
}</span>
</code></pre>
<h4 id="rrggbbaa">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#rrggbbaa">#</a>
      #rrggbbaa
    </h4><p><strong>cssnext</strong> transforme les <a href="http://dev.w3.org/csswg/css-color/#hex-notation" >notations hexad√©cimales</a> #RRGGBBAA et #RGBA en rgba().</p>
<pre><code class="lang-css"><span class="hljs-tag">body</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#5c69</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#C73D5C59</span></span></span>;
}</span>
</code></pre>
<p>R√©sultat :</p>
<pre><code class="lang-css"><span class="hljs-tag">body</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">rgba</span>(<span class="hljs-number">85</span>, <span class="hljs-number">204</span>, <span class="hljs-number">102</span>, <span class="hljs-number">0.6</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-function">rgba</span>(<span class="hljs-number">199</span>, <span class="hljs-number">61</span>, <span class="hljs-number">92</span>, <span class="hljs-number">0.34902</span>)</span></span>;
}</span>
</code></pre>
<h4 id="rebeccapurple">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#rebeccapurple">#</a>
      rebeccapurple
    </h4><p>Transforme simplement la couleur <a href="https://github.com/postcss/postcss-color-rebeccapurple#why-this-plugin-" ><code>rebeccapurple</code></a> en <code>rgb(102, 51, 153)</code>.</p>
<h3 id="rem-units">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#rem-units">#</a>
      rem units
    </h3><p>Rien de bien extraordinaire ici, on g√©n√®re un <strong><em>fallback</em> en pixels pour les unit√©s en rem</strong>. Certaines personnes pourraient penser qu‚Äôun tel <em>fallback</em> est inutile de nos jours. Cependant, pour des projets bien sp√©cifiques (compatibilit√© IE 7 et 8 requise), c‚Äôest encore une n√©cessit√©.
Non mais vous n‚Äôavez quand m√™me pas besoin d‚Äôun exemple pour √ßa ? Si ? Bon‚Ä¶ d‚Äôaccord. Allons-y !</p>
<pre><code class="lang-css"><span class="hljs-class">.section-Highlight</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">2.5rem</span></span></span>;
}</span>
</code></pre>
<p>R√©sultat :</p>
<pre><code class="lang-css"><span class="hljs-class">.section-Highlight</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">40px</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">2.5rem</span></span></span>;
}</span>
</code></pre>
<h2 id="note-importante-sur-les-fonctionnalites">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#note-importante-sur-les-fonctionnalites">#</a>
      Note importante sur les fonctionnalit√©s
    </h2><p>Vous pouvez manuellement activer ou d√©sactiver certaines fonctionnalit√©s si vous n‚Äôen ressentez pas le besoin.
Cela √©tant dit, il vous est conseill√© d‚Äôutiliser l‚Äôoption <a href="http://cssnext.io/usage/#browsers" ><code>browsers</code></a>,
qui permet de g√©rer automatiquement la liste des fonctionnalit√©s √† activer.
Par exemple si vous sp√©cifiez un environnement o√π IE 8 n‚Äôest pas support√©, l‚Äôoption de transformation des <code>rem</code>
en <code>px</code> ne sera pas activ√©. Tout comme Autoprefixer ne rajoutera pas les pr√©fixes inutiles.</p>
<h2 id="fonctionnalites-bonus">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#fonctionnalites-bonus">#</a>
      Fonctionnalit√©s bonus
    </h2><p>Les deux fonctionnalit√©s qui vont suivre ne sont pas vraiment en rapport avec les sp√©cifications CSS. Cependant, elles m√©ritent tout de m√™me leur place dans cette br√®ve pr√©sentation de l‚Äôoutil.</p>
<h3 id="import">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#import">#</a>
      <code>import</code>
    </h3><p>Et si vous pouviez importer des fichiers locaux et des modules (<code>node_modules</code> ou <code>web_modules</code>) pour produire un seul et m√™me fichier CSS les contenant tous ? Oui, <a href="https://github.com/sass/sass/issues/193" >c‚Äôest √† vous que je m‚Äôadresse, les utilisateurs de Sass</a>, hum. Eh bien, avec <strong>cssnext</strong>, c‚Äôest possible.</p>
<h3 id="compress">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#compress">#</a>
      <code>compress</code>
    </h3><p>Comme vous l‚Äôavez s√ªrement devin√©, c‚Äôest juste une option pour compresser <em>ou pas</em> votre fichier de sortie, et ceci gr√¢ce √† <a href="https://github.com/ben-eb/cssnano" >cssnano</a>.</p>
<h3 id="usage">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/introduction-a-cssnext/#usage">#</a>
      Usage
    </h3><p>Voici un exemple simple de ces deux fonctionnalit√©s. J‚Äôai ici utilis√© <a href="https://github.com/cssnext/gulp-cssnext" >gulp-cssnext</a>, un des <a href="http://cssnext.io/setup/" >nombreux plugins</a> qui vous aident √† d√©marrer avec <strong>cssnext</strong>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp'</span>),
    cssnext = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-cssnext"</span>);

gulp.task(<span class="hljs-string">'styles'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  gulp.src(<span class="hljs-string">"css/index.css"</span>)
  .pipe(cssnext({
    compress: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// default is false</span>
  }))
  .pipe(gulp.dest(<span class="hljs-string">"./dist/"</span>))
});
</code></pre>
<p>Ensuite, dans mon fichier <code>index.css</code>, j‚Äôai ceci :</p>
<pre><code class="lang-css"><span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"normalize.css"</span></span>; <span class="hljs-comment">/* == @import "./node_modules/normalize.css/index.css"; */</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"cssrecipes-defaults"</span></span>; <span class="hljs-comment">/* == @import "./node_modules/cssrecipes-defaults/index.css"; */</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"project-modules/partner"</span></span>; <span class="hljs-comment">/* relatif √† css/ */</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"typo"</span></span>; <span class="hljs-comment">/* m√™me niveau que mon index.css principal situ√© dans css/ */</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-string">"highlight"</span> (min-width: <span class="hljs-number">25em</span>)</span>;
</code></pre>
<p>Et le rendu final sera :</p>
<pre><code class="lang-css"><span class="hljs-comment">/* contenu de ./node_modules/normalize.css/index.css */</span>
<span class="hljs-comment">/* contenu de ./node_modules/cssrecipes-defaults/index.css */</span>
<span class="hljs-comment">/* contenu de project-modules/partner.css */</span>
<span class="hljs-comment">/* contenu de typo.css */</span>
<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> (min-width: <span class="hljs-number">25em</span>) </span>{
  <span class="hljs-comment">/* contenu de highlight.css */</span>
}
</code></pre>
<p>Je sais ce que vous ressentez. Ce n‚Äôest peut-√™tre pas le coup de foudre au premier coup d‚Äô≈ìil (enfin, pour certains comme moi si, mais bon, passons). Vous ne l‚Äôacceptez pas encore mais il va falloir vous rendre √† l‚Äô√©vidence, un jour ou l‚Äôautre vous coderez comme √ßa. Mieux vaut vous y mettre tout de suite, non ? :)</p>
<p>Bref, pour r√©sumer, disons simplement que le but principal de <strong>cssnext</strong> est de pouvoir d√©velopper selon les sp√©cifications du W3C en gardant bien √† l‚Äôesprit que, th√©oriquement, il sera possible de le supprimer plus tard (quand il ne sera plus utile).</p>
<p>En effet, dans un futur proche, les fonctionnalit√©s qu‚Äôoffre cet outil ne seront plus g√©r√©es par <strong>cssnext</strong> lui-m√™me mais directement par les navigateurs. Laissons-les s‚Äôadapter, chacun √† leur vitesse et pr√©parons-nous. Voil√† tout l‚Äôint√©r√™t du code <em>future-proof</em>, comme le permet <a href="http://babeljs.io/" >babeljs</a> pour le JavaScript.</p>
<p>En attendant, il y a encore du boulot : voici une <a href="https://github.com/cssnext/cssnext/issues?q=is%3Aopen+is%3Aissue+label%3A%22type%3A+feature+request%22" >liste des fonctionnalit√©s √† venir</a>.</p>
<p>Maintenant, √† vous de jouer. N‚Äôoubliez pas d‚Äôaller faire un tour sur le <a href="https://github.com/cssnext/cssnext" >repo GitHub</a>, n‚Äôh√©sitez pas √† suivre <a href="https://twitter.com/cssnext" >@cssnext</a> sur Twitter pour √™tre au courant des derni√®res news et rejoignez la <a href="https://gitter.im/cssnext/cssnext" >room cssnext sur Gitter</a> si vous avez des questions.</p>
<ul>
<li><a href="http://cssnext.io/" >Site officiel</a></li>
</ul>
]]></description>
            <link>http://putaindecode.fr/posts/css/introduction-a-cssnext/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/css/introduction-a-cssnext/</guid>
            <pubDate>Tue, 02 Jun 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Introduction au d√©ploiement continu]]></title>
            <description><![CDATA[<h1 id="deployer-en-continu">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/le-deploiement-continu/#deployer-en-continu">#</a>
      D√©ployer en continu ?
    </h1><p>Il s‚Äôagit d‚Äôavoir un site stable en production, ceci de mani√®re automatis√©e et
continue. Rien que √ßa.</p>
<p>Il faut comprendre par l√† sans passer par FTP avec Filezilla.
Pas de bouton ‚ÄúUpload‚Äù ou ‚ÄúSync‚Äù apr√®s avoir fait une modification de code.
Pas de risque de p√©ter tout votre site si vos modifications rentrent en conflit
avec les modifications de votre coll√®gue, qui lui aussi vient de pousser un
bon gros patch bien sale.</p>
<p>La premi√®re cons√©quence est que les mises en
production ne sont plus stressantes, car tr√®s r√©guli√®res.<br><a href="http://www.estcequonmetenprodaujourdhui.info/" >Certaines personnes ne recommandent pas les mises en production tous les jours
</a> mais lorsque vous avez mis en
place l‚Äôint√©gration continue, vous minimisez grandement les risques.</p>
<p>La preuve en est que certaines entreprises font des mises en productions plusieurs
centaines de fois par jour ! (GitHub est un bon exemple).</p>
<h2 id="pre-requis-au-deploiement-continu">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/le-deploiement-continu/#pre-requis-au-deploiement-continu">#</a>
      Pr√©-requis au d√©ploiement continu
    </h2><p>Vous n‚Äôavez qu‚Äôune chose √† faire avant de vous attaquer √† la mise en place du
d√©ploiement continu : vous devez d√©j√† avoir
<a href="/posts/ci/introduction/" >l‚Äôint√©gration continue</a> en place.</p>
<p>Une fois vous √™tes bon √† ce niveau, vous pouvez passer √† l‚Äô√©tape suivante.</p>
<h2 id="faire-un-script-qui-fait-les-choses-qui-vont-bien-quand-les-tests-vont-bien">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/le-deploiement-continu/#faire-un-script-qui-fait-les-choses-qui-vont-bien-quand-les-tests-vont-bien">#</a>
      Faire un script qui fait les choses qui vont bien quand les tests vont bien
    </h2><p>Une fois qu‚Äôon a une commande qui peut jouer tous les tests et dire ‚Äúy‚Äôa bon‚Äù ou
‚Äútatoukass√©‚Äù, il nous faut pr√©voir les actions √† r√©aliser quand nos tests sont
OK.</p>
<p>Un d√©ploiement FTP, un d√©ploiement git, ou plus compliqu√© via CDN, peu importe.
<strong>Il faut juste une commande qui marche simplement.</strong></p>
<p>Pour notre site, la commande est <code>npm run deploy</code>. Cette commande pousse le site
g√©n√©r√© sur la branche <code>gh-pages</code>
(puisqu‚Äôon se sert <a href="https://pages.github.com/" >des pages GitHub</a>).</p>
<h2 id="automatiser-le-script-qui-fait-les-choses-qui-vont-bien-quand-les-tests-vont-bien">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/le-deploiement-continu/#automatiser-le-script-qui-fait-les-choses-qui-vont-bien-quand-les-tests-vont-bien">#</a>
      Automatiser le script qui fait les choses qui vont bien quand les tests vont bien
    </h2><p>On peut ensuite √©ventuellement englober les pr√©c√©dentes √©tapes dans une seule
commande qui va se d√©brouiller s‚Äôil n‚Äôy a pas d‚Äôerreur. Mais bon, si vous n‚Äôavez
que deux commandes (comme on a dans l‚Äôexemple de notre site), un simple appel de
cette fa√ßon devrait faire l‚Äôaffaire :</p>
<pre><code class="lang-console">$ <span class="hljs-built_in">npm</span> test &amp;&amp; <span class="hljs-built_in">npm</span> run deploy
</code></pre>
<p>Si <code>npm test</code> retourne une erreur, la deuxi√®me commande ne sera pas ex√©cut√©e.</p>
<h2 id="la-suite-au-prochaine-episode">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/le-deploiement-continu/#la-suite-au-prochaine-episode">#</a>
      La suite au prochaine √©pisode
    </h2><p>La prochaine √©tape (dans un prochain article) sera de mettre √ßa en place sur un
serveur d‚Äôint√©gration continue, nous y √©tudierons simplement ce que nous avons
fait pour notre site.</p>
<p>Si vous √™tes trop curieux, vous pouvez d√©j√† <a href="https://github.com/putaindecode/putaindecode.fr" >consulter le code source de notre
site</a> et fouiller dans le
<code>package.json</code> (section <code>scripts</code>) pour deviner la suite‚Ä¶</p>
]]></description>
            <link>http://putaindecode.fr/posts/ci/le-deploiement-continu/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/ci/le-deploiement-continu/</guid>
            <pubDate>Mon, 25 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Qu'est-ce que l'int√©gration continue ?]]></title>
            <description><![CDATA[<p>Certains risquent d‚Äô√™tre d√©√ßus puisque nous ne parlerons pas ici des fameux <code>3x8</code>,
technique qui consiste √† faire tourner 3 √©quipes d‚Äôint√©grateurs HTML en
continu afin d‚Äôavoir du PSD &gt; HTML 24h sur 24.</p>
<h2 id="le-principe-de-l-integration-continue">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#le-principe-de-l-integration-continue">#</a>
      Le principe de l‚Äôint√©gration continue
    </h2><blockquote>
<p>L‚Äôint√©gration continue est un ensemble de pratiques utilis√©es en g√©nie
logiciel consistant √† v√©rifier √† chaque modification de code source que le
r√©sultat des modifications ne produit pas de r√©gression dans l‚Äôapplication
d√©velopp√©e.</p>
</blockquote>
<p><small>
<a href="https://fr.wikipedia.org/wiki/Int%C3%A9gration_continue" >Source: Wikip√©dia</a>
</small></p>
<h2 id="pre-requis-pour-mettre-en-place-l-integration-continue">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#pre-requis-pour-mettre-en-place-l-integration-continue">#</a>
      Pr√©-requis pour mettre en place l‚Äôint√©gration continue
    </h2><p>Avant de rentrer dans le vif du sujet, assurez-vous d‚Äôavoir d√©j√† de bonne bases,
pour maintenir une base de code saine en
<a href="/posts/git/versionner-avec-git/" >versionnant avec git</a>.
Nous sommes en 2015, l‚Äôann√©e o√π l‚Äôon √©tait cens√© avoir les voitures
volantes, nous n‚Äôallons donc pas expliquer ici √† quoi sert de versionner du
code.</p>
<p>Du code versionn√© ne suffit pas, il faut avoir des tests automatis√©s bien
entendu.
<a href="/posts/js/introduction-au-testing-js-front/" >Front</a> et back, il en faut de tous
les c√¥t√©s.</p>
<p>Ensuite, il nous faudra choisir un serveur qui va g√©rer l‚Äôint√©gration continue.
Il existe des services tels que:</p>
<ul>
<li><a href="http://travis-ci.org/" >Travis</a></li>
<li><a href="https://circleci.com/" >CircleCI</a></li>
<li><a href="https://www.atlassian.com/software/bamboo/" >Bamboo</a></li>
<li><a href="https://codeship.com/" >Codeship</a></li>
<li><a href="http://jenkins-ci.org/" >Jenkins</a></li>
</ul>
<h2 id="l-integration-continue-en-pratique">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#l-integration-continue-en-pratique">#</a>
      L‚Äôint√©gration continue en pratique
    </h2><p>Un fois qu‚Äôon a notre code test√© et versionn√© et qu‚Äôon a configur√© son serveur
de <em>CI</em>, chaque modification va d√©clencher des actions sur ce serveur, puis,
en fonction des r√©sultats, va d√©clencher d‚Äôautres actions tout en vous notifiant
si besoin.</p>
<p>Un exemple classique serait le suivant : une fois les derni√®res modifications de
code pouss√©es sur la branche principale sur votre d√©p√¥t de code, le serveur
d‚Äôint√©gration continue va jouer tous les tests et d√©ployer le tout en production si
tout a march√© sur des roulettes.</p>
<p>Si des probl√®mes surviennent, rien ne sera d√©ploy√© et vous serez notifi√© sur
les services que vous avez configur√©s (email, IRC, webhook, etc).</p>
<p>Nous pouvons imaginer que votre serveur vienne vous insulter sur
votre logiciel de chat interne, en vous montrant du doigt.
On pourrait aussi imaginer une synth√®se vocale crier votre nom et pr√©ciser √†
toute l‚Äô√©quipe que
<a href="https://www.youtube.com/watch?v=mbDcnUH6rOc" >vous avez mert√©</a> :
<em>‚ÄúMoOx, you just fucked up the build by breaking 42 tests!
Fix that please‚Äù</em>.
Pour finir dans les exemples farfelus, nous pourrions avoir une petite tourelle
type <em>Nerf</em> qui vous met un petit headshot qui va bien.
Des √©quipes font vraiment √ßa, et vous vous en doutez, y‚Äôa de la grosse marrade au
programme.</p>
<p>L‚Äôid√©e est vraiment de pousser le plus souvent possible, les plus petites
modifications possibles avec la meilleure couverture de tests possible.
Ceci afin de minimiser les risques. De plus, cela aide √† rester focalis√©.</p>
<p>Tout ce processus (versionn√© aussi tant qu‚Äô√† faire), qui permet de jouer tous
les tests <strong>rapidement</strong> (dans un environnement similaire √† la production), doit
√™tre transparent et accessible localement, afin que les d√©veloppeurs aient une
bonne visibilit√© et une bonne compr√©hension du syst√®me en place.</p>
<h2 id="faire-des-tests-automatises-c-est-la-vie">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#faire-des-tests-automatises-c-est-la-vie">#</a>
      Faire des tests automatis√©s, c‚Äôest la vie
    </h2><p>J‚Äôai mis un titre pour √ßa car c‚Äôest important. Vraiment.
Tout d√©veloppeur qui n‚Äôa pas encore √©crit ses premiers tests a peur.
Puis avec le temps, il se dit que finalement, il ne fallait pas
avoir autant d‚Äôappr√©hension et qu‚Äôil √©tait tr√®s con de ne pas avoir
test√© automatiquement tout ses codes sources plus t√¥t.
√Ä tel point qu‚Äôune
<a href="http://the--kyza.deviantart.com/art/What-the-Flux-511691704" >DeLorean modifi√©e</a>
pour se pr√©venir soi-m√™me ne serait pas de refus.</p>
<p>Une fois la barri√®re franchie, on se dit vraiment qu‚Äôon √©tait stupide de pas
avoir essay√© avant.</p>
<h2 id="une-commande-qui-execute-les-tests">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#une-commande-qui-execute-les-tests">#</a>
      Une commande qui √©xecute les tests
    </h2><p>Un fois qu‚Äôon a √©crit des tests, ou m√™me souvent avant, on automatise
l‚Äôex√©cution des tests. En g√©n√©ral c‚Äôest rapide, √©tant donn√© qu‚Äôune simple
commande ou un simple script suffit.
Beaucoup de <em>test runners</em> existent et vous n‚Äôaurez aucune difficult√© √† en
trouver un en ad√©quation avec votre language favori.</p>
<p>Pour notre site, la commande est <code>npm test</code>. Simple, efficace.</p>
<p>Elle ex√©cute tout ce qui est n√©cessaire √† compiler notre application et √† jouer
les tests tout en retournant un r√©sultat lisible et un code d‚Äôerreur si besoin.</p>
<h2 id="et-apres">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/ci/introduction/#et-apres">#</a>
      Et apr√®s ?
    </h2><p>L√†, si vous avez d√©j√† mis tout √ßa en place, le bonheur ultime du d√©veloppeur
n‚Äôest pas loin : vous pouvez rapidement v√©rifier qu‚Äôil n‚Äôy a pas de r√©gressions
et agir en cons√©quence.</p>
<p>Chez <em>Putain de code !</em> (en date de cet article), notre couverture de
tests est loin d‚Äô√™tre bonne. Mais ce site √©tant un petit plaisir un peu risqu√©,
nous faisons quand m√™me du
<a href="/posts/ci/le-deploiement-continu" >d√©ploiement continu</a>, l‚Äô√©tape d‚Äôapr√®s !<br>On aime bien l‚Äôid√©e du <em><a href="http://zachholman.com/talk/move-fast-break-nothing" >move fast &amp; break <del>no</del>thing
</a></em>.</p>
]]></description>
            <link>http://putaindecode.fr/posts/ci/introduction/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/ci/introduction/</guid>
            <pubDate>Thu, 21 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Comment d√©boguer facilement du web y compris sur tablettes et t√©l√©phones]]></title>
            <description><![CDATA[<p>Vous souhaitez d√©boguer votre site ou application web mais vous ne savez pas trop comment faire ? Bon. Je sais que vous savez mais je peux peut-√™tre vous faciliter la t√¢che.</p>
<p>Commen√ßons par le plus simple.</p>
<h2 id="un-navigateur-un-inspecteur">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#un-navigateur-un-inspecteur">#</a>
      Un navigateur, un inspecteur
    </h2><p>Si vous ne voulez pas vous prendre la t√™te, la solution la plus simple reste d‚Äôutiliser l‚Äôinspecteur fourni par votre navigateur pour analyser vos pages web. Fini les add-ons √† installer (comme Firebug), chaque navigateur r√©cent a maintenant son propre inspecteur, m√™me Internet Explorer.</p>
<p>√áa, c‚Äôest la partie que vous devez s√ªrement d√©j√† savoir. Par contre, quid du mobile ?</p>
<h3 id="oui-quid-du-mobile">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#oui-quid-du-mobile">#</a>
      Oui, quid du mobile ?
    </h3><p>C‚Äôest justement principalement ce qui m‚Äôint√©resse ici.</p>
<p>Pour ce qui est du mobile, je vous propose de commencer par brancher votre t√©l√©phone ou tablette sur votre poste en USB puis de lancer deux navigateurs. Mais pas n‚Äôimporte lesquels. Les m√™mes navigateurs sur desktop et sur mobile. Par exemple, si vous voulez d√©boguer Safari sur iOS, alors lancez Safari sur votre Mac. Si vous voulez d√©boguer Chrome sur Android, alors lancez Chrome sur votre desktop. Ce n‚Äôest vraiment plus aussi compliqu√© qu‚Äôauparavant o√π il √©tait n√©cessaire d‚Äôinstaller des applications en ligne de commande (comme <a href="https://developer.android.com/tools/help/adb.html" >adb</a> par exemple) avant de pouvoir rendre la connexion possible. Maintenant, les navigateurs incorporent directement de quoi se connecter aux mobiles.</p>
<p>Une connexion se fera entre les deux navigateurs (mobile et desktop) et vous permettra de voir ce qu‚Äôil se passe sur votre mobile en regardant la fen√™tre de devtools sur votre desktop. Quelques pr√©cisions pour chacun des navigateurs :</p>
<ul>
<li>Chrome : lancez l‚ÄôURL <code>chrome://inspect</code></li>
<li>Safari : allez dans <code>develop</code> puis vous verrez vos appareils connect√©s et les URL lanc√©es sur vos appareils</li>
</ul>
<p>Pas mal non ?</p>
<p>Mais nous pouvons aller encore plus loin gr√¢ce √† Firefox qui va nous faciliter la t√¢che. En effet, celui-ci est capable de d√©boguer n‚Äôimporte quel navigateur via WebIDE et son <em>adapter</em> <a href="https://developer.mozilla.org/en-US/docs/Tools/Valence" >Valence</a>.</p>
<h2 id="allez-firefox-webide">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#allez-firefox-webide">#</a>
      Allez, Firefox WebIDE !
    </h2><p>Au d√©part ce projet avait pour but de d√©boguer Firefox OS mais gr√¢ce au projet <a href="https://developer.mozilla.org/en-US/docs/Tools/Valence" >Valence</a>, WebIDE permet maintenant aussi de se connecter √† d‚Äôautres navigateurs comme iOS Safari ou Desktop Chrome (n‚Äôimporte en fait) et de pouvoir d√©boguer dans les devtools de Firefox. √áa, c‚Äôest cool.</p>
<p>Pour activer WebIDE sur votre Firefox, ouvrez un onglet et rentrez comme URL<br /><code>about:config?filter=devtools.webide.enabled</code><br />
puis mettre l‚Äôoption √† <code>true</code>.</p>
<p>Allez apr√®s dans devtools, ‚Äúsettings‚Äù (l‚Äôengrenage) et activez :</p>
<ul>
<li><code>Enable browser chrome and add-on debugging toolboxes</code></li>
<li><code>Enable remote debugging</code></li>
</ul>
<p>puis red√©marrez.</p>
<p>Vous devriez avoir ‚ÄúWebIDE‚Äù de disponible mais aussi ‚ÄúBrowser Toolbox‚Äù qui est un debugger pour inspecter l‚Äôapplication Firefox en elle-m√™me. Pratique pour faire des th√®mes !</p>
<p>Une fois WebIDE lanc√©, allez dans <code>Select runtime</code> puis <code>Install Simulator</code> et installez <code>ADB Helper Add-on</code> ainsi que <code>Tools Adapters Add-on</code>.</p>
<p>Vous √™tes bon(ne) pour pouvoir d√©boguer. Plus qu‚Äô√† brancher votre appareil, allez dans <code>Select runtime</code> et le voir dans la section <code>USB Devices</code>.</p>
<p>N‚Äôh√©sitez pas √† vous r√©f√©rer √† la <a href="https://developer.mozilla.org/en-US/docs/Tools/WebIDE" >documentation officielle</a> pour de plus amples informations.</p>
<p>Un petit hic tout de m√™me. Cela reste une beta (√† mon sens), de ce fait la connexion est un peu instable. Il est parfois difficile de se connecter √† un appareil. Pour cela, d√©branchez votre t√©l√©phone puis rebranchez-le, et red√©marrez Firefox puis relancez WebIDE, cela devrait √™tre bon.</p>
<p>Mis √† part ceci, c‚Äôest top.</p>
<blockquote>
<p>Oui mais moi je dois d√©boguer Android Browser, √ßa marche tout √ßa ?</p>
</blockquote>
<p>Biiiien, non. J‚Äôavoue tout. Aucune des solutions que je viens de vous donner ne fonctionne sur Android Browser.</p>
<blockquote>
<p>Euh‚Ä¶ Quoi ?!</p>
</blockquote>
<p>Oui oui, je comprends que vous soyez √©tonn√©(e). Moi aussi, je suis d√©pit√© √† chaque fois que je dois d√©velopper dessus. Ce navigateur est une belle merde. Il ne se met √† jour que quand votre OS s‚Äôy met. Il est le navigateur par d√©faut et le moteur des webviews sur de nombreux (anciens (!|?)) Android. √Ä vrai dire, je ne comprends m√™me pas comment ce navigateur a pu exister sauf pour dire ‚ÄúHey, vous avez vu, on ne vous a pas impos√© Chrome, contrairement √† Microsoft avec IE‚Äù. Ils auraient p‚Äôt√™te d√ª finalement.</p>
<p>Bref. Rassurez-vous, j‚Äôai des solutions.</p>
<p>Je pourrais vous parler du format en <strong>CLI</strong> mais je ne pense pas que cela vous int√©resserait. Et vu qu‚Äôon ne peut pas inspecter le DOM, juste voir la console, ce n‚Äôest vraiment pas plaisant pour d√©boguer.</p>
<p>Je pourrais aussi vous parler de la solution du <code>about:debug</code> mais c‚Äôest chiant (mais √ßa d√©panne). Cela permet d‚Äôafficher une console JS dans le navigateur du mobile. Je vais plut√¥t vous parler ici d‚Äôun inspecteur √©crit en page web qui se branche partout, un peu comme un Firebug lite. Son petit nom ? <a href="http://people.apache.org/~pmuellr/weinre-docs/latest/" >weinre</a>.</p>
<h2 id="weinre">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#weinre">#</a>
      weinre
    </h2><p>‚Ä¶ est une solution plus trop r√©cente mais qui a le m√©rite de fonctionner partout, facilement et surtout sur Android browser. Celui-ci va cr√©er une page web avec un webkit-debugger-like, qui lui est connect√© via un websocket sur le site que vous √™tes en train de d√©boguer, vous permettant √† la fois d‚Äôavoir une console mais aussi une inspection du DOM. Et √ßa, c‚Äôest vraiment chouette.</p>
<p><img src="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/weinre-console.png" alt=""></p>
<p>Passons √† son installation.</p>
<h3 id="installation">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#installation">#</a>
      Installation
    </h3><pre><code class="lang-console">$ (sudo) npm -g <span class="hljs-keyword">install</span> weinre
</code></pre>
<h3 id="utilisation">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#utilisation">#</a>
      Utilisation
    </h3><p>Lancez d‚Äôabord le process :</p>
<pre><code class="lang-console"><span class="hljs-variable">$ </span>weinre
</code></pre>
<p>Ajoutez le script dans votre page qui communiquera avec votre serveur (exemple) :</p>
<pre><code class="lang-javascript">&lt;script src=<span class="hljs-string">"http://localhost:8080/target/target-script-min.js#anonymous"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre>
<p>Puis ouvrez la page <code>http://localhost:8080</code>, vous devriez avoir quelque chose comme ceci :</p>
<p><img src="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/weinre-interface.png" alt=""></p>
<p>Plus qu‚Äô√† cliquer sur <code>http://localhost:8080/client/#anonymous</code> et vous arriverez sur l‚Äôinterface du debugger.</p>
<p>Attention par contre. Ayant eu des probl√©matiques de temps de connexion au websocket, j‚Äôai d√ª rajouter un <code>setTimeout</code> avant de lancer mon JavaScript afin que la connexion entre la page web et le serveur se fasse pour bien afficher la totalit√© des <code>console.log</code> et autres. Sans √ßa, j‚Äôai vu le d√©but de mon app ne pas √™tre inspect√©e, dommage.</p>
<p>Pour le moment j‚Äôai r√©gl√© ce probl√®me en mettant un <code>setTimout</code> de 2000ms sur l‚Äôex√©cution de mon code car il n‚Äôy a actuellement pas de moyens de savoir si la connexion au websocket s‚Äôest faite ou non.</p>
<p>Sachez cependant que le projet n‚Äôest plus trop maintenu mais que le principal <em>maintainer</em> est encore √† l‚Äô√©coute et recevra volontiers vos am√©liorations.</p>
<p>Il existe deux alternatives √† weinre :</p>
<ul>
<li><a href="http://jsconsole.com/remote-debugging.html" >jsconsole</a> (que je n‚Äôai pas test√©)</li>
<li><a href="http://vorlonjs.com/" >Vorlon.js</a> : tr√®s sympa, tr√®s prometteur, plus propre que weinre. Seul hic, j‚Äôai voulu tester Vorlon.js sur Android Browser (Android 4.3), il a fait planter Android Browser rendant impossible le debug. Dommage, j‚Äôaurais bien remplac√© weinre par celui-ci.</li>
</ul>
<hr>
<p>Bien. On a fait le tour des solutions pour inspecter facilement le DOM ainsi qu‚Äôavoir une console sur n‚Äôimporte quel navigateur.</p>
<p>Ce qui serait int√©ressant maintenant, c‚Äôest d‚Äôanalyser les trames HTTP de n‚Äôimporte quel appareil.</p>
<h2 id="comment-analyser-le-flux-http">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#comment-analyser-le-flux-http">#</a>
      Comment analyser le flux HTTP
    </h2><p>Pour cette t√¢che, je vous propose d‚Äôinstaller l‚Äôoutil <a href="http://mitmproxy.org/" >mitmproxy</a> qui vous permettra de cr√©er un proxy r√©cup√©rant tout votre trafic HTTP et de vous l‚Äôafficher requ√™te par requ√™te.</p>
<p>Ce qui va s√ªrement vous int√©resser sera la partie <a href="http://mitmproxy.org/doc/transparent.html" >transparent proxying</a>. Le proxy se chargera juste d‚Äô√©couter votre trafic et de l‚Äôafficher.</p>
<p>Il sera n√©cessaire aussi de configurer votre navigateur afin que celui-ci se connecte √† votre proxy.</p>
<p>Si vous √™tes sur Android, il vous est n√©cessaire de le sp√©cifier dans la configuration r√©seau de votre appareil. Pour cela :</p>
<ul>
<li>Connectez-vous au WiFi (du m√™me r√©seau que votre h√¥te) (par exemple ‚ÄúMoOx‚Äù)</li>
<li>Allez dans ‚ÄúSettings‚Äù, ‚ÄúWi-Fi‚Äù</li>
<li>Restez appuy√© sur le nom du WiFi (toujours ‚ÄúMoOx‚Äù)</li>
<li>Une popin appara√Ætra, cliquez sur ‚ÄúModify network‚Äù</li>
<li>Cochez ‚ÄúShow advanced options‚Äù</li>
<li>‚ÄúProxy settings‚Äù, mettez <code>manual</code></li>
<li>Entrez les informations de mitmproxy pour vous y connecter</li>
<li>Validez</li>
</ul>
<p>Tout passera maintenant par lui et vous aurez dans votre shell une belle interface montrant toutes les trames passant.</p>
<p><img src="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/mitmproxy.png" alt=""></p>
<h2 id="note">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/#note">#</a>
      Note
    </h2><p>Une petite note rapide. Pour utliser le Simulator iOS (si vous n‚Äôavez pas d‚ÄôiPhone/iPad sous la main par exemple) il est possible que vous deviez installer <a href="https://github.com/google/ios-webkit-debug-proxy" >iOS Webkit Debug Proxy</a>. Je n‚Äôai pas eu √† le faire mais <a href="https://twitter.com/tfeserver" >@tfeserver</a> en a eu besoin. Je vous laisse √ßa de c√¥t√© si par hasard cela vous √©tait n√©cessaire.</p>
<hr>
<p>Avec √ßa, vous pouvez maintenant masteriser le debug sur tous les appareils sans vous prendre la t√™te. Il existe aussi une solution s‚Äôappelant <a href="http://www.browsersync.io/" >BrowserSync</a> permettant √† la fois le debug et la synchro des comportements sur les diff√©rents devices mais √ßa, ce sera peut-√™tre pour un prochain post.</p>
<p>Bon d√©bug.</p>
]]></description>
            <link>http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/frontend/comment-deboguer-du-web-sur-tablettes-et-telephones/</guid>
            <pubDate>Tue, 19 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Les utilitaires en ligne de commande]]></title>
            <description><![CDATA[<p>Avoir acc√®s √† ses utilitaires en ligne de commande (<a href="https://en.wikipedia.org/wiki/Command-line_interface" >CLI</a>) est un quotidien dans nos m√©tiers et un avantage ind√©niable. Ce n‚Äôest pas nouveau et cela existe depuis la nuit des temps. Tout utilisateur
d‚ÄôUnix voue un culte particulier √† son terminal.</p>
<p>J‚Äôai r√©cemment eu √† d√©velopper un utilitaire en Node.js/iojs, j‚Äôai donc voulu avec cet article d√©blayer un peu le terrain
et pr√©senter quelques utilitaires tr√®s pratiques.</p>
<p>Deux postulats avant de commencer :</p>
<ul>
<li>Pourquoi JavaScript ? En coh√©rence avec le workflow que j‚Äôutilise.</li>
<li>Cet article n‚Äôa pas pour but d‚Äôapprendre √† √©crire du JavaScript avec Node.js/iojs.</li>
</ul>
<h2 id="hello-world">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#hello-world">#</a>
      Hello world
    </h2><p>Avant de commencer √† coder, il va tout d‚Äôabord falloir cr√©er deux fichiers qui seront n√©cessaires et obligatoires :</p>
<pre><code class="lang-console"><span class="hljs-comment">// cr√©ation du dossier</span>
$ <span class="hljs-keyword">mkdir</span> putaindecode-<span class="hljs-keyword">cli</span> &amp;&amp; <span class="hljs-keyword">cd</span> putaindecode-<span class="hljs-keyword">cli</span>

<span class="hljs-comment">// cr√©ation de index.js</span>
$ touch index.js

<span class="hljs-comment">// cr√©ation de package.json</span>
$ touch package.json
</code></pre>
<p>Le fichier <code>index.js</code> va se pr√©senter comme ceci :</p>
<pre><code><span class="hljs-shebang">#!/usr/bin/env node</span>
<span class="hljs-comment">// Cette ligne ou shebang permet de d√©finir l'interpr√©teur de notre script, √† savoir `node`</span>

<span class="hljs-comment">// notre fameux hello world</span>
console.log(<span class="hljs-string">"Hello world"</span>)
</code></pre><p>Pour notre fichier <code>package.json</code>, deux m√©thodes possibles pour l‚Äô√©crire, soit en faisant <code>npm init</code> puis suivre les instructions, soit adapter ce JSON :</p>
<pre><code class="lang-console">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"putaindecode-cli"</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span></span>,
  "<span class="hljs-attribute">description</span>": <span class="hljs-value"><span class="hljs-string">"Putaindecode cli"</span></span>,
  "<span class="hljs-attribute">keywords</span>": <span class="hljs-value">[
    <span class="hljs-string">"cli"</span>,
    <span class="hljs-string">"npm"</span>
  ]</span>,
  "<span class="hljs-attribute">author</span>": <span class="hljs-value"><span class="hljs-string">"magsout"</span></span>,
  "<span class="hljs-attribute">license</span>": <span class="hljs-value"><span class="hljs-string">"MIT"</span></span>,
  "<span class="hljs-attribute">repository</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"git"</span></span>,
    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode/putaindecode-cli.git"</span>
  </span>}</span>,
  "<span class="hljs-attribute">engines</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">node</span>": <span class="hljs-value"><span class="hljs-string">"&gt;=0.10"</span>
  </span>}</span>,
  "<span class="hljs-attribute">homepage</span>":<span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode-cs/putaindecode-cli"</span>
  <span class="hljs-string">"bugs"</span>: {
    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode-cs/putaindecode-cli/issues"</span>
  </span>}</span>,
  "<span class="hljs-attribute">files</span>": <span class="hljs-value">[
    <span class="hljs-string">"index.js"</span>
  ]</span>,
  "<span class="hljs-attribute">dependencies</span>": <span class="hljs-value">{}</span>,
  "<span class="hljs-attribute">devDependencies</span>": <span class="hljs-value">{}</span>,
  "<span class="hljs-attribute">bin</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">putaindecode</span>": <span class="hljs-value"><span class="hljs-string">"index.js"</span>
  </span>}
</span>}
</code></pre>
<p>La ligne importante √† ne surtout pas oublier :</p>
<pre><code class="lang-console"><span class="hljs-string">"bin"</span>: {
  <span class="hljs-string">"putaindecode-cli"</span>: <span class="hljs-string">"index.js"</span>
}
</code></pre>
<p>Elle permettra de d√©terminer le script √† ex√©cuter lorsque la commande <code>putaindecode-cli</code> sera lanc√©e.</p>
<p>Si on vulgarise un peu le principe, en installant le script, le fichier <code>index.js</code> sera renomm√© en <code>putaindecode-cli.js</code> et sera copi√© dans le r√©pertoire ad√©quat (cela d√©pend de l‚ÄôOS).</p>
<p>Lorsque la commande <code>putaindecode-cli</code> sera ex√©cut√©e, le shell va chercher le fichier ex√©cutable en utilisant les r√©pertoires list√©s dans la variable PATH.</p>
<p>Si on suit ce raisonnement, l‚Äôinstallation d‚Äôun script √©crasera automatiquement l‚Äôancienne version ou tout script de m√™me nom.</p>
<p>Pour s‚Äôassurer qu‚Äôil n‚Äôexiste pas d‚Äôautres commandes portant le m√™me nom, il est conseill√© d‚Äôutiliser la commande : <code>which putaindecode-cli</code> qui ne retournera rien s‚Äôil n‚Äôy a aucun r√©sultat :</p>
<pre><code class="lang-console">#putaindecode-<span class="hljs-keyword">cli</span> ne retourne aucun r√©sultat
$ <span class="hljs-keyword">which</span> putaindecode-<span class="hljs-keyword">cli</span>

#node <span class="hljs-keyword">est</span> install√© et accessible au path suivant
$ <span class="hljs-keyword">which</span> node
  /usr/<span class="hljs-keyword">local</span>/bin/node
</code></pre>
<h2 id="installation-du-script">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#installation-du-script">#</a>
      Installation du script
    </h2><p>Afin de v√©rifier que le script fonctionne correctement, il suffit tout simplement d‚Äôex√©cuter dans le r√©pertoire la commande : <code>./index.js</code>.</p>
<p>Une erreur de droit ? Un petit chmod pour arranger √ßa : <code>chmod +x index.js</code>.</p>
<p>√Ä ce stade, si tout fonctionne bien, <code>Hello World</code> va s‚Äôafficher.</p>
<p>Par contre, ex√©cuter notre script de la sorte n‚Äôest pas tr√®s pratique, d‚Äôautant plus qu‚Äôil sera n√©cessaire de conna√Ætre √† chaque fois le chemin vers le fichier.</p>
<p>Il serait beaucoup plus simple de pouvoir ex√©cuter le script comme une commande. Comme pour tout package npm, cela se fait avec <code>npm install</code>.</p>
<pre><code class="lang-console"><span class="hljs-comment">// installation en global du script</span>
$ npm install -<span class="hljs-keyword">g</span>

<span class="hljs-comment">// ex√©cution de la commande</span>
$ putaindecode-<span class="hljs-keyword">cli</span>

<span class="hljs-comment">// r√©sultat de la commande</span>
Hello world
</code></pre>
<p>Le script est maintenant accessible partout sur l‚ÄôOS gr√¢ce √† la commande <code>putaindecode-cli</code>. L‚Äôinstallation en global n‚Äôest pas absolument pas n√©cessaire, tout d√©pend de l‚Äôint√©r√™t de votre script. Il est d‚Äôailleurs souvent pr√©f√©rable de l‚Äôinstaller en local dans un projet avec <code>--save</code> ou <code>--save-dev</code>.</p>
<h2 id="installation-des-scripts-de-base">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#installation-des-scripts-de-base">#</a>
      Installation des scripts de base
    </h2><p>La puissance de <code>NPM</code> provient de son nombre impressionnant de packages mis √† disposition.</p>
<p>Pour gagner du temps et √©viter d‚Äôavoir √† recoder la roue. Le script <code>putaindecode-cli</code> va avoir besoin de trois choses :</p>
<ul>
<li>une gestion des commandes (commande, argument, aide)</li>
<li>une gestion des couleurs (notice, error, warning)</li>
<li>une capacit√© √† stopper proprement notre code.</li>
</ul>
<h3 id="commander">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#commander">#</a>
      <code>commander</code>
    </h3><p>Pour les commandes avec en prime la gestion des arguments et de l‚Äôaide, <a href="https://github.com/tj/commander" >commander</a> est tout a fait adapt√© et r√©pondra pratiquement √† tous nos besoins.</p>
<p>Il est simple d‚Äôutilisation et tr√®s bien maintenu.</p>
<p>Voici un exemple de ce qu‚Äôon peut faire :</p>
<pre><code class="lang-js"><span class="hljs-comment">/* Default */</span>
program
  .version(pkg.version)

<span class="hljs-comment">/* command */</span>
program
  .command(<span class="hljs-string">"command"</span>)
  .alias(<span class="hljs-string">'c'</span>)
  .description(<span class="hljs-string">"   command does something"</span>)
  .option(<span class="hljs-string">"-v, --verbose"</span>, <span class="hljs-string">"Verbose"</span>)
  .option(<span class="hljs-string">"-f, --force"</span>, <span class="hljs-string">"Force installation"</span>)
  .action(commandAction)
  .on(<span class="hljs-string">"--help"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"  Example:"</span>)
    <span class="hljs-built_in">console</span>.log();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     command does something"</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command"</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
  });

<span class="hljs-comment">/* help */</span>
program.on(<span class="hljs-string">"--help"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"  Examples:"</span>)
  <span class="hljs-built_in">console</span>.log();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     command do something"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     Force command does something"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command -f"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
});

program.parse(process.argv)

<span class="hljs-comment">/* help by default */</span>
<span class="hljs-keyword">if</span> (!program.args.length) program.help()
</code></pre>
<h3 id="chalk">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#chalk">#</a>
      <code>chalk</code>
    </h3><p><em>Null</em> besoin de faire un cours sur les couleurs, mais l‚Äôaffichage d‚Äôune notice est bien plus pertinent avec sa couleur associ√©e. C‚Äôest √† ce moment qu‚Äôentre en jeu <a href="https://github.com/sindresorhus/chalk" >chalk</a>. Relativement simple √† mettre en place et √† utiliser :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chalk'</span>)

<span class="hljs-comment">/* var */</span>
<span class="hljs-keyword">var</span> error   = chalk.bold.red
<span class="hljs-keyword">var</span> warn    = chalk.yellow
<span class="hljs-keyword">var</span> success = chalk.green
<span class="hljs-keyword">var</span> notice  = chalk.blue

<span class="hljs-comment">/* code */</span>
<span class="hljs-built_in">console</span>.log(warn(<span class="hljs-string">'No command'</span>))
<span class="hljs-built_in">console</span>.log(notice(<span class="hljs-string">"file modified !"</span>))
</code></pre>
<h3 id="exit">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#exit">#</a>
      <code>exit</code>
    </h3><p>Peu importe comment s‚Äôex√©cute son code, il est important de bien savoir maitriser l‚Äôarr√™t de son script. Pour √ßa, <code>process.exit()</code> nous sera bien utile.</p>
<p>Dans le cas d‚Äôune erreur, la valeur de <code>exit</code> doit syst√©matiquement √™tre sup√©rieure √† 0, et donc bien naturellement en cas de succ√®s, elle doit √™tre √©gale √† 0.</p>
<p>Voici une <a href="http://www.virtsync.com/c-error-codes-include-errno" >liste des valeurs</a> de <code>exit</code> et de leurs correspondances.</p>
<h2 id="thanks-god-for-our-terminal">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#thanks-god-for-our-terminal">#</a>
      Thanks god for our terminal
    </h2><p>Si vous souhaitez voir quelques exemples de projets avec des commandes et des mises en situations int√©ressantes, allez faire un tour sur ces projets :</p>
<ul>
<li><a href="https://github.com/cssnext/cssnext/blob/master/bin/cssnext.js" >cssnext</a></li>
<li><a href="https://github.com/sindresorhus/trash/blob/master/cli.js" >trash</a></li>
</ul>
<p>Je vous invite √©galement √† visionner la <a href="http://blog.clement.delafargue.name/posts/2015-02-25-declarative-cli-parsing-in-js.html" >vid√©o</a> de <a href="https://twitter.com/clementd" >Clement Delafargue</a> qui a fait une pr√©sentation sur le sujet en d√©but d‚Äôann√©e.</p>
<p>√Ä partir de l√† on dispose d‚Äôune bonne base pour refaire le monde et accro√Ætre la flemme du d√©veloppeur que l‚Äôon est en automatisant tout plein de t√¢ches.</p>
]]></description>
            <link>http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/</guid>
            <pubDate>Tue, 12 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Utiliser React en moteur de templates]]></title>
            <description><![CDATA[<p>Vous connaissez probablement tous des moteurs de templates.
En JavaScript nous avons Handlebars, Jade, EJS, Slim‚Ä¶
Tous ces projets partent de bonnes intentions mais √† l‚Äôutilisation,
on peut sentir des limitations et donc de l‚Äôinsatisfaction.</p>
<p>Utiliser Handlebars par exemple, c‚Äôest un peu devoir coder tout un tas de helpers
pour g√©rer une partie de votre affichage, √ßa peut vite devenir lourd.
√ätre restreint √† une syntaxe limit√©e par choix est un peu frustrant.
Quand c‚Äôest pas √ßa, c‚Äôest la syntaxe du moteur qui va √™tre lourde.</p>
<p>On peut en venir √† regretter PHP. Faut avouer que ce langage √©tait plut√¥t simple
√† utiliser en tant que moteur de template.
Efficace et pas de restrictions. On trouve m√™me parfois des <code>mysql_query()</code>
dans des templates‚Ä¶</p>
<p>Blague √† part, nous cherchions des langages pour refaire une partie de notre site
puisque nous n‚Äô√©tions pas vraiment satisfaits du processus actuel
(anciennement Handlebars, puis Jade).</p>
<p>Mais finalement, pourquoi ne pas rester avec du JavaScript, purement et simplement ?</p>
<p>C‚Äôest ce que nous avons fait avec React et JSX qui sont de plus en plus utilis√©s.
La syntaxe est plut√¥t lib√©ratrice.</p>
<p>Pour ceux qui ne connaissent pas JSX, il s‚Äôagit d‚Äôun superset de JavaScript qui
supporte une syntaxe XML transform√© en appel de fonctions JavaScript.
Il faut dire que le XML a beau √™tre verbeux, pour d√©finir des
√©l√©ments ayant des propri√©t√©s et des enfants, on a pas vraiment fait plus
lisible et clair sur ce point. Le HTML est plut√¥t simple √† prendre en main c‚Äôest
certain. Les m√©thodes de rendu de React (ce qui va nous int√©resser) sont tr√®s proches
de l‚ÄôHTML.</p>
<p>Ceux qui ont utilis√© JSX (bien qu‚Äôayant pu avoir des naus√©es au premier contact)
avouent souvent qu‚Äôils ont fini par aimer cette petite syntaxe cr√©√©e par Facebook qui
fonctionne tr√®s bien avec React.</p>
<p>Du coup, si on utilisait √ßa pour faire de simple templates et non pas des composants
d‚Äôinterface utilisateur dynamiques ? Qui peut le plus peut le moins (quoi qu‚Äôen
fait, des templates, c‚Äôest un peu des composants d‚Äôinterface).</p>
<h2 id="exemple-de-template-react-jsx">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/#exemple-de-template-react-jsx">#</a>
      Exemple de template React/JSX
    </h2><p>Si vous ne savez pas trop ce qu‚Äôest React, nous vous recommandons de lire
notre <a href="/posts/js/introduction-a-reactjs/" >introduction √† React</a>.</p>
<p>Dans notre cas, on ne va pas sp√©cialement b√©n√©ficier de certaines de ses forces,
mais √ßa fera tr√®s bien le job pour notre besoin.</p>
<p>Nous n‚Äôaborderons pas dans le d√©tail la syntaxe React/JSX, ni ES6, pour rester
focalis√©s sur la finalit√© (on a pr√©vu des articles √† ce propos, en attendant
  <a href="http://babeljs.io/docs/learn-es6/" >voici de quoi vous occuper avec ES6</a>).</p>
<p><em>Attention, pour ceux qui sont encore sur des plugins jQuery, √ßa risque de vous
piquer les yeux</em> üò≠.</p>
<p><a name="es6-class"></a></p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>

export default class PostTemplate extends Component {

  render() {
    return (
      &lt;html&gt;
        &lt;head&gt;
          &lt;title&gt;{this.props.pageTitle}&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
          &lt;article className=<span class="hljs-string">"org-Post"</span>&gt;
            &lt;header className=<span class="hljs-string">"org-Post-header"</span>&gt;
              &lt;h1&gt;{this.props.pageTitle}&lt;/h1&gt;
            &lt;/header&gt;
            &lt;div
              className=<span class="hljs-string">"org-Post-content"</span>
              dangerouslySetInnerHTML={{__html: this.props.pageContent}}
            /&gt;
          &lt;/article&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    )
  }
}
</code></pre>
<p>Ce que vous voyez c‚Äôest bien du JavaScript. Un peu am√©lior√© via JSX, on ne va
pas le nier (dans notre cas, on g√®re tout √ßa de mani√®re transparente avec
<a href="http://babeljs.io/" >babel(-node)</a>).</p>
<p>√áa ressemble dr√¥lement √† de l‚ÄôHTML et c‚Äôest √ßa qui est appr√©ciable pour nous.
Vous noterez que l‚Äôattribut pour d√©finir une classe HTML est <code>className</code> puisque
React est en JavaScript et que le mot <code>class</code> est r√©serv√©
(cf. <a href="http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/#es6-class" >la d√©finition en ES6 de la classe</a>).</p>
<p>En m√™me temps ce qui est cool, c‚Äôest qu‚Äôon reste dans du JavaScript.</p>
<p>On peut donc utiliser toutes nos biblioth√®ques pr√©f√©r√©es via <em>npm</em> pour l‚Äôaffichage
(exemple : <code>momentjs</code>), ou simplement des boucles via les m√©thodes de parcours de
tableau tel que <code>forEach()</code> ou <code>map()</code> en appelant d‚Äôautres composants.</p>
<p>Ci-dessous vous trouverez un exemple plus complexe avec une page pour la liste
des posts et quelques composants.
Les balises qui ressemblent √† du HTML et qui commencent par une majuscule sont li√©es √† des
composants qui doivent √™tre d√©finis (dans notre cas import√©s).
C‚Äôest une particularit√© de React.</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>

<span class="hljs-keyword">import</span> Html <span class="hljs-keyword">from</span> <span class="hljs-string">"../Html"</span>
<span class="hljs-keyword">import</span> Head <span class="hljs-keyword">from</span> <span class="hljs-string">"../Head"</span>
<span class="hljs-keyword">import</span> Body <span class="hljs-keyword">from</span> <span class="hljs-string">"../Body"</span>
<span class="hljs-keyword">import</span> PostsList <span class="hljs-keyword">from</span> <span class="hljs-string">"../PostsList"</span>

export default class Posts extends Component {

  render() {
    return (
      &lt;Html&gt;
        &lt;Head title={this.props.file.title} /&gt;
        &lt;Body&gt;
          &lt;h1&gt;{this.props.file.title}&lt;/h1&gt;
          &lt;PostsList
            posts={
              this.props.collections.posts
                .filter((item) =&gt; {
                  /*
                    ce que vous voulez pour filtrer votre collection
                    eg:
                    return !item.draft
                  */
                }
              }
          /&gt;
        &lt;/Body&gt;
      &lt;/Html&gt;
    )
  }
}
</code></pre>
<p>Voici deux exemples de composants utilis√©s ci-dessus :</p>
<h3 id="head">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/#head">#</a>
      Head
    </h3><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>

export default class Head extends Component {

  render() {
    return (
      &lt;head&gt;
        &lt;meta charSet=<span class="hljs-string">"utf-8"</span> /&gt;
        &lt;meta httpEquiv=<span class="hljs-string">"X-UA-Compatible"</span> content=<span class="hljs-string">"IE=Edge"</span> /&gt;
        &lt;meta
          name=<span class="hljs-string">"viewport"</span>
          content=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>
        /&gt;
        &lt;title&gt;{this.props.title}&lt;/title&gt;
        &lt;link
          rel=<span class="hljs-string">"stylesheet"</span>
          href=<span class="hljs-string">"/index.css"</span>
        /&gt;
        &lt;link
          rel=<span class="hljs-string">"alternate"</span>
          href=<span class="hljs-string">"/feed.xml"</span>
          title={this.props.title}
          type=<span class="hljs-string">"application/atom+xml"</span>
        /&gt;
        {this.props.children}
      &lt;/head&gt;
    )
  }
}
</code></pre>
<h3 id="body">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/#body">#</a>
      Body
    </h3><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, {Component, PropTypes} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>

<span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">"../Header"</span>
<span class="hljs-keyword">import</span> Footer <span class="hljs-keyword">from</span> <span class="hljs-string">"../Footer"</span>
<span class="hljs-keyword">import</span> GoogleAnalytics <span class="hljs-keyword">from</span> <span class="hljs-string">"../Analytics"</span>

export default class Body extends Component {

  render() {
    return (
      &lt;body&gt;

        &lt;Header /&gt;

        &lt;div className=<span class="hljs-string">"Main"</span>&gt;
          {this.props.children}
        &lt;/div&gt;

        &lt;Footer /&gt;

        &lt;script src={<span class="hljs-string">"/index.js"</span>}&gt;&lt;/script&gt;

        &lt;GoogleAnalytics /&gt;

      &lt;/body&gt;
    )
  }
}
</code></pre>
<p>Bon c‚Äôest bien beau mais comment je g√®re l‚Äôaffichage du composant initial
finalement (le parent) ?</p>
<h2 id="comment-utiliser-un-template-react-jsx">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/#comment-utiliser-un-template-react-jsx">#</a>
      Comment utiliser un template React/JSX ?
    </h2><p>C‚Äôest bien simple. Dans notre cas, pas besoin de React c√¥t√© client. On doit g√©rer
√ßa c√¥t√© ¬´ serveur ¬ª (je mets √ßa entre guillemets puisque dans notre cas pr√©cis, c‚Äôest
pour g√©n√©rer un site statique, et c‚Äôest donc sur une machine quelconque que la
g√©n√©ration se fait).</p>
<p>Voil√† de quoi effectuer le rendu de nos composants vers du bon vieux HTML (car c‚Äôest la finalit√©
d‚Äôun <em>moteur de template</em>).</p>
<pre><code class="lang-js">import react from &quot;react&quot;
import markdownify from &quot;./markdown-parser&quot;
// je vous conseille marked pour rendre du markdown
// c&#39;est ce que nous utilisons pour rendre nos pages √† l&#39;heure o√π j&#39;√©cris ce post

const reactClass = require(&quot;./template/PostTemplate&quot;)
const component = new (react.createFactory(reactClass))({
  // ici on passe nos &quot;props&quot; react
  pageTitle: &quot;Test&quot;,
  pageContent: markdownify(&quot;Imaginons du **markdown** pars√©&quot;),
  // vous pouvez bien entendu rajouter d&#39;autres choses
  collections: {
    posts: [
      //...
    ]
  }
})

let html
try {
  html = react.renderToStaticMarkup(component)
}
catch (err) {
  // Vous devrez g√©rer votre exception selon votre environnement
  // si c&#39;est pour un test on peut simplement ne pas utiliser
  // try/catch, √ßa nous p√®tera √† la gueule et c&#39;est tant mieux
  throw err
}

// maintenant vous faites ce que vous voulez de votre string html !
// ex: require(&quot;fs&quot;).writeFile(...)
</code></pre>
<p>La m√©thode int√©ressante de React est dans notre cas <code>renderToStaticMarkup()</code> qui
va nous g√©n√©rer un HTML qui va bien.</p>
<p>Pour aller plus loin on pourrait d√©cider d‚Äôutiliser <code>renderToString()</code> plut√¥t que
<code>renderToStaticMarkup()</code> afin de pouvoir faire prendre le relais √† ReactJS c√¥t√© client
mais l√† <a href="/posts/js/reactjs-et-rendu-serverside/" >le niveau de complexit√© est diff√©rent</a>.</p>
<p>Pour la petite anecdote, notre site utilise actuellement <a href="http://www.metalsmith.io/" >metalsmith</a>,
une petite biblioth√®que simple mais qui permet par son API de faire des choses sympas.</p>
<p>J‚Äôai donc cod√© <a href="https://github.com/search?q=user%3AMoOx+metalsmith" >quelques plugins metalsmith</a>
dont un <a href="https://github.com/MoOx/metalsmith-react" >metalsmith-react</a> √† l‚Äôoccasion.</p>
<p>N‚Äôh√©sitez pas √† consulter
<a href="https://github.com/putaindecode/putaindecode.fr" >le code source de notre site</a>
pour faire des d√©couvertes sympas.</p>
]]></description>
            <link>http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/js/utiliser-react-en-moteur-de-templates/</guid>
            <pubDate>Thu, 07 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Impl√©menter Flux]]></title>
            <description><![CDATA[<p>Si vous n‚Äôavez pas encore lu
<a href="http://putaindecode.fr/posts/js/flux-qu-est-ce-c-est/" >l‚Äôintroduction √† flux</a>,
n‚Äôh√©sitez pas √† jeter un ≈ìil avant de lire ce post.</p>
<p>Une des choses importantes avec Flux, et pourtant pas √©videntes apr√®s lecture
<a href="https://github.com/facebook/flux/tree/master/examples/" >des exemples officiels</a>,
c‚Äôest que les stores doivent √™tre des instances, et non des singletons que
les composants r√©cup√®rent en d√©pendance directe.</p>
<p>La raison de cette n√©cessit√©, c‚Äôest la possibilit√© de servir une page
pre-rendue sur le serveur. En soi, vous devez imp√©rativement amorcer votre
dispatcher et vos stores dans le scope de la requ√™te, ou vos utilisateurs
se retrouveront avec des stores remplis de data ne leur appartenant pas.</p>
<p>Puisque l‚Äôint√©r√™t d‚Äôune solution comme react dans le cadre du server-side
rendering est d‚Äôutiliser les m√™mes composants que sur le client, il faut
que notre approche soit convenable sur nos deux environements.</p>
<p>La question d√®s lors est ¬´comment passer les stores √† nos composants react
maintenant qu‚Äôils ne sont plus des d√©pendances directes ?¬ª.</p>
<p>On va les passer via les <code>props</code> de parent √† enfant ? lolnope.
La plupart de nos composants n‚Äôauront pas conscience de la pr√©sence de ces
stores, et seront utilis√©s dans diff√©rents contextes. Et c‚Äôest justement
l‚ÄôAPI <code>context</code> que nous allons utiliser.</p>
<p>Cette API est assez simple, en soi, le <code>context</code> d‚Äôun composant est construit
au fur et √† mesure que ses anc√™tres d√©cident d‚Äôy ajouter de la data.</p>
<p>Exemple simple :</p>
<pre><code class="lang-javascript">import React, {Component, PropTypes} from "react"

class App extends Component {

  // on d√©finit les types de ce que l'on souhaite passer dans
  // le contexte
  static childContextTypes = {
    foo: PropTypes.string,
  }

  // on cr√©e une m√©thode qui retourne ce contexte
  getChildContext() {
    return {
      foo: this.props.foo,
    }
  }

  render() {
    return (
      &lt;div className="putainde-App"&gt;
        &lt;Container /&gt;
      &lt;/div&gt;
    )
  }
}

class Container extends Component {

  // les contextes sont *merged*, ce qui nous permet de le construire
  // sans se soucier du niveau auquel sera notre composant.
  static childContextTypes = {
    bar: PropTypes.string,
  }

  getChildContext() {
    return {
      bar: "oh hai",
    }
  }

  render() {
    return (
      &lt;div className="putainde-Container"&gt;
        &lt;IntermediaryComponent /&gt;
      &lt;/div&gt;
    )
  }

}

// ce composant n'a pas besoin de savoir que ses enfants on besoin
// de certaines propri√©t√©s du contexte
class IntermediaryComponent extends Component {
  render() {
    return (
      &lt;Content /&gt;
    )
  }
}

class Content extends Component {

  // pour chaque composant utilisant des propri√©t√©s du contexte,
  // on stipule ce dont on a besoin
  static contextTypes = {
    foo: PropTypes.string,
    bar: PropTypes.string,
  }

  render() {
    return (
      &lt;div className="putainde-Content"&gt;
        &lt;div className="putainde-Content-line"&gt;
          &lt;strong&gt;foo&lt;/strong&gt;: {this.context.foo}
        &lt;/div&gt;
        &lt;div className="putainde-Content-line"&gt;
          &lt;strong&gt;bar&lt;/strong&gt;: {this.context.bar}
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }

}

React.render(
  &lt;App foo={Date.now()} /&gt;,
  document.getElementById("App")
)
</code></pre>
<p>Cela nous donne cet output :
<a href="http://jsbin.com/zitohibaze/1/" >http://jsbin.com/zitohibaze/1/</a></p>
<p>Gr√¢ce √† cette API, on peut cr√©er des composants isol√©s, et dont les
composants parents n‚Äôauront pas n√©cessairement besoin de conna√Ætre le
contexte.</p>
<p>L‚Äôid√©e, pour en revenir √† Flux, c‚Äôest de passer notre dispatcher dans
ce contexte, et de placer les stores dans le dispatcher au moment de
l‚Äôamorce de l‚Äôapp.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> dispatcher = <span class="hljs-keyword">new</span> Dispatcher()

dispatcher.registerStore(<span class="hljs-keyword">new</span> SomeStore())
dispatcher.registerStore(<span class="hljs-keyword">new</span> SomeOtherStore())

React.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">App</span> <span class="hljs-attribute">dispatcher</span>=<span class="hljs-value">{dispatcher}</span> /&gt;</span>,
  document.getElementById("App")
)</span>
</code></pre>
<p>D√©sormais, pour avoir une API d√©cente pour r√©cuperer les donn√©es des stores,
on a deux principales solutions:</p>
<ul>
<li>utiliser un mixin</li>
<li>utiliser un higher-order component</li>
</ul>
<p>Puisque la direction que prend l‚ÄôAPI de React, √† terme, est de ne plus
fournir de mixins, et de laisser au TC39 le temps de prendre la bonne
d√©cision sur la fa√ßon dont JavaScript traitera la composition ; il semble
plus ad√©quat d‚Äôutiliser un higher-order component. Cela aura en plus
l‚Äôavantage de rendre le composant r√©cup√©rant les donn√©es <em>stateless</em>.</p>
<p>Ce genre d‚ÄôAPI ressemble √† √ßa :</p>
<pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComponentWithData</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  static stores = {
    <span class="hljs-comment">// nom du store: nom de la prop souhait√©e</span>
    MyStore: <span class="hljs-string">"my_store"</span>,
  }

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
        {/* la data est pass√©e via les props*/}
        {this.props.my_store.foo}
      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    )</span>
  }
}

<span class="hljs-comment">// storeReceiver wrap `ComponentWithData` dans un higher-order component</span>
<span class="hljs-comment">// et se charge de r√©cup√©rer le store dans le contexte pour les passer</span>
<span class="hljs-comment">// dans les props de `ComponentWithData`</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> storeReceiver(ComponentWithData)
</code></pre>
<p>Enfin, avec cette approche, les action creators que l‚Äôon voit dans les
exemples de flux ne peuvent plus garder la m√™me forme, puisqu‚Äôil ne doivent
plus avoir le dispatcher comme d√©pendance directe (ce dernier √©tant une
instance). Du coup, ce sont d√©sormais des fonctions pures :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> PostActions = {
  getPost(slug) {
    <span class="hljs-keyword">return</span> {
      type: ActionTypes.POST_GET,
      slug: slug,
    }
  },
  receivePost(res) {
    <span class="hljs-keyword">return</span> {
      type: ActionTypes.POST_RECEIVE,
      res,
    }
  },
  error(res) {
    <span class="hljs-keyword">return</span> {
      type: ActionTypes.POST_ERROR,
      res,
    }
  },
}
</code></pre>
<p>et nos composants utilisent :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> React, {Component, PropTypes} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> PostActions <span class="hljs-keyword">from</span> <span class="hljs-string">"actions/PostActions"</span>

class MyComponent extends Component {

  static contextTypes = {
    dispatcher: PropTypes.object,
  }

  static propTypes = {
    slug: PropTypes.string,
    title: PropTypes.title,
  }

  handleClick() {
    this.context.dispatcher.dispatch(
      PostActions.getPost(this.props.slug)
    )
  }

  render() {
    return (
      &lt;button
        onClick={() =&gt; this.handleClick()}&gt;
        {this.props.title}
      &lt;/button&gt;
    )
  }
}
</code></pre>
<p>Pour r√©sumer, les avantages de cette approche sont :</p>
<ul>
<li>un meilleur d√©couplage</li>
<li>une isolation solide des composants</li>
<li>la possibilit√© de pre-render sur le serveur</li>
<li>une testabilit√© accrue, puisqu‚Äôil est simple d‚Äôutiliser un mock ou des
instances cr√©es pour le test dans le contexte de nos composants.</li>
</ul>
<p>Bisous bisous.</p>
]]></description>
            <link>http://putaindecode.fr/posts/js/implementer-flux/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/js/implementer-flux/</guid>
            <pubDate>Fri, 01 May 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[HATEOAS, le Graal des d√©veloppeurs d'API]]></title>
            <description><![CDATA[<p>Nous vivons aujourd‚Äôhui dans un monde o√π tout devient service. Twitter, Facebook, Google Drive, GitHub, tout le monde y va de sa petite API pour que nous, geeks, puissions profiter pleinement des moult fonctionnalit√©s offertes par ces plateformes. Qu‚Äôentend-on par service ? Comment les rendre disponibles facilement et intelligemment ? On va essayer d‚Äôy r√©pondre ! </p>
<h2 id="les-webservices">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#les-webservices">#</a>
      Les webservices
    </h2><p>Rappelons juste, pour mettre tout le monde d‚Äôaccord, ce qui se passe pendant une simple navigation web.</p>
<ol>
<li>Tu tapes l‚Äôadresse de ton site pr√©f√©r√©</li>
<li>Le navigateur envoie la requ√™te</li>
<li>Le navigateur re√ßoit du code HTML et l‚Äôinterpr√®te, pour voir s‚Äôil faut charger d‚Äôautres choses</li>
<li>Le navigateur relance les requ√™tes pour charger les images, scripts et CSS</li>
<li>Le navigateur re√ßoit toutes les ressources et te les affiche dans sa fen√™tre.</li>
</ol>
<p>On parle donc de contenu qu‚Äôil faut afficher pour les √™tres humains, avec des images, des styles et des comportements qui facilitent l‚Äôergonomie et te permettent de dire <em>‚Äúwouaouw, ce site est vraiment beau, cool et pratique !‚Äù</em></p>
<p>Imaginons maintenant la m√™me chose, mais √† destination des programmes, qui ne consomment que de l‚Äôinformation brute et structur√©e, on ne va donc plus s‚Äôencombrer avec les CSS, les JS, et autres gifs anim√©s (oui, les gifs anim√©s, √ßa les fait pas marrer les machines‚Ä¶) ! On va se concentrer sur le contenu √©chang√© et sur les moyens utilis√©s pour optimiser ces √©changes.</p>
<h3 id="la-premiere-ecole-soap">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#la-premiere-ecole-soap">#</a>
      La premi√®re √©cole : SOAP
    </h3><p>Imaginons deux programmes qui veulent discuter en passant par le web. Dans les ann√©es 90, des mecs super brillants se sont dit : <em>‚ÄúOn va se baser sur le XML pour faire communiquer nos programmes sur le web‚Äù</em>.
L‚Äôapproche est assez logique et ing√©nieuse. Tout d‚Äôabord, les deux parties (le client et le serveur) se partagent une notice d‚Äôutilisation : la WSDL (Web Service Description Language), qui est un document XML d√©crivant toutes les m√©thodes qui peuvent √™tre appel√©es par le client sur le serveur, avec les structures de donn√©es disponibles pour ces √©changes.
Le client pr√©pare donc sa demande et l‚Äôenveloppe dans une grosse structure XML contenant toutes les m√©tadonn√©es (m√©thode appel√©e, signature num√©rique, etc.). Une fois que le serveur a re√ßu cette demande, il la traite et r√©pond aussi dans une grosse enveloppe XML.</p>
<p>Tu viens de comprendre le SOAP (Service Oriented Application Protocol), aucun rapport avec une quelconque savonnette du coup. Cette m√©thode a fait ses preuves puisqu‚Äôelle fait tourner encore aujourd‚Äôhui des milliers de syst√®mes tr√®s complexes et tr√®s fiables.</p>
<h3 id="la-maison-d-en-face-rest">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#la-maison-d-en-face-rest">#</a>
      La maison d‚Äôen face : REST
    </h3><p>Plusieurs ann√©es ont pass√©es et les esprits ont √©volu√©. On a commenc√© √† entendre des grandes d√©clarations comme : <em>‚ÄúLe SOAP c‚Äôest vraiment lourdingue !‚Äù</em>, <em>‚ÄúLe protocole HTTP est sous-exploit√© !‚Äù</em> ou encore <em>‚ÄúLes enveloppes XML et les WSDL ? Merci bien !‚Äù</em> et c‚Äôest √† ce moment-l√† qu‚Äôon a donn√© un acronyme bidon pour d√©crire le protocole HTTP sans vraiment le nommer : REST (REpresentational State Transfert). Pour l‚Äôanecdote, tout le monde s‚Äôaccorde √† dire que cet acronyme ne veut rien dire ;)</p>
<p>Le but du jeu est donc d‚Äôutiliser au maximum les possibilit√©s du protocole HTTP, les verbes, les URL et les codes retours pour d√©crire des API de la mani√®re la plus fid√®le possible. On a donc gagn√© en simplicit√© et la communication entre machines se veut d√©sormais √† la port√©e de tous. Je reviendrai en d√©tail sur le protocole HTTP un peu plus tard.</p>
<h3 id="un-partout-balle-au-centre">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#un-partout-balle-au-centre">#</a>
      Un partout : balle au centre
    </h3><p>Je tiens √† remettre les choses au clair. On entend beaucoup trop souvent : <em>‚ÄúFais du REST, SOAP c‚Äôest nul‚Äù</em>. Il y a en effet clairement un effet de mode ! Les API REST pullulent et sont vraiment tr√®s pratiques. Toutefois, dans les gros syst√®mes n√©cessitant du RPC ou encore de la signature num√©rique, pour les √©changes de donn√©es m√©dicales par exemple, le contrat WSDL et la rigueur du XML sont clairement des alli√©s ! </p>
<h2 id="alors-comme-ca-http-ca-fait-tout">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#alors-comme-ca-http-ca-fait-tout">#</a>
      Alors comme √ßa, HTTP √ßa fait tout ?
    </h2><p>Il y a un type qui s‚Äôappelle Leonard Richardson et qui a mis en place un <a href="http://martinfowler.com/articles/richardsonMaturityModel.html" >mod√®le de maturit√©</a> pour qualifier les API webservice.</p>
<h3 id="niveau-0">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#niveau-0">#</a>
      Niveau 0
    </h3><p>C‚Äôest le minimum acceptable dans la communication HTTP :</p>
<ul>
<li>Toutes les requ√™tes sont envoy√©es √† la m√™me URL, quelle que soit la demande.</li>
<li>Toutes les requ√™tes sont envoy√©es avec le verbe POST.</li>
<li>Quel que soit le type de retour (donn√©e ou erreur), le code HTTP retourn√© par le serveur sera toujours 200 (OK, tout s‚Äôest bien pass√©).</li>
<li>Le contenu √©chang√© est majoritairement du XML (pour les enveloppes notamment).</li>
</ul>
<p>Quand on fait du webservice avec SOAP, c‚Äôest ce niveau qui est utilis√© lors de la communication HTTP.</p>
<h3 id="niveau-1">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#niveau-1">#</a>
      Niveau 1
    </h3><p>Avec ce premier niveau, on essaye d‚Äôenrichir un peu plus l‚Äôutilisation. On ajoute la notion de <em>ressource</em>, en fonction de la donn√©e m√©tier manipul√©e, l‚ÄôURL de la requ√™te sera diff√©rente. La preuve par l‚Äôexemple :</p>
<ul>
<li><strong><em>POST /agenda</em></strong> : permet de travailler avec les donn√©es de l‚Äôagenda de l‚Äôapplication</li>
<li><strong><em>POST /customers</em></strong> : permet de travailler avec le registre des clients  </li>
</ul>
<p>On profite aussi de la vue hi√©rarchique que nous proposent les URL :</p>
<ul>
<li><strong><em>POST /customers/42</em></strong> : permet de travailler avec le client qui poss√®de l‚Äôidentifiant 42</li>
</ul>
<p>Rien qu‚Äôen tra√ßant les URL appel√©es sur le serveur, on peut comprendre ce que le client HTTP cherche √† faire‚Ä¶ pas d√©gueu, non ?</p>
<h3 id="niveau-2">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#niveau-2">#</a>
      Niveau 2
    </h3><p>Le protocole HTTP utilise des verbes pour les requ√™tes et des codes num√©riques pour les retours. Ce sont ces deux m√©canismes qui seront utilis√©s en compl√©ment du niveau 1.</p>
<p>Les principaux verbes HTTP que l‚Äôon utilise sont GET, POST, PUT et DELETE. Leur nom est d√©j√† tr√®s √©vocateur.</p>
<ul>
<li><strong><em>GET /customers/42</em></strong> pour r√©cup√©rer les informations du client 42</li>
<li><strong><em>PUT /customers</em></strong> <em>(+ corps de la requ√™te)</em> pour enregistrer un nouveau client</li>
<li><strong><em>POST /customers/42</em></strong> <em>(+ corps de la requ√™te)</em> pour mettre √† jour les informations du client 42</li>
<li><strong><em>DELETE /customers/42</em></strong> pour supprimer le client 42</li>
</ul>
<p>Facile, non ? La r√©ponse du serveur devient tout aussi logique gr√¢ce aux codes HTTP.
Ces codes sont juste des nombres de 3 chiffres respectant cette logique :</p>
<ul>
<li><strong><em>1xx</em></strong> : <em>‚ÄúJe suis en train de bosser, attends encore un peu.‚Äù</em></li>
<li><strong><em>2xx</em></strong> : <em>‚ÄúVoil√† le r√©sultat, √ßa s‚Äôest bien pass√©.‚Äù</em></li>
<li><strong><em>3xx</em></strong> : <em>‚ÄúLe contenu est d√©plac√©, va voir ailleurs (cf. en-t√™te location).‚Äù</em></li>
<li><strong><em>4xx</em></strong> : <em>‚ÄúTu me demandes n‚Äôimporte quoi, tu as merd√©.‚Äù</em></li>
<li><strong><em>5xx</em></strong> : <em>‚ÄúJ‚Äôai merd√©‚Ä¶‚Äù</em></li>
</ul>
<p>Parmi les plus connus, on a donc 404 (<em>‚Äútu me demandes quelque chose qui n‚Äôexiste pas‚Äù</em>), 403 (<em>‚Äúacc√®s interdit‚Äù</em>), 304 (<em>‚Äúpas la peine de m‚Äôemmerder, la donn√©e est dans ton cache‚Äù</em>) et bien s√ªr 200 (<em>‚ÄúOK, tout va bien‚Äù</em>).</p>
<p>Et si les codes HTTP sont ta nouvelle passion, je te sugg√®re de te documenter sur le code <a href="http://fr.wikipedia.org/wiki/Hyper_Text_Coffee_Pot_Control_Protocol" >418</a> !</p>
<h3 id="niveau-3-hateoas">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#niveau-3-hateoas">#</a>
      Niveau 3 : HATEOAS
    </h3><p>Alors on a les verbes HTTP et les codes retours. √Ä quoi peut ressembler le Graal des API REST alors ? Si on r√©fl√©chit un peu, on peut se dire qu‚Äôil faudrait, pour toutes les URL, donner un code retour HTTP coh√©rent pour chaque verbe, logique non ? De cette mani√®re, on peut entamer un v√©ritable dialogue avec le serveur HTTP, enti√®rement bas√© sur REST. Voil√† une bonne nouvelle pour ceux qui veulent tailler une bavette ailleurs que sur Google Hangouts !</p>
<p>Un petit exemple de dialogue : </p>
<pre><code>&gt; <span class="hljs-type">GET</span> /customers/<span class="hljs-number">42</span>
<span class="hljs-number">200</span> <span class="hljs-type">OK</span>

&gt; <span class="hljs-type">PUT</span> /customers/<span class="hljs-number">42</span> <span class="hljs-decorator">{...}</span>
<span class="hljs-number">409</span> <span class="hljs-type">Conflict</span>

&gt; <span class="hljs-type">DELETE</span> /customers/<span class="hljs-number">42</span>
<span class="hljs-number">204</span> <span class="hljs-type">No</span> <span class="hljs-type">Content</span>

&gt; <span class="hljs-type">GET</span> /customers/<span class="hljs-number">42</span>
<span class="hljs-number">404</span> <span class="hljs-type">Not</span> <span class="hljs-type">Found</span>
</code></pre><p>C‚Äôest un bon d√©but, mais ce niveau 3 va quand m√™me un peu plus loin ! N‚Äôas-tu jamais trouv√© g√©nial qu‚Äôavec de simples liens dans les pages web, tu pouvais naviguer des heures et des heures ? </p>
<p>Pourquoi ne pas ajouter des liens dans les ressources retourn√©es via REST ? Nous venons de mettre le doigt sur HATEOAS (<em>Hypermedia As The Engine Of Application State</em>). On peut d√©sormais imaginer un tas de choses comme :</p>
<ul>
<li>Quand on renvoie un tableau json par exemple, dans chaque item, <ul>
<li>on peut ajouter les liens qui permettent de le mettre √† jour ;</li>
<li>on peut ajouter les liens qui permettent de r√©cup√©rer des donn√©es li√©es comme l‚Äôauteur d‚Äôun livre, les mentions d‚Äôun tweet, etc. ;</li>
<li>on peut ajouter l‚ÄôURL de putaindecode.fr.</li>
</ul>
</li>
</ul>
<p>Voici un exemple de trame JSON avec les informations HATEOAS. Pour information, il s‚Äôagit d‚Äôun webservice qui permet de lister des conf√©rences.</p>
<pre><code><span class="hljs-collection">[
  <span class="hljs-collection">{
    <span class="hljs-string">"conference"</span>: <span class="hljs-collection">{
      <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">"links"</span>: <span class="hljs-collection">[
        <span class="hljs-collection">{
          <span class="hljs-string">"rel"</span>: <span class="hljs-string">"list"</span>,
          <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/conferences/"</span>
        }</span>,
        <span class="hljs-collection">{
          <span class="hljs-string">"rel"</span>: <span class="hljs-string">"self"</span>,
          <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/conferences/1"</span>
        }</span>
      ]</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Take Off Conf 2013"</span>,
      <span class="hljs-string">"startDate"</span>: <span class="hljs-string">"2013-01-17T00:00:00+01:00"</span>,
      <span class="hljs-string">"endDate"</span>: <span class="hljs-string">"2013-01-18T00:00:00+01:00"</span>,
      <span class="hljs-string">"talks"</span>: <span class="hljs-collection">[
        <span class="hljs-collection">{
          <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-string">"speakerName"</span>: <span class="hljs-string">"Jakob Mattsson"</span>,
          <span class="hljs-string">"title"</span>: <span class="hljs-string">"You are not service oriented enough!"</span>,
          <span class="hljs-string">"links"</span>: <span class="hljs-collection">[
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"self"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/1"</span>
            }</span>,
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"list"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/"</span>
            }</span>
          ]</span>
        }</span>,
        <span class="hljs-collection">{
          <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
          <span class="hljs-string">"speakerName"</span>: <span class="hljs-string">"Olivier Lacan"</span>,
          <span class="hljs-string">"title"</span>: <span class="hljs-string">"Science-based development"</span>,
          <span class="hljs-string">"links"</span>: <span class="hljs-collection">[
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"self"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/2"</span>
            }</span>,
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"list"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/"</span>
            }</span>
          ]</span>
        }</span>,
        <span class="hljs-collection">{
          <span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>,
          <span class="hljs-string">"speakerName"</span>: <span class="hljs-string">"Xavier Coulon"</span>,
          <span class="hljs-string">"title"</span>: <span class="hljs-string">"Build your website with awestruct and publish..."</span>,
          <span class="hljs-string">"links"</span>: <span class="hljs-collection">[
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"self"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/3"</span>
            }</span>,
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"list"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/"</span>
            }</span>
          ]</span>
        }</span>,
        <span class="hljs-collection">{
          <span class="hljs-string">"id"</span>: <span class="hljs-number">4</span>,
          <span class="hljs-string">"speakerName"</span>: <span class="hljs-string">"R√©mi Parmentier"</span>,
          <span class="hljs-string">"title"</span>: <span class="hljs-string">"Design for developers"</span>,
          <span class="hljs-string">"links"</span>: <span class="hljs-collection">[
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"self"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/4"</span>
            }</span>,
            <span class="hljs-collection">{
              <span class="hljs-string">"rel"</span>: <span class="hljs-string">"list"</span>,
              <span class="hljs-string">"href"</span>: <span class="hljs-string">"http://localhost:8080/hateoas-webservice/rs/talks/"</span>
            }</span>
          ]</span>
        }</span>
      ]</span>
    }</span>
  }</span>,<span class="hljs-collection">{
  ...
  }</span> 
]</span>
</code></pre><p>Dans cette trame, tu auras remarqu√© les objets dans les tableaux nomm√©s ‚Äúlinks‚Äù, ce sont les liens disponibles pour chacun des objets renvoy√©s ! On peut imaginer qu‚Äôen fonction des droits de l‚Äôutilisateur courant, il y ait plus ou moins de liens.</p>
<h2 id="est-ce-que-c-est-standard">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#est-ce-que-c-est-standard">#</a>
      Est-ce que c‚Äôest standard ?
    </h2><p>Eh bien non ! Il n‚Äôy a pas vraiment de convention pour l‚Äô√©criture des liens dans les trames renvoy√©es. Cela d√©pend du format renvoy√© dans un premier temps. Comment formaliser un standard si on renvoie en JSON, XML et YML en fonction des en-t√™tes HTTP du client ?</p>
<p>De la m√™me mani√®re, tu auras remarqu√© que l‚Äôon ne pr√©cise pas le verbe HTTP √† utiliser sur les URL. C‚Äôest la raison pour laquelle il faut impl√©menter un retour coh√©rent pour tous les verbes HTTP courants !</p>
<p>Et pour finir, comment conna√Ætre le format du document JSON accept√© avec les requ√™tes POST par exemple ? Il n‚Äôy a pas non plus de r√®gle ! On pourrait imaginer par exemple un document ‚Äútype‚Äù qui serait renvoy√© apr√®s une requ√™te ‚ÄúOPTION‚Äù sur l‚ÄôURL.</p>
<p>Il y a toutefois quelques exp√©rimentations comme <a href="http://en.wikipedia.org/wiki/Hypertext_Application_Language" >HAL</a> ou encore <a href="http://jsonapi.org/" >JSON API</a> qui tentent de normaliser un peu ce flou artistique.</p>
<p>Tu fais ta petite popote ! Tu fais comme tu veux ! √áa a du bon aussi !</p>
<h2 id="bon-ok-je-fais-comment-pour-le-mettre-en-place-maintenant">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#bon-ok-je-fais-comment-pour-le-mettre-en-place-maintenant">#</a>
      ‚ÄúBon ok, je fais comment pour le mettre en place maintenant ?‚Äù
    </h2><p>Tu remontes tes manches et tu te d√©merdes !</p>
<p>Il y a quelques frameworks qui vont te donner un coup de main. Dans le monde Java par exemple, il existe <a href="http://docs.jboss.org/resteasy/docs/2.0.0.GA/userguide/html/LinkHeader.html" >Resteasy-links</a> (avec un exemple d‚Äôutilisation <a href="https://github.com/awillemant/hateoas-example" >sur mon repo GitHub</a>), ou encore <a href="http://projects.spring.io/spring-hateoas/" >Spring HATEOAS</a></p>
<p>Pour les <em>Nodistes</em>, une simple recherche sur <a href="https://www.npmjs.com/search?q=hateoas" >npmjs</a> renverra un tas d‚Äôoutils ! </p>
<h2 id="references">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/api/hateoas/#references">#</a>
      R√©f√©rences
    </h2><p>Oui, parce qu‚Äôil y a des gens bien plus brillants que moi pour vous convaincre sur l‚ÄôHypermedia !</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/HATEOAS" >Wikip√©dia</a></li>
<li><a href="http://martinfowler.com/articles/richardsonMaturityModel.html" >Blog de Martin Fowler</a></li>
<li>Les travaux de Steve Klabnik, Rubyiste reconnu (ex : <a href="https://www.youtube.com/watch?v=g4sqydY3hHU" >Designing Hypermedia APIs</a>)</li>
<li>Ori Pekelman : <a href="https://www.youtube.com/watch?v=ZZxOaCP8vyg" >son talk √† la Take Off Conf 2014</a></li>
<li><a href="http://blog.xebia.fr/2014/03/17/post-vs-put-la-confusion/" >Un excellent article de Xebia sur la bonne utilisation de POST et PUT</a></li>
</ul>
]]></description>
            <link>http://putaindecode.fr/posts/api/hateoas/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/api/hateoas/</guid>
            <pubDate>Thu, 12 Mar 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Du CSS √©volutif]]></title>
            <description><![CDATA[<p>Modulaire, maintenable, r√©utilisable, accessible. Ces termes sont au c≈ìur de nos m√©tiers et on nous les rab√¢che toute la journ√©e.</p>
<p>Malgr√© la grossi√®ret√© de ces mots pour certains d‚Äôentre vous, il est tout √† fait possible de pondre du CSS en utilisant tous ces principes.</p>
<h2 id="maintenable">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#maintenable">#</a>
      Maintenable
    </h2><p>L‚Äôun des trucs les plus chiants du CSS c‚Äôest bien la cascade, qui, malgr√© sa bonne volont√©, n‚Äôapporte pas que des solutions. Pour pallier aux probl√®mes que l‚Äôon peut vite cr√©er, <a href="http://putaindecode.fr/posts/css/petite-definition-bem/" >la m√©thodologie BEM</a> a vu le jour avec son <a href="http://blog.kaelig.fr/post/48196348743/fifty-shades-of-bem" >lot de variantes</a>.</p>
<p>La grande majorit√© des membres de p! utilisent cette convention :</p>
<pre><code class="lang-css"><span class="hljs-class">.MyComponent</span> <span class="hljs-rules">{}</span>
<span class="hljs-class">.MyComponent</span><span class="hljs-class">.is-state</span> <span class="hljs-rules">{}</span>
<span class="hljs-class">.MyComponent--modifier</span> <span class="hljs-rules">{}</span>

<span class="hljs-class">.MyComponent-element</span> <span class="hljs-rules">{}</span>
<span class="hljs-class">.MyComponent-anotherElement</span> <span class="hljs-rules">{}</span>
</code></pre>
<p>D‚Äôun coup d‚Äô≈ìil, on devine la structure <code>HTML</code> qui en d√©coule et l‚Äôutilit√© de chaque √©l√©ment. Les √©tats sont toujours les m√™mes et clairement identifiables car commen√ßant par <code>is-*</code>, de m√™me que les √©l√©ments d√©finis par <code>-</code> ainsi que les modificateurs <code>--</code>.</p>
<p>Avec cette m√©thodologie rares sont les s√©lecteurs d√©passant :</p>
<pre><code class="lang-css"><span class="hljs-class">.MyComponent-element</span> <span class="hljs-class">.MyComponent-anotherElement</span> <span class="hljs-rules">{}</span>
</code></pre>
<p>L‚Äôint√©r√™t ? Apporter de la s√©mantique √† notre code CSS, en utilisant des classes, des classes et des classes afin de clairement s‚Äôabstraire de la cascade. Finis les <code>!important</code>, on √©vite ainsi les probl√®mes d‚Äô√©l√©ments et les soudains changements de structure HTML qui te forcent √† r√©√©crire tes s√©lecteurs.</p>
<p>Cette m√©thode est d‚Äôailleurs, entre autres, utilis√©e par <a href="http://twitter.com" >Twitter</a> via <a href="http://suitcss.github.io/" >SUIT CSS</a>.</p>
<h2 id="modulaire">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#modulaire">#</a>
      Modulaire
    </h2><p>Partant de notre m√©thodologie, on va d√©velopper notre site web comme un gros Lego. Chaque partie graphique de notre projet sera un composant, une brique.</p>
<p>On pourrait imaginer des √©l√©ments comme <code>NavBar</code>, <code>Pagination</code>, <code>Article</code> que l‚Äôon va assembler au fur et √† mesure de notre d√©veloppement. Notre site sera compos√© de plusieurs dizaines de fichiers (<code>Composant</code>), mais aucun n‚Äôexc√®dera quelques centaines de lignes, grand maximum. Beaucoup plus facile √† d√©bugger et donc sur le long terme plus maintenable.</p>
<p>Il va de soi qu‚Äôon utilisera son outil pr√©f√©r√© pour concat√©ner et minimiser le tout en un seul fichier, sinon on risque d‚Äôavoir quelques probl√®mes de <em>webperf</em>.</p>
<h2 id="accessible">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#accessible">#</a>
      Accessible
    </h2><p>Pour obtenir un design adaptatif ou accessible, il est n√©cessaire d‚Äôutiliser des unit√©s dites relatives. C‚Äôest √† ce moment qu‚Äôinterviennent les unit√©s stars du moment que sont <code>em</code> et <code>rem</code>.</p>
<p>Mais voil√† que <code>em</code> rencontre un inconv√©nient majeur, encore et toujours notre fameuse cascade. Chaque √©l√©ment d√©pend de son propre <code>font-size</code> ou de celui de son parent. Alors, vous imaginez l‚Äô√©l√©ment de l‚Äô√©l√©ment de l‚Äô√©l√©ment. On peut vite perdre les p√©dales. Je vous vois venir avec l‚Äôunit√© <code>rem</code>. Effectivement on r√©sout compl√®tement le probl√®me de la cascade, mais on perd en modularit√©.</p>
<p>Prenons notre exemple de <code>NavBar</code>, voici comment on pourrait commencer ce composant :</p>
<pre><code class="lang-css"><span class="hljs-class">.NavBar</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1rem</span></span></span>;
}</span>
  <span class="hljs-class">.NavBar-item</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> .<span class="hljs-number">875em</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">1em</span></span></span>;
  }</span>
</code></pre>
<p>Notre classe principale √©tant d√©finie en <code>rem</code>, il devient alors tr√®s facile de calculer l‚Äôensemble de ces <code>-item</code> en <code>em</code>.
On diminue ainsi de nouveau les probl√®mes de cascade. De plus, on peut tr√®s facilement augmenter la taille g√©n√©rale de notre composant, en augmentant la taille de son <code>font-size</code> dans sa classe principale.
On atteint alors un double objectif : en plus d‚Äô√™tre accessible en supprimant les pixels, on rend notre composant r√©utilisable sur d‚Äôautres projets en s‚Äôadaptant tr√®s facilement √† son contexte.</p>
<h2 id="namespace">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#namespace">#</a>
      Namespace
    </h2><p>On utilise tous des scripts <code>vendors</code>. Pour √©viter les collisions avec ceux-ci et encore une fois √† cause de cette maudite cascade, voici un petit truc qui vous √©vitera de modifier vos classes : l‚Äôajout d‚Äôun namespace √† nos composants.</p>
<p>On va utiliser notre exemple de tout √† l‚Äôheure avec <code>NavBar</code> :</p>
<pre><code class="lang-css"><span class="hljs-class">.putainde-NavBar</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1rem</span></span></span>;
}</span>
  <span class="hljs-class">.putainde-NavBar-item</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> .<span class="hljs-number">875em</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">1em</span></span></span>;
  }</span>
</code></pre>
<h2 id="pour-finir">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#pour-finir">#</a>
      Pour finir
    </h2><p>C‚Äôest verbeux, on ne peut pas le nier. Par moment, on peut se dire qu‚Äô√©crire une classe seulement pour une propri√©t√©, est-ce si pertinent que √ßa ? Sauf qu‚Äôau moment ou vous √©crivez votre <code>css</code> vous ne pouvez pas dire qu‚Äô√† la prochaine mise √† jour, il vous faudra peut-√™tre en rajouter 5, et donc votre classe sera finalement bien utile.</p>
<p>Toutes ces m√©thodes m‚Äôont fait abandonner <code>Sass</code> et son framework <code>Compass</code>. Ce qu‚Äôapporte un langage comme <code>Sass</code> (au-del√† de l‚Äôaspect programmation, mais c‚Äôest une autre histoire) vient principalement de ses features telles que  <a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html#nested_rules" >nested</a> et <a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html#extend" >@extend</a>. Et franchement, une bonne indentation, un bon nommage de classes et une utilisation intelligente de <code>BEM</code> vous feront vite oublier <code>Sass</code> sans regarder en arri√®re.</p>
<p>Sur l‚Äôensemble de mes projets, je n‚Äô√©cris plus que ce qu‚Äôon appelle commun√©ment du <code>Vanilla CSS</code>. Petit b√©mol quand m√™me, histoire de pouvoir utiliser des sp√©cifications pas forc√©ment encore compatibles sur tous les navigateurs, j‚Äôai ajout√© dans mon workflow l‚Äôoutil <a href="https://github.com/postcss/postcss" >PostCSS</a>, le tout contr√¥l√© par <a href="http://cssnext.github.io/" >cssnext</a> dont voici quelques exemples d‚Äô<a href="https://cssnext.github.io/cssnext-playground/" >utilisation</a>.</p>
<p>Je vous encourage vivement √† tester ces deux outils (<a href="https://github.com/postcss/postcss" >PostCSS</a> ou <a href="http://cssnext.github.io/" >cssnext</a>) qui vous apporteront variables, manipulation des couleurs, etc, ainsi que concat√©nation des <code>@import</code> tout en conservant du CSS valide (selon les sp√©cifications).</p>
<h2 id="le-truc-du-moment">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/css/du-css-evolutif/#le-truc-du-moment">#</a>
      Le truc du moment
    </h2><p>Avant de terminer cet article, je voulais mentionner l‚Äôid√©e/concept qui commence √† faire son petit bout de chemin √† savoir le <code>style inline</code>.</p>
<p>Cela revient tout simplement √† √©crire directement le CSS dans son code <code>HTML</code></p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"font-size:1rem"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"font-size:.875em; padding:1em"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Avant d‚Äôhurler au blasph√®me ou au scandale, il est n√©cessaire de mettre en ad√©quation cette id√©e avec les contraintes rencontr√©es lors du d√©veloppement d‚Äôune application utilisant principalement du <code>JavaScript</code>.</p>
<p>Si vous souhaitez un peu plus d‚Äôinformations sur le sujet, je vous invite √† lire la <a href="https://speakerdeck.com/vjeux/react-css-in-js" >pr√©sentation</a> de <a href="https://twitter.com/Vjeux" >@Vjeux</a>, front-end engineer chez Facebook. Il explique les probl√®mes rencontr√©s avec le <code>CSS</code> et les solutions mises en place par les d√©veloppeurs de Facebook ou plus exactement de <code>ReactJS</code>.</p>
]]></description>
            <link>http://putaindecode.fr/posts/css/du-css-evolutif/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/css/du-css-evolutif/</guid>
            <pubDate>Tue, 10 Mar 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Il d√©marre Vim par erreur, ce qui se passe ensuite est tout simplement bluffant]]></title>
            <description><![CDATA[<blockquote>
<p>√Ä premi√®re vue, vous allez √©prouver de la tristesse, mais ce qui se passe ensuite est tout simplement incroyable‚Ä¶</p>
<p>Alors qu‚Äôil √©tait en train d‚Äôeffectuer une mise en production,
ce d√©veloppeur s‚Äôest confront√© √† une situation qui aurait pu compl√®tement d√©raper.
Une intervention directement sur le serveur de production √©tait obligatoire afin d‚Äô√©diter la base de donn√©es au format .txt.</p>
<p>Apr√®s avoir pass√© plusieurs heures pour se connecter √† distance via une connexion s√©curis√©e,
Maxime est tomb√© nez √† nez avec une console d‚Äôadministration en ligne de commande !
Il √©tait compl√®tement d√©sempar√© par l‚Äôabsence de fen√™tre.</p>
<p>Ce qui s‚Äôest pass√© ensuite est tout simplement incroyable :
fort de sa pers√©v√©rance, Maxime d√©cide tout de m√™me de se rapprocher du clavier !
Apr√®s une rapide recherche sur les Internets,
il tape la premi√®re commande qu‚Äôil trouve :</p>
<pre><code class="lang-console"><span class="hljs-variable">$ </span>vim
</code></pre>
<p>Alors qu‚Äôon pourrait imaginer un drame, comme il arrive souvent quand <a href="https://duckduckgo.com/?q=I+am+stuck+in+VIM" >une personne tombe dans ce pi√®ge</a>,
Maxime ne s‚Äôest pas laiss√© abattre et a persist√© dans sa d√©marche‚Ä¶</p>
</blockquote>
<p>Bon, assez plaisant√©.</p>
<h2 id="_pourquoi-j-essayerais-vim-_">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/#_pourquoi-j-essayerais-vim-_">#</a>
      <em>Pourquoi j‚Äôessayerais Vim ?</em>
    </h2><p>J‚Äôai commenc√© par Eclipse. Qu‚Äôil fallait r√©installer assez souvent sans quoi on perdait 10 minutes de sa vie √† chaque ouverture d‚Äôautocomplete.
Je suis pass√© par NetBeans, WebStorm‚Ä¶ Sans √™tre convaincu. Plus r√©cemment, j‚Äô√©tais assez content sous Sublime Text avant d‚Äôessayer Atom
(car en gros Atom est quasiment la m√™me chose, en technologie web, open source et fait par GitHub).
Mais j‚Äôai toujours eu envie de me la p√©ter devant 2 √©crans tout noir,
en ligne de commande, comme dans les super productions am√©ricaines.</p>
<p>Plus s√©rieusement, je passe de plus en plus de temps devant ma console‚Ä¶
Enfin vous savez, le terminal, pas l‚Äôautre truc un peu plus fun (et encore que).</p>
<p>J‚Äôai toujours eu envie de comprendre pourquoi autant de gens (car mine de rien il y en a un paquet) utilisaient Vim,
et se moquaient un bon coup √† chaque sortie d‚Äôun nouvel √©diteur.
Car bon faut avouer, se moquer c‚Äôest facile.
Du coup un jour, j‚Äôai d√©marr√© Vim.</p>
<h2 id="_pourquoi-j-ai-rien-compris-quand-je-me-suis-retrouve-dans-vim-_">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/#_pourquoi-j-ai-rien-compris-quand-je-me-suis-retrouve-dans-vim-_">#</a>
      <em>Pourquoi j‚Äôai rien compris quand je me suis retrouv√© dans Vim ?</em>
    </h2><p>Le truc le plus d√©routant dans Vim, c‚Äôest les modes.
Et quand on ouvre Vim, on ne se retrouve pas dans le mode le plus logique (√† premi√®re vue).</p>
<p>En fait, ce qu‚Äôon dit pas trop, c‚Äôest que Vim est toujours utilis√© aujourd‚Äôhui car on peut l‚Äôutiliser uniquement au clavier.
Vous allez me r√©pondre qu‚Äôon peut en faire de m√™me avec tous les √©diteurs de texte.</p>
<p>Mais <strong>Vim a clairement √©t√© d√©velopp√© pour minimiser les d√©placements des mains</strong>.</p>
<p>C‚Äôest pour moi la chose la plus importante √† retenir. Et la chose la plus attractive.
Les bons d√©veloppeurs ont tous une bonne flemme au fond d‚Äôeux, c‚Äôest bien connu.</p>
<p>Pour un peu plus sur l‚Äôhistoire de Vim, direction <a href="https://fr.wikipedia.org/wiki/Vim" >wikipedia.org/wiki/Vim</a>.</p>
<h2 id="commencer-avec-vim">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/#commencer-avec-vim">#</a>
      Commencer avec Vim
    </h2><p>Du coup, quand je suis dans Vim, comment √ßa se passe ?</p>
<p>Je passerai plus tard assez rapidement sur les diff√©rents points, vu que d‚Äôautres ressources,
dont notamment le livre <a href="https://vimebook.com/" >Vim pour les humains</a>, le font tr√®s bien en douceur.</p>
<p>C‚Äôest d‚Äôailleur gr√¢ce √† ce livre que je me suis lanc√©.
Je tiens donc √† remercier <a href="http://viserlalune.com/" >Vincent Jousse</a> pour avoir pris le temps d‚Äô√©crire cet ouvrage.</p>
<p>Profitez de cet ouvrage, en plus <a href="http://ploum.net/le-prix-libre-une-impossible-utopie/" >le prix est libre</a>.
Et puis quand on pense au prix des licences de certains IDE‚Ä¶</p>
<p>Ce livre est fait pour n‚Äôimporte qui, d√©butant ou pas.
Vraiment, mangez-en si vous souhaitez essayer Vim (oui je sais, manger un e-book comme √ßa, √ßa para√Æt pas √©vident).</p>
<p>J‚Äôai essay√© plusieurs fois sans trop savoir o√π commencer, sans succ√®s.
Ce livre m‚Äôa aid√© et se d√©vore en quelques dizaines de minutes (deux ou trois heures grand max),
clavier sous les mains (bah oui rien de mieux pour se lancer).</p>
<p>J‚Äôai essay√© et me voil√† conquis, une fois que j‚Äôai compris sa valeur ajout√©e.</p>
<p>Pour bien s‚Äôy prendre, forcez-vous √† travailler avec Vim au moins une journ√©e en suivant les conseils que vous trouverez dans cet ouvrage.
Cela a fonctionn√© pour moi : je gagne d√©j√† du temps au bout de quelques semaines d‚Äôutilisation.</p>
<p>Pourquoi pas vous ?</p>
<h2 id="pour-apprendre-vim">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/#pour-apprendre-vim">#</a>
      Pour apprendre Vim
    </h2><p>Vous pouvez donc :</p>
<ul>
<li>lire l‚Äôe-book <a href="http://vimebook.com" >Vim pour les humains</a></li>
<li>lancer la commande <code>vimtutor</code></li>
<li>jouer √† <a href="http://vim-adventures.com/" >Vim Adventures</a></li>
<li>vous entra√Æner sur des exemples concrets avec <a href="http://vimgolf.com/" >VimGolf</a></li>
</ul>
<p>Voici aussi un cheatsheet indispensable qui permet de bien m√©moriser le pourquoi des touches
(b = begin, w = word, e = end, r = replace, i = insert, a = append, o = open, ctrl f = forward, ctrl b = backward, etc).</p>
<p><img src="http://putaindecode.fr/posts/vim/vim-cheatsheet.gif" alt="cheatsheet VIM"></p>
<p>Vous remarquerez que souvent les commandes en majuscules font la m√™me chose mais dans le sens inverse (f/F, o/O), ou de mani√®re plus cat√©gorique (d/D, y/Y).</p>
<h2 id="passer-a-vim-est-un-investissement">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/#passer-a-vim-est-un-investissement">#</a>
      Passer √† Vim est un investissement
    </h2><p>Point important : il faut avoir envie.
Il ne s‚Äôagit pas de changer simplement d‚Äô√©diteur, car on doit compl√®tement changer ses habitudes.
Plus aucun raccourci clavier que vous avez l‚Äôhabitude d‚Äôutiliser ne va fonctionner.
Je me r√©p√®te mais il faut se forcer un minimum avant d‚Äôimaginer les possibilit√©s de cet √©diteur.</p>
<p>Cela dit, on peut rapidement voir la puissance de Vim apr√®s quelques heures d‚Äôutilisation
(m√™me si on peut aussi un peu rager en cherchant des commandes simples qu‚Äôon arrive pas √† faire).</p>
<p>Sachez aussi que beaucoup d‚Äô√©diteurs ont des modes Vim (Sublime Text, Atom et d‚Äôautres). Il doit bien y avoir une raison, non ?
Notez aussi que Vim est install√© par d√©faut sur beaucoup d‚Äôenvironnement de type Unix.</p>
<p>Vim est configurable √† souhait (via le fichier <code>.vimrc</code>) et poss√®de m√™me son propre language de scripts (Vim Script ou viml)
ce qui permet de cr√©er de nouvelles fonctionnalit√©s simplement. Et m√™me du coup d‚Äôen faire des ‚Äúplugins‚Äù.</p>
<p>Je vous pr√©pare un prochain post pour vous faire un petit m√©mo condens√© de ce qu‚Äôon peut faire avec, et surtout comment.</p>
<blockquote>
<p>:q^C:wq</p>
</blockquote>
]]></description>
            <link>http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/vim/il-demarre-vim-par-erreur-ce-qui-se-passe-ensuite-est-tout-simplement-bluffant/</guid>
            <pubDate>Tue, 03 Mar 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Quelques retours sur React et le rendu serveur]]></title>
            <description><![CDATA[<p>On entend souvent parler d‚Äôapplications JavaScript isomorphiques, et m√™me si le 
nom ne <a href="https://news.ycombinator.com/item?id=8237449" >fait</a> <a href="https://twitter.com/wycats/status/566857009836724224" >pas</a> 
<a href="https://medium.com/the-thinkmill/making-the-case-for-progressive-javascript-a98dfa82b9d7" >l‚Äôunanimit√©</a>, 
ce qu‚Äôil y a derri√®re, le concept de <em>server side rendered JavaScript</em> est en 
passe de devenir  un sujet plut√¥t tendance pour 2015 gr√¢ce √† la mont√© en puissance 
de <a href="http://facebook.github.io/react/" >Reactjs</a>.  Faire du rendu d‚Äôapplication 
JavaScript cot√© serveur permet de r√©concilier enfin le d√©veloppeur de 
<em>Single Page App</em> (SPA) avec l‚Äôam√©lioration progressive, l‚Äôaccessibilit√© et le 
SEO&nbsp;; quoique Google comme les lecteurs d‚Äô√©cran ont plut√¥t bien √©volu√© sur
ce point. L‚Äôautre avantage non n√©gligeable √† mon sens, est qu‚Äôon am√©liore les 
performances per√ßues par rapport
 √† une SPA classique puisque&nbsp;:</p>
<ul>
<li>On supprime une requ√™te <em>ajax</em> au d√©marrage pour r√©cup√©rer le contenu
initial. </li>
<li>On am√©liore la vitesse de rendu initial de page. </li>
<li>On b√©n√©ficie de la fluidit√© de navigation d‚Äôune SPA.</li>
</ul>
<p>Pour plus d‚Äôinfo sur les avantages, il y a <a href="http://tech.m6web.fr/isomorphic-single-page-app-parfaite-react-flux/" >cet article</a> sur le blog de M6Tech.</p>
<p>Afin de me familiariser avec React et son √©cosyst√®me, rien de mieux que mettre 
les mains dedans&nbsp;! C‚Äôest un peu pour toutes ces raisons que j‚Äôai d√©cid√© de 
l‚Äôutiliser pour mon site web (un site statique). </p>
<p><strong>Inutile et donc totalement justifi√© pour le d√©veloppeur que je suis</strong>. 
Une des premi√®res briques que j‚Äôai mises en place a √©t√© le routeur.</p>
<p>##react-router
Pour une fois dans la communaut√© JavaScript, il y a une biblioth√®que de r√©f√©rence 
et c‚Äôest celle l√† : <a href="https://github.com/rackt/react-router" >react-router</a>. 
Le routeur est fortement inspir√© par celui d‚ÄôEmber au sens o√π les URL et leurs routes 
sont au c≈ìur du dispositif. Le routeur se pr√©sente sous forme de composant React 
et √ßa donne √ßa.</p>
<pre><code class="lang-jsx"><span class="hljs-comment">//routes.js</span>

<span class="hljs-built_in">var</span> React = <span class="hljs-keyword">require</span>(<span class="hljs-string">"react"</span>);
<span class="hljs-built_in">var</span> Router = <span class="hljs-keyword">require</span>(<span class="hljs-string">"react-router"</span>);

<span class="hljs-built_in">var</span> Route = Router<span class="hljs-built_in">.</span>Route;
<span class="hljs-built_in">var</span> DefaultRoute = Router<span class="hljs-built_in">.</span>DefaultRoute;
<span class="hljs-built_in">var</span> NotFoundRoute = Router<span class="hljs-built_in">.</span>NotFoundRoute;

<span class="hljs-built_in">var</span> App = <span class="hljs-keyword">require</span>(<span class="hljs-string">"./app"</span>);
<span class="hljs-built_in">var</span> Home = <span class="hljs-keyword">require</span>(<span class="hljs-string">"./home/homePage"</span>);
<span class="hljs-built_in">var</span> Project = <span class="hljs-keyword">require</span>(<span class="hljs-string">"./project/projectPage"</span>);
<span class="hljs-built_in">var</span> NotFound = <span class="hljs-keyword">require</span>(<span class="hljs-string">"./notFound"</span>);

<span class="hljs-built_in">var</span> routes = (
  &lt;Route path=<span class="hljs-string">"/"</span> handler={App}&gt;
    &lt;DefaultRoute name=<span class="hljs-string">"index"</span> handler={Home} /&gt;
    &lt;Route name=<span class="hljs-string">"project"</span> path=<span class="hljs-string">"/projects/:url"</span> handler={Project} /&gt;
    &lt;NotFoundRoute name=<span class="hljs-string">"404"</span> handler={NotFound} /&gt;
  &lt;/Route&gt;
);

module<span class="hljs-built_in">.</span>exports = routes;
</code></pre>
<p>√Ä mon sens, l‚Äôaspect d√©claratif apporte de la clart√© et am√©liore la compr√©hension 
du syst√®me. On voit rapidement quel composant est utilis√© en fonction de l‚ÄôURL. 
L‚Äôautre avantage du d√©claratif, c‚Äôest qu‚Äôil permet de mani√®re assez simple, 
d‚Äôimbriquer les routes en imbriquant les n≈ìuds <code>&lt;Route&gt;</code>.</p>
<p>En plus des composants, on a aussi √† disposition des <em>mixins</em> pour naviguer 
programmatiquement ou acc√©der aux infos du routeur (chemin, param√®tres, ‚Ä¶)</p>
<p>Et le gros plus de cette biblioth√®que : elle peut aussi s‚Äôutiliser cot√© serveur, 
pour la g√©n√©ration des vues et √©viter ainsi de dupliquer du code puisqu‚Äôon va 
pouvoir carr√©ment utiliser tel quel le fichier pr√©c√©dent. Plut√¥t cool&nbsp;!
Voici un exemple de <em>middleware</em> pour faire marcher √ßa dans Express&nbsp;:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">"react"</span>);
<span class="hljs-keyword">var</span> Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">"react-router"</span>);

<span class="hljs-comment">// notre fichier routes.js</span>
<span class="hljs-keyword">var</span> routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/routes"</span>);
<span class="hljs-comment">// notre template de page html</span>
<span class="hljs-keyword">var</span> Html = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/html"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reactView</span>(<span class="hljs-params">req, res, next</span>) </span>{
  Router.run(routes, req.url, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">Handler, state</span>) </span>{
    <span class="hljs-comment">// on r√©cup√®re les donn√©es pour cette vue en fonction de la requ√™te.</span>
    <span class="hljs-keyword">var</span> data = getViewData(req);

    <span class="hljs-comment">// on g√©n√®re la soupe au tag avec nos donn√©es dedans</span>
    <span class="hljs-keyword">var</span> markup = React.renderToString(React.createElement(Handler), data);

    <span class="hljs-comment">// on utilise React comme moteur de template</span>
    <span class="hljs-keyword">var</span> HtmlElement = React.createElement(Html, {markup: markup});  
    res.send(<span class="hljs-string">"&lt;!DOCTYPE html&gt;"</span> +  React.renderToStaticMarkup(HtmlElement));
  });
}
</code></pre>
<p>Et voici le composant <code>Html.jsx</code> que l‚Äôon utilise comme <em>template</em> pour notre page principale.</p>
<pre><code class="lang-jsx">var React = require('react');

var Html = React.createClass({
  render: function() {
    return (
      <span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charSet</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">meta</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Mon site perso<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/app.js"</span> /&gt;</span><span class="handlebars"><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"react-app"</span> <span class="hljs-attribute">dangerouslySetInnerHTML</span>=</span></span><span class="hljs-expression">{{__<span class="hljs-variable">html</span>: <span class="hljs-variable">this.props.markup</span>}}</span><span class="xml"><span class="hljs-tag"> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
    );
  }

});

module.exports = Html;</span></span>
</code></pre>
<p>Une fois que le code HTML a √©t√© g√©n√©r√© via<code>React.renderToString(React.createElement(Handler), data);</code>, 
on pourrait utiliser n‚Äôimporte quel moteur de template (lodash.template, handlebars, ejs, jade, PHP‚Ä¶) 
pour g√©n√©rer le HTML de la page √† renvoyer. Dans un souci de rationalisation des outils, 
j‚Äôai pr√©f√©r√© utiliser React. </p>
<p>Vous avez d√ª vous apercevoir qu‚Äôon utilise 2 m√©thodes diff√©rentes pour g√©n√©rer 
du HTML avec React&nbsp;:</p>
<ul>
<li><code>React.renderToString(React.createElement(Handler), data);</code></li>
<li><code>React.renderToStaticMarkup(React.createElement(Handler), data);</code></li>
</ul>
<p>La diff√©rence entre les deux m√©thodes est simple. Dans la premi√®re, React annote 
les n≈ìuds HTML avec des <code>data-reactid</code> dans le but de pouvoir ensuite reprendre 
la main lorsque votre l‚Äôapplication s‚Äôex√©cutera dans le navigateur. De cette mani√®re, 
React sait que vous l‚Äôinitialisez avec un contenu g√©n√©r√© depuis le serveur. 
Et si il d√©tecte une diff√©rence entre le code existant et celui qu‚Äôil g√©n√®re, 
vous aurez droit √† un <a href="https://github.com/facebook/react/blob/2aeb8a2a6beb00617a4217f7f8284924fa2ad819/src/browser/ui/__tests__/ReactRenderDocument-test.js#L205-L215" >petit warning</a>. 
La deuxi√®me m√©thode permet de g√©n√©rer du code HTML sans annotations, 
comme n‚Äôimporte quel moteur de <em>template</em>.</p>
<p>Les plus attentifs auront remarqu√© qu‚Äôon passe les donn√©es initiales lors de 
la cr√©ation de l‚Äôapplication via des <em>props</em> React. Quid de l‚Äôutilisation 
de flux dans tout √ßa ?</p>
<h2 id="flux-et-le-rendu-serveur">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/#flux-et-le-rendu-serveur">#</a>
      Flux et le rendu serveur
    </h2><p>Avec <a href="http://facebook.github.io/flux/" >Flux</a>, ce sont les stores qui maintiennent 
l‚Äô√©tat de notre application. Si l‚Äôon ne veut pas afficher notre application 
sans aucune donn√©es, nous allons devoir pr√©alablement peupler nos stores 
avant d‚Äôappeler <code>React.renderToString()</code>. </p>
<p>L√† o√π √ßa se corse un peu, c‚Äôest qu‚Äôil va falloir remplir nos stores avant de d√©marrer 
notre application sous peine de voir le message d‚Äôalerte dont je parlais plus haut. 
Le plus simple alors est de passer ces donn√©es au moteur de template, 
en plus du markup (par exemple sous la forme d‚Äôun n≈ìud <code>&lt;script type=&quot;application/json&quot;&gt;JSON DATA&lt;/script&gt;</code>.
Il ne reste plus qu‚Äôa r√©cup√©rer ces donn√©es avant d‚Äôappeler <code>React.render( Application, document.getElementById(&quot;react-app&quot;))</code></p>
<p>Par exemple&nbsp;: </p>
<pre><code class="lang-javascript"><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  <span class="hljs-comment">// getData() va r√©cuperer et parser le contenu du tag script </span>
  <span class="hljs-comment">// qui contient nos donn√©es</span>
  <span class="hljs-keyword">var</span> storeData= getData(); 

  <span class="hljs-comment">// on d√©clenche une actions</span>
  actions.init( storeData);

  <span class="hljs-comment">// on lance le rendu</span>
  React.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">App</span> /&gt;</span>, document.getElementById("react-app"));
});</span>
</code></pre>
<h2 id="le-mot-de-la-fin">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/#le-mot-de-la-fin">#</a>
      Le mot de la fin
    </h2><p>Penser son application React pour qu‚Äôelle puisse √™tre rendue cot√© serveur 
introduit de nouvelles probl√©matiques, notamment avec l‚Äôajout du <em>pattern</em> Flux. 
En fonction des pages que l‚Äôon souhaite afficher, on devra initialiser diff√©rents <em>stores</em>. 
√Ä nous de d√©terminer, en fonction de l‚ÄôURL et du composant √† afficher, 
lequel initialiser, et cela, que l‚Äôon soit sur le client ou le serveur. 
De la m√™me mani√®re, il faudra √™tre capable de charger nos donn√©es, ind√©pendamment 
de l‚Äôenvironnement d‚Äôex√©cution (coucou XHR).</p>
<p>Un d√©but de r√©ponse se trouve dans les exemples fournis avec react-router. 
L‚Äôid√©e est de passer par une propri√©t√© <code>statics</code> lors de la cr√©ation des composants React 
qui seront associ√©s √† une <code>&lt;Route/&gt;</code>.</p>
<pre><code class="lang-jsx"><span class="hljs-keyword">var</span> ProjectPage = React.createClass({ 
  statics: {
    fetchData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span></span>{
      <span class="hljs-keyword">return</span> api.getPageData(params.url)
        .then( actions.initProject)
        .<span class="hljs-keyword">catch</span>( actions.loadProjectError);
    }
  }
 ...
 });
</code></pre>
<p>Dans ce bloc <code>statics</code>, on d√©finit une fonction qui servira √† r√©cup√©rer les donn√©es 
pour ce composant mais on pourrait tr√®s bien imaginer retourner la liste d‚Äôactions 
√† lancer ou encore les <em>stores</em> √† initialiser voire m√™me un descripteur des donn√©es n√©cessaires 
√† la vue (<a href="https://www.youtube.com/watch?v=9sc8Pyc51uU" >cf Relay / GraphQL</a>) </p>
<p>Ensuite, lorsque le callback fourni √† <code>Router.run()</code> est appel√©, il suffit de parcourir 
les <em>Handler</em> pour r√©cup√©rer les informations contenues dans les blocs <code>statics</code>, 
les traiter et enfin faire <code>React.render()</code>.</p>
<pre><code class="lang-Javascript">// On renvoie une promesse qui sera r√©solue lorsque que toutes les donn√©es d√©mand√©es via fetchData seront re√ßues.
Router.run(routes, Router.HistoryLocation, function (Handler, <span class="hljs-keyword">state</span>) {
  var p = Promise.<span class="hljs-literal">all</span>(<span class="hljs-keyword">state</span>.routes
    .filter(route =&gt; route.handler.fetchData)  // d√©finit fetchData
    .map(route =&gt; {
      return route.handler.fetchData(<span class="hljs-keyword">state</span>.params);
    })
  );
  p.then( x =&gt; {
    React.render(<span class="hljs-variable">&lt;Handler {...state} /&gt;</span>, document.getElementById(<span class="hljs-string">"react-app"</span>))
  });
});
</code></pre>
<p>Le principe est simple et peut √™tre facilement encapsul√© dans un module pour 
√™tre partag√© entre le client et le serveur.  J‚Äôesp√®re que cet article vous a permis 
d‚Äôappr√©hender un peu mieux le rendu cot√© serveur d‚Äôune application React. 
N‚Äôh√©sitez pas √† laisser des commentaires si vous avez des questions o√π 
si vous souhaitez partager vos exp√©riences dans ce domaine. </p>
<p>Et quelques liens vid√©o des sessions de la #reactjsconf :</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=XZfvW1a8Xac" >React.js Conf 2015 - react-router increases your productivity </a> </li>
<li><a href="https://www.youtube.com/watch?v=z5e7kWSHWTg" >React.js Conf 2015 - Hype!</a> : un aper√ßu des possibilit√©s de react-router</li>
</ul>
]]></description>
            <link>http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/</guid>
            <pubDate>Mon, 23 Feb 2015 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[JavaScript modulaire pour le front-end : les bases]]></title>
            <description><![CDATA[<p>Quand on r√©alise des applications en JS pour les navigateurs web, on ne peut plus se contenter de mettre des tags <code>script</code> dans le bon ordre pour charger les biblioth√®ques tierces que l‚Äôon utilise comme pour un site web. C‚Äôest pourquoi il existe des outils pour permettre d‚Äô√©crire du JavaScript modulaire et r√©utiliser plus facilement les innombrables biblioth√®ques publi√©es par la communaut√© JS.</p>
<p>Cependant, ce principe d‚Äô√©criture modulaire et de publication de code n‚Äô√©tant pas int√©gr√© dans le langage lui-m√™me, de tr√®s nombreuses solutions existent plus ou moins compatibles les unes avec les autres et aboutissant √† une forte fragmentation de la communaut√©.
Donc quand on d√©cide de se mettre au JavaScript modulaire, on trouve tout un tas d‚Äôarticles (en anglais) parfois trop vieux (‚Äúune √©tape de build n‚Äôest pas adapt√©e au navigateur‚Äù), parfois trop subjectifs (‚ÄúJ‚Äôaime pas la syntaxe AMD‚Äù), parfois confus (‚Äúutiliser les modules pour de l‚Äôinjection de d√©pendances‚Äù), parfois simplistes (‚ÄúAMD vs CommonJS‚Äù).</p>
<p>C‚Äôest pourquoi j‚Äôai voulu partager mon exp√©rience, en essayant d‚Äôabord de reposer les bases du probl√®me, puis en vous faisant part de ce que j‚Äôestime √™tre la solution la plus satisfaisante actuellement.</p>
<p>D‚Äôabord, il faut faire la distinction entre 3 aspects du probl√®me :</p>
<ul>
<li>le format d‚Äô√©criture des modules (‚Äúmodule authoring format‚Äù)</li>
<li>le syst√®me de gestion des packages (‚Äúpackage management‚Äù)</li>
<li>la convention de r√©solution des d√©pendances de module</li>
</ul>
<h1 id="format-d-ecriture-des-modules">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#format-d-ecriture-des-modules">#</a>
      Format d‚Äô√©criture des modules
    </h1><p>Le module est la brique de base pour d√©composer un gros fichier JS en plusieurs fichiers plus petits et focalis√©s sur une fonctionnalit√© pr√©cise. La plupart du temps un module est un fichier JS qui fournit une fonction, un constructeur ou un objet de valeur. Et comme, pour fournir cette fonctionnalit√©, un module peut avoir besoin d‚Äôautres modules, il existe un m√©canisme pour d√©clarer ses d√©pendances.</p>
<p>Actuellement, 2 standards principaux existent pour √©crire ces modules : <strong>AMD</strong> et <strong>CommonJS</strong>.
Il est √©galement possible d‚Äôutiliser la <a href="http://www.2ality.com/2014/09/es6-modules-final.html" >syntaxe retenue par ES6</a> (qui j‚Äôesp√®re va enfin devenir le standard unique) mais pour l‚Äôinstant, √ßa demande encore une √©tape de ‚Äútranspilation‚Äù en AMD ou CJS.</p>
<p>Le format AMD (dans sa forme la plus courante) est :</p>
<pre><code class="lang-js">define([<span class="hljs-string">'moduleA'</span>, <span class="hljs-string">'moduleB'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-comment">// j'utilise a et b</span>
  <span class="hljs-keyword">return</span> maFonctionTresUtile;
});
</code></pre>
<p>Le format CommonJS (dans sa forme la plus courante) est :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moduleA'</span>);
<span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moduleB'</span>);
<span class="hljs-comment">// j'utilise a et b</span>
<span class="hljs-built_in">module</span>.exports = maFonctionTresUtile;
</code></pre>
<p>Ca n‚Äôest pas tr√®s diff√©rent dans l‚Äôesprit : tous les 2 permettent de d√©crire des d√©pendances et d‚Äôexporter une valeur.
La diff√©rence principale r√©side dans le fait que :</p>
<ul>
<li>CommonJS pr√©voit une √©valuation en une passe dans laquelle il faut r√©soudre les d√©pendances au fur et √† mesure</li>
<li>alors que AMD pr√©voit une √©valuation en 2 passes :<ul>
<li>une premi√®re pour r√©cup√©rer uniquement la liste des d√©pendances</li>
<li>et une seconde o√π on ex√©cute le callback (le corps du module) avec les d√©pendances r√©solues.
C‚Äôest pourquoi on parle de format ‚Äúsynchrone‚Äù dans le premier cas et ‚Äúasynchrone‚Äù dans le second car on peut r√©soudre les d√©pendances de fa√ßon asynchrone en AMD.</li>
</ul>
</li>
</ul>
<p>Dans les 2 cas, par contre, il y a besoin d‚Äôune <em>r√©solution des d√©pendances</em>, c‚Äôest √† dire qu‚Äôun module ne peut pas √™tre ex√©cut√© tel quel dans un navigateur en le chargeant via un tag <code>script</code>. Non, il faut un <em>loader</em>, c‚Äôest √† dire un outil qui va charger le module qu‚Äôon lui demande et va r√©soudre les d√©pendances en cascade. Mais contrairement √† ce que l‚Äôon pourrait croire, les r√®gles de r√©solution des d√©pendances n‚Äôont rien √† voir avec le format du module (on verra √ßa plus tard).</p>
<h1 id="package-management">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#package-management">#</a>
      Package management
    </h1><p>Parlons maintenant des packages. En effet, pouvoir d√©couper du code en modules, c‚Äôest bien ; mais ce qui est encore mieux c‚Äôest de pouvoir le partager avec d‚Äôautres pour qu‚Äôil soit facilement r√©utilisable et arr√™ter le syndr√¥me de :</p>
<blockquote>
<p>‚Äúje recode un event emitter dans ma biblioth√®que comme √ßa je n‚Äôai pas de
d√©pendance et c‚Äôest plus facile √† consommer par mes utilisateurs‚Äù</p>
</blockquote>
<p> C‚Äôest le probl√®me n¬∞1 des biblioth√®ques front qui pr√©sentent souvent comme un argument de ne pas avoir de d√©pendances. Sauf que, si on y r√©fl√©chit, √ßa veut dire que : soit c‚Äôest une biblioth√®que tr√®s bas niveau, soit le mec a recod√© des trucs qui existent d√©j√† au lieu de s‚Äôoccuper de son sujet principal.</p>
<p>C‚Äôest l√† qu‚Äôentre en jeu la notion de <em>package</em> (que je ne traduirai pas en fran√ßais, car √ßa ne servirait qu‚Äô√† apporter de la confusion). Un package est un ensemble de fichiers (pas forc√©ment des fichiers JS d‚Äôailleurs) avec des m√©tadonn√©es associ√©es pour d√©crire principalement :</p>
<ul>
<li>o√π est stock√© le package,</li>
<li>qui est l‚Äôauteur,</li>
<li>quelle est la licence,</li>
<li>quelle est la version,</li>
<li>et ‚Ä¶ quelles sont les d√©pendances et leurs versions !</li>
</ul>
<p>Ici les d√©pendances sont des d√©pendances entre packages, <a href="http://fr.slideshare.net/domenicdenicola/client-side-packages" >ce qui n‚Äôa rien √† voir avec les d√©pendances entre modules</a>.</p>
<p>Pour faciliter l‚Äôutilisation des packages, on utilise un <em>package manager</em>, dont le r√¥le principal est, √† partir d‚Äôun id de module (et √©ventuellement d‚Äôun num√©ro de version), de trouver l‚Äôadresse o√π se trouve les fichiers, les t√©l√©charger et les installer localement‚Ä¶ et ceci de fa√ßon r√©cursive pour les d√©pendances, ce qui est le gros avantage par rapport √† le faire √† la mano. Mais sinon, √ßa n‚Äôest pas plus compliqu√© que √ßa dans le principe, et √ßa reste valable pour des fichiers JS ou non, front-end ou non.</p>
<p>Les principaux package managers pour le front-end sont <a href="https://www.npmjs.com/" >npm</a> et <a href="http://bower.io" >bower</a>.
La grande diff√©rence entre les deux est que <strong>npm installe les d√©pendances de fa√ßon relative</strong> : pour chaque package, les d√©pendances sont install√©es dans un sous-dossier (node_modules).</p>
<ul>
<li>mon-projet-avec-nmp<ul>
<li>app.js</li>
<li>node_modules<ul>
<li>une-dependance<ul>
<li>main.js</li>
<li>nodes_modules<ul>
<li>une-dependance-indirecte<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>une-autre-dependance<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Alors que <strong>bower prend le parti d‚Äôinstaller les d√©pendances √† plat</strong> : le package et ses d√©pendances et les d√©pendances des d√©pendances sont toutes install√©es au m√™me niveau dans le m√™me dossier.</p>
<ul>
<li>mon-projet-avec-bower<ul>
<li>app.js</li>
<li>bower_components<ul>
<li>une-dependance<ul>
<li>main.js</li>
</ul>
</li>
<li>une-autre-dependance<ul>
<li>main.js</li>
</ul>
</li>
<li>une-dependance-indirecte<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>L‚Äôapproche bower semble √™tre une bonne id√©e car si 2 packages ont la m√™me d√©pendance (ou des d√©pendances compatibles semver), une seule est install√©e. Alors qu‚Äôavec npm chaque package installe sa propre d√©pendance.</p>
<p>Cependant, s‚Äôil y a une incompatibilit√© de versions :</p>
<blockquote>
<p>le package A d√©clare une d√©pendance sur X en version 1
le package B d√©clare une d√©pendance sur X mais en version 2</p>
</blockquote>
<p>Avec bower, on est coinc√© : on ne peut installer qu‚Äôune seule version. Lors du <code>bower install</code>, il faudra choisir quelle version on garde : soit A devra utiliser X2, soit B devra utiliser X1.</p>
<ul>
<li>mon-app-avec-bower<ul>
<li>bower_components<ul>
<li>package-A</li>
<li>package-B</li>
<li>package-X<ul>
<li>main.js // v1 ou v2 mais pas les 2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Bower appelle cela de la <em>r√©solution de conflits</em>. Mais concr√™tement, cela veut dire qu‚Äôon force une d√©pendance qui n‚Äôest pas support√©e officiellement par le package en question. Donc on se retrouve responsable de v√©rifier que le package B fonctionne correctement avec X1. Pas cool :-(</p>
<p>Alors qu‚Äôavec npm les versions des d√©pendances sont respect√©es, il n‚Äôy a pas de question √† se poser.</p>
<ul>
<li>mon-app-avec-npm<ul>
<li>node_modules<ul>
<li>package-A<ul>
<li>node_modules<ul>
<li>package-X<ul>
<li>main.js // v1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>package-B<ul>
<li>node_modules<ul>
<li>package-X<ul>
<li>main.js // v2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="resolution-des-dependances-de-module">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#resolution-des-dependances-de-module">#</a>
      R√©solution des d√©pendances de module
    </h1><p>La question est alors :</p>
<blockquote>
<p>‚ÄúPourquoi existe-t-il des package managers sp√©cifiquement pour le web front-end ?‚Äù</p>
</blockquote>
<p>R√©ponse :</p>
<blockquote>
<p> ‚ÄúPour faciliter l‚Äôutilisation de modules publi√©s dans des packages dans le contexte du front-end‚Äù</p>
</blockquote>
<p>Super ! Mais concr√™tement ?</p>
<p>Et bien, venons en au coeur du probl√®me : <em>la r√©solution des module-id en fichier</em>. Comme on l‚Äôa vu, pour charger un module dans le navigateur, il faut utiliser un loader. Et une de ses t√¢ches est de <em>r√©soudre</em> les <code>module_id</code> en adresse de fichier.</p>
<p>Au pire il faudrait explicitement dire au loader pour chaque <code>module_id</code> o√π est le fichier correspondant. Heureusement, ce n‚Äôest pas le cas, ni avec requireJS, ni avec les loaders compatibles npm.</p>
<h2 id="amd">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#amd">#</a>
      AMD
    </h2><p>RequireJS et les autres loaders AMD vont assez loin en  mati√®re de <a href="http://requirejs.org/docs/api.html#config" >configuration</a> mais souvent , √ßa revient √† d√©crire des r√®gles du style <em>tous les modules id qui commencent par <code>mon-package</code> sont √† chercher dans le dossier <code>./mon-package</code></em>.</p>
<p>En fait, √ßa n‚Äôest pas tout √† fait vrai qu‚Äôil faille syst√©matiquement configurer les r√®gles de r√©solution avec RequireJS : il y a une r√®gle par d√©faut qui stipule que les module_id sont r√©solus par rapport √† une ‚ÄúbaseURL‚Äù (qui par d√©faut est celle du fichier html). Donc si on installe tous les packages au m√™me niveau, √ßa marche par d√©faut.
C‚Äôest pour cela que bower est souvent utilis√© pour les packages front-end en AMD car il installe les fichiers √† plat et de cette fa√ßon on limite le besoin de configuration.</p>
<h2 id="npm">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#npm">#</a>
      NPM
    </h2><p>A l‚Äôoppos√© de cette approche tr√®s flexible, il y a nodeJS avec une <a href="https://github.com/substack/browserify-handbook#how-node_modules-works" >convention simple et statique</a>, qui dit en gros :</p>
<ul>
<li>si c‚Äôest une r√©f√©rence relative, il suffit de suivre le chemin</li>
<li>si c‚Äôest une r√©f√©rence absolue, il faut chercher dans le dossier <code>node_modules</code> et ceci de fa√ßon r√©cursive jusqu‚Äô√† arriver √† la racine</li>
</ul>
<p>Et donc z√©ro config, puisque √ßa n‚Äôest pas configurable. Ca peut para√Ætre √™tre une limitation mais c‚Äôest une force.</p>
<h1 id="conclusion">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#conclusion">#</a>
      Conclusion
    </h1><p>Si tous les packages en AMD utilisaient la r√®gle de r√©solution par d√©faut et que l‚Äôon utilisait bower pour les installer, on n‚Äôaurait rien √† configurer. Mais dans la pratique, √ßa n‚Äôest pas le cas et on se retrouve √† devoir configurer les r√®gles de r√©solution non seulement pour ses propres d√©pendances (<em>pourquoi pas</em>) mais √©galement pour les d√©pendances de ses d√©pendances (<em>et l√† √ßa ne va plus</em>).
Et il reste toujours le probl√®me des conflits de version li√©s √† l‚Äôapproche de mettre les d√©pendances √† plat.</p>
<p>D‚Äôun autre c√¥t√©, il y a la convention nodeJS qui impose des r√®gles simples, non modifiables et qui n‚Äôa pas de probl√®me de conflit de versions. C‚Äôest √† dire qu‚Äôil suffit de faire <code>npm install mon-package</code> et √ßa marche. Une convention qui fait l‚Äôunanimit√© pour le backend JS.</p>
<p>C√¥t√© front, on lui reproche de charger les d√©pendances sans les d√©doublonner et de le faire en synchrone, ce qui n‚Äôest pas adapt√© quand le chargement des fichiers se fait via un r√©seau en http et pas directement depuis un disque local comme sur un serveur.</p>
<p>C‚Äôest pourquoi a √©t√© invent√© <a href="http://http://browserify.org/" >browserify</a> qui apporte actuellement <a href="http://putaindecode.fr/posts/js/browserify-all-the-things/" >le meilleur des 2 mondes</a> : toujours z√©ro config selon la convention nodeJS et un syst√®me de bundle/build (via une analyse syntaxique du code JS pour d√©tecter les d√©pendances) afin d‚Äôassembler tous les modules en un seul fichier adapt√© au navigateur.
On peut lui reprocher la n√©cessit√© d‚Äôune √©tape de build et le fait que le code source en d√©bug est en un seul fichier mais :</p>
<ol>
<li>de toute fa√ßon pour la prod, il y aura une √©tape de build et en d√©v, avec un outillage adapt√© (par exemple <code>watchify</code> qui rebuild en incr√©mental) √ßa n‚Äôest pas la mer √† boire</li>
<li>avec le support des sources-map dans les navigateurs, on peut maintenant retrouver en debug les m√™mes noms de fichiers et les m√™mes num√©ro de ligne que dans les fichiers d‚Äôorigine et les points d‚Äôarr√™t fonctionnent.</li>
</ol>
<p>Au final, √ßa en devient m√™me un avantage, car le code que l‚Äôon ex√©cute en dev dans le navigateur est tr√®s proche de ce que l‚Äôon aura en prod, en tout cas plus proche qu‚Äôavec requireJS pour lequel on d√©veloppe sans build et pour lequel il faut √©crire √† nouveau une config de build pour la mise en prod.</p>
<h1 id="conclusion-de-la-conclusion">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/#conclusion-de-la-conclusion">#</a>
      Conclusion de la conclusion
    </h1><p>Ma conclusion est que le point crucial pour faciliter la r√©utilisation de modules, c‚Äôest de <strong>minimiser les contraintes sur les utilisateurs</strong> et donc de se rapprocher d‚Äôun usage <em>plug and play</em>. Pour cela il faut une convention forte entre le package manager et le loader/builder de modules, afin d‚Äô√©viter √† l‚Äôutilisateur de devoir √©crire des configs ‚Ä¶ la plupart du temps.
Bien s√ªr, la recherche du ‚Äúz√©ro config‚Äù n‚Äôest pas une fin et c‚Äôest particuli√®rement vrai c√¥t√© front o√π les contraintes de chargement de fichiers sont fortes. Et si vous voulez diviser votre bundle en plusieurs fichiers ou si vous voulez des r√®gles d‚Äôoptimisation complexes pour votre build, il est normal de devoir mettre les mains dans le cambouis.
Mais si au moins le cas d‚Äôusage le plus fr√©quent (compiler son appli en un seul fichier qui sera charg√© via un tag <code>script</code>) est simplifi√© au maximum, alors on pourra s√ªrement voir c√¥t√© front, le m√™me √©tat d‚Äôesprit que c√¥t√© back. Et je suis plut√¥t optimiste, <a href="https://medium.com/@trek/last-week-i-had-a-small-meltdown-on-twitter-about-npms-future-plans-around-front-end-packaging-b424dd8d367a" >contrairement √† certains</a>.</p>
<p>Utilisateur de la premi√®re heure d‚Äô<code>AMD</code> et de <code>Dojo loader</code>, puis de <code>bower</code>, je me suis rendu compte de leurs limites et surtout j‚Äôai √©t√© r√©guli√®rement g√™n√© par la complexit√© de la configuration‚Ä¶ surtout lorsqu‚Äôil fallait passer au build. Cela freine la r√©utilisation de modules tiers et c‚Äôest dommage.
Ce n‚Äôest pas un probl√®me intrins√®que au format de module et toutes les discussions sur ‚Äúmoi j‚Äôaime / j‚Äôaime pas la syntaxe AMD‚Äù sont secondaires (d‚Äôailleurs <a href="https://www.npmjs.com/package/deamdify" >browserify peut fonctionner avec des biblioth√®ques en AMD</a>).
Mais dans la pratique, nous migrons vers la solution <code>npm + browserify</code> et c‚Äôest vraiment moins compliqu√©.</p>
<p>J‚Äôesp√®re que cet article vous permettra d‚Äôy voir plus clair, de d√©passer les querelles sur les pr√©f√©rences personnelles de chacun, et de vous aider √† faire votre choix.
Je n‚Äôestime pas √™tre un expert du sujet, il y a s√ªrement beaucoup de choses √† compl√©ter ou pr√©ciser, donc n‚Äôh√©sitez pas √† r√©agir.</p>
<p>Pour aller plus loin et regarder vers le futur que nous am√®ne ES6, il y a cet <a href="https://medium.com/@brianleroux/es6-modules-amd-and-commonjs-c1acefbe6fc0" >excellent article</a>.</p>
]]></description>
            <link>http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/</guid>
            <pubDate>Mon, 15 Dec 2014 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Premi√®re application Ember. Suite et fin.]]></title>
            <description><![CDATA[<p>L‚Äô<a href="/posts/js/premiere-app-ember" >article pr√©c√©dent</a> vous a accompagn√© pour la cr√©ation d‚Äôune premi√®re application <a href="http://emberjs.com" >Ember</a>. 
Mais il faut bien reconna√Ætre que l‚Äôexemple √©tait tr√®s simple et que, du coup, le m√©rite est faible. 
Pour se  rattraper, on va complexifier un peu les choses.</p>
<p>Tout comme dans l‚Äôarticle pr√©c√©dent, nous d√©taillerons r√©guli√®rement les concepts mis en ≈ìuvre. Parce que vous le valez bien.</p>
<h2 id="sommaire">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#sommaire">#</a>
      Sommaire
    </h2><ul>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#edition-d-une-serie" >√âdition d‚Äôune s√©rie</a><ul>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#routes-imbriquees" >Routes imbriqu√©es</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#-code-outlets-code-" >Outlets</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#liens-entre-routes" >Liens entre routes</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#enregistrement-des-modifications" >Enregistrement des modifications</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#actions-sur-les-transitions" >Actions sur les transitions</a></li>
</ul>
</li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#relations-avec-ember-data" >Relations avec Ember Data</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#insertion-d-un-gabarit" >Insertion d‚Äôun gabarit</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#creation-d-une-nouvelle-serie" >Cr√©ation d‚Äôune nouvelle s√©rie</a></li>
<li><a href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#conclusion" >Conclusion</a></li>
</ul>
<h2 id="edition-d-une-serie">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#edition-d-une-serie">#</a>
      √âdition d‚Äôune s√©rie
    </h2><p>On veut pouvoir basculer depuis la fiche d‚Äôune s√©rie vers son √©dition en mode <em>in place</em>. C‚Äôest-√†-dire
en <strong>rempla√ßant</strong> la zone de visualisation de cette fiche par sa zone d‚Äô√©dition.</p>
<p>On acc√®de √† la fiche en mode visualisation √† l‚ÄôURL <code>/series/{id}/</code> et en mode √©dition √† l‚ÄôURL <code>/series/{id}/edit</code>. √âvidemment, 
on reconstruit uniquement la zone de la fiche et non l‚Äôapplication enti√®re (et donc ni l‚Äôen-t√™te ni la liste des s√©ries).</p>
<h3 id="routes-imbriquees">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#routes-imbriquees">#</a>
      Routes imbriqu√©es
    </h3><p>Commen√ßons par d√©finir une nouvelle route <code>edit</code>, sous-route de <code>seriesItem</code> : </p>
<pre><code class="lang-js"><span class="hljs-comment">// /app/router.js</span>
Router.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.resource(<span class="hljs-string">'series'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.route(<span class="hljs-string">'seriesItem'</span>, { path: <span class="hljs-string">'/:seriesItem_id'</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.route(<span class="hljs-string">'edit'</span>);
    });
  });
});
</code></pre>
<p>Pour que notre nouvelle route affiche la fiche en mode √©dition, on doit - <a href="/posts/js/debuter-avec-ember/#les-fondamentaux" >rappelez-vous</a> - imp√©rativement suivre les 
<a href="http://emberjs.com/guides/concepts/naming-conventions/" >conventions de nommage</a> et cr√©er un gabarit <code>edit.hbs</code> dans le 
r√©pertoire <code>/app/templates/series/series-item/</code> :</p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series/series-item/edit.hbs` --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-details"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"cancel"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cancel"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"title"</span>&gt;</span>{{input id="title" type="text" value=title}}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> {{<span class="hljs-attribute">bind-attr</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"coverUrl"</span><span class="hljs-value">}}</span> <span class="hljs-attribute">alt</span>=<span class="hljs-value">"Series's first album cover"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cover"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"description"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"scriptwriter"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"scriptwriter"</span>&gt;</span>Scriptwriter<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"control"</span>&gt;</span>{{input id="scriptwriter" type="text" value=scriptwriter required="required"}}<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"illustrator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"illustrator"</span>&gt;</span>Illustrator<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"control"</span>&gt;</span>{{input id="illustrator" type="text" value=illustrator}}<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"publisher"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"publisher"</span>&gt;</span>Publisher<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"control"</span>&gt;</span>{{input id="publisher" type="text" value=publisher}}<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"summary"</span>&gt;</span>{{textarea value=summary rows="10"}}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
</code></pre>
<p>√Ä ce stade, naviguer sur <code>/series/{@id}/edit</code> ne l√®ve pas d‚Äôerreur mais n‚Äôa aucun effet. En effet, on a
d√©fini une route imbriqu√©e mais conserv√© le gabarit <code>/app/templates/series/series-item.hbs</code> inchang√©. L‚Äôactivation de la route <code>series.seriesItem</code> 
affiche donc toujours ce gabarit, m√™me dans le cas d‚Äôune sous-route telle que <code>series.seriesItem.edit</code>. </p>
<h3 id="outlets">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#outlets">#</a>
      <code>outlets</code>
    </h3><p>La solution est √† aller chercher du c√¥t√© du concept d‚Äô<code>{{outlet}}</code> d√©fini dans l‚Äô<a href="/posts/js/premiere-app-ember/#-code-outlet-code-et-routes-imbriquees" >article pr√©c√©dent</a>.
Un <code>{{outlet}}</code> est n√©cessaire <strong>√† chaque fois qu‚Äôon d√©finit un niveau d‚Äôimbrication.</strong> Mais comme on veut quand m√™me continuer √† afficher la s√©rie √† 
l‚ÄôURL <code>/series/{@id}/</code>, on va utiliser la <strong>route implicite</strong> <code>series.seriesItem.index</code> (cf. <a href="/posts/js/premiere-app-ember/#routes-et-controleurs-implicites" >article pr√©c√©dent</a>) 
et son gabarit, dans lequel on va copier l‚Äôancien contenu de <code>series-item.hbs</code>.</p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series/series-item/index.hbs --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-details"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> {{<span class="hljs-attribute">bind-attr</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"coverUrl"</span><span class="hljs-value">}}</span> <span class="hljs-attribute">alt</span>=<span class="hljs-value">"Series's first album cover"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cover"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dl</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"description"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dt</span>&gt;</span>scriptwriter<span class="hljs-tag">&lt;/<span class="hljs-title">dt</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dd</span>&gt;</span>{{scriptwriter}} <span class="hljs-tag">&lt;/<span class="hljs-title">dd</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dt</span>&gt;</span>illustrator<span class="hljs-tag">&lt;/<span class="hljs-title">dt</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dd</span>&gt;</span>{{illustrator}}<span class="hljs-tag">&lt;/<span class="hljs-title">dd</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dt</span>&gt;</span>publisher<span class="hljs-tag">&lt;/<span class="hljs-title">dt</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dd</span>&gt;</span>{{publisher}}<span class="hljs-tag">&lt;/<span class="hljs-title">dd</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dl</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"summary"</span>&gt;</span>
      {{summary}}
    <span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Le gabarit <code>series-item.hbs</code> est quant √† lui modifi√© car il doit changer en fonction de la sous-route activ√©e.
Et puisqu‚Äôon ne veut rien afficher de plus, son contenu se r√©sume √† un <code>{{outlet}}</code> :</p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series-item.hbs --&gt;</span>
{{outlet}}
</code></pre>
<p>Et voil√† ! L‚Äôaffichage de l‚ÄôURL <code>/series/{@id}/</code> est inchang√© alors que l‚ÄôURL <code>/series/{@id}/edit</code> 
affiche d√©sormais le formulaire d‚Äô√©dition.</p>
<h3 id="liens-entre-routes">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#liens-entre-routes">#</a>
      Liens entre routes
    </h3><p>Pour pouvoir plus facilement basculer en mode √©dition, on ajoute un lien vers la route correspondante gr√¢ce √† <code>link-to</code> 
(cf. <a href="http://emberjs.com/guides/templates/links/" >doc officielle</a>).</p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series/series-item/index.hbs --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-details"</span>&gt;</span>
    {{#link-to 'series.seriesItem.edit' id class="edit"}}edit{{/link-to}}
    <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
    ...
</code></pre>
<p>On note que la route vers laquelle le lien pointe est pr√©fix√©e par <code>series</code> parce qu‚Äôon a d√©fini une route et non une resource.
En effet, une ressource r√©initialise l‚Äôespace de nommage et permet donc des noms de routes plus courts. Pour pouvoir pointer vers <code>seriesItem.edit</code> on aurait donc d√ª
remplacer <code>this.route(&#39;seriesItem&#39;, ...</code> par <code>this.resource(&#39;seriesItem&#39;, ...</code>.</p>
<p>On peut d√©sormais √©diter notre s√©rie. On remarque au passage que la modification du titre de la s√©rie le met √©galement √† jour en temps r√©el dans la liste des s√©ries gr√¢ce
au <em>binding</em> (cf. <a href="/posts/js/premiere-app-ember/#-em-bindings-em-et-mise-a-jour-des-gabarits" >article pr√©c√©dent</a>).</p>
<h3 id="enregistrement-des-modifications">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#enregistrement-des-modifications">#</a>
      Enregistrement des modifications
    </h3><p>Nous allons maintenant rendre op√©rationnels nos deux boutons d‚Äô√©dition <em>annuler</em> et <em>valider</em>. Pour cela, on commence par associer des actions √† nos boutons :</p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series/series-item/edit.hbs` --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-details"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> {{<span class="hljs-attribute">action</span> "<span class="hljs-attribute">submit</span>"}} <span class="hljs-attribute">class</span>=<span class="hljs-value">"submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"reset"</span> {{<span class="hljs-attribute">action</span> "<span class="hljs-attribute">cancel</span>"}} <span class="hljs-attribute">class</span>=<span class="hljs-value">"cancel"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
...
</code></pre>
<p>Comme il s‚Äôagit de manipulations sur le mod√®le et de transitions entre routes, les actions correspondantes seront trait√©es par la route.</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/routes/series/series-item/edit.js</span>
<span class="hljs-keyword">import</span> Ember <span class="hljs-keyword">from</span> <span class="hljs-string">'ember'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Ember.Route.extend({
  model: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.seriesItem'</span>);
  },
  actions: {
    submit: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.seriesItem.edit'</span>).save().then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.transitionTo(<span class="hljs-string">'series.seriesItem'</span>);
      }.bind(<span class="hljs-keyword">this</span>));
    },

    cancel: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.seriesItem.edit'</span>).rollback();
      <span class="hljs-keyword">this</span>.transitionTo(<span class="hljs-string">'series.seriesItem'</span>);
    }
  }
});
</code></pre>
<p>Quelques mots sur ces quelques lignes : </p>
<ul>
<li>Dans une <code>route</code>, le mod√®le courant est r√©cup√©r√© via <code>this.modelFor(&#39;nomRoute&#39;)</code>. Ici, on r√©cup√®re explicitement le mod√®le charg√© automatiquement 
(par convention) par la route m√®re <code>seriesItem</code>. Notez qu‚Äôon aurait pu omettre la r√©cup√©ration du mod√®le compl√®tement car la route m√®re s‚Äôen occupe pour nous.</li>
<li>Une fois le mod√®le r√©cup√©r√©, on peut invoquer les m√©thodes apport√©es par <a href="https://github.com/emberjs/data" >Ember Data</a>.</li>
<li>Pour un <code>cancel</code>, on invoque <code>rollback()</code> : toutes les modifications effectu√©es sont annul√©es et le mod√®le est r√©initialis√©.</li>
<li>Pour un <code>submit</code>, on invoque un <code>save()</code> qui enregistre les modifications apport√©es au mod√®le dans le <em>magasin</em> 
(<a href="http://emberjs.com/api/data/classes/DS.Store.html" >Store</a>) d‚Äô<a href="https://github.com/emberjs/data" >Ember Data</a>.</li>
<li>Les op√©rations effectu√©es sur les mod√®les sont bien souvent asynchrones puisque, dans le cas nominal, elles font 
intervenir des API REST pour enregistrer ou mettre √† jour les donn√©es depuis un serveur. Dans le cas o√π l‚Äôon souhaite
attendre la fin du traitement pour effectuer une action (comme ici dans le cas du <code>save</code>), il est n√©cessaire d‚Äôutiliser
les <em>promesses</em> (<code>promises</code>) qu‚Äô<a href="https://github.com/emberjs/data" >Ember Data</a> renvoie (<code>.then(...)</code>). Dans le cas contraire, le code serait
ex√©cut√© avant la fin du traitement et ne permettrait pas de proposer un retour utilisateur propre (gestion des cas d‚Äôerreurs notamment).</li>
<li>Les transitions entre routes sont possibles via <code>this.transitionTo(&#39;nomRoute&#39;)</code>.</li>
</ul>
<h3 id="actions-sur-les-transitions">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#actions-sur-les-transitions">#</a>
      Actions sur les transitions
    </h3><p>Mais je voudrais encore ajouter une derni√®re petite cerise sur ce g√¢teau : annuler automatiquement toutes les modifications effectu√©es
sur la s√©rie d√®s que l‚Äôon quitte la route. <a href="http://emberjs.com" >Ember</a> pr√©voit en effet des m√©canismes avanc√©s pour travailler sur les transitions entre 
routes (cf. <a href="http://emberjs.com/guides/routing/preventing-and-retrying-transitions/" >doc officielle</a>). En particulier <code>willTransition</code> : </p>
<pre><code class="lang-js"><span class="hljs-comment">// app/routes/series/series-item/edit.js</span>
  actions: {
    ...
    willTransition: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.seriesItem.edit'</span>).rollback();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }
</code></pre>
<p>L‚Äôaction est tr√®s simple ici mais on imagine facilement comment on pourrait ajouter une confirmation et d√©terminer, en fonction
de la r√©ponse, si l‚Äôon doit continuer la transition ou l‚Äôabandonner.</p>
<h2 id="relations-avec-ember-data-ember-data">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#relations-avec-ember-data-ember-data">#</a>
      Relations avec <a href="https://github.com/emberjs/data" >Ember Data</a>
    </h2><p><a href="https://github.com/emberjs/data" >Ember Data</a> permet de d√©finir des relations entre nos mod√®les. Ajoutons donc des albums √† nos s√©ries :</p>
<p>On d√©finit d‚Äôabord une nouvelle entit√© <code>Album</code> et ses propri√©t√©s et on indique que cet album √©tait associ√© √† une s√©rie via la propri√©t√© <code>series</code> 
et √† la m√©thode <code>DS.belongsTo</code> (cf. <a href="http://emberjs.com/api/data/#method_belongsTo" >doc officielle</a>). 
Ce qui se traduit plus loin, dans l‚Äôinitialisation des donn√©es par <code>series: 1</code> o√π 1 est l‚Äôidentifiant de la 
s√©rie en question.</p>
<pre><code class="lang-js"><span class="hljs-comment">// /app/models/album.js</span>
<span class="hljs-keyword">import</span> DS <span class="hljs-keyword">from</span> <span class="hljs-string">'ember-data'</span>;

<span class="hljs-keyword">var</span> Album = DS.Model.extend({
  title               : DS.attr(<span class="hljs-string">'string'</span>),
  publicationDate     : DS.attr(<span class="hljs-string">'date'</span>),
  number              : DS.attr(<span class="hljs-string">'number'</span>),
  coverName           : DS.attr(<span class="hljs-string">'string'</span>, {defaultValue: <span class="hljs-string">'default.jpg'</span>}),
  series              : DS.belongsTo(<span class="hljs-string">'seriesItem'</span>),
  coverUrl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'/assets/images/albums/covers/'</span> + <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'coverName'</span>);
  }.property(<span class="hljs-string">'coverName'</span>)
});

Album.reopenClass({
  FIXTURES: [{
    id: <span class="hljs-number">1</span>,
    title: <span class="hljs-string">'Somewhere Within the Shadows'</span>,
    publicationDate: <span class="hljs-string">'Nov 2000'</span>,
    number: <span class="hljs-number">1</span>,
    coverName: <span class="hljs-string">'blacksad-1.jpg'</span>,
    series: <span class="hljs-number">1</span>
  }, {
    id: <span class="hljs-number">2</span>,
    title: <span class="hljs-string">'Arctic-Nation'</span>,
    publicationDate: <span class="hljs-string">'Mar 2003'</span>,
    number: <span class="hljs-number">2</span>,
    coverName: <span class="hljs-string">'blacksad-2.jpg'</span>,
    series: <span class="hljs-number">1</span>
  }]
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Album;
</code></pre>
<p>On modifie ensuite le mod√®le <code>SeriesItem</code> pour indiquer une relation inverse gr√¢ce √† la propri√©t√© <code>albums</code> et √† 
la m√©thode <code>DS.hasMany</code> (cf. <a href="http://emberjs.com/api/data/#method_hasMany" >doc officielle</a>) puis affecter la liste des 
identifiants des albums √† la s√©rie via <code>albums: [1, 2]</code> : </p>
<pre><code class="lang-js"><span class="hljs-comment">// /app/models/series-item.js</span>
<span class="hljs-keyword">import</span> DS <span class="hljs-keyword">from</span> <span class="hljs-string">'ember-data'</span>;

<span class="hljs-keyword">var</span> SeriesItem = DS.Model.extend({
    title               : DS.attr(<span class="hljs-string">'string'</span>, {defaultValue: <span class="hljs-string">'New Series'</span>}),
    ...
    albums              : DS.hasMany(<span class="hljs-string">'album'</span>, {<span class="hljs-keyword">async</span>: <span class="hljs-literal">true</span>})
});

SeriesItem.reopenClass({
    FIXTURES: [{
    id: <span class="hljs-number">1</span>,
    ...
    albums: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]
    }, ...
]});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> SeriesItem;
</code></pre>
<h2 id="insertion-d-un-gabarit">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#insertion-d-un-gabarit">#</a>
      Insertion d‚Äôun gabarit
    </h2><p>Maintenant qu‚Äôon a des albums pour nos s√©ries, on serait bien int√©ress√© de les voir s‚Äôafficher. Seulement voil√†, on veut juste les
afficher √† c√¥t√© de la visualisation d‚Äôune s√©rie. On ne veut rien proposer d‚Äôautre pour ces albums que le <em>binding</em> des propri√©t√©s et
leur affichage. Pas besoin de route ou de contr√¥leur. On va pour cela utiliser un outil particulier permettant simplement
d‚Äôins√©rer (d‚Äôafficher) un gabarit au sein d‚Äôune route existante via le <em>helper</em> : <code>render</code> (cf. 
<a href="http://emberjs.com/guides/templates/rendering-with-helpers/#toc_the-code-view-code-helper" >doc officielle</a>).</p>
<p>On modifie donc le gabarit <code>/series/series-item.hbs</code> pour qu‚Äô√† c√¥t√© de la fiche d‚Äôune s√©rie soit affich√©e la liste de ses albums : </p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series/series-item.hbs --&gt;</span>

{{outlet}}

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-albums"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>
        {{#each album in albums}}
            {{render 'partials/albumItem' album}}
        {{/each}}
    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/partials/album-item.hbs --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"album"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> {{<span class="hljs-attribute">bind-attr</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"coverUrl"</span><span class="hljs-value">}}</span> <span class="hljs-attribute">alt</span>=<span class="hljs-value">"Album cover"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cover"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"description"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dl</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">dt</span>&gt;</span>volume<span class="hljs-tag">&lt;/<span class="hljs-title">dt</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">dd</span>&gt;</span>{{number}}<span class="hljs-tag">&lt;/<span class="hljs-title">dd</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">dt</span>&gt;</span>date<span class="hljs-tag">&lt;/<span class="hljs-title">dt</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">dd</span>&gt;</span>{{publicationDate}}<span class="hljs-tag">&lt;/<span class="hljs-title">dd</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dl</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
</code></pre>
<h2 id="creation-d-une-nouvelle-serie">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#creation-d-une-nouvelle-serie">#</a>
      Cr√©ation d‚Äôune nouvelle s√©rie
    </h2><p>Histoire de terminer en beaut√© on va ajouter vite fait la cr√©ation d‚Äôune s√©rie.</p>
<p>Comme on commence √† avoir l‚Äôhabitude, on fait √ßa en deux coups de cuill√®re √† pot : </p>
<pre><code class="lang-js"><span class="hljs-comment">// /app/router.js</span>
Router.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.resource(<span class="hljs-string">'series'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.route(<span class="hljs-string">'seriesItem'</span>, { path: <span class="hljs-string">'/:seriesItem_id'</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.route(<span class="hljs-string">'edit'</span>);
    });
    <span class="hljs-keyword">this</span>.route(<span class="hljs-string">'create'</span>);
  });
});
</code></pre>
<pre><code class="lang-js"><span class="hljs-comment">// /app/routes/series/create.js</span>
<span class="hljs-keyword">import</span> Ember <span class="hljs-keyword">from</span> <span class="hljs-string">'ember'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Ember.Route.extend({
  model: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.store.createRecord(<span class="hljs-string">'seriesItem'</span>);
  },

  renderTemplate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.render(<span class="hljs-string">'series.seriesItem.edit'</span>);
  },

  actions: {
    submit: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.create'</span>).save().then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.transitionTo(<span class="hljs-string">'series.seriesItem'</span>, <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.create'</span>));
      }.bind(<span class="hljs-keyword">this</span>));
    },

    cancel: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.create'</span>).rollback();
      <span class="hljs-keyword">this</span>.transitionTo(<span class="hljs-string">'series'</span>);
    },

    willTransition: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.modelFor(<span class="hljs-string">'series.create'</span>).rollback();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }
});
</code></pre>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!-- /app/templates/series.hbs --&gt;</span>
    ...
      {{/each}}
        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"series-item"</span>&gt;</span>
          {{#link-to 'series.create' class="add"}}add{{/link-to}}
        <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    ...
</code></pre>
<p>Les points importants √† noter : </p>
<ul>
<li>Le mod√®le est, cette fois-ci, cr√©√© √† l‚Äôactivation de la route via <code>this.store.createRecord(...)</code>.</li>
<li>Comme on ne souhaite pas proposer de gabarit propre pour cette route, on utilise <code>renderTemplate</code> pour indiquer √† <a href="http://emberjs.com" >Ember</a> quel
gabarit il doit utiliser. </li>
<li>Les actions <code>submit</code>, <code>cancel</code> et <code>willTransition</code> sont sensiblement les m√™mes que pour l‚Äô√©dition mais travaillent sur un mod√®le diff√©rent et 
renvoient vers d‚Äôautres routes.</li>
<li>On note le passage du mod√®le lors de la transition en cas de <code>submit</code>.</li>
<li>Il serait l√©gitime de se poser la question de r√©utilisation de code entre ces deux routes, compte tenu des similarit√©s. Ce n‚Äôest pas l‚Äôobjet 
de l‚Äôarticle mais pourrait √™tre envisag√© √† l‚Äôaide d‚Äôun <code>mixin</code> partag√© (cf. <a href="http://emberjs.com/api/classes/Ember.Mixin.html" >doc officielle</a>).  </li>
</ul>
<h2 id="conclusion">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/js/premiere-app-ember-suite/#conclusion">#</a>
      Conclusion
    </h2><p>Au travers de cet article et des pr√©c√©dents, j‚Äôesp√®re vous avoir donn√© un aper√ßu du mod√®le de d√©veloppement que propose
<a href="http://emberjs.com" >Ember</a>. Vous avez compris, j‚Äôesp√®re, qu‚Äô<a href="http://emberjs.com" >Ember</a> est un v√©ritable framework avec des opinions fortes et qu‚Äôil doit √™tre pris comme
tel ou laiss√© de c√¥t√© pour une solution plus l√©g√®re selon vos besoins.</p>
<p>Mais j‚Äôai √©galement essay√© d‚Äôaller plus en profondeur sur certains aspects et de montrer des cas d‚Äôutilisation concrets. 
Ce dernier article montre qu‚Äôil est √©galement possible de fournir √† <a href="http://emberjs.com" >Ember</a> 
des configurations explicites afin d‚Äôaller plus loin que les conventions par d√©faut.</p>
<p>Maintenant, vous n‚Äôavez plus d‚Äôexcuses‚Ä¶ Vous ne pourrez pas dire que vous ne connaissiez pas. </p>
<p><em>Note: les sources de l‚Äôapplication exemple sont <a href="https://github.com/bmeurant/ember-articles/tree/premiere-app-ember-suite" >disponibles sur github</a>.</em></p>
]]></description>
            <link>http://putaindecode.fr/posts/js/premiere-app-ember-suite/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/js/premiere-app-ember-suite/</guid>
            <pubDate>Tue, 09 Dec 2014 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[L'injection de d√©pendances en PHP]]></title>
            <description><![CDATA[<p>Salutations ! Aujourd‚Äôhui, je suis venu te parler de PHP (sisi), et notamment du m√©canisme d‚Äôinjection de d√©pendances avec lequel tu n‚Äôes peut-√™tre pas familier. Au menu, des objets, des usines et des conteneurs, alors enfile ton bonnet et tes gants, on va bouger du bordel !</p>
<h2 id="l-injection-de-dependances-c-est-quoi-ce-truc">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/php/injection-dependances/#l-injection-de-dependances-c-est-quoi-ce-truc">#</a>
      L‚Äôinjection de d√©pendances ? C‚Äôest quoi ce truc ?
    </h2><p>Si tu fais de la programmation orient√©e objet, il est fort probable que ce terme ne te soit pas totalement inconnu. En PHP, on a principalement commenc√© √† nous en rebattre les oreilles avec l‚Äôav√®nement de Symfony, qui est aujourd‚Äôhui le framework web majeur pour ce langage. Fabien Potencier, cr√©ateur et <em>lead developer</em> de Symfony, cite en exemple sur <a href="http://fabien.potencier.org/article/11/what-is-dependency-injection" >son blog</a> cette d√©finition :</p>
<blockquote>
<p><em>Dependency Injection is where components are given their dependencies through their constructors, methods, or directly into fields.</em></p>
<p>Quelqu‚Äôun</p>
</blockquote>
<p>C‚Äôest clair, non ? Non ? Bon. Imaginons un bout d‚Äôappli PHP, o√π l‚Äôon d√©sire g√©rer des personnes qui ont chacune une adresse postale. Si tu n‚Äôas pas trop dormi √† la fac le vendredi matin apr√®s ta cuite du jeudi soir, tu devrais pouvoir d√©terminer tout seul qu‚Äôon va avoir besoin d‚Äôune classe <code>Person</code> et d‚Äôune classe <code>Address</code> :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$number</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$street</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$zipcode</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$city</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>)</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;number = <span class="hljs-variable">$number</span>;
        <span class="hljs-variable">$this</span>-&gt;street = <span class="hljs-variable">$street</span>;
        <span class="hljs-variable">$this</span>-&gt;zipcode = <span class="hljs-variable">$zipcode</span>;
        <span class="hljs-variable">$this</span>-&gt;city = <span class="hljs-variable">$city</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;
}
</code></pre>
<p>Tu noteras que je n‚Äôai pas encore √©crit le constructeur de la classe <code>Person</code>. Justement. Le d√©veloppeur na√Øf proc√©dera de la fa√ßon suivante :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>)</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;address = <span class="hljs-keyword">new</span> Address(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>);
    }
}

<span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> Person(<span class="hljs-number">5</span>, <span class="hljs-string">'All√©e des Rosiers'</span>, <span class="hljs-number">78670</span>, <span class="hljs-string">'Villennes-sur-Seine'</span>);
</code></pre>
<p>Alors oui, hein, √ßa marche, et on peut instancier une personne et son adresse en une ligne de code. Le probl√®me est qu‚Äôen proc√©dant ainsi, les classes <code>Person</code> et <code>Address</code> deviennent <strong>√©troitement coupl√©es</strong> : la classe <code>Person</code> est inutilisable sans la classe <code>Address</code>, et pire, le code interne de la premi√®re serait impact√© par un changement sur la seconde.</p>
<p>Pas convaincu ? Qu‚Äôest-ce qui se passera le jour o√π on l√®vera 10 millions de dollars pour internationaliser l‚Äôappli ?</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>
</span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$country</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span>)</span>
    </span>{
        <span class="hljs-comment">// ...</span>
        <span class="hljs-variable">$this</span>-&gt;country = <span class="hljs-variable">$country</span>;
    }
}
</code></pre>
<p>Ah bah mince, il faut aussi modifier le constructeur de la classe <code>Person</code> pour y ajouter le nouveau param√®tre <code>$country</code> de mani√®re sym√©trique. C‚Äôest ballot.</p>
<p>Dans l‚Äôid√©al, la classe <code>Person</code> devrait se foutre royalement de la fa√ßon dont la classe <code>Address</code> fonctionne. Une personne a toujours besoin d‚Äôune adresse, mais √ßa n‚Äôimplique certainement pas que ce soit le r√¥le de cette classe de la forger. Alors, on fait comment ? C‚Äôest tr√®s simple :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(Address <span class="hljs-variable">$address</span>)</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;address = <span class="hljs-variable">$address</span>;
    }
}
</code></pre>
<p>L‚Äôinjection de d√©pendances, c‚Äôest pr√©cis√©ment √ßa. Si une classe a besoin d‚Äôune instance d‚Äôune autre classe, que ce soit dans son constructeur ou dans une autre m√©thode (un <em>setter</em> par exemple), alors elle prend cette instance directement en param√®tre et ne s‚Äôoccupe certainement pas de l‚Äôinstancier elle-m√™me. Proc√©der ainsi permet d‚Äô√©crire du code <strong>d√©coupl√©</strong>, √©vitant toute interd√©pendance entre ses diff√©rents composants, ce qui les rend <strong>r√©utilisables</strong> sans devoir embarquer toute la smala au passage, mais √©galement beaucoup plus <strong>maintenables</strong> puisque chaque classe s‚Äôoccupe de ses fesses et pas de celles des autres. En PHP, on tire √©galement parti du <em>type hinting</em> d‚Äôobjets, qui permet de s‚Äôassurer d‚Äôembl√©e que notre param√®tre est une instance de la classe voulue et non pas n‚Äôimporte quoi.</p>
<p>Alors oui, je t‚Äôentends d√©j√† grommeler :</p>
<blockquote>
<p>Ouais mais du coup je dois instancier une adresse moi-m√™me √† chaque fois que je cr√©e une personne, c‚Äôest relou ton truc</p>
</blockquote>
<p>Si telle est ton opinion, <del>tu ne m√©rites pas de vivre</del> je t‚Äôinvite √† poursuivre la lecture de cet article avec l‚Äôentrain qui te caract√©rise.</p>
<h2 id="l-usine-a-la-rescousse">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/php/injection-dependances/#l-usine-a-la-rescousse">#</a>
      L‚Äôusine √† la rescousse
    </h2><p>Je ne sais pas si tu sais, mais il existe un <em>design pattern</em> assez r√©pandu en programmation orient√©e objet que l‚Äôon nomme <strong>factory</strong> (usine en fran√ßais, d‚Äôo√π le titre pourrave de cette partie).</p>
<p>En gros, le principe est de cr√©er une classe dont le r√¥le est d‚Äôinstancier d‚Äôautres classes, pr√©cis√©ment dans le cas o√π une telle t√¢che demande plusieurs lignes de code, afin justement d‚Äô√©viter de r√©p√©ter celles-ci. Pour reprendre notre exemple :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonFactory</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPerson</span><span class="hljs-params">(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span>)</span>
    </span>{
        <span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> Address(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Person(<span class="hljs-variable">$address</span>);
    }
}
</code></pre>
<p>Pour le coup, tu te dis peut-√™tre que je te prends all√®grement pour un idiot : pourquoi se prendre le chou √† cr√©er une classe qui fait exactement ce qu‚Äôon faisait directement dans <code>Person</code> au d√©part ? Parce que tu n‚Äôas pas bien √©cout√©, <del>petit c</del> jeune padawan. L‚Äôobjectif en utilisant l‚Äôinjection de d√©pendances, c‚Äôest que nos classes ne soient pas d√©pendantes (justement) les unes des autres si ce n‚Äôest pas justifi√©. Une personne a beau avoir besoin d‚Äôune adresse, on pourrait fort bien imaginer les utiliser l‚Äôune sans l‚Äôautre (tu comprendras √† la partie suivante). Dans le cas de <code>PersonFactory</code>, notre objectif est justement de cr√©er une personne √† partir des diff√©rents composants d‚Äôune adresse en une ligne de code, pour conserver la simplicit√© du code m√©tier qui te tient tant √† coeur (et tu as bien raison, au fond). Seulement, <code>Person</code> et <code>Address</code> restent utilisables avec ou sans <code>PersonFactory</code> : l‚Äôobjectif est atteint, petit navire.</p>
<p>Tant qu‚Äôon en est √† se simplifier la vie :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonFactory</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getZipcodeFromDistrict</span><span class="hljs-params">(<span class="hljs-variable">$district</span>)</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">75000</span> + <span class="hljs-variable">$district</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createParigot</span><span class="hljs-params">(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$district</span>)</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;createPerson(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$this</span>-&gt;getZipcodeFromDistrict(<span class="hljs-variable">$district</span>), <span class="hljs-string">'Paris'</span>, <span class="hljs-string">'France'</span>);
    }
}
</code></pre>
<p>Tu t‚Äôimagines faire ce genre de chose dans la classe <code>Person</code> ou la classe <code>Address</code> ? J‚Äôesp√®re bien que non.</p>
<h2 id="oui-ca-sert-a-quelque-chose-une-interface">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/php/injection-dependances/#oui-ca-sert-a-quelque-chose-une-interface">#</a>
      Oui, √ßa sert √† quelque chose une interface
    </h2><p>Dans tes souvenirs brumeux de vendredis matins √©tudiants (<em>cf. supra</em>), tu retrouveras peut-√™tre des bribes de cours portant sur les <strong>interfaces</strong>. Si tout ce que tu as retenu, c‚Äôest qu‚Äô‚Äùune classe toute vide √ßa sert √† rien‚Äù, lis donc ce qui va suivre.</p>
<p>Une interface, c‚Äôest avant tout un contrat. Une classe qui <strong>impl√©mente</strong> une interface s‚Äôengage √† impl√©menter toutes les m√©thodes que celle-ci d√©clare. Sans m√™me lire le code de ladite classe, on sait donc d‚Äôembl√©e comment on peut jouer avec et comment elle est cens√©e fonctionner.</p>
<p>Poursuivons encore sur notre exemple et imaginons qu‚Äôon doive g√©rer des adresses ne respectant pas le format utilis√© jusqu‚Äôici, par exemple une adresse plus basique constitu√©e d‚Äôune unique cha√Æne de caract√®res :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAddress</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;
}
</code></pre>
<p>Dans l‚Äô√©tat actuel des choses, on ne peut pas utiliser une instance de cette classe avec <code>Person</code>, puisque le constructeur de cette derni√®re attend une instance d‚Äô<code>Address</code>. Qu‚Äô√† cela ne tienne !</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAddress</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;address;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;number.<span class="hljs-string">', '</span>.<span class="hljs-variable">$this</span>-&gt;street.<span class="hljs-string">', '</span>.<span class="hljs-variable">$this</span>-&gt;zipcode.<span class="hljs-string">' '</span>.<span class="hljs-variable">$this</span>-&gt;city.<span class="hljs-string">', '</span>.<span class="hljs-variable">$this</span>-&gt;country;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(AddressInterface <span class="hljs-variable">$address</span>)</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;address = <span class="hljs-variable">$address</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAddress</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;address;
    }
}

<span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> BasicAddress(<span class="hljs-string">'test test un deux un deux'</span>);
<span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> Person(<span class="hljs-variable">$address</span>);

<span class="hljs-variable">$factory</span> = <span class="hljs-keyword">new</span> PersonFactory();
<span class="hljs-variable">$robert</span> = <span class="hljs-variable">$factory</span>-&gt;createParigot(<span class="hljs-number">1</span>, <span class="hljs-string">'Rue de la Paix'</span>, <span class="hljs-number">2</span>);

<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$person</span>-&gt;getAddress()-&gt;getFullAddress()); <span class="hljs-comment">// 'test test un deux un deux'</span>
<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$robert</span>-&gt;getAddress()-&gt;getFullAddress()); <span class="hljs-comment">// '1, rue de la Paix, 75002 Paris, France'</span>
</code></pre>
<p>Tu vois l‚Äôid√©e ? En demandant une instance de n‚Äôimporte quelle classe impl√©mentant <code>AddressInterface</code> au lieu d‚Äôune instance d‚Äô<code>Address</code> sp√©cifiquement, on se donne plus de mou et on r√©duit encore davantage le couplage entre nos classes. Qu‚Äôon cr√©e une personne avec une instance d‚Äô<code>Address</code> ou de <code>BasicAddress</code>, on pourra dans tous les cas obtenir l‚Äôadresse postale de ladite personne de la m√™me fa√ßon.</p>
<h2 id="elle-contient-ta-fiancee-hein-mitch">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/php/injection-dependances/#elle-contient-ta-fiancee-hein-mitch">#</a>
      Elle contient ta fianc√©e, hein Mitch ?
    </h2><p>Tu auras peut-√™tre tiqu√© sur un d√©tail du dernier exemple : le fait de ne pas faire de <code>PersonFactory</code> une classe statique (beurk) nous oblige √† l‚Äôinstancier pour pouvoir l‚Äôutiliser ; ce qui, √† n‚Äôen pas douter, t‚Äôaura men√© √† te dire ‚Äúarf, √ßa va m‚Äôen faire des <code>new MachinFactory()</code> pour instancier mes objets‚Äù. L√† encore, l‚Äôinjection de d√©pendances peut nous aider, quoique de mani√®re indirecte : en utilisant un conteneur d‚Äôinjection de d√©pendances.</p>
<p>Un conteneur (√ßa sera plus court) peut <em>grosso modo</em> √™tre compar√© √† une grosse <em>factory</em> capable d‚Äôinstancier plusieurs classes. En pratique, afin d‚Äô√©viter d‚Äô√©crire et de devoir maintenir une classe monolithique, on en fera plut√¥t quelque chose qui fait appel aux diff√©rentes <em>factories</em>. Poursuivons sur notre exemple :</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DependencyInjectionContainer</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPersonFactory</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PersonFactory();
    }
}
</code></pre>
<p>Mais √ßa ne s‚Äôarr√™te √©videmment pas l√†. De par le fait d‚Äôutiliser l‚Äôinjection de d√©pendances √† grande √©chelle, on a souvent besoin d‚Äôinstancier nous-m√™me les objets dont on a besoin. Dans certains cas, ce seront toujours les m√™mes, ce qui vaut pour les <em>factories</em> mais pas que : pense aux diff√©rentes librairies qui composent un projet web, par exemple. Ce ne serait pas g√©nial que les diff√©rentes instances de ces classes soient accessibles via le conteneur pour pouvoir y acc√©der √† l‚Äôenvi ?</p>
<pre><code class="lang-php"><span class="hljs-variable">$container</span> = <span class="hljs-keyword">new</span> DependencyInjectionContainer();

<span class="hljs-variable">$container</span>-&gt;getOrm()-&gt;performSomeNaughtyQuery();
<span class="hljs-variable">$container</span>-&gt;getTwig()-&gt;renderUglyTemplate();
<span class="hljs-variable">$container</span>-&gt;getTranslator()-&gt;translate(<span class="hljs-string">'Putain de code !'</span>);
</code></pre>
<p>Les objets ainsi g√©r√©s par un tel conteneur deviennent d√®s lors des <strong>services</strong> dans ton application.</p>
<blockquote>
<p>Mais √ßa signifie instancier un service √† chaque appel ?</p>
</blockquote>
<p>Pas n√©cessairement ! Il existe des m√©canismes permettant de conserver une m√™me instance pour la servir lors des appels suivants. Cela sort un peu du cadre de cet article, mais je t‚Äôinvite vivement √† jeter un oeil √† <a href="http://php-di.org/" >PHP-DI</a>, qui est un conteneur d‚Äôinjection de d√©pendances tr√®s bien fichu que tu peux utiliser dans ton projet si tu le souhaites.</p>
<h2 id="epilogue">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/php/injection-dependances/#epilogue">#</a>
      √âpilogue
    </h2><p>Si tu d√©veloppes en PHP, j‚Äôesp√®re t‚Äôavoir montr√© qu‚Äôil est possible d‚Äô√©crire du code plus maintenable et plus √©l√©gant en utilisant l‚Äôinjection de d√©pendances. Dans le cas contraire, sache que ce concept est tr√®s r√©pandu dans les langages orient√©s objet d‚Äôune mani√®re g√©n√©rale - apr√®s tout, <a href="https://docs.angularjs.org/guide/di" >on en retrouve m√™me dans Angular</a>.</p>
<p>Bon code, et n‚Äôoublie pas, on ne met pas en prod le vendredi, c‚Äôest mal. Allez, file !</p>
]]></description>
            <link>http://putaindecode.fr/posts/php/injection-dependances/</link>
            <guid isPermaLink="true">http://putaindecode.fr/posts/php/injection-dependances/</guid>
            <pubDate>Wed, 05 Nov 2014 00:00:00 GMT</pubDate>
        </item>
    </channel>
</rss>