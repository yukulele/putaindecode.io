<?xml version="1.0" encoding="utf-8" ?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Putain de code !</title><description></description><link>http://putaindecode.fr</link><!-- generator putaindecode--><lastBuildDate>Thu, 01 May 2014 15:56:13 GMT</lastBuildDate><atom:link href="http://putaindecode.fr/feed.xml" rel="self" type="application/rss+xml"></atom:link><item><title>Introduction au testing js front</title><description><![CDATA[[
<p>Les tests automatis√©s en front-end ont longtemps √©t√© ignor√©s,
et le sont encore trop.</p>
<p>√âcrire des tests peut para√Ætre chiant, mais le temps qu&#39;ils rapportent
compense largement celui que l&#39;on passe √† les √©crire.</p>
<h2 id="-crire-du-js-testable">√©crire du js testable</h2>
<p>Prenons un exemple simple et moche :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//app.js</span>
;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

  <span class="hljs-keyword">var</span> cart = $(<span class="hljs-string">"#cart"</span>)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToCart</span><span class="hljs-params">(id)</span>{</span>
    <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>)
    element.html(catalog[id])
    cart.append(element)
  }

  $(<span class="hljs-string">".js-updateCart"</span>)
    .on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
      addToCart($(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"id"</span>))
    })

})()
</code></pre>
<p>Tester ce code est particuli√®rement lourd, pour plusieurs raisons :</p>
<ul>
<li>les functions √† tester ne sont pas accessibles</li>
<li>on doit simuler un <code>click</code> pour tester un comportement logique.</li>
<li>on doit cr√©er un element et modifier sont <code>data-id</code> √† chaque cas souhait√©.</li>
<li>pour tester <code>addToCart</code> on doit aller regarder dans le DOM.</li>
</ul>
<h3 id="1-rendez-accessibles-vos-m-thodes-au-test-runner">1. rendez accessibles vos m√©thodes au test runner</h3>
<p>Vous pouvez utiliser un namespace ad√©quat.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> app = window.app = {}
app.cart = {}
app.cart.addToCart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-comment">/* ‚Ä¶ */</span> }
</code></pre>
<p>Mais ne souhaitez probablement pas rendre vos m√©thodes accessibles √† la console.</p>
<p>Utilisez un module-system : <a href="http://browserify.org">browserify</a> ou
<a href="http://requirejs.org">requirejs</a> (si vous n&#39;avez pas besoin de chargement
conditionnel et souhaitez cr√©er un bundle par build, utilisez browserify qui
poss√®de une syntaxe beaucoup plus sympathique et une codebase r√©duite, vous
pourrez m√™me <code>require</code> depuis un module npm).</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>) <span class="hljs-comment">// oh, un module npm</span>

module.exports = {
  element : $(<span class="hljs-string">"#cart"</span>),
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-comment">/* ‚Ä¶ */</span>
  }
}
</code></pre>
<p>Vous pourrez ainsi s√©parer proprement votre application en modules et les tester individuellement.</p>
<h3 id="2-oui-mais-les-modules-interd-pendants-alors-">2. oui, mais les modules interd√©pendants alors ?</h3>
<p>L√†, √ßa devient un peu plus tricky.
Ce que je conseille √† titre personnel c&#39;est d&#39;utiliser des events
pour faire communiquer les diff√©rentes parties de l&#39;application.</p>
<p>Cela permet d&#39;√©viter d&#39;utiliser des mocks d&#39;autres parties de l&#39;application partout.</p>
<p>Par exemple, si je souhaite tester le fait qu&#39;un click sur <code>.js-updateCart</code>
d√©clanchera bien <code>updateCart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//view.js</span>

<span class="hljs-comment">// view est une petite class qui route les events</span>
<span class="hljs-comment">// en rendant les listeners accessibles aux tests</span>
<span class="hljs-comment">// vous pouvez tr√®s facilement en concevoir une</span>
<span class="hljs-comment">// √† votre go√ªt en quelques lignes de code</span>
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/view"</span>)

<span class="hljs-comment">// eventbus est l'event bus de l'application, il orchestre</span>
<span class="hljs-comment">// la communication entre les diff√©rents modules</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)

<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

module.exports = view.extend({
  element : document.body,
  events : [
    {
      type : <span class="hljs-string">"click"</span>,
      selector : <span class="hljs-string">".js-addToCart"</span>,
      listener : <span class="hljs-string">"addToCart"</span>
    }
  ],
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-keyword">var</span> target = eventObject.currentTarget
    <span class="hljs-keyword">var</span> id = $(target).data(<span class="hljs-string">"id"</span>)
    eventbus.fire(<span class="hljs-string">"addToCart"</span>, {
      id : id
    })
  }
})
</code></pre>
<p>et je n&#39;aurais qu&#39;√† √©couter cet event depuis <code>cart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.js</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

module.exports = {
  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">this</span>._addToCart = <span class="hljs-keyword">this</span>.addToCart.bind(<span class="hljs-keyword">this</span>)
    eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  release : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    eventbus.stopListening(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-comment">// et on a eventObject.id</span>
    <span class="hljs-keyword">this</span>.products.push(catalog[eventObject.currentTarget.data(<span class="hljs-string">"id"</span>)])
  }
}
</code></pre>
<p>Gr√¢ce √† cette architecture, je vais pouvoir tester individuellement
les deux modules.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// view.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/view"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

tape(<span class="hljs-string">"view"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  test.plan(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>)
  element.data(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>)
  <span class="hljs-comment">// on teste facilement l'envoi</span>
  eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    test.equal(eventObject.id, <span class="hljs-number">1</span>)
  })
  view.addToCart({
    currentTarget : element
  })
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> cart = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/cart"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

tape(<span class="hljs-string">"cart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  cart.initialize()
  eventbus.fireSync(<span class="hljs-string">"addToCart"</span>, {id:<span class="hljs-number">1</span>})
  test.deepEqual(
    cart[<span class="hljs-number">0</span>],
    catalog[<span class="hljs-number">1</span>],
    <span class="hljs-string">"receives addToCart event"</span>
  )
  test.end()
})
</code></pre>
<h2 id="tester-tous-les-cas-possibles">tester tous les cas possibles</h2>
<p>Ce sont souvent les edge-cases qui nous font nous arracher les cheveux.
Pour pallier ces soucis, tester en profondeur est essentiel.</p>
<p>Prenons un exemple, une m√©thode qui teste si la valeur qu&#39;on lui passe est
une <code>string</code>.</p>
<p>On serait tent√© de simplement tester les r√©sultats positifs de cette fa√ßon :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.equal(<span class="hljs-built_in">type</span>.isString(<span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>Or, si par m√©garde ma m√©thode <code>isString</code> se r√©v√®le √™tre :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">"string"</span>
}
</code></pre>
<p>on ne v√©rifie pas le cas <code>type.isString(new String(&quot;&quot;))</code>.</p>
<p>Du coup, des tests complets :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-keyword">function</span>(test){
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-keyword">new</span> String(<span class="hljs-string">""</span>)), <span class="hljs-keyword">false</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>permettent ici d&#39;identifier qu&#39;en r√©alit√© on a besoin de :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(value) == <span class="hljs-string">"[object String]"</span>
}
</code></pre>
<p>Et c&#39;est √† la force des r√©sultats de tests que vous identifierez rapidement
vous familiariserez √† tous ces edge-cases.</p>
<p>√Ä chaque correctif de bug, ajoutez des tests (mais √ßa, vous le saviez d√©j√†).</p>
<h2 id="cross-browser-testing">cross-browser testing</h2>
<p>√Ä l&#39;heure actuelle, o√π l&#39;on se trouve notamment tr√®s souvent avec du
feature testing.
Pour le tester compl√®tement, on doit se servir de vrais navigateurs :
un headless (certes, tr√®s pratique) comme <a href="http://phantomjs.org">phantomjs</a>
ne permettra pas d&#39;obtenir 100% de coverage.</p>
<pre><code class="lang-javascript">var supportsAnimationFrame =
  !!(
    win.requestAnimationFrame <span class="hljs-string">||</span>
    win.webkitRequestAnimationFrame <span class="hljs-string">||</span>
    win.mozRequestAnimationFrame <span class="hljs-string">||</span>
    win.ORequestAnimationFrame <span class="hljs-string">||</span>
    <span class="hljs-comment">// vous avez fait une faute de frappe,</span>
    <span class="hljs-comment">// et mis un `O` majuscule, seul un</span>
    <span class="hljs-comment">// test sur les version concern√©es d'Opera</span>
    <span class="hljs-comment">// vous permettront de l'identifier</span>
    win.msRequestAnimationFrame
  )
</code></pre>
<p>De plus, vous pouvez par habitude √™tre tent√© d&#39;utiliser un
<code>Array.prototype.forEach</code> alors que votre scope navigateur inclut
IE8; seuls des tests sur un vrai browser vous permettront d&#39;identifier le souci.</p>
<p>Je vous conseille fortement testling, tr√®s simple √† int√©grer dans vos
modules, et gratuit pour tout projet open-source.</p>
<p>Dans le <code>package.json</code> :</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">testling</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">files</span>": <span class="hljs-value"><span class="hljs-string">"test/**/*.js"</span></span>,
    "<span class="hljs-attribute">browsers</span>": <span class="hljs-value">[
      <span class="hljs-string">"ie/9..latest"</span>,
      <span class="hljs-string">"chrome/22..latest"</span>,
      <span class="hljs-string">"firefox/16..latest"</span>,
      <span class="hljs-string">"safari/6..latest"</span>,
      <span class="hljs-string">"opera/11.0..latest"</span>,
      <span class="hljs-string">"iphone/6..latest"</span>,
      <span class="hljs-string">"ipad/6..latest"</span>,
      <span class="hljs-string">"android-browser/latest"</span>
    ]
  </span>}
</span>}
</code></pre>
<p>Et ajouter un webhook dans l&#39;admin de votre repository GitHub pointant vers</p>
<blockquote>
<p><a href="http://git.testling.com">http://git.testling.com</a></p>
</blockquote>
<p>Vous pouvez l&#39;utiliser avec tape (son test harness par d√©faut)
Mocha, QUnit et n&#39;importe quelle biblioth√®que
de test supportant <code>TAP</code> comme indiqu√© sur
<a href="https://ci.testling.com/guide/custom_libraries">le site de testling</a>.</p>
<p>Vous trouverez aussi des alternatives populaires
<a href="http://www.browserstack.com">similaires</a>,
ou ayant <a href="http://karma-runner.github.io">une approche diff√©rente</a>.</p>
<p>Par ailleurs, si dans votre code il existe des variations entre les navigateurs,
vous pouvez utiliser du test conditionnel :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">if</span>(typeof {}.__proto__ == <span class="hljs-string">"object"</span>){
  test.equal(<span class="hljs-keyword">list</span>.__proto__ === <span class="hljs-keyword">Array</span>.prototype, <span class="hljs-keyword">false</span>, <span class="hljs-string">"__proto__ isn't Array.prototype"</span>)
} <span class="hljs-keyword">else</span> {
  test.equal(<span class="hljs-keyword">list</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">Array</span>, <span class="hljs-keyword">false</span>, <span class="hljs-string">"Isn't a window Array"</span>)
}
</code></pre>
<p>Happy testing!</p>
<pre><code class="lang-shell">$ testling

TAP version <span class="hljs-number">13</span>
<span class="hljs-preprocessor"># tests</span>
ok <span class="hljs-number">1</span> bisous

<span class="hljs-number">1.</span><span class="hljs-number">.1</span>
<span class="hljs-preprocessor"># tests 1</span>
<span class="hljs-preprocessor"># pass  1</span>

<span class="hljs-preprocessor"># ok</span>
</code></pre>

]]></description><pubDate>Thu, 01 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</guid></item><item><title>Introduction √† Gulp</title><description><![CDATA[[
<p>Vous commencez tous √† connaitre les <em>tasks runners</em>, ces outils qui permettent
d&#39;automatiser les t√¢ches de d√©veloppement r√©currentes.
Personnellement
 <a href="http://moox.io/slides/2013/grunt-before-after/">je n&#39;ai</a>
 <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">pas arr√™t√©</a>
 <a href="http://moox.io/slides/2014/introduction-gulp/">d&#39;en parler</a>
 depuis que
 <a href="/posts/js/premiers-pas-avec-grunt/">Grunt</a>
 √† d√©terr√© cette vielle probl√©matique, assez r√©cente pour le d√©veloppement Web c√¥t√© front end.</p>
<p>Il faut avouer que de par l&#39;√©volution du d√©veloppement Web, c√¥t√© front end,
on voit beaucoup de personnes qui n&#39;ont pas de vraies bases de d√©veloppeur.
Je veux dire par l√† non pas que ces personnes sont incomp√©tentes, mais plut√¥t
qu&#39;il manque parfois la bonne flemme du d√©veloppeur, celle qui le pousse √† <strong>d√©velopper</strong>
des solutions techniques pour mieux d√©velopper des produits.
Il manque un peu <a href="http://fr.wiktionary.org/wiki/algorithmie">d&#39;algorithmie</a>
dans les veines, de curiosit√© et d&#39;amour du risque.
Ce n&#39;est pas en restant dans sa zone de confort qu&#39;on va de l&#39;avant. Enfin si vous
avez des exemples contraires, je suis preneur.
Mais tout cela doit provenir du fait que pas mal de m√©tiers dans le web sont nouveaux,
dont celui de ¬´ d√©veloppeur Web front end ¬ª et que du coup, peu de personnes ont
initialement suivi des formations appropri√©s (pour ma part je proviens d&#39;une
formation <em>d&#39;analyste-programmeur</em>, conception et d√©veloppement software quoi).
Je remarque que niveau back end il y a beaucoup moins de lacunes, du fait que
les probl√©matiques g√©r√©es de ce c√¥t√© sont (il me semble) moins nouvelles.</p>
<p>Bref. Je ne vais pas m&#39;√©terniser sur une intro du pourquoi on met en place un task
runner, ni faire une comparaison entre Make, Rake, Cake, Jake, Grunt, Brunch
et Broccoli.
Rentrons dans le vif. Parlons Gulp.</p>
<h1 id="pourquoi-gulp">Pourquoi Gulp</h1>
<p>Je vais faire court. Pour faire simple, son point fort r√©side dans le fait qu&#39;il utilise des
<a href="http://dailyjs.com/2012/09/10/streams/">streams</a> (tl;dr: un flux de donn√©es - en m√©moire)
et qu&#39;il limite au maximum l&#39;utilisation de fichiers.
Au point qu&#39;il existe une <a href="https://github.com/godaddy/gulp-header/issues/4#issuecomment-32111457">police Gulp</a>
pour vous dire.
Si vous voulez en savoir plus sur les streams, n&#39;h√©sitez pas √† lire l&#39;article de
Nicolas Froidure <a href="http://www.insertafter.com/articles-gulp_vs_grunt.html">Gulp remplacera-t-il Grunt ?</a>
qui contient une partie explicative sur les streams.</p>
<p>Dans la pratique cela √©vite d&#39;avoir un gruntfile qui, si on imagine une task
sass -&gt; autoprefixer -&gt; csso, passe <a href="/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-grunt">3 fois par des lectures/√©critures sur le syst√®me
de fichiers</a>.</p>
<figure>
  <img src="http://jaysoo.ca/images/grunt-flow-2.png" alt="">
  <figcaption>Sans stream</figcaption>
</figure>

<p>Et du coup au lieu d&#39;avoir un fichier de conf d&#39;une soixantaine de lignes, on arrive
√† avoir <a href="http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-gulp">quelque chose de concis</a>
(une vingtaine de ligne seulement).</p>
<figure>
  <img src="http://jaysoo.ca/images/gulp-flow.png" alt="">
  <figcaption>Avec stream</figcaption>
</figure>

<h2 id="installation">Installation</h2>
<p>Pour avoir la commande globale sur le syst√®me (comme grunt-cli) :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>npm i -g gulp
</code></pre>
<p>Ensuite dans votre projet :</p>
<pre><code class="lang-shell">$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-WHATEVER</span>
</code></pre>
<p><em>Note : <code>npm i -D</code> == <code>npm install --save-dev</code>, c&#39;est cadeau.</em></p>
<p>Bon dans mon exemple j&#39;ai mis un peu n&#39;importe quoi, donc on va faire un mini workflow de hipster hacker.</p>
<h2 id="utilisation">Utilisation</h2>
<p>On part avec une t√¢che tr√®s simple : pr√©-processeur CSS <a href="http://myth.io">Myth</a> et
optimisation avec <a href="https://github.com/css/csso">CSSO</a>.</p>
<pre><code class="lang-shell">$ mkdir putaindegulp <span class="hljs-subst">&amp;&amp;</span> cd putaindegulp
$ npm init
$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-myth</span> gulp<span class="hljs-attribute">-csso</span> minimist
</code></pre>
<pre><code class="lang-js">var gulp = require(<span class="hljs-string">"gulp"</span>)
  , gutil = require(<span class="hljs-string">"gulp-util"</span>)
  , plumber = require(<span class="hljs-string">"gulp-plumber"</span>)
  , myth = require(<span class="hljs-string">"gulp-myth"</span>)
  , csso = require(<span class="hljs-string">"gulp-csso"</span>)
  , options = require(<span class="hljs-string">"minimist"</span>)(process<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.slice</span>(<span class="hljs-number">2</span>))

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"styles"</span>, function() {
  gulp<span class="hljs-preprocessor">.src</span>(<span class="hljs-string">"./src/css/*.css"</span>)
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? plumber() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(myth({sourcemap: !options<span class="hljs-preprocessor">.production</span>}))
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? csso() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(gulp<span class="hljs-preprocessor">.dest</span>(<span class="hljs-string">"./dist/css/"</span>))
})

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], function() {
  gulp<span class="hljs-preprocessor">.watch</span>(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})
</code></pre>
<p>Voil√† c&#39;est tout. Et heureusement.</p>
<p>Bon, on se refait l&#39;exemple comment√© :</p>
<pre><code class="lang-js"><span class="hljs-comment">// bah l√† ok, on est oblig√© d'y passer pour avoir l'API Gulp</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)

  <span class="hljs-comment">// √áa c'est optionnel, c'est pour avoir (entre autres la m√©thode noop())</span>
  <span class="hljs-comment">// je reviens dessus apr√®s</span>
  <span class="hljs-comment">// https://github.com/gulpjs/gulp-util</span>
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)

  <span class="hljs-comment">// L√† on a Mario le plombier qui fixe la tuyauterie foireuse.</span>
  <span class="hljs-comment">// Ce plugin patch le probl√®me de stream avec node.js qui fait que tout le process</span>
  <span class="hljs-comment">// explose √† la moindre erreur (pas pratique en cas de watch par exemple)</span>
  <span class="hljs-comment">// en gros, il remplace la m√©thode pipe et attrape les erreurs pour les ressortir gentiment</span>
  <span class="hljs-comment">// https://gist.github.com/floatdrop/8269868</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

  <span class="hljs-comment">// Ici, rien de magique, du plugin en veux-tu en voil√†</span>
  , myth = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-myth"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

  <span class="hljs-comment">// ici on chope les options de la ligne de commande</span>
  <span class="hljs-comment">// exemple: pour avoir options.production √† true,</span>
  <span class="hljs-comment">// il suffit de faire `gulp --production`</span>
  , options = <span class="hljs-built_in">require</span>(<span class="hljs-string">"minimist"</span>)(process.argv.slice(<span class="hljs-number">2</span>))

<span class="hljs-comment">// D√©finition d'une t√¢che, un nom et une fonction.</span>
<span class="hljs-comment">// Ce qui est pratique c'est le fait de pouvoir mettre ce qu'on veut</span>
<span class="hljs-comment">// y compris un console.log() ^^</span>
<span class="hljs-comment">// un autre param√®tre peut √™tre ajout√© avant la fonction, qui permet de pr√©ciser</span>
<span class="hljs-comment">// les d√©pendances (cf task dev plus bas par exemple)</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// Ici on attrape les fichiers (glob classique)</span>
  <span class="hljs-comment">// √† la racine (on va consid√©rer que nos fichiers finaux ne seront pas dans</span>
  <span class="hljs-comment">// des sous dossiers, r√©serv√©s aux partials &amp; co)</span>
  gulp.src(<span class="hljs-string">"./src/css/*.css"</span>)

    <span class="hljs-comment">// On utilise plumber que si on build en dev, sinon faut que √ßa p√™te, qu'on</span>
    <span class="hljs-comment">// soit pr√©venu lors d'un build pour la prod</span>
    .pipe(options.production ? plumber() : gutil.noop())

    <span class="hljs-comment">// Et l√† on pipe nos plugins</span>
    <span class="hljs-comment">// toujours en jouant avec les options si besoin</span>
    .pipe(myth({sourcemap: !options.production}))
    .pipe(options.production ? csso() : gutil.noop())

    <span class="hljs-comment">// Super important, on convertit nos streams en fichiers</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
})

<span class="hljs-comment">// Ici on a une t√¢che de dev qui lance un watch APRES avoir ex√©cut√© `styles` une fois</span>
gulp.task(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// gulp.watch est natif (pas comme avec grunt)</span>
  <span class="hljs-comment">// vous noterez qu'ici par exemple on va surveiller tous les fichiers</span>
  <span class="hljs-comment">// et non pas ceux juste √† la racine par exemple</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})

<span class="hljs-comment">// Comme grunt, `gulp` sans argument lancera la t√¢che `default`.</span>
</code></pre>
<p>Bien entendu, vous avez d√©j√† compris que si vous voulez remplacer Myth par Sass,
c&#39;est l&#39;histoire de 4 secondes.</p>
<h2 id="putain-de-code-approuve-gulp-">Putain de Code approuve Gulp.</h2>
<p>Ici on est carr√©ment fan de Gulp. Il faut bien avouer que
<a href="https://twitter.com/putaindecode/status/460868992396460032">√ßa va vite</a>
(encore plus appr√©ciable lorsque l&#39;on n&#39;a pas de SSD) et que c&#39;est plaisant √† √©crire.
Pas de configurations pas sp√©cialement verbeuse et trop espac√©e.
Avec Gulp on se sent plus libre, moins contraint.
Du coup, <strong>on a carr√©ment fait notre site avec Gulp</strong>
(puis au passage un petit refresh graphique tant qu&#39;√† faire).</p>
<p>Pour aller plus loin, vous n&#39;avez qu&#39;√† ouvrir notre <a href="https://github.com/putaindecode/website/blob/master/Gulpfile.js">Gulpfile</a>
et regarder nos <a href="https://github.com/putaindecode/website/tree/master/tasks">tasks</a>
qui vont de <a href="https://github.com/putaindecode/website/blob/master/tasks/clean.js">la plus simple</a>
√† <a href="https://github.com/putaindecode/website/blob/master/tasks/contributors.js">la plus compliqu√©</a>.</p>
<p>Pour voir des t√¢ches plus ¬´ real world example ¬ª je vous invite √† regarder les tasks suivantes :</p>
<ul>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/server.js">server</a>,
le server de dev local avec livereload dedans ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/watch.js">watch</a>,
le classique et si simple watcher ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/publish.js">publish</a>,
la t√¢che pour publier le dossier <code>dist/</code> sur les <a href="https://pages.github.com/">gh-pages</a> ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/icons.js">icons</a>,
qui transforme des SVG en fontes d&#39;icones avec le bout de CSS qui va bien ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts-linting.js">scripts-linting</a>,
qui v√©rifie la qualit√© du code ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts.js">scripts</a>,
du <a href="/posts/js/browserify-all-the-things/">browserify</a> pour nos JS c√¥t√© client ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/stylesheets.js">stylesheets</a>,
notre t√¢che qui m√©lange (pour l&#39;instant) Stylus et Rework (suite √† une rixe √† la r√©cr√©, on n&#39;a pas r√©ussi √† se mettre d&#39;accord, donc chacun √† rajout√© son morceau) ;</li>
</ul>
<p>Bien entendu, si vous ne comprenez pas certaines parties, n&#39;h√©sitez pas √†
<a href="https://github.com/putaindecode/website/issues/new">ouvrir une issue</a>
pour demander des explications.</p>
<h2 id="vous-reprendrez-bien-un-peu-de-gulp-pardon-">Vous reprendrez bien un peu de‚Ä¶ Gulp* ! Pardon.</h2>
<p>Si vous avez encore envie de d√©tails je vous renvoie sur l&#39;article anglais
<a href="http://markgoodyear.com/2014/01/getting-started-with-gulp/">Getting started with gulp</a>
qui d√©taille tellement bien chaque point que m√™me un anglophobe comprendrait.</p>
<p>Vous avez aussi
<a href="https://github.com/gulpjs/gulp/blob/master/docs/README.md">une documentation</a>
tr√®s bien faite, qui comporte carr√©ment
<a href="https://github.com/gulpjs/gulp/tree/master/docs/recipes">des exemples <em>officiels</em> tout pr√™ts</a>.</p>
<p>Comme je vous disais plus t√¥t, les auteurs de Gulp sont assez carr√©s et valident
(ou plut√¥t <em>invalident</em>) <a href="https://npmjs.org/search?q=gulpplugin">les plugins</a> qui
ne respectent pas les
<a href="https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md">r√®gles</a>.
Je trouve que c&#39;est gage de qualit√©.</p>
<p>Pour finir quelques liens pour ceux qui en veulent toujours plus :</p>
<ul>
<li><a href="http://www.insertafter.com/articles-retour_experience_gulp.html">Gulp : Retour d&#39;exp√©rience</a></li>
<li><a href="http://jaysoo.ca/2014/01/27/gruntjs-vs-gulpjs/">Grunt vs. Gulp, au-del√† des chiffres</a> (anglais)</li>
</ul>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>gulp bisous
‚ùØ ‚ô° üòò
</code></pre>

]]></description><pubDate>Tue, 29 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-gulp/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-gulp/</guid></item><item><title>Les post-processeurs CSS</title><description><![CDATA[[
<p>Vous avez surement entendu parler des <a href="http://iamvdo.me/blog/les-postprocesseurs-css"><em>post-processeurs CSS</em></a>.
J&#39;ai personnellement pas mal fait r√©f√©rence √† <del>ce concept</del> cette expression ces derniers temps.
Que ce soit lorsque je vous racontais
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">comment se passer des pr√©fixes CSS</a>
ou lors
<a href="/posts/css/le-point-sur-les-preprocesseurs/">d&#39;un point sur les pr√©-processeurs CSS</a>.
N&#39;y a-t-il rien qui vous a fait tiquer ?</p>
<h2 id="du-post-processing-">Du post-processing ?</h2>
<p>Bon on va pas jouer sur les mots mais quand m√™me un peu. <em>Post</em> √ßa veut dire apr√®s.
Mais apr√®s quoi ? Apr√®s du <em>processing</em>. Donc en th√©orie apr√®s que la feuille de
style ait √©t√© trait√©e.</p>
<p>Si on revient sur <em>pr√©-processeurs</em>, on a quelques choses de sens√©.
On travaille sur la feuille de style avant qu&#39;elle n&#39;ait √©t√© trait√©e.
Trait√©e par qui ? Je dirais le navigateur pas vous ?
Dans ce cas le pr√©-processing est tout √† fait logique.</p>
<p>Mais le post-processing ? Du vrai post-processing √ßa existe ? Oui et √ßa ressemblerait √† √ßa par exemple :
<a href="http://jsfiddle.net/yyx990803/B5JTg/">Interpolation de CSS avec Vue.js</a> (enfin je crois).
Ici on a un process sur du CSS existant, d√©j√† trait√© par le navigateur.</p>
<p>Bon ok j&#39;avoue que je pinaille un peu. On pourrait consid√©rer que le &quot;process&quot;,
c&#39;est le fait d&#39;am√©liorer sa feuille de style et dans ce cas, on pourrait accepter pr√©- et post-process.
Mais √ßa reste pas super exact de mon point de vue.</p>
<p>Du coup on appelle √ßa comment les post-processeurs ?
Devrait-on appeler √ßa du <em>post-pr√©-processing</em> ? Je vous le demande.</p>
<p>Assez plaisant√©, passons donc √† l&#39;explication de ce qu&#39;on appelera le <em>post-processing.</em></p>
<h2 id="le-post-processing">Le post-processing</h2>
<p>Quel est la diff√©rence avec du pr√©-processing ? Pour r√©pondre √† cette question,
il faut bien d√©finir ce qu&#39;est le pr√©-processing dans notre contexte.</p>
<h3 id="le-pr-processing-css">Le pr√©-processing CSS</h3>
<p>Le pr√©-processing est un pr√©-traitement avant le traitment final. Dans le cas de feuille de style,
on travaille donc sur des pr√©-feuilles de style. Ce ne sont donc pas des feuilles de style.
Comment les diff√©rencie-t-on ? La syntaxe.</p>
<p>Hola hola, calmez-vous. J&#39;en entends d√©j√† chouiner qu&#39;avec Sass, Less et Stylus,
on peut coller du CSS valide et √áa Marche‚Ñ¢. Oui √ßa marche. Mais seulement dans ce sens.
Si on essaye de faire parser un <code>@foreach</code>, <code>@include</code> ou ce genre de nouveaut√©s
apport√©s par un pr√©-processeur, votre navigateur il va faire la gueule.</p>
<p>En effet un pr√©-processeur n&#39;est rien d&#39;autre qu&#39;un langage. Un nouveau.
Il ajoute des √©l√©ments √† ce langage, et change m√™me √©ventuellement la syntaxe.
Certes il peut s&#39;appuyer sur un langage existant (par exemple la syntaxe Scss de Sass, ou la syntaxe Less )
mais √ßa n&#39;est pas oblig√© (exemple avec l&#39;ancienne syntaxe Sass, ou encore pour changer de registre, CoffeeScript pour du JavaScript).</p>
<h3 id="diff-rence-entre-post-processing-et-pr-processing">Diff√©rence entre post-processing et pr√©-processing</h3>
<p>Avant de parler des diff√©rences il nous faut un cas concret pour y voir plus clair.
Autoprefixer est un tr√®s bon exemple, mais je vais vous en montrer un encore plus pertinent: les fallbacks REM.
J&#39;esp√®re que vous connaissez le REM (root EM), cette unit√© CSS tr√®s utile qui permet d&#39;avoir la souplesse de l&#39;unit√© EM,
en se basant non sur l&#39;√©lement parent, mais l&#39;√©lement root (donc le document).
Cette unit√© CSS n&#39;est par exemple pas compatible avec IE8, et certain d&#39;entre vous doivent encore le supporter.</p>
<p>On a donc vu pas mal de mixins genre <code>rem2px()</code> pour ajouter un fallback, via des pr√©-processeurs CSS.
Sauf que l√†, il semble beaucoup plus pertinent de ne pas alourdir son code (car on y ajoute rien d&#39;int√©ressant),
surtout lorsque c&#39;est pour supporter de vieux navigateurs.
Et si on pouvait ajouter un petit coup de peinture magique, je dirais m√™me automatique,
afin d&#39;avoir ce fallback ?</p>
<p>Et bien, on peut. √áa prend 20 secondes, et √ßa fera les choses bien, sans oubli.
Exemple avec <a href="https://github.com/ctalkington/rework-rem-fallback">rework-rem-fallback</a></p>
<pre><code class="lang-js"><span class="hljs-comment">// il faudrait installer les d√©pendances de la fa√ßon suivante</span>
<span class="hljs-comment">// $ npm i rework rework-rem-fallback</span>

<span class="hljs-keyword">var</span> rework = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework'</span>) <span class="hljs-comment">// le moteur rework, je reviens dessus apr√®s</span>
  , remFallback = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework-rem-fallback'</span>) <span class="hljs-comment">// le plugin rework</span>

  <span class="hljs-comment">// lecture du fichier css</span>
  , css = <span class="hljs-keyword">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(<span class="hljs-string">'dist/index.css'</span>, <span class="hljs-string">'utf8'</span>).toString()

  <span class="hljs-comment">// on traite le CSS en indiquant √† rework la source, et le plugin √† utiliser</span>
  , out = rework(css).<span class="hljs-keyword">use</span>(remFallback()).toString()

  <span class="hljs-comment">// ici on fait la m√™me chose, mais comme si la font de base √©tait en 14px</span>
  , out14 = rework(css).<span class="hljs-keyword">use</span>(remFallback(<span class="hljs-number">14</span>)).toString()
</code></pre>
<p>Avec l&#39;exemple d&#39;avant, et ce bout de CSS:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem </span></span></span>}
</code></pre>
<p>... On obtiendra le r√©sultat suivant:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">80</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Notre exemple n&#39;est pas int√©gr√© dans un
<a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">workflow automatis√©</a>,
mais c&#39;est juste pour vous montrer que c&#39;est l&#39;histoire de 5 lignes de code
et pas autant de lignes que de fois o√π l&#39;on a <code>rem</code> dans sa feuille de style.</p>
<p>Sexy n&#39;est-ce pas ?</p>
<p>L&#39;autre grosse diff√©rence entre le pr√©- et le post-processing, c&#39;est le langage.
Ce post-processing s&#39;effectue apr√®s du pr√©-processing. Donc apr√®s que le pr√©-processeur,
cet autre langage, ait fait son boulot.</p>
<p><strong>Le post-processing s&#39;effectue sur du CSS de mani√®re transparente.</strong></p>
<p><em>Ce processing s&#39;effectue sur du vrai CSS (disons la syntaxe CSS).</em></p>
<p>Cette syntaxe √©tant tr√®s simple (se r√©sumant principalement √† <code>selecteur { prop: value }</code> - oui y&#39;a les r√®gles <code>@*</code> en plus je sais),
<a href="https://github.com/reworkcss/css-parse#performance">c&#39;est tr√®s rapide √† parser</a>.</p>
<h2 id="pourquoi-du-post-processing-">Pourquoi du post-processing ?</h2>
<p>Comme on vient de le voir avec les 2 points pr√©c√©dents, on a d√©j√† 3 bonnes raisons :</p>
<ul>
<li>la simplicit√© (pour certains cas de figures, c&#39;est plus pertinent, √ßa √©vite trop de code et des
oublis)</li>
<li>la vitesse</li>
<li>le fait de pouvoir brancher ses propres plugins</li>
</ul>
<p>Je sais pas vous mais moi √ßa me suffit. Et en cherchant mieux, on pourrait s√ªrement trouver d&#39;autres arguments.
(<em>Rappel : d&#39;ailleurs n&#39;h√©sitez pas √† modifier cet article si vous en avez</em>).</p>
<h2 id="avec-quoi-doit-on-post-processer-ces-css-">Avec quoi doit-on post-processer ces CSS ?</h2>
<p>Comme vous avez pu le voir tout √† l&#39;heure j&#39;ai pris dans un exemple Rework,
mais il existe aussi PostCSS, plus r√©cent.</p>
<h3 id="-rework-https-github-com-reworkcss-rework-"><a href="https://github.com/reworkcss/rework">Rework</a></h3>
<p>Rework a √©t√© initi√© par le grand <a href="https://github.com/visionmedia">TJ Holowaychuck</a>,
cette machine de guerre (<a href="http://www.quora.com/TJ-Holowaychuk-1/How-is-TJ-Holowaychuk-so-insanely-productive">que certains ne pensent m√™me pas humain</a> pour vous dire).
TJ √©tait il fut un temps utilisateur de Sass, il avait donc m√™me commenc√© le
portage de <a href="https://github.com/stunti/sass.js">Sass en Node</a>.
Il a d√ª se rendre compte bien avant nous que ce n&#39;√©tait finalement pas forc√©ment la meilleure option.
Il a donc d√©velopp√© <a href="https://github.com/LearnBoost/stylus/">Stylus</a> (si, si, c&#39;est bien lui),
le temps de comprendre qu&#39;une autre approche √©tait possible (pour info, il ne maintient maintenant plus Stylus).</p>
<p>C&#39;est donc <a href="https://github.com/reworkcss/rework/commit/0a7be255bfe753d03f93c7072351266fa636e80a">le 1er Septembre 2012 qu&#39;il pousse la premi√®re version de Rework</a>.</p>
<p>L&#39;objectif de Rework n&#39;est pas sp√©cialement de g√©rer du post-process.
Rework se place comme un manipulateur de CSS, permettant (entre autres) :</p>
<ul>
<li>l&#39;automatisation d&#39;ajout des pr√©fixes</li>
<li>la cr√©ation de nouvelles propri√©t√©s</li>
<li>l&#39;int√©gration d&#39;images inline</li>
</ul>
<p>Vous me direz que √ßa ressemble vachement √† un pr√©-processeur n&#39;est-ce pas ?
Vu l&#39;historique que je viens de vous conter et <a href="https://github.com/reworkcss/rework#plugins">les plugins par d√©faut</a>,
vous aurez bien compris que c&#39;est l&#39;id√©e : faire un moteur de pr√©-processeur o√π l&#39;on y branche des plugins pour ajouter nos propres fonctionnalit√©s.
C&#39;est gr√¢ce √† ce projet qu&#39;Autoprefixer a initialement vu le jour d&#39;ailleurs.</p>
<h3 id="-postcss-https-github-com-ai-postcss-"><a href="https://github.com/ai/postcss">PostCSS</a></h3>
<p>Beaucoup plus r√©cent, PostCSS a √©t√© √©crit par l&#39;auteur d&#39;Autoprefixer.</p>
<blockquote>
<p>Heu mais quoi ? Tu viens de nous dire que Autoprefixer utilisait Rework ?!</p>
</blockquote>
<p>Oui <em>c&#39;√©tait</em> le cas. <em>Utilisait</em>. L&#39;auteur de PostCSS s&#39;explique dans <a href="https://github.com/ai/postcss#rework">son README</a>.
Il y indique que, bien que tr√®s similaire, Rework et PostCSS n&#39;ont pas √©t√© d√©velopp√© pour les m√™mes raisons.
C&#39;est ce qui explique les diff√©rences au niveau des moteurs.
PostCSS se veut plus pr√©servateur par rapport √† votre source d&#39;origine,
et g√®re donc mieux sourcemap, peut conserver votre espacement et indentation,
parse de mani√®re plus s√©curis√© (vu que √ßa se veut mieux g√©rer le code legacy).</p>
<p>Dans la pratique je n&#39;ai jamais eu de probl√®me avec Rework, me souciant peu de la mise en forme de la sortie CSS.
Mais PostCSS semble avoir une API plus haut niveau et plus souple pour mieux travailler les feuilles de styles.</p>
<h3 id="rework-ou-postcss-">Rework ou PostCSS ?</h3>
<p>Tout d√©pend ce que vous voulez faire. Si vous avez en t√™te l&#39;id√©e de d√©velopper un outil,
je pencherais plus vers PostCSS. Mais en temps qu&#39;utilisateur, pour l&#39;instant, d√©finitivement Rework.</p>
<p>Ce dernier a clairement beaucoup plus de plugins existants. Voyez par vous-m√™mes :</p>
<ul>
<li><a href="https://www.npmjs.org/search?q=rework">npmjs.org/search?q=rework</a></li>
<li><a href="https://www.npmjs.org/search?q=postcss">npmjs.org/search?q=postcss</a></li>
</ul>
<h2 id="rework-ce-n-est-pas-_que_-du-post-processing-">Rework ce n&#39;est pas <em>que</em> du post-processing ?</h2>
<p>Oui en effet, comme je le disais avant, c&#39;est pas le but. C&#39;est du &quot;processing&quot;.
Pr√©-, post-... Qu&#39;est-ce que √ßa change dans le fond hein ?</p>
<p>L&#39;id√©e, en temps que d√©veloppeur, est d&#39;am√©liorer le confort d&#39;√©criture sans contrainte.
Comme je l&#39;ai indiqu√© <a href="/posts/css/le-point-sur-les-preprocesseurs/#mon-avis-sur-les-pr-processeurs">pr√©c√©demment</a>,
j&#39;ai lach√© les pr√©-processeurs &quot;classiques&quot; ayant l&#39;impression d&#39;utiliser un tank pour tuer une mouche.
Car au fond pour 90% (si ce n&#39;est plus) d&#39;entres nous,
que nous faut-il pour bien d√©velopper des feuilles de styles ?
Un peu d&#39;organisation, des variables et un poil de math ?
Personnellement je me contente de √ßa. Pour l&#39;organisation, je suis devenu fan de BEM
(on vous en parle bient√¥t).</p>
<p><strong>Et en attendant de vraiment pouvoir utiliser les variables CSS associ√© √† <code>calc()</code>,
je reste sur du <em>custom pr√©-processing</em> via Rework avec lequel je peux coder avec la syntaxe des specs (m√™me si c&#39;est en draft), plus future-proof.</strong></p>
<p>J&#39;aime conserver la syntaxe CSS et avoir un process ultra-rapide et transparent.</p>
<h3 id="prochaine-tape-faire-son-propre-pr-post-processeur-css-c-est-simple">Prochaine √©tape: faire son propre pr√©/post-processeur CSS, c&#39;est simple</h3>
<p>Rework ayant un bon petit paquet de plugins d√©j√† existants, c&#39;est assez simple de r√©aliser son propre pr√©-processeur via quelques lignes de code seulement.
La mise en place et l&#39;automatisation feront l&#39;objet d&#39;un prochain article !</p>

]]></description><pubDate>Tue, 08 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/les-post-processeurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/les-post-processeurs/</guid></item><item><title>Le point sur les pr√©-processeurs CSS</title><description><![CDATA[[
<h2 id="pourquoi-les-pr-processeurs">Pourquoi les pr√©-processeurs</h2>
<p>Voil√† ce que j&#39;ai √©crit en 2011 dans
<a href="http://moox.io/blog/utiliser-des-variables-fonctions-css/">mon premier post sur les pr√©-processeur</a>.
Je venais de d√©couvrir cette notion et j&#39;avais donc fait le tour de la question.</p>
<blockquote>
<p>Le langage des CSS n‚Äôa pas de c√¥t√© dynamique. C‚Äôest lui avec lequel, √† chaque
fois qu‚Äôon int√®gre une maquette graphique, on doit se taper tout de z√©ro.
Il a beau exister des CSS ¬´ Reset ¬ª, des frameworks CSS, tout un tas de
grilles pr√™te √† l‚Äôemploi, des composants de CSS r√©utilisables avec l‚Äôapproche
objet, je n‚Äôai jamais r√©ellement √©tait satisfait par ces m√©thodes, que ce soit
√† cause des contraintes qu‚Äôimpose la syntaxe (devoir mettre des classes √† tout
va dans l‚ÄôHTML √ßa peut vite devenir chiant dans un CMS), ou par d‚Äô√©ventuelles
limitations qui obligent √† ¬´ trop ¬ª modifier la source du document (pas assez
de, ou trop de, ou seulement √ßa ne me plait pas comment c‚Äôest fait).</p>
</blockquote>
<p>J&#39;avais tout dit, m√™me des trucs qu&#39;aujourd&#39;hui je pense √™tre des conneries (il
n&#39;y a que les cons qui ne changent pas d&#39;avis + c&#39;est en faisant des erreurs
qu&#39;on apprend le mieux), mais je reviendrais dessus plus tard.</p>
<p>Du coup on en retire quoi ? Qu&#39;utiliser un pr√©-processeur se justifie par
l&#39;ajout de fonctionnalit√©s lorsque vous √©crivez des feuilles de style (en tant
que d√©veloppeur). En tant qu&#39;utilisateur du code produit, cela va permettre
d&#39;ajouter une couche abstraction (ce qui peut poser des probl√®mes, je reviendrais
sur ce point plus tard).</p>
<h2 id="principales-fonctionnalit-s">Principales fonctionnalit√©s</h2>
<ul>
<li>variables</li>
<li>fonctions</li>
<li>mixins (permettant de r√©aliser des sorties CSS param√©trables)</li>
<li><code>@import</code> intelligent (pas c√¥t√© client)</li>
<li>nesting (imbrications des s√©lecteurs pour √©viter la r√©p√©tition)</li>
<li>optimisation et abstraction pouss√©e (via les mixins, placeholders et <code>@extend</code>)</li>
</ul>
<p>Anciennement on aurait rajout√© √† cette liste la gestion du CSS 3, mais comme
je l&#39;expliquais il y a peu, ce n&#39;est plus n√©cessaire, on a une m√©thode bien
mieux, rapide et surtout <b>maintenu √† jour</b> avec
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">AutoPrefixer</a></p>
<h2 id="les-principaux-pr-processeurs">Les principaux pr√©-processeurs</h2>
<h3 id="-sass-http-sass-lang-com-"><a href="http://sass-lang.com/">Sass</a></h3>
<p>Sass est √† mon avis le plus mature des pr√©-processeurs CSS.
Il poss√®de 2 syntaxes (une indent√©e et une plus proche de CSS).
Ce projet avance √† bon rythme. Niveau fonctionnalit√©s, rien √† dire si ce n&#39;est que
celui-ci a un petit plus pour avec la feature <code>@content</code> qui permet pour le coup de
passer tout un bloc de propri√©t√©s en param√®tre √† des mixins. Ce qui est super
pratique lorsque l&#39;on √©crit pas mal de media queries.
(Apr√®s, venez pas me dire qu&#39;on a plein de fois les media-queries qui se
r√©p√®tent et que ce n&#39;est pas bien pour la taille du fichier, gzip se chargera de √ßa -
<small><a href="https://twitter.com/kaelig/status/412909849207644160">exemple similaire</a>)</small>.</p>
<p>Le langage Sass poss√®de une impl√©mentation d&#39;origine en Ruby mais aussi depuis
quelques temps une impl√©mentation C qui se veut beaucoup plus rapide et portable:
<a href="http://libsass.org/">libsass</a> mais qui est encore un peu en retard niveau
fonctionnalit√© (affaire √† suivre). Surtout depuis la version 3.3 qui poss√®de de
nouvelles fonctionnalit√©s (comme les maps, entre autres).</p>
<p>Avec ce pr√©-processeur, on peut s&#39;√©loigner pas mal du CSS natif, que ce soit avec
la syntaxe ou l&#39;aspect programmation (il n&#39;y a qu&#39;√† voir des trucs comme
<a href="https://github.com/Team-Sass/modular-scale">modular-scale</a> ou
<a href="https://github.com/HugoGiraudel/SassyMatrix">SassyMatrix</a>).</p>
<p>Bibliot√®ques construites sur Sass :</p>
<ul>
<li><a href="http://compass-style.org/">Compass</a>, solide, bas√© sur Ruby (incompatible libsass),</li>
<li><a href="http://bourbon.io/">Bourbon</a>, plus light mais plus rapide.</li>
</ul>
<h3 id="-less-http-lesscss-org-"><a href="http://lesscss.org/">LESS</a></h3>
<p>Je n&#39;ai pas trop envie de parler de ce pr√©-processeur assez classique, qui a fait un
choix assez √©trange pour les variables par exemple (oui, <code>@</code> est un caract√®re
sp√©cial en CSS, c&#39;est assez √©trange de rajouter une couche avec pour les variables
avec ce dernier).
J&#39;esp√®re seulement que ceux qui l&#39;utilisent aujourd&#39;hui n&#39;utilise pas le script c√¥t√© client
(ce qui provoquerait un affichage sans CSS si le client n&#39;a pas JavaScript activ√©).
Bien qu&#39;il soit populaire, le repository sur GitHub n&#39;est pas signe de bonne sant√©
√† mes yeux. Voir des pull-requests qui tra√Ænent vielles de plusieurs
<del>mois</del> <ins>ann√©es</ins> me laissent dubitatif...
Puis il n&#39;y a qu&#39;√† voir l&#39;exemple sur la homepage du site avec les box-shadow,
pour voir que ce pr√©-processeur est assez d√©pr√©ci√©.</p>
<p>Ajoutons √† cela le fait que Twitter Boostrap a (enfin) une version Sass...</p>
<p>C√¥t√© fonctionnalit√©s, l&#39;aspect programmation est assez laborieux avec la fa√ßon dont
sont g√©r√©s les mixins conditionnels. Je passe sur ce point gerbant.</p>
<p>Bibliot√®ques construites sur Less :</p>
<ul>
<li><a href="http://lesshat.madebysource.com/">LESS Hat</a>,</li>
<li><a href="http://lesselements.com/">LESS Elements</a>.</li>
</ul>
<h3 id="-stylus-http-learnboost-github-io-stylus-"><a href="http://learnboost.github.io/stylus/">Stylus</a></h3>
<p>Stylus se veut plus transparent que les autres pr√©-processeurs. C&#39;est un point
r√©ussi puisqu&#39;il permet d&#39;avoir des mixins transparents au niveau √©criture.
Cela peut par contre bien entendu rendre la maintenance et la compr√©hension plus
difficile si on en abuse.
Il permet aussi de coder sans <code>{}</code> ni <code>:</code> ni <code>;</code> (bien que tout cela soit optionnel)</p>
<p>Niveau fonctionnalit√©s cela ne vaut pas Sass. Ici pas de <code>@content</code> ou de maps.</p>
<p>Bibliot√®que construite sur Stylus :</p>
<ul>
<li><a href="http://visionmedia.github.io/nib/">Nib</a></li>
</ul>
<h3 id="alternatives">Alternatives</h3>
<p>On peut s&#39;amuser √† faire un pr√©-processeur CSS avec n&#39;importe quel langage c&#39;est
√©vident.
Mais <a href="http://www.alsacreations.com/astuce/lire/1433-utiliser-php-pour-gerer-vos-styles-css.html">les enfants, ne faites pas √ßa.</a>
√Ä moins que vous souhaitiez alourdir vos CSS plus que vous y gagnerez.
Puis si c&#39;est juste pour ajouter des variables, il existe d&#39;autres solutions...</p>
<p><em>Note: si vous avez d&#39;autres pr√©-processeurs int√©ressants, je me ferais un plaisir
de les ajouter ici. Mais bon <a href="https://github.com/putaindecode/website/blob/master/pages/posts/css/le-point-sur-les-preprocesseurs/index.md">vous pouvez aussi le faire tout seul comme un
grand</a>.</em></p>
<h2 id="les-pr-processeurs-sont-ils-vraiment-n-cessaire-">Les pr√©-processeurs sont-ils vraiment n√©cessaire ?</h2>
<blockquote>
<p>Oula. Le mec vient de nous poser un post pour nous parler des pr√©-processeurs,
et il nous sort une question comme √ßa ? Il est o√π le pi√®ge ?</p>
</blockquote>
<p>Si je pose la question c&#39;est que j&#39;ai une petite r√©ponse par l√†. Et elle ne va
peut-√™tre pas vous plaire.</p>
<p>Je vais revenir sur certains points qui peuvent poser probl√®me avec les pr√©-processeurs.</p>
<h3 id="le-nesting-cay-mal">Le nesting cay mal</h3>
<p>Ahh... Le nesting, c&#39;est bien pratique lorsque l&#39;on travaille sur un CMS
(ou n&#39;importe quoi ayant un code HTML qu&#39;on ne maitrise pas facilement)
de pouvoir utiliser le nesting pour pouvoir rapidement produire les s√©lecteurs ad√©quats.
Mais en terme de maintenance et surtout de r√©utilisation, c&#39;est vraiment √† chier.
Faut dire ce qui est.</p>
<pre><code class="lang-scss">.widget {
 <span class="hljs-comment"> // titre</span>
  h3 { }

 <span class="hljs-comment"> // widget body</span>
  &gt; <span class="hljs-operator">div</span> {

   <span class="hljs-comment"> // liste</span>
    ul {

    }
  }
}
</code></pre>
<p>Cet exemple est parfait pour d√©montrer les limites du nesting.
Comment faire si, sur un widget donn√©e, nous avons comme titre un h2 ou h4 ?
Il faut alourdir la CSS. Pareillement, si notre fameuse liste dans le corps n&#39;est
pas dans la m√™me arborescence que celle d√©crite, il faut √† nouveau alourdir notre CSS.
Sans rentrer dans ces solutions solides (nous parlerons de BEM tr√®s bient√¥t),
cette solution serait bien plus √©l√©gante pour la r√©utilisation :</p>
<pre><code class="lang-css"><span class="hljs-class">.widget</span> <span class="hljs-rules">{<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-title</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-body</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

    <span class="hljs-class">.widget-body-list</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>
</code></pre>
<p>Vous remarquerez que j&#39;ai un code ici beaucoup plus compr√©hensible par un nouveau,
mais aussi bien mieux r√©utilisable et surtout, point tr√®s important, non coupl√©
(non d√©pendant) √† notre arborescence HTML (coucou le DOM).
De plus, utiliser le nesting provoque des s√©lecteurs √† rallonges, apr√®s c&#39;est la
course √† la longueur (et au poids) des s√©lecteurs quand il faut surcharger une
r√®gle h√©rit√©e.
Avec de simple s√©lecteurs, pas de souci de ce genre l√†.</p>
<p><em>ProTip‚Ñ¢ : vous remarquerez que j&#39;indente mon CSS √† l&#39;image des composants, √ßa mange
pas de pain, est cela facilite la lecture, moins lin√©aire.</em></p>
<p>Donc je reviens sur ce que je disais, il faut utiliser pleins de classes dans l&#39;HTML.
√áa sert √† √ßa. Votre CSS produit de cette fa√ßon sera bien plus r√©utilisable.</p>
<h3 id="l-abstraction-cay-dangereux">L&#39;abstraction cay dangereux</h3>
<p>On en revient √† la magie. Lorsqu&#39;on a trop de couche qui cache ce qu&#39;il y a
r√©ellement sous le capot, <a href="http://linuxfr.org/news/encore-un-exemple-de-code-spaghetti-toyota">on peut vite perdre le contr√¥le</a>.</p>
<p>Et voici <a href="https://github.com/MoOx/compass-recipes/issues/104">un parfait exemple</a>
o√π un utilisateur de ma biblioth√®que <a href="https://github.com/MoOx/compass-recipes">Compass Recipes</a>
avait un probl√®me lorsqu&#39;il utilisait 2 mixins qui cachaient trop de code.
Dans  notre cas corners-tucked (version coin scotch√©) et background-noise (bruit visuel).
Il en a perdu des choses simples et avait pass√© beaucoup de temps √† se prendre la t√™te
alors que la solution √©tait tr√®s (trop) simple (une histoire entre <code>background-image</code>
et le shorthand <code>background</code>).</p>
<p>Je me laisse souvent attirer par la magie d&#39;un code, mais mon exp√©rience m&#39;indique
aujourd&#39;hui qu&#39;il ne faut pas abuser de cette partie myst√©rieuse o√π l&#39;on ne sait
plus ce qui se passe.</p>
<p>Je vous laisse imaginer du nesting cach√© dans des mixins qui utilisent d&#39;autres mixins
qui font des @extends de placeholders...</p>
<blockquote>
<p>Un grand pouvoir implique de grandes responsabilit√©s.</p>
</blockquote>
<p>Tout est dit. Il faut faire attention. Tr√®s attention.</p>
<h2 id="mon-avis-sur-les-pr-processeurs">Mon avis sur les pr√©-processeurs</h2>
<p>Je pense que les pr√©-processeurs restent utiles mais seulement pour des projets
de tr√®s grosse envergure, qui poss√®de √©norm√©ment de code CSS et/ou extr√™mement dynamique.
Ou que vous utilisez de solutions comme <a href="http://getbootstrap.com/">Bootstrap</a> ou
<a href="http://foundation.zurb.com/">Foundation</a>, chose que je d√©conseille pour autre chose que des prototypes.</p>
<p>De part mon exp√©rience et mon recul (si si j&#39;en prends je vous jure), je pense que
j&#39;aurais pu m&#39;en passer bien plus souvent que j&#39;ai voulu l&#39;admettre par le pass√©.
Mais bon comme je dis souvent, quel plaisir de se planter quand ce n&#39;est pas dans un platane !</p>
<p>Ce qu&#39;il faut retenir clairement c&#39;est que ce ne sont pas les pr√©-processeurs qui
vont vous faire √©crire des meilleurs feuilles de styles. C&#39;est plus un travail sur
une m√©thodologie et  une organisation adapt√© √† vos besoins qui am√©lioreront
votre quotidien de webdesigner (oui quoi, d√®s qu&#39;on code du CSS, on peut
utiliser l&#39;appellation webdesigner sur son CV, √ßa en jete).</p>
<p>J&#39;ai donc longtemps appr√©ci√© les pr√©-processeurs CSS, mais aujourd&#39;hui je commence
√† leur tourner le dos du fait que je n&#39;utilise que trop peu de leurs fonctionnalit√©s.
J&#39;√©vite l&#39;overkill quoi.</p>
<p>Quand on voit que des <em>grands</em> de l&#39;HTML / CSS comme <a href="http://nicolasgallagher.com/">@necolas</a>
n&#39;utilise pas de pr√©-processeur, on a de quoi se poser des questions.
Avec une bonne biblioth√®que comme <a href="https://github.com/suitcss/suit/">SUIT CSS</a>,
on s&#39;en retrouve √† ne manquer que des petites choses.</p>
<p>Que l&#39;on peut combler.</p>
<p>Avec les post-processeurs par exemple.</p>
<p>J&#39;ai donc √† ce jour moi aussi conserv√© une couche pour ajouter le minimum vital en tant que d√©veloppeur.</p>
<p>Mais ne voulant pas alourdir ce post consacr√© aux pr√©-processeurs CSS,
vous pourrez continuer la lecture au prochain √©pisode qui sera consacr√© aux post-processeurs...</p>
<p><small>(Mamam, t&#39;as vu ce cliffhanger digne des s√©ries US !)</small></p>
<p>Bon promis la prochain fois je vous en parle des post-processeurs. Pour de vrai.</p>

]]></description><pubDate>Tue, 11 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</guid></item><item><title>Mise en place d‚Äôautoprefixer</title><description><![CDATA[[
<p>Suite √† mon pr√©c√©dent article <a href="/posts/css/comment-en-finir-avec-les-prefixes/">Comment en finir avec les pr√©fixes CSS</a>,
certains sont rest√©s sur leur faim.
Voici donc de rapides exemples de mise en place de cette solution.</p>
<h2 id="installation-d-autoprefixer">Installation d‚Äôautoprefixer</h2>
<p>Il vous faudra <a href="http://nodejs.org/">Node.js</a> (qui embarque maintenant <a href="https://www.npmjs.org/">Npm</a>) afin de pouvoir
installer ce nouveau joujou.</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on install autoprefixer via npm en global</span>
$ <span class="hljs-built_in">npm</span> install --<span class="hljs-built_in">global</span> autoprefixer
<span class="hljs-comment"># ou pour les fain√©ants</span>
$ <span class="hljs-built_in">npm</span> i -g autoprefixer
</code></pre>
<p>Une fois ceci fait, vous devriez avoir la commande <code>autoprefixer</code> disponible.
On v√©rifie de suite avec <code>autoprefixer -v</code>.</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -v
autoprefixer <span class="hljs-number">1.0</span>.<span class="hljs-number">20140203</span>
</code></pre>
<p>Vous remarquerez que le num√©ro de version est un peu sp√©cial : il contient une
date en place d‚Äôun num√©ro de patch. Cette date correspond √† la derni√®re mise √†
jour de la base de donn√©es de <em>Can I Use</em>.</p>
<h2 id="utilisation-d-autoprefixer">Utilisation d‚Äôautoprefixer</h2>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer *.css
</code></pre>
<p>C‚Äôest aussi simple que √ßa.</p>
<p>En fait non je plaisante, c‚Äôest un tout petit peu plus long car par d√©faut,
comme beaucoup de commandes, vous allez avoir la sortie crach√©e en plein visage.</p>
<p>Pour voir les options, comme d‚Äôhabitude <code>--help</code> ou <code>-h</code> :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -h
</code></pre>
<p>On y apprend l‚Äôexistance des options suivantes :</p>
<pre><code>Options:
  -<span class="ruby">b, --browsers <span class="hljs-constant">BROWSERS</span>  add prefixes <span class="hljs-keyword">for</span> selected browsers
</span>  -<span class="ruby">o, --output <span class="hljs-constant">FILE</span>        set output file
</span>  -<span class="ruby">d, --dir <span class="hljs-constant">DIR</span>            set output dir
</span>  -<span class="ruby">m, --map                generate source map
</span>  -<span class="ruby">i, --info               show selected browsers <span class="hljs-keyword">and</span> properties
</span>  -<span class="ruby">h, --help               show help text
</span>  -<span class="ruby">v, --version            print program version</span>
</code></pre><p>Du coup si on veut faire un coup de commande bien personnalis√©e on pourra faire :</p>
<pre><code class="lang-shell">$ autoprefixer -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span> index<span class="hljs-preprocessor">.css</span>
</code></pre>
<p>Il va par contre nous falloir un fichier css pour tester :</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on met un peu de CSS dans index.css mani√®re de tester le bouzin</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">"* { box-sizing:border-box}"</span> &gt; index.css
</code></pre>
<p>On peut donc essayer notre commande plus haut qui va remplir le fichier <code>prefixed.css</code></p>
<p>Pour v√©rifier :</p>
<pre><code class="lang-shell">$ cat prefixed<span class="hljs-built_in">.</span>css
<span class="hljs-subst">*</span> { <span class="hljs-attribute">-webkit</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; <span class="hljs-attribute">-moz</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; box<span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>}
</code></pre>
<p>On a bien eu des pr√©fixes ajout√©s en fonction de notre demande (bon rien pour IE
qui n‚Äôest pas pass√© par une version pr√©fix√©)</p>
<p>Par d√©faut, <em>autoprefixer</em> utilise <code>&gt; 1%, last 2 versions, Firefox ESR, Opera 12.1</code> pour les navigateurs.
Je pense que pour la plupart d‚Äôentre vous voudront ajouter &quot;Explorer 8&quot; √† la liste, mais √ßa
n‚Äôest en th√©orie pas n√©cessaire vu le permier argument qui demande de pr√©fixer tous les navigateurs
dont l‚Äôusage global est sup√©rieur √† 1%. Peut-√™tre Explorer 7 pour certains ?
Faites un tour sur la <a href="http://caniuse.com/usage_table.php">page d√©di√© aux statistiques globales sur CanIUse.com</a> pour avoir une id√©e.</p>
<p>Sinon, pour du petit one shot, un plugin dans votre √©diteur suffira:</p>
<ul>
<li><a href="https://github.com/sindresorhus/atom-autoprefixer">plugin autoprefixer pour Atom</a></li>
<li><a href="https://github.com/sindresorhus/sublime-autoprefixer">plugin autoprefixer pour Sublime Text</a></li>
<li><a href="https://github.com/mikaeljorhult/brackets-autoprefixer">plugin autoprefixer pour Brackets</a></li>
</ul>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>Int√©gration dans Sublime Text</figcaption>
</figure>

<h2 id="automatisation-d-autoprefixer-autoception-">Automatisation d‚Äôautoprefixer (autoception)</h2>
<p>Bien entendu on va pas se taper la commande √† la main tout le temps hein...
Il nous faut automatiser nos processus. Sans quoi on perd du temps, et
<a href="http://deboutlesgens.com/blog/jai-pas-le-temps-la-pire-excuse-qui-soit/">le temps... C‚Äôest du temps !</a></p>
<p>Donc, comme je l‚Äôai dit pr√©c√©demment, on peut utiliser <em>autoprefixer</em> avec les solutions
suivantes:</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec l‚Äôapplication <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu)</li>
</ul>
<p>Si vous avez besoin, je pense que vous trouverez sans trop de probl√®me d‚Äôautres
impl√©mentations.</p>
<p>Cela dit, je vais vous montrer quelques cas d‚Äôutilisations:</p>
<h3 id="make">Make</h3>
<p>L√† c‚Äôest facile, tout bon d√©veloppeur doit avoir <code>make</code> sur sa machine (sinon
c‚Äôest que t‚Äôes pas d√©veloppeur, je sais pas trop ce que tu fais ici du coup).</p>
<p>On peut tout simplement cr√©er un fichier <code>Makefile</code> avec la commande pr√©c√©dente:</p>
<pre><code class="lang-shell"><span class="hljs-comment"># cr√©ation d‚Äôun dossier pour notre popote (puis on va dedans...)</span>
<span class="hljs-variable">$ </span>mkdir autoprefixer-test &amp;&amp; cd autoprefixer-test

<span class="hljs-comment"># On cr√©er un makefile avec une t√¢che `css` (cr√©ation/√©crasement via &gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"css:"</span> &gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On v√©rifie qu‚Äôon a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>

<span class="hljs-comment">## On ajoute notre commande au fichier (ajout au fichier existant via &gt;&gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"\tautoprefixer index.css -b \"last 2 versions, &gt; 1%, Explorer 7, Android 2\" -o prefixed.css"</span> &gt;&gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On v√©rifie qu‚Äôon a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>
</code></pre>
<p>Voil√† votre Makefile doit √™tre bien rempli. Pour tester la commande <code>css</code>:</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>make css
</code></pre>
<p>Vous remarquerez que la commande <em>autoprefixer</em> s‚Äôaffiche, si √ßa vous emb√™te, rajoutez
<code>@</code> devant. Vous pouvez modifier votre Makefile dans ce sens:</p>
<pre><code><span class="hljs-label">css:</span>
    echo <span class="hljs-string">"‚ùØ Autoprefixage magique."</span>
    @autoprefixer index<span class="hljs-preprocessor">.css</span> -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span>
</code></pre><p><em>Attention : Les Makefiles utilisent des tabulations uniquement ! Sans quoi cela
ne va pas marcher comme pr√©vu.</em></p>
<p>Vous avez donc maintenant un exemple assez simpliste qui peut √™tre utilis√© si
vous n‚Äôavez pas encore <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">automatis√© votre workflow</a>
via des outils comme <a href="http://gulpjs.com/">Gulp</a> ou <a href="http://gruntjs.com/">Grunt</a>.</p>
<p>Passons justement √† ces solutions plus s√©rieuses.</p>
<h3 id="autoprefixer-avec-gulp">Autoprefixer avec Gulp</h3>
<p>Je ne vais pas trop rentrer dans les d√©tails de Gulp (ce n‚Äôest pas le sujet ici).
Voici cependant une exemple assez bref et compr√©hensible pour commencer, avec
une seule √©criture sur le syst√®me de fichier (contrairement √† la solution Grunt).</p>
<pre><code class="lang-js"><span class="hljs-comment">// gulp stuff</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)
  <span class="hljs-comment">// le plombier ajuste les fuites des tuyaux (erreur de pipe)</span>
  <span class="hljs-comment">// ceci est conseill√© pour √©viter que chaque erreur "casse" tout le process</span>
  <span class="hljs-comment">// d√®s qu‚Äôune erreur est remont√© par un plugin</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

<span class="hljs-comment">// css stuff</span>
<span class="hljs-keyword">var</span> sass = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-ruby-sass"</span>)
  , autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-autoprefixer"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

<span class="hljs-comment">// css task: sass, autoprefixer et csso si --production</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.src(<span class="hljs-string">"./src/css/*.scss"</span>)
    <span class="hljs-comment">// it‚Äôs me, Mario</span>
    .pipe(plumber())

    .pipe(sass({style: <span class="hljs-string">"expanded"</span>}))

    <span class="hljs-comment">// Autoprefixer \\</span>
    <span class="hljs-comment">// vous remarquerez que ici chaque option est un param√®tre</span>
    <span class="hljs-comment">// pas comme pour l‚Äôappel en ligne de commande.</span>
    .pipe(autoprefixer(<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>))

    <span class="hljs-comment">// optimisation CSS pour la prod uniquement</span>
    .pipe(gulp.env.production ? csso() : gutil.noop())

    <span class="hljs-comment">// unique √©criture sur disque</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
    <span class="hljs-comment">// je passe sur cette partie √† configurer, mais ici on peut imaginer un</span>
    <span class="hljs-comment">// livereload en plus, il faudra d√©finir livereload et livereloadServer</span>
    <span class="hljs-comment">// cette partie d√©pend un peu de votre serveur durant le d√©v.</span>
    <span class="hljs-comment">// ca fera l‚Äôobjet d‚Äôun post tiens...</span>
    <span class="hljs-comment">//.pipe(livereload(livereloadServer))</span>
})

gulp.task(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    gulp.run(<span class="hljs-string">"styles"</span>)
  })
})

<span class="hljs-comment">// T√¢ches disponibles :</span>

<span class="hljs-comment">// - pour g√©n√©rer les feuilles de styles</span>
<span class="hljs-comment">//   (pour optimiser pour la prod, utiliser l‚Äôoption)</span>
<span class="hljs-comment">// $ gulp styles [--production]</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la t√¢che `styles` d√®s que n√©cessaire</span>
<span class="hljs-comment">// $ gulp dev</span>
</code></pre>
<h3 id="autoprefixer-avec-grunt">Autoprefixer avec Grunt</h3>
<p>Voici un petit Gruntfile avec la m√™me configuration que ci dessus</p>
<pre><code class="lang-js">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>
<span class="hljs-pi">  "use strict"</span>;

  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-sass"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-autoprefixer"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-csso"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-watch"</span>)

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">"expanded"</span>
        }
      , files: [{
          expand: <span class="hljs-literal">true</span>
        , flatten: <span class="hljs-literal">true</span>
        , cwd: <span class="hljs-string">"./src/css"</span>
        , src: [<span class="hljs-string">"*.scss"</span>]
        , dest: <span class="hljs-string">"./dist/css"</span>
        , ext: <span class="hljs-string">".css"</span>
        }]
      }
    }
  , autoprefixer: {
      options: {
        browsers: [<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>]
      }
    , dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }
  , csso: {
      dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css/"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }

  , watch: {
      styles: {
        files: [<span class="hljs-string">"./src/css/**/*.scss"</span>]
      , tasks: [<span class="hljs-string">"styles"</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">"styles"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>])
  grunt.registerTask(<span class="hljs-string">"styles:production"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>, <span class="hljs-string">"csso"</span>])
  grunt.registerTask(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"watch"</span>])
}

<span class="hljs-comment">// T√¢ches disponibles :</span>

<span class="hljs-comment">// - pour g√©n√©rer les feuilles de styles</span>
<span class="hljs-comment">// $ grunt styles</span>

<span class="hljs-comment">// - pareil, mais optimiser pour la prod</span>
<span class="hljs-comment">// $ grunt styles:production</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la t√¢che `styles` d√®s que n√©cessaire</span>
<span class="hljs-comment">// $ grunt watch</span>
</code></pre>
<p>Comme vous pouvez le voir, la version Grunt est un peu plus volumineuse (bien qu‚Äôespac√©e).
Personnellement j‚Äôaime la concision de gulp.
De plus la version Grunt sera plus longue car nous aurons 3 lectures / √©critures sur le disque.</p>
<p><em>Notez que bien entendu dans notre exemple pr√©c√©dent, nous pouvons remplacer Sass
par un autre pr√© / post-processeur.</em></p>
<h3 id="autoprefixer-avec-stylus">Autoprefixer avec Stylus</h3>
<p>Dans les exemples pr√©c√©dents, j‚Äôai montr√© une solution classique avec Sass.
Mais voici compl√®tement autre chose: <em>autoprefixer</em> peut s‚Äôutiliser en &quot;plugin&quot; Stylus.</p>
<p>C‚Äôest assez simple il suffit d‚Äôutiliser l‚Äôoption <code>use</code> (<code>-u</code> en cli).
Voil√† ce qu‚Äôon aurait en cli :</p>
<pre><code class="lang-shell">$ npm install <span class="hljs-attribute">-g</span> stylus autoprefixer<span class="hljs-attribute">-stylus</span>
$ stylus <span class="hljs-attribute">-u</span> autoprefixer<span class="hljs-attribute">-stylus</span> <span class="hljs-attribute">-o</span> index<span class="hljs-built_in">.</span>css index<span class="hljs-built_in">.</span>styl
</code></pre>
<h4 id="avec-grunt">Avec Grunt</h4>
<p>Il suffira d‚Äôutiliser donc l‚Äôoption <code>use</code> dans votre configuration.</p>
<h4 id="-avec-gulp-"><del>Avec Gulp</del></h4>
<p>La fa√ßon de faire de gulp, via des streams pour √©viter la lecture / √©criture multiple fait que le plugin
<em>autoprefixer-stylus</em> est vide de sens.
Vous pouvez donc utiliser <em>autoprefixer</em> normalement, apr√®s l‚Äôappel du pr√©-processeur.</p>
<hr>
<p>Voil√† j‚Äôesp√®re que cette fois-ci vous √™tes rassasi√©(e) afin de ne plus avoir envie de manger des pr√©fixes CSS !</p>

]]></description><pubDate>Tue, 04 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</guid></item><item><title>Git, boutez les bugs, domptez votre historique!</title><description><![CDATA[[
<p>Vous viendez de lire l&#39;<a href="/posts/git/versionner-avec-git/">article de madx</a> sur le gestionnaire
de version Git et vous vous dites que vous aimeriez en d√©couvrir plus! Vous l&#39;utilisez d√©j√† mais √™tes
en qu√™te de quelques nouvelles (ou pas) astuces √† vous mettre sous la dent! Bienvenue!</p>
<p>Si vous d√©sirez vous servir de cet article comme d&#39;un tutoriel il est recommand√© d&#39;avoir quelques
bases concernant l&#39;utilisation et le fonctionnement de Git (commits/branches/etc‚Ä¶).</p>
<p>Allez, je ne vous fais pas plus attendre, voici ma liste des fonctionnalit√©s Git dont je ne
saurais plus me passer:</p>
<h2 id="git-lg-l-alias-qui-vous-parle-d-histoire">git lg, l&#39;alias qui vous parle d&#39;Histoire</h2>
<p>√Ä l&#39;aide, √† l&#39;aide je ne comprends plus rien √† l&#39;historique de mon d√©p√¥t Git!
J&#39;ai cr√©√© un monstre‚Ä¶ Pas de panique! J&#39;ai pour vous l&#39;alias qu&#39;il vous faut,
honteusement pomp√© de <a href="https://coderwall.com/p/euwpig">ce site</a>, mais
comme j&#39;ai pas d&#39;honneur‚Ä¶ Pour le mettre en place il suffit d&#39;entrer la commande
suivante dans votre terminal pr√©f√©r√©:</p>
<pre><code class="lang-bash">$ git config --global alias.lg <span class="hljs-string">"log --color --graph --pretty=format:'<span class="hljs-variable">%Cred</span><span class="hljs-variable">%h</span><span class="hljs-variable">%Creset</span> -<span class="hljs-variable">%C</span>(yellow)<span class="hljs-variable">%d</span><span class="hljs-variable">%Creset</span> <span class="hljs-variable">%s</span> <span class="hljs-variable">%Cgreen</span>(<span class="hljs-variable">%cr</span>) <span class="hljs-variable">%C</span>(bold blue)&lt;<span class="hljs-variable">%an</span>&gt;<span class="hljs-variable">%Creset</span>' --abbrev-commit"</span>
</code></pre>
<p>Au cas o√π vous ne seriez pas √† l&#39;aise avec ce genre de choses, sachez simplement que la commande
<code>git config --global alias.lg</code> permet d&#39;inscrire √† votre configuration g√©n√©rale un nouvel alias (
ici lg). Le reste est ce que doit faire cet alias, √† savoir afficher un historique reformat√© de votre
d√©p√¥t Git.</p>
<p>Allez, je vous met au d√©fi d&#39;oser taper un coup de <code>git lg</code> dans votre terminal
maintenant (dans un d√©p√¥t Git bien entendu banane). Pour l&#39;exemple, je l&#39;ai r√©alis√© dans le d√©p√¥t
de Putain De Code:</p>
<figure>
  <img src="../../../images/posts/git/boutez-les-bugs-domptez-votre-historique/omagad-history.png" alt="capture historique">
  <figcaption>Le pouvoir de l&#39;arc en ciel</figcaption>
</figure>

<p>Eh oui, sous vos yeux √©bahis se dessine maintenant l&#39;historique de votre d√©p√¥t!
Tout y est: cr√©ations de branches, commits, merges, les miaouOnes‚Ä¶ Voil√†, vous ne pourrez plus
dire que vous n&#39;y comprenez rien, vous seriez un fieff√© menteur.</p>
<h2 id="git-bisect-trouver-et-punir">git bisect, trouver et punir</h2>
<p>S&#39;il y a bien quelque chose d&#39;aga√ßant dans l&#39;activit√© de d√©veloppement, c&#39;est que bien
souvent on est amen√© √† travailler en √©quipe, et √©videmment, il y en a toujours
un pour introduire des Putain De Bugs. Alors c&#39;est parti on sort le d√©bugger pour
l&#39;autre ingrat, on place les <code>console.log</code> et autres <code>var_dump()</code> pour trouver d&#39;o√π
peut bien venir ce fichu probl√®me, et on se coule un caf√© parce qu&#39;entre nous, √ßa peut
prendre du temps.</p>
<p>Heureusement pour nous, l√† aussi Git est au rendez-vous avec sa fonctionnalit√© de <em>bisecting</em>. Je vous vois d√©j√† en
train de baver devant votre √©cran, mais non, Git ne va pas corriger vos bugs bien √©videmment, il va vous aider
√† trouver le changement dans le code qui l&#39;a fait appara√Ætre et ceci gr√¢ce √† la commande <code>git bisect</code>.</p>
<p>Pour lancer une <em>bisection</em> par Git il suffit d&#39;entrer <code>git bisect start</code> dans votre terminal pr√©f√©r√©
et le tour est jou√©!</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git bisect start
$
</code></pre>
<figure>
    <figcaption> Capitaine, regardez il n&#39;y a rien </figcaption>
</figure>

<p>Oui bon d&#39;accord, il va falloir s&#39;investir un peu plus pour parvenir √† nos fins. Pour l&#39;instant Git est
pass√© en mode <em>bisection</em>, maintenant il a besoin d&#39;informations pour s&#39;ex√©cuter:</p>
<ul>
<li>Un commit o√π le bug est pr√©sent</li>
<li>Un commit o√π le bug est absent</li>
</ul>
<p>Imaginons que le commit sur lequel nous sommes comporte le bug, nous allons donc le signaler √† Git avec
<code>git bisect bad</code>. Nous allons ensuite nous d√©placer sur un commit plus ancien qui ne comporte pas le bug et
le signaler √† son tour: <code>git bisect good</code>.</p>
<p>Git va alors se mettre en route et vous d√©placer automatiquement de commit en commit. Pour chacun d&#39;eux vous n&#39;aurez
qu&#39;√† le d√©clarer bon ou mauvais comme expliqu√© au dessus, jusqu&#39;√† ce que Git vous fournisse le premier commit
comportant le bug, celui dont le changement a r√©v√©l√© le disfonctionnement.</p>
<pre><code class="lang-bash">$ git bisect bad
1082351d9157e98aed1bbee8b9ad6deedca1288f is the first bad <span class="hljs-operator"><span class="hljs-keyword">commit</span>
<span class="hljs-keyword">commit</span> <span class="hljs-number">1082351</span>d9157e98aed1bbee8b9ad6deedca1288f
Author: Maxime Thirouin &lt;m@***.io&gt;
<span class="hljs-keyword">Date</span>:   Fri Jan <span class="hljs-number">17</span> <span class="hljs-number">08</span>:<span class="hljs-number">19</span>:<span class="hljs-number">46</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    ¬Ø\_(„ÉÑ)_/¬Ø Fix shit bring <span class="hljs-keyword">in</span> <span class="hljs-number">34</span>a44c98048f2b74fc2dd20f0be807c1e23e8b58

:<span class="hljs-number">040000</span> <span class="hljs-number">040000</span> <span class="hljs-number">7</span>a5d5010f0aaa052ffdc0747b182dc6178a346db d3562872efd1b9d662a89825a3070d64f860cc34 M  src</span>
</code></pre>
<figure>
    <figcaption>1, 2, 3, Soleil!</figcaption>
</figure>

<p>Et voil√†, le tour est jou√©, en plus Git vous a positionn√© sur ce commit, il ne manque plus qu&#39;un petit coup de
<code>git show</code> et vous savez tout. Pour revenir √† votre travail, un simple <code>git bisect reset</code> fera l&#39;affaire!
Il ne vous reste plus qu&#39;√† punir la personne fautive, mais pour √ßa je vous laisse avec votre imagination,
je suis s√ªr que vous trouverez.</p>
<p>Pour les fanatiques de l&#39;efficacit√© et de l&#39;automatisation, sachez que Git en a encore dans le ventre. Si vous
connaissez d√©j√† un bon et un mauvais commit, vous pouvez tout simplement lancer la <em>bissection</em> √† grand coup de
<code>git bisect start MAUVAIS_COMMIT BON_COMMIT</code> et si, cerise sur le g√¢teau, vous √™tes en possession d&#39;une suite de tests
unitaires (oui non je sais faut pas d√©conner), <code>git bisect run &lt;votre_script&gt;</code> vous permettra de la lancer et la
recherche du premier commit d√©fectueux se fera alors toute seule!</p>
<h2 id="git-rebase-du-pur-story-telling">git rebase, du pur story-telling</h2>
<p>Je ne sais pas s&#39;il vous est d√©j√† arriv√© de naviguer dans les d√©p√¥ts Git de projets libres, mais souvent on y trouve que tr√®s
peu de commits poubelles, ces commits avec comme message &quot;step&quot; ou autre &quot;stuff&quot;. Chaque commit correspond √† une fonctionnalit√©,
un bug fix, une unit√© logique coh√©rente. Je ne sais pas pour vous, mais personnellement un <em>git log</em> ne ressemble pas √†
√ßa chez moi!</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><figure>
    <figcaption>best git log, ever</figcaption>
</figure>

<p>Bien que l&#39;on essaye de nous faire croire que les logiciels libres sont cod√©s par des rockstars, ce qui permet de justifier le
mythe du <em>1 commit = 1 fonctionnalit√©</em>, vous n&#39;√™tes pas dupes; l&#39;historique Git de ces d√©p√¥ts est bel et bien retravaill√©, et ceci dans
le but de maintenir sa coh√©rence et de permettre √† tous les contributeurs de le comprendre. Si cela s&#39;applique particuli√®rement
dans le cadre des logiciels libres, il n&#39;en est pas moins satisfaisant d&#39;avoir √©galement un historique clair sur ses propres d√©p√¥ts.</p>
<p>Pour cela, l&#39;arme de choix s&#39;appelle <code>git rebase</code>. Cette fonctionnalit√© permet de r√©√©crire l&#39;historique de vos d√©p√¥ts, de
r√©organiser les commits, d&#39;en supprimer, de changer leur message associ√© etc‚Ä¶ La fonctionnalit√© est assez simple √† utiliser, nous allons
prendre exemple sur l&#39;historique pr√©sent√© ci-dessus: je voudrais supprimer le commit dont le message est &#39;stuff&#39; parce que finalement il
s&#39;av√®re inutile. Je veux √©galement fusionner le commit &#39;misc&#39; avec le commit &#39;Now my new functionality finally works&#39; et renommer ce dernier
pour qu&#39;il soit plus explicite et fasse r√©f√©rence √† ma User Story correspondante dans mon outil de tracking pr√©f√©r√©.</p>
<p>Pour commencer, il faut dire jusqu&#39;√† quel commit on souhaite effectuer cette r√©√©criture; pour cela, dans mon cas, deux solutions:</p>
<ul>
<li>Faire r√©f√©rence √† partir de HEAD (l&#39;√©tiquette courante), ici: HEAD~3 (je veux r√©√©crire jusqu&#39;au commit avant &#39;stuff&#39;)</li>
<li>Fournir le SHA1 du commit avant &#39;stuff&#39; (ici 2645b1cdbdd72bea6c392c011320556997327761)</li>
</ul>
<p>Je vais utiliser la premi√®re m√©thode (le choix n&#39;influe en rien sur la suite), et donc lancer la r√©√©criture en invoquant la commande: <code>git rebase -i HEAD~3</code>
( -i voulant dire de lancer un <em>rebase</em> en mode int√©ractif). Voici ce qui m&#39;est alors pr√©sent√©:</p>
<pre><code>pick <span class="hljs-number">9</span>db49a3 stuff
pick <span class="hljs-number">551</span>b243 misc
pick e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><p>Git m&#39;affiche tous les commits concern√©s par l&#39;op√©ration (en ordre inverse), devant chacun d&#39;eux, la mention <em>pick</em>, et une l√©gende en bas.
<em>pick</em>, comme l&#39;indique la l√©gende, signifie que ce commit sera conserv√©, mais je peux remplacer cette mention par les suivantes:</p>
<ul>
<li>reword : modifier le message de commit.</li>
<li>edit : utiliser le commit mais me laisser le modifier avec un <code>git commit --amend</code> qui permet de commiter l&#39;√©tat courant de la copie de travail en
l&#39;incorporant au commit pr√©c√©dent.</li>
<li>squash : utiliser le commit en le fusionnant avec le commit pr√©c√©dent.</li>
<li>fixup : utiliser le commit en le fusionnant avec le commit pr√©c√©dent et ne pas utiliser son message associ√©.</li>
<li>exec : ex√©cuter une commande sur ce commit.</li>
</ul>
<p>En plus de ces diff√©rentes mentions, je peux √©galement effectuer deux autres actions:</p>
<ul>
<li>d√©placer un commit, ce qui aura pour effet final de le d√©placer dans l&#39;historique.</li>
<li>supprimer un commit, ce qui aura comme r√©sultat de le faire dispara√Ætre de l&#39;historique.</li>
</ul>
<p>Pour ma part, je vais:</p>
<ul>
<li>supprimer la premi√®re ligne parce que j&#39;ai d√©cid√© que le commit &#39;stuff&#39; ne me servait √† rien.</li>
<li>mettre la mention reword devant le commit &#39;misc&#39;, car je vais fusionner le dernier commit avec celui-ci et mettre un nouveau message.</li>
<li>mettre la mention fixup devant le commit &#39;Now my new functionality finally works&#39; car je vais le fusionner au pr√©c√©dent et abandonner son message.</li>
</ul>
<p>Ce qui nous donne le r√©sultat suivant:</p>
<pre><code>reword <span class="hljs-number">551</span>b243 misc
fixup e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><figure>
    <figcaption>Attention ch√©rie, √ßa va trancher</figcaption>
</figure>

<p>Il n&#39;y a plus qu&#39;√† sauvegarder et quitter (:x dans vim) pour que la machine se mette en route. Si certaines actions que vous avez effectu√©es, notamment
le d√©placement de commits, provoquent des conflits, Git va vous demander de les r√©soudre au fur et √† mesure; il suffit pour cela d&#39;√©diter vos fichiers, puis
de les marquer comme r√©solus au moyen de la commande <code>git add &lt;lefichier&gt;</code> avant de reprendre avec la commande <code>git rebase --continue</code>. Comme convenu,
Git vous demande d&#39;√©diter le message du commit marqu√© en <em>reword</em>:</p>
<pre><code>Story #<span class="hljs-number">34</span> - Poker cards now have a real back picture

<span class="hljs-preprocessor"># Please enter the commit message for your changes. Lines starting</span>
<span class="hljs-preprocessor"># with '#' will be ignored, and an empty message aborts the commit.</span>
<span class="hljs-preprocessor"># HEAD detached at ca4ff95</span>
<span class="hljs-preprocessor"># You are currently rebasing branch 'master' on 'ca4ff95'.</span>
<span class="hljs-preprocessor">#   (all conflicts fixed: run "git rebase --continue")</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Changes to be committed:</span>
<span class="hljs-preprocessor">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># modified:   README.txt</span>
<span class="hljs-preprocessor">#</span>
</code></pre><figure>
    <figcaption>Un commit qu&#39;il est mieux pour le relire</figcaption>
</figure>

<p>L&#39;op√©ration va continuer puis Git va vous rendre la main. Il vous suffit alors de faire un <code>git log</code> pour appr√©cier le r√©sultat:</p>
<pre><code>commit <span class="hljs-number">481</span>b4dccf4fedf4ed9d7f4e83ae5c19a07f7e12e
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Story <span class="hljs-preprocessor">#34 - Poker cards now have a real back picture</span>
</code></pre><figure>
    <figcaption>Et c&#39;est le succ√®√®√®√®√®√®√®s</figcaption>
</figure>

<p>Vous n&#39;avez plus qu&#39;un seul commit tout beau tout propre! Vous pouvez maintenant le pousser sur votre d√©p√¥t et vous vanter d&#39;avoir un bel historique, parce
que vous aussi, vous √™tes une rockstar :).</p>
<p>Pour ceux qui d√©sirent aller encore plus loin dans l&#39;automatisation de ce processus de rebase, je vous conseille d&#39;aller jeter un ≈ìil √† l&#39;utilisation
de l&#39;option <a href="http://madx.me/articles/git_rebase_autosquash.html">--autosquash</a>.</p>
<h2 id="git-reflog-la-commande-de-celui-qui-a-fait-n-importe-quoi">git reflog, la commande de celui qui a fait n&#39;importe quoi</h2>
<p>Voici venu le temps <del>des rires et des chants</del> de la deni√®re commande que je souhaitais vous pr√©senter, j&#39;ai nomm√© <code>git reflog</code>. Cette commande
c&#39;est votre <em>joker</em>, elle assure votre survie, notamment si vous avez √©t√© assez zinzins pour suivre les exemples donn√©s dans cet article, parce
que honn√™tement‚Ä¶</p>
<figure>
    <img src="http://i1.kym-cdn.com/photos/images/newsfeed/000/305/224/3e1.jpg" alt="I have no idea what I&#39;m doing">
</figure>

<p>Vous ne le savez peut √™tre pas, mais Git, dans sa grande bont√©, garde une r√©f√©rence de toutes vos actions, de tous les endroits o√π vous vous √™tes d√©placez.
Ce registre, c&#39;est le <em>references log</em>, et en plus on peut y acc√©der simplement gr√¢ce √† la commande <code>git reflog</code> (sans d√©conner). Faisons un petit tour
dans le miens:</p>
<pre><code><span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">0</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
<span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">1</span>}: rebase -i (fixup): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
<span class="hljs-number">8</span>fd5835 HEAD@{<span class="hljs-number">2</span>}: rebase -i (<span class="hljs-keyword">continue</span>): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
ca4ff95 HEAD@{<span class="hljs-number">3</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> ca4ff952310d6246216e83f49309b32b2d2fa010
e739e7c HEAD@{<span class="hljs-number">4</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">5</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">6</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">7</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">8</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">9</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">10</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">11</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">12</span>}: commit: Now <span class="hljs-keyword">my</span> new functionality finally works
<span class="hljs-number">551</span>b243 HEAD@{<span class="hljs-number">13</span>}: commit: misc
<span class="hljs-number">9</span>db49a3 HEAD@{<span class="hljs-number">14</span>}: commit (amend): stuff
af7fc36 HEAD@{<span class="hljs-number">15</span>}: commit: misc
ca4ff95 HEAD@{<span class="hljs-number">16</span>}: commit (initial): <span class="hljs-keyword">first</span> commit
</code></pre><figure>
    <figcaption>Il est beau mon reflog, il est frais</figcaption>
</figure>

<p>On voit ici l&#39;ensemble de mes op√©rations appara√Ætre comme le <em>rebase</em> effectu√© pr√©c√©demment (bon d&#39;accord il appara√Æt plusieurs fois parce que j&#39;ai
fait quelques tests avant d&#39;√©crire cette partie de l&#39;article). Chaque op√©ration poss√®de un SHA1 qui est en fait une r√©f√©rence vers le commit concern√©, dans l&#39;√©tat
dans lequel il √©tait au moment de l&#39;op√©ration. Bien, imaginons que j&#39;ai fait n&#39;importe quoi avec le rebase et que je veuille retrouver mon √©tat pr√©c√©dent, et bien
il me suffira ici de faire un <code>git checkout e739e7c</code> (dans votre cas la ligne sera probablement plus simple √† trouver). Et l√† si je refais un <code>git log</code>, miracle:</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><p>Vous voil√† retomb√©s sur vos pieds! Vous n&#39;avez plus qu&#39;√† reconnecter votre branche √† ce commit si jamais vous en aviez une et vous √™tes reparti pour de nouvelles
aventures.</p>
<p>Sachez tout de m√™me que ce <em>references log</em> peut √™tre effac√©, et il est m√™me conseill√© de le faire r√©guli√®rement pour des probl√©matiques de performance de Git sur
votre d√©p√¥t; conserver tous ces commits peut devenir co√ªteux √† la longue. La commande <code>git gc</code> pour <em>garbage collector</em> s&#39;occupera de faire le m√©nage
pour vous.</p>
<p>Voil√†, on arrive au bout de notre aventure, j&#39;esp√®re que vous avez appris quelque chose et que Git vous fait maintenant moins peur.</p>
<p>Amike,</p>

]]></description><pubDate>Thu, 27 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</link><guid isPermaLink="true">http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</guid></item><item><title>Twitter comme lecteur de flux</title><description><![CDATA[[
<p><em>(Note : dans cet article, j&#39;ai volontairement pris comme exemple la version Web afin que tout le monde puisse profiter de l&#39;exp√©rience mais il est √©vident que vous puissiez le faire avec votre application twitter favorite).</em></p>
<p>Bien avant la fin de Google Reader, je me posais d√©j√† la question de l&#39;int√©r√™t d&#39;un lecteur de flux {rss|atom}. En effet, il m&#39;√©tait p√©nible d&#39;organiser les flux que je souhaitais lire : les ranger par cat√©gorie, supprimer les sites morts ou ceux qui ne m&#39;int√©ressaient plus; de plus, je n&#39;ai jamais r√©ellement utilis√© les fonctionnalit√©s d&#39;un lecteur de flux comme le syst√®me de marquage, savoir si le flux a √©t√© lu ou non, lire l&#39;article dans le lecteur (je le lis toujours sur le site, jamais dans l&#39;application). Et puis c&#39;est parfois p√©nible de trouver un lecteur de flux simple, multi-OS et gratuit.</p>
<p>J&#39;ai √©t√© un grand fan √† l&#39;√©poque de Netvibes puis je l&#39;ai d√©laiss√© pour Google Reader et nous voil√† quelques temps apr√®s, sans r√©elle solution √† mon sens pour lire agr√©ablement des flux tel que je le concois.</p>
<p>J&#39;exp√©rimente pourtant une solution depuis quelques mois qui me sied bien. J&#39;utilise en effet Twitter en tant que lecteur de flux. Oui, car cela a plusieurs avantages :</p>
<ul>
<li><p>Il existe une application pour <a href="https://play.google.com/store/apps/details?id=com.twitter.android&amp;hl=fr">Android</a>, <a href="https://about.twitter.com/products/iphone">iOS</a> ainsi que <a href="https://itunes.apple.com/fr/app/twitter/id409789998?mt=12">Mac</a>; mais aussi la <a href="https://twitter.com/">version Web</a> et <a href="https://tweetdeck.twitter.com/">Tweetdeck</a> est disponible sur tous les environnements.</p>
</li>
<li><p>Je fais ma veille majoritairement via Twitter; j&#39;√©cr√®me au fil de la journ√©e ce qui m&#39;int√©resse ou non. Si c&#39;est rapide √† lire alors je le lis, sinon je <em>bookmark</em> l&#39;article en &quot;Read later&quot; sur mon navigateur. Cela permet de trier rapidement l&#39;information et de lire plus paisiblement cela au moment opportun.
De plus, √©tant donn√© que l&#39;information est donn√©e par mes <em>following</em> et que je suis les personnes qui m&#39;int√©ressent vraiment, l&#39;information est alors souvent pertinente. Encore faut-il avoir la bonne TL.
Et  si j&#39;ai besoin d&#39;aller chercher une information pr√©cise, j&#39;irai la trouver √† travers un moteur de recherche... donc aucune probl√©matique de &quot;neutralit√©&quot; de l&#39;information.</p>
</li>
<li><p>De plus, √©tant donn√© que je fais justement cette veille via Twitter, cela me permet d&#39;avoir qu&#39;un seul outil. Cela m&#39;ennuie au plus haut point de collectionner les outils. Je suis certes partisant d&#39;utiliser le bon outil pour chaque t√¢che plut√¥t qu&#39;un couteau-suisse, mais finalement Twitter et un lecteur de flux ne sont pas si √©loign√©s.</p>
</li>
<li><p>Enfin, la majorit√© des blogs / sites que j&#39;appr√©cie ont leur propre compte twitter qui postent l&#39;url de leurs articles, il suffit alors de les suivre. Et si ce n&#39;est pas le cas, je vous montrerai une petite astuce pour que √ßa le soit.</p>
</li>
</ul>
<p>Vous vous sentez chaud(e) pour commencer ? Tr√®s bien, c&#39;est parti !</p>
<h2 id="cr-er-une-liste-twitter">Cr√©er une liste Twitter</h2>
<p>Pour cr√©er une liste, aucun probl√®me, vous allez dans &quot;Me&quot; dans le <em>header</em> puis &quot;List&quot; dans la colonne de gauche pour vous retrouver ici :</p>
<p><img src="../../../images/posts/twitter/twitter-list.jpg" alt=""></p>
<p>Puis vous cliquez sur <code>Create list</code> et vous rentrez les informations que vous souhaitez :</p>
<p><img src="../../../images/posts/twitter/create-list.png" alt=""></p>
<p>Nous voil√† avec notre belle liste. Il n&#39;y a plus qu&#39;√† la remplir de jolis <em>following</em>.</p>
<p>Prenons par exemple <code>@nodenpm</code>, un beau <em>bot</em> tweetant les nouveaux packages node.js ou/et les updates de ces packages.</p>
<p><img src="../../../images/posts/twitter/nodenpm.jpg" alt=""></p>
<p>Ajoutons-le √† notre liste.</p>
<p><img src="../../../images/posts/twitter/add-in-list.png" alt=""></p>
<p>Nous voil√† maintenant avec notre liste comprenant un <em>following</em>. Ce qui en ayant ajout√© quelques comptes donnera quelque chose comme ceci :</p>
<p><img src="../../../images/posts/twitter/twitter-list-read.jpg" alt=""></p>
<p>Vous pouvez maintenant appr√©cier votre lecteur de flux.</p>
<p>Oh mais ! C&#39;est l√† que vous constatez qu&#39;un de vos sites pr√©f√©r√©s n&#39;a pas de compte Twitter ! Que faire ? Haha, et si on utilisait la puissance de IFTTT pour se cr√©er un bot twitter qui tweet chaque nouvel article d&#39;un des sites que vous appr√©ciez ?! Mais ouais !</p>
<h2 id="ifttt-la-solution-pour-parfaire-notre-lecteur">IFTTT, la solution pour parfaire notre lecteur</h2>
<p>Mais avant tout, cr√©ons notre compte twitter &quot;bot&quot; qui va tweeter ce qu&#39;on souhaite.</p>
<h3 id="compte-twitter-bot-">Compte twitter &quot;bot&quot;</h3>
<ul>
<li>D√©connectez-vous</li>
<li>Inscrivez-vous √† nouveau sur Twitter (le mien s&#39;appelle <a href="https://twitter.com/kud_feeds">@kud_feeds</a> par exemple)</li>
<li>Mettez-lui une belle bio, un bel avatar</li>
<li>D√©connectez-vous √† nouveau</li>
<li>Connectez-vous avec votre vrai compte</li>
<li>Ajoutez votre &quot;bot&quot; √† la liste que vous venez de cr√©er pr√©c√©demment</li>
</ul>
<p>... et voil√† !</p>
<h3 id="ifttt">IFTTT</h3>
<p><img src="../../../images/posts/ifttt.png" alt=""></p>
<p>Maintenant, IFTTT.</p>
<blockquote>
<p>IFTTT (&quot;If This Then That&quot;) est un service qui permet aux utilisateurs de connecter diff√©rentes applications ensemble √† travers de simples conditions nomm√©es &quot;recettes&quot;.</p>
</blockquote>
<p>IFTTT va vous permettre d&#39;aller pomper les flux {rss|atom} de vos sites pr√©f√©r√©s puis ayant acc√®s √† votre <em>bot</em> va permettre de tweeter le contenu des flux ! C&#39;est pas beau √ßa hein ?! =)</p>
<ul>
<li>Allez sur <a href="https://ifttt.com">ifttt.com</a></li>
<li>Cr√©ez-vous un compte (je vous conseille de cr√©er un compte sp√©cialement pour le <em>bot</em> car IFTTT ne propose de relier qu&#39;un seul compte twitter. Du coup, si comme moi vous appr√©ciez IFTTT et que vous souhaitez autant utiliser IFTTT pour votre compte twitter principal que votre compte <em>bot</em>, je vous conseille de vous cr√©er deux comptes IFTTT)</li>
<li>Cr√©ez une nouvelle recette en cliquant sur <code>Create</code></li>
<li>Cliquez sur <code>this</code></li>
<li>Puis <code>feed</code></li>
<li>Choissisez le <em>trigger</em> (&quot;d√©clencheur&quot;) que vous souhaitez, moi je prends plut√¥t le premier <code>New feed item</code> (le plus simple)</li>
<li>Indiquez l&#39;url du flux de votre site, par exemple <code>http://dribbble.com/_kud/shots/following.rss</code></li>
<li>Puis <code>then</code></li>
<li>Twitter</li>
<li><code>Post a tweet</code></li>
<li>Laissez tel quel le <em>template</em> de base pour le moment (vous pourrez le changer quand vous serez √† l&#39;aise avec IFTTT)</li>
<li>Mettez la description qui va bien</li>
</ul>
<p>Et on est bon.</p>
<p>Vous avez maintenant une nouvelle recette qui d√®s qu&#39;un article sortira, un tweet de votre <em>bot</em> apparaitra. Vous pouvez d&#39;ailleurs v√©rifier que tout marche bien en cliquant sur la fl√®che <em>Check Recipe Now</em>.</p>
<p>Vous n&#39;aurez plus qu&#39;√† cr√©er une nouvelle recette en dupliquant cette recette √† chaque fois que vous voudrez suivre un nouveau flux. Certes √©ventuellement plus contraignant qu&#39;un vrai lecteur de flux mais vous y gagnerez largement par la suite ;)</p>
<p>Et voil√†, nous avons maintenant une belle liste Twitter qui repr√©sentre votre lecteur de flux. Voici la mienne : <a href="https://twitter.com/_kud/lists/feeds">https://twitter.com/_kud/lists/feeds</a></p>
<p>Vous pouvez m√™me pousser le vice en cr√©ant plusieurs listes par cat√©gorie mais √ßa sous-entend aussi de cr√©er des <em>bots</em> et donc des comptes IFTTT par cat√©gorie. Heureusement que j&#39;en ai qu&#39;une. ;)</p>
<p>Enjoy!</p>

]]></description><pubDate>Wed, 26 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</link><guid isPermaLink="true">http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</guid></item><item><title>Comment en finir avec les pr√©fixes CSS</title><description><![CDATA[[
<p>En mettant de c√¥t√© le d√©bat trollesque <em>faut-il ou pas des pr√©fixes CSS ?</em>
(car avouons-le, ils sont l√†, il faut faire avec), on ne va pas se le cacher,
les pr√©fixes CSS √ßa nous brise tous les... touches du clavier.
Eh bien oui, sans automatisation on est oblig√© de se taper des caract√®res en plus.
M√™me avec un IDE correct, on peut faire √ßa rapidement, mais √ßa n√©cessite
presque √† chaque fois une action de notre part.</p>
<h2 id="pr-fixer-via-des-outils-en-ligne">Pr√©fixer via des outils en ligne</h2>
<p>Les √©l√®ves au fond de la classe me montreront de suite des solutions comme
<a href="http://prefixmycss.com/">prefixmycss.com</a> ou l&#39;ancien prefixr.
Inopin√©ment, un moche &quot;Mourrez moi sile vou pler&quot; sort de mon corps.
Non, s√©rieusement, ce n‚Äôest pas une fa√ßon de faire √ßa. Aller sur une web app √†
chaque fois que je veux pr√©fixer mes CSS ? S√©rieusement ?
Vous avez qu‚Äô√† aussi faire un service postal o√π j‚Äôenvoie mes fichiers CSS dans
une cl√© USB et qu‚Äôon me renvoie sous 48h avec les pr√©fixes ajout√©s.
Super pratique.</p>
<h2 id="pr-fixer-via-javascript">Pr√©fixer via JavaScript</h2>
<p>Une autre solution serait <a href="http://leaverou.github.io/prefixfree/">prefix-free</a>,
mais je ne vais m√™me pas en parler tellement l‚Äôid√©e de d√©pendre de JavaScript pour
avoir un <code>border-radius</code> ou une <code>transition</code> CSS me donne une migraine.
Je vous passe les d√©tails niveau performance. Selon les cas, on pourrait m√™me avoir
un petit flash visuel sans les propri√©t√©s pr√©fix√©es.
Non mais fl√ªte. On ne fait pas √ßa. On n‚Äôalourdit pas une page web avec du JavaScript
pour parser la feuille de style et r√©int√©grer des pr√©fixes quoi. Au secours.</p>
<h2 id="pr-fixer-via-les-pr-processeurs-css">Pr√©fixer via les pr√©-processeurs CSS</h2>
<p>Alors l√†, j‚Äôen entends d√©j√† qui parle √† voix haute au milieu de la classe :</p>
<blockquote>
<p>Bah lui c‚Äôest clair il‚Äôconnait pas les pr√©-processeurs CSS le noube</p>
</blockquote>
<p>Sans rentrer dans un d√©bat trollesque (encore un), √† part peut-√™tre avec <em>Stylus</em> et ces
mixins transparent (coucou <em><a href="http://visionmedia.github.io/nib/">Nib</a></em>),
on est oblig√© de rajouter du code.
Avec <em>Sass</em> il faudra (en scss) rajouter <code>@include</code> et un couple de parenth√®se (et
au passage avoir <em>Compass</em> si on ne veut pas coder les mixins √† la main).
Avec <em>Less</em> il faudra aussi une librairie <em>Less Hat</em> si on n‚Äôa pas envie de se taper
du mixin qui donne de la naus√©e comme on peut voir sur la
<a href="http://lesscss.org/">page d‚Äôaccueil</a>.</p>
<h2 id="les-pr-fixes-c-est-comme-le-lait-a-tourne">Les pr√©fixes, c‚Äôest comme le lait, √ßa tourne</h2>
<p>D‚Äôailleurs, parlons en vite fait de cette page d‚Äôaccueil qui au jour o√π j‚Äô√©cris
se post, comporte <b>en premier exemple</b> un mixin pour <code>box-shadow</code>
(hashtag ohlol).</p>
<p>Certaines propri√©t√©s comme <code>box-shadow</code>, ou encore <code>border-radius</code>, sont
aujourd‚Äôhui pr√©fix√©es √† tort, car comme on peut le voir sur le site de
<a href="http://caniuse.com/">CanIUse.com</a>, elles n‚Äôont plus vraiment besoin d‚Äô√™tre pr√©fix√©es, √†
moins que vous supportiez encore Firefox 3.6, Safari iOS 3 ou Android 2...
Je vous renvoie rapidement sur ce (vieil) article de Chris Coyier
<a href="http://css-tricks.com/do-we-need-box-shadow-prefixes/">Do we need box-shadow or border-radius prefixes anymore?</a>
en guise de m√©mo :)</p>
<p>Sans √™tre de mauvaise foi, on va vite avouer qu‚Äôon ne peut pas forc√©ment tout savoir.
Donc on ne peut pas √™tre au top pour conna√Ætre quand il faut ou quand il n‚Äôy a plus
besoin de pr√©fixer x ou y (oui bon x et y ne sont pas des propri√©t√©s CSS, c‚Äôest
pour l‚Äôexemple).
Qui sait qu‚Äôon peut enfin arr√™ter de pr√©fixer box-sizing dans Firefox depuis la 29 ?
Ou la 30 je ne sais plus...</p>
<p>Bon mais alors comment faire ? J‚Äôentends les fayots du premier rang parler d‚Äôauto...
auto... AUTOPREFIXER ?!</p>
<p>MAIS C‚ÄôEST POSSIBLE √áA ?</p>
<p>Bon allons √† l‚Äôessentiel, assez troll√©.</p>
<h1 id="autoprefixer">Autoprefixer</h1>
<p>Ce magnifique outil, bas√© sur une solide base de donn√©es (au hasard, CanIUse.com),
permet de pr√©fixer automatiquement vos CSS, et ce, de mani√®re intelligente.
Vous pouvez en effet configurer autoprefixer, afin de lui pr√©ciser quel
navigateur vous voulez utiliser.
Vous pouvez au choix lui demander de supporter X versions en arri√®re, les versions
qui ont un usage global &gt; √† Y% de trafic, ou encore une version minimale donn√©e.</p>
<p>Voici quelques exemples de configuration.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Je supporte une version en arri√®re et les navigateurs qui ont plus de 1% de trafic ainsi qu'Internet Explorer 7</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 1 version"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;

<span class="hljs-comment">// Je supporte 2 versions en arri√®re, et minimum BlackBerry 10 et Android 4</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 2 version"</span>, <span class="hljs-string">"BlackBerry 10"</span>, <span class="hljs-string">"Android 4"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;
</code></pre>
<p>Dans ces lignes de code JavaScript... Quoi attendez c‚Äôest en JavaScript ? Oh le
fourbe, il nous recale sa techno de front-end de mes deux.
Bon faites pas les relous, que vous soyez front-end ou back-end, vous avez Node.js hein ?</p>
<p>Donc aucune inqui√©tude, il existe une commande pour que vous puissiez faire √ßa rapidement :</p>
<pre><code class="lang-shell"><span class="hljs-preprocessor"># on install autoprefixer via npm en global</span>
npm install --global autoprefixer
<span class="hljs-preprocessor"># ou pour les fain√©ants</span>
npm i -g autoprefixer

<span class="hljs-preprocessor"># on prefixe !</span>
autoprefixer *.css
</code></pre>
<p>L√† bon de suite, r√©flexe, vous me sautez dessus √† la gorge en me criant:</p>
<blockquote>
<p>NON MAIS T‚ÄôAS CRU QUE J‚ÄôALLAIS TAPER LA COMMANDE √Ä CHAQUE FOIS TOCARD ?</p>
</blockquote>
<p>No problem, comme tout outil bien foutu, il y‚Äôa une multitudes de fa√ßon de
l‚Äôutiliser :</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec l‚Äôapplication <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu),</li>
</ul>
<p>Bien entendu, parfois, lorsqu‚Äôon fait un petit bout de CSS standalone,
vous avez aussi √† dispo des plugins pour
<a href="https://github.com/sindresorhus/sublime-autoprefixer">Sublime Text</a>
 ou <a href="https://github.com/mikaeljorhult/brackets-autoprefixer">Brackets</a>
 afin de ne pas forc√©ment avoir √† utiliser les app ou process cit√©s juste avant.</p>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>Int√©gration dans Sublime Text</figcaption>
</figure>

<p>Cet outil est maintenant bas√© sur <a href="https://github.com/ai/postcss">PostCSS</a>,
un post-processeur CSS. Vous pouvez donc l‚Äôutiliser en plugin pour ce post-proc√©sseur.</p>
<p>Attends attends, un WAT ? Un <strong>POST</strong>-processeur ? Oui tu as bien lu car les
pr√©-processeurs c‚Äôest so 2000.
Mais √ßa, je vous en parle la prochaine fois ;)</p>
<p>Tout plein de -moz-bisous.</p>
<hr />

<p>PS: Convaincu par cette solution ? Tant mieux, elle est simple √† mettre en place.
Tout √ßa est d√©crit dans la <a href="/posts/css/mise-en-place-autoprefixer/">mise en place d&#39;autoprefixer</a>
avec des exemples concrets pour ajouter √ßa dans un workflow existant.</p>

]]></description><pubDate>Tue, 25 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</guid></item><item><title>Sublime Text en tant qu'√©diteur Markdown</title><description><![CDATA[[
<p>La vie de d√©veloppeur n&#39;est jamais facile. Tu souhaites faire quelque chose de pr√©cis et tu te retrouves √† faire totalement autre chose, <em>patchant</em> ci ou tu as d√©couvert √ßa.</p>
<p>Typiquement, j&#39;√©tais tranquillement en train d&#39;√©crire un article pour <strong>p!</strong> qui n&#39;avait rien √† voir avec celui actuel, et je me retrouve √† personnaliser mon Sublime Text pour Markdown car ne souhaitant plus utiliser autre chose que celui-ci pour l&#39;√©criture.</p>
<p>Il y a certes le tr√®s bon <a href="http://mouapp.com/">Mou.app</a> (<code>$ brew cask install mou</code>) sur Mac OS X mais comme indiqu√©, il n&#39;est que pour Mac, or il m&#39;arrive parfois d&#39;√™tre sur Windows.
De plus, les √©diteurs en ligne comme <a href="https://stackedit.io/">stackedit.io</a> ou <a href="http://dillinger.io/">dillinger.io</a> sont pratiques mais comme j&#39;ai tendance √† stocker mes brouillons sur <a href="https://db.tt/nTkiSUb">dropbox</a>, ces outils vous demandent l&#39;acc√®s de toute votre dropbox, chose que je n&#39;aime pas sp√©cialement.</p>
<p>Bref, tout √ßa pour dire que tout centraliser sur Sublime Text et utiliser dropbox pour √©crire des articles me semble une pratique plut√¥t agr√©able.</p>
<p>Pour cela, quittez totalement vos √©diteurs Markdown et installez les plugins Sublime Text qui vont bien.</p>
<h2 id="markdownediting">MarkdownEditing</h2>
<p>Premi√®rement, <a href="http://ttscoff.github.io/MarkdownEditing/">MarkdownEditing</a>, ce petit plugin est votre parfait compagnon qui vous permettra d&#39;avoir la bonne coloration syntaxique de votre Markdown. Il vous permettra de mettre en √©vidence les liens, le code, et tout le reste. Du bonheur donc.</p>
<p><img src="../../../images/posts/preview-markdownediting.png" alt=""></p>
<p>Oui alors, j&#39;ai fait quelques configurations car √† la base, ca ressemble plut√¥t √† √ßa :</p>
<p><img src="../../../images/posts/preview-markdownediting-light.png" alt=""></p>
<p>Si vous souhaitez modifier Sublime Text mais uniquement pour le format Markdown, faites : <code>Preferences &gt; Browse Packages...</code> puis aller dans <code>User</code> et cr√©ez un fichier <code>Markdown.sublime-settings</code>. Celui-ci sera lu et appliqu√© √† chaque fois que vous √©diterez un fichier Markdown.</p>
<p>Voici ce que j&#39;ai pour le moment :</p>
<pre><code>{
  "<span class="hljs-attribute">color_scheme</span>": <span class="hljs-value"><span class="hljs-string">"Packages/MarkdownEditing/MarkdownEditor-Dark.tmTheme"</span></span>,
  "<span class="hljs-attribute">enable_table_editor</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  "<span class="hljs-attribute">table_editor_syntax</span>": <span class="hljs-value"><span class="hljs-string">"Auto"</span></span>,
  "<span class="hljs-attribute">tab_size</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
  "<span class="hljs-attribute">extensions</span>":
  <span class="hljs-value">[
    <span class="hljs-string">"mdown"</span>,
    <span class="hljs-string">"txt"</span>,
    <span class="hljs-string">"md"</span>
  ]
</span>}
</code></pre><p>Le th√®me <code>dark</code> pour pas se niquer les yeux (coucou <a href="https://twitter.com/bloodyowl">@bloodyowl</a>), j&#39;active aussi d&#39;autres plugins dont je vais vous parler d&#39;ici peu, j&#39;affecte le spacing √† <code>2</code>, et je d√©clare que j&#39;utiliserai l&#39;√©diteur Markdown pour ce genre de fichiers : <code>.mdown</code>, <code>.txt</code>, <code>.md</code>.</p>
<p>Bien, passons √† la suite.</p>
<h2 id="markdown-preview">Markdown Preview</h2>
<p>Notre cher <a href="https://twitter.com/revolunet">@revolunet</a> a fait un excellent plugin Markdown pour Sublime Text: <a href="https://github.com/revolunet/sublimetext-markdown-preview">Sublime Text Markdown Preview</a>. Celui-ci permet d&#39;avoir un rendu de votre Markdown en <code>.html</code>. Vous pouvez soit compiler votre Markdown pour cr√©er un fichier HTML, soit l&#39;ouvrir directement dans votre navigateur.</p>
<p>Diff√©rents formats disponibles :</p>
<ul>
<li>Python Markdown</li>
<li>Github Flavored Markdown</li>
</ul>
<p>Un autre parfait compagnon en somme, qui quant √† lui s&#39;occupera de dig√©rer l&#39;excellent article que vous √™tes en train d&#39;√©crire.</p>
<p>Je vous parlerai √©ventuellement un jour de <a href="http://johnmacfarlane.net/pandoc/">pandoc</a> qui permet de faire ce genre de choses mais en un peu plus complet et g√©n√©rique (Sublime Text n&#39;est pas n√©cessaire) mais c&#39;est un poil plus complexe. Jettez-y un ≈ìil tout de m√™me.</p>
<h2 id="smartmarkdown">SmartMarkdown</h2>
<p><a href="https://github.com/demon386/SmartMarkdown">Petit plugin</a> int√©ressant qui vous permettra de cacher des parties de votre texte en le repliant. Par exemple, vous vous mettez devant un titre du style <code>##</code> et vous appuyez sur <code>tab</code>, cela repliera votre texte. Plut√¥t pratique pour se focaliser.</p>
<p><img src="../../../images/posts/preview-smartmarkdown.png" alt=""></p>
<h2 id="sublimetableeditor">SublimeTableEditor</h2>
<p>Pr√©c√©demment dans ma configuration Markdown, vous avez pu voir ceci :</p>
<pre><code>  <span class="hljs-string">"enable_table_editor"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"table_editor_syntax"</span>: <span class="hljs-string">"Auto"</span>,
</code></pre><p>Cela permet de configurer <a href="https://github.com/vkocubinsky/SublimeTableEditor">SublimeTableEditor</a> qui vous permettra de correctement aligner vos tableaux dans Markdown.</p>
<p>Et voil√†. Avec tout ceci, vous √™tes par√©(e) √† √©crire votre Markdown dans de bonnes conditions. Plus qu&#39;√† mettre du Jazz et vous pr√©parer une tasse de th√© et c&#39;est parti.</p>
<h2 id="bonus-markdown-extended">Bonus : Markdown Extended</h2>
<p>Il est possible que vous n&#39;aimiez pas forc√©ment MarkdownEditing, et dans ce cas je vous propose un autre plugin pas inint√©ressant non plus s&#39;appelant <a href="https://github.com/jonschlinkert/sublime-markdown-extended">Markdown Extended</a>. Il vous permettra d&#39;avoir la bonne coloration syntaxique lorsque vous √©crivez du code dans votre √©diteur.</p>
<h4 id="avant">Avant</h4>
<p><img src="../../../images/posts/preview-markdownextended-before.png" alt=""></p>
<h4 id="apr-s">Apr√®s</h4>
<p><img src="../../../images/posts/preview-markdownextended-after.png" alt=""></p>
<p>Oh et j&#39;oubliais, voici quelques documentations sur Markdown histoire de bien l&#39;utiliser :</p>
<ul>
<li><a href="http://daringfireball.net/projects/markdown/syntax">Documentation officielle</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown Cheatsheet</a></li>
<li><a href="http://warpedvisions.org/projects/markdown-cheat-sheet.md">Another Markdown Cheatsheet</a></li>
</ul>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</link><guid isPermaLink="true">http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</guid></item><item><title>La puissance de dnsmasq</title><description><![CDATA[[
<p>Derni√®rement, j&#39;ai voulu acc√©der avec mon Smartphone √† ma machine virtuelle (<em>VM</em>) de d√©veloppement qui se trouve sur mon poste de travail (<em>machine ou poste h√¥te</em>). Ma machine virtuelle me permet de reproduire √† l&#39;identique la production afin d&#39;avoir le moins de marge d&#39;erreur possible entre la phase de d√©veloppement et la phase de mise en production.</p>
<p>A ce moment l√†, j&#39;acc√©dais √† ma machine virtuelle √† partir de mon poste via le fichier <em>hosts</em> comprenant ceci :</p>
<pre><code><span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span> monsite<span class="hljs-preprocessor">.dev</span>
</code></pre><p>Le probl√®me est que seul mon poste est au courant de la r√©solution du nom de domaine de par cette m√©thode.</p>
<p>√âtant donn√© qu&#39;il est laborieux de changer des <em>hosts</em> sur un appareil comme un t√©l√©phone et que je n&#39;ai pas non plus envie de dupliquer cette modification sur chaque appareil, il me fallait trouver une solution g√©n√©ralis√©e.</p>
<p>C&#39;est l√† que <strong><a href="http://fr.wikipedia.org/wiki/Dnsmasq">dnsmasq</a></strong> entre en jeu.</p>
<blockquote>
<p>Dnsmasq est un serveur l√©ger pour fournir les services DNS, DHCP, Bootstrap Protocol et TFTP pour un petit r√©seau, voire pour un poste de travail. Il permet d&#39;offrir un service de nommage des machines du r√©seau interne non int√©gr√©es au service de nommage global (i.e. le service DNS d&#39;Internet). Le service de nommage est associ√© au service d&#39;adressage de telle mani√®re que les machines dont le bail DHCP est fourni par Dnsmasq peuvent avoir automatiquement un nom DNS sur le r√©seau interne. Le logiciel offre un service DHCP statique ou dynamique.</p>
</blockquote>
<h2 id="dnsmasq-le-serveur-dns-tout-petit">dnsmasq, le serveur dns tout petit</h2>
<p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>
<ul>
<li>acc√©l√©rer la r√©solution dns</li>
<li>ne pas polluer le r√©seau interne de la boite avec des r√©solutions de domaines propre √† votre poste (imaginez que vous soyez plusieurs √† avoir <em>monsite.dev</em> (ce qui est le cas dans notre boite)); une r√©solution se ferait uniquement vers un seul poste donc impossible de faire sans si vous √™tes plusieurs</li>
<li>ne pas dupliquer sur chacun appareil la r√©solution dns</li>
<li>r√©ussir √† r√©soudre un nom de domaine sur un appareil o√π le fichier <em>hosts</em> est difficile voire impossible d&#39;acc√®s</li>
</ul>
<p>Cependant, tout n&#39;est pas si rose, je vais vous montrer pourquoi apr√®s.</p>
<h3 id="partage-de-connexion">Partage de connexion</h3>
<p>Je vous propose dans un premier temps de partager votre connexion via le Wifi sous Mac OS X afin :</p>
<ul>
<li>d&#39;avoir constamment un d√©bit stable et performant; √©tant donn√© que vous √™tes souvent devant votre poste pour tester sur diff√©rents appareils, en partageant votre connexion via Wifi, vous vous assurez d&#39;avoir un excellent d√©bit, chose qui n&#39;est pas toujours √©vidente quand le wifi de votre boite est un peu / souvent trop loin</li>
<li>d&#39;utiliser le serveur dns (dnsmasq) que vous allez monter</li>
</ul>
<p>Pour cela, il suffit de faire : <code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en source, et <code>Wifi</code> en sortie. (Je vous conseille d&#39;ailleurs de prot√©ger votre Wifi avec une cl√© WPA2).</p>
<figure><img src="../../../images/posts/macosx-network-sharing.png" alt=""></figure>

<p><em>Ici, c&#39;est USB Ethernet en source car je suis sur un Mac Book Air donc aucun port ethernet natif mais choisissez Ethernet si possible.</em></p>
<p>Une fois que le partage de connexion via Wifi est activ√©, vous pouvez vous y connecter avec votre smartphone (ou tablette).</p>
<p>Cela cr√©e alors un nouveau r√©seau priv√© entre votre machine h√¥te et votre t√©l√©phone avec des adresses comme <code>192.168.2.x</code>. La machine h√¥te aura s√ªrement l&#39;adresse <code>192.168.2.1</code> et votre t√©l√©phone tr√®s probablement <code>192.168.2.2</code>.</p>
<p>C&#39;est alors un autre r√©seau que le r√©seau interne √† la boite en <code>192.168.1.x</code>.</p>
<p>Notez aussi que la machine h√¥te, faisant bridge, donne les informations en cascade aux appareils connect√©s. Ce que vous sp√©cifiez comme serveurs dns sur la machine h√¥te sera alors ceux utilis√©s par les appareils √©tant connect√©s √† votre partage de r√©seau.</p>
<h3 id="aaaah-dnsmasq-">Aaaah dnsmasq !</h3>
<p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via <strong>homebrew</strong>.</p>
<h4 id="dnsmasq-via-homebrew">dnsmasq via homebrew</h4>
<pre><code><span class="hljs-variable">$ </span>brew install dnsmasq
</code></pre><h4 id="configuration-de-dnsmasq">configuration de dnsmasq</h4>
<p>Une fois install√©, on copie la configuration :</p>
<pre><code>$ <span class="hljs-keyword">cp</span> /usr/local/opt/dnsmasq/dnsmasq<span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.example</span> /usr/local/etc/dnsmasq<span class="hljs-preprocessor">.conf</span>
</code></pre><p>puis on √©dite le comme ceci :</p>
<pre><code><span class="hljs-preprocessor"># Add domains which you want to force to an IP address here.</span>
<span class="hljs-preprocessor"># The example below send any host in double-click.net to a local</span>
<span class="hljs-preprocessor"># web-server.</span>
<span class="hljs-preprocessor">#address=/double-click.net/127.0.0.1</span>
address=/monsite.dev/<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span>

<span class="hljs-preprocessor"># If you want dnsmasq to listen for DHCP and DNS requests only on</span>
<span class="hljs-preprocessor"># specified interfaces (and the loopback) give the name of the</span>
<span class="hljs-preprocessor"># interface (eg eth0) here.</span>
<span class="hljs-preprocessor"># Repeat the line for more than one interface.</span>
<span class="hljs-preprocessor">#interface=</span>
<span class="hljs-preprocessor"># Or you can specify which interface _not_ to listen on</span>
<span class="hljs-preprocessor">#except-interface=</span>
<span class="hljs-preprocessor"># Or which to listen on by address (remember to include 127.0.0.1 if</span>
<span class="hljs-preprocessor"># you use this.)</span>
listen-address=<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-preprocessor"># If you don't want dnsmasq to read /etc/hosts, uncomment the</span>
<span class="hljs-preprocessor"># following line.</span>
no-hosts
</code></pre><p>Nous pr√©cisons dans un premier temps la r√©solution du nom de domaine <code>monsite.dev</code> (notez que c&#39;est du wildcard, donc pas besoin de pr√©ciser les sous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs de la machine h√¥te et enfin nous indiquons que nous ne voulons pas prendre en compte le fichier <code>/etc/hosts</code> vu qu&#39;on sp√©cifie les r√©solutions via <code>address</code>.</p>
<p>Cela permettra √† terme de ne plus g√©rer le fichier <code>/etc/hosts</code> et de tout sp√©cifier dans <code>dnsmasq.conf</code>.</p>
<h4 id="lancer-dnsmasq-au-d-marrage-de-la-machine">lancer dnsmasq au d√©marrage de la machine</h4>
<p>On copie le fichier de d√©mon dans le dossier qui va bien puis on lance le d√©mon.</p>
<pre><code>$ <span class="hljs-built_in">sudo</span> cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons
$ <span class="hljs-built_in">sudo</span> launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre><h4 id="utiliser-le-serveur-dnsmasq">utiliser le serveur dnsmasq</h4>
<p>Etant donn√© que vous partagez votre connexion et que votre poste fait h√¥te, le serveur dns utilis√© sera celui install√© sur votre poste, donc rien √† faire.</p>
<p>Sinon :</p>
<ul>
<li><p>vous pouvez changer le serveur dns de la machine h√¥te dans <code>network</code> et dans ce cas, que ce soit sur vos appareils connect√©s au wifi ou votre machine principale, vous utiliserez <strong>dnsmasq</strong> mais je vous le d√©conseile car j&#39;ai constat√© que j&#39;atteignais trop facilement le nombre de connexions maximum.</p>
</li>
<li><p>vous pouvez aussi modifier le serveur dns de l&#39;appareil connect√© au wifi partag√© :</p>
</li>
</ul>
<p><em>(Sous Android)</em></p>
<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>
<figure><img src="../../../images/posts/android-network-advanced.jpg" alt=""></figure>

<p>Mais quel int√©r√™t car vous devrez faire cela sur tous vos appareils connect√©s</p>
<ul>
<li>vous pouvez aussi √©diter le fichier <code>/etc/bootpd.plist</code> qui d√©finit toute votre configuration de partage de connexion :</li>
</ul>
<pre><code>$ <span class="hljs-built_in">sudo</span> <span class="hljs-variable">$EDITOR</span> /etc/bootpd.plist
</code></pre><pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">plist</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>Subnets<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>_creator<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>com.apple.InternetSharing<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>allocate<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_domain_name_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_router<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_max<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_min<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2/24<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_address<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_mask<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>255.255.255.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_range<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.2<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.254<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>bootp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>detect_other_dhcp_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>bridge100<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>use_server_config_for_dhcp_options<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">plist</span>&gt;</span>
</code></pre>
<p><code>192.168.2.1</code> est l&#39;adresse de votre machine h√¥te dans le r√©seau de partage.</p>
<h2 id="oh-oui-j-oubliais-mac-os-x-peut-tre-lourd-parfois">Oh oui, j&#39;oubliais, Mac OS X peut √™tre lourd parfois</h2>
<p>Oui, quand vous cr√©ez un partage de connexion sur Mac OS X, il lance son propre serveur dns s&#39;appelant <strong>_mdnsresponder</strong>. C&#39;est le syst√®me <em>Bonjour</em> de iOS/Mac OS X permettant √† n&#39;importe quel appareil Apple de communiquer entre eux. Le probl√®me c&#39;est qu&#39;il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>
<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez √©ventuellement voir que <strong>_mdnsresponder</strong> est lanc√© aussi bien en ipv6 qu&#39;en ipv4 sur le port 53. Cela vous emp√™chera de lancer <strong>dnsmasq</strong>.</p>
<p>Ce que je vous propose dans ces cas l√†, c&#39;est de couper votre partage de connexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de le <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de connexion. Comme √ßa <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>
<p>Autre point, √©vitez, mais vraiment, de nommer vos noms de domaines personnels en <code>.local</code>. En effet, ceux-ci sont plut√¥t r√©serv√©s √† l&#39;environnement Mac OS X. Ils sont d&#39;ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent √† n&#39;importe quel produit Apple sur le r√©seau de se connecter √† d&#39;autres postes Apple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors s&#39;emm√©ler entre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>
<p>Happy coding !</p>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</link><guid isPermaLink="true">http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</guid></item><item><title>BROWSERIFY ALL THE THINGS</title><description><![CDATA[[
<p>Alors que je prends go√ªt √† me passer de frameworks (principalement √† cause des
courbes d&#39;apprentissage et des √©ventuelles lourdeurs et/ou restrictions que cela
impose, mais c&#39;est une autre histoire),
je cherchais la meilleure fa√ßon d&#39;√©crire des micro composants r√©utilisables.</p>
<p>Pour le JavaScript, j&#39;ai commenc√© il y a bien longtemps par des extensions/plugins
<a href="http://prototypejs.org/">Prototype</a>, puis peu de temps apr√®s, du plugins
<a href="http://plugins.jquery.com/">jQuery</a> √† la pelle.
Souvent √† tord puisque j&#39;utilisais peut √™tre 1% de la librairie en d√©pendance -
exemple avec mon <a href="https://github.com/MoOx/jQuery.Loading-Indicator/">indicateur de chargement avec s√©maphore</a>
ou encore mon <a href="https://github.com/MoOx/jQuery.External-Links/">plugin qui ouvre les liens externes avec du target blank automatique</a>.</p>
<p><b>Je ne ferais plus jamais √ßa pour la simple raison du ratio &quot;poids / % d&#39;utilisation&quot; de la d√©pendance.</b></p>
<p>Alors oui, utiliser jQuery a peut-√™tre du bon. Mais s&#39;en passer aussi.
<a href="/posts/js/de-jquery-a-vanillajs/">C&#39;est faisable pour pleins de petites choses</a>.
<a href="/posts/js/comment-se-passer-de-libraries-frameworks-javascript/">Et c&#39;est pas forc√©ment difficile</a>.</p>
<p>Car si je veux utiliser mon petit script qui ajoute des targets blank automatiquement,
 devoir inclure jQuery pour si peu, √ßa fait mal √† mes kilobites.</p>
<p>En attendant <a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">
la gestion de modules via ES6</a>, il nous faut g√©rer aujourd&#39;hui nos composants
et d√©pendances √† la main.
Encore qu&#39;on pourrait faire un transpiler pour utiliser cette syntaxe (√ßa existe
d√©j√†, il n&#39;y a qu&#39;√† voir sur GitHub), mais l√† on ne ferait que cr√©er une nouvelle
d√©finition de module.</p>
<p>C√¥t√© back-end, on a d√©j√† ce qu&#39;il faut en JavaScript avec la gestion
<a href="http://nodejs.org/api/modules.html">des modules en Node</a>.
Un simple <code>require(&#39;module&#39;)</code> va tenter de r√©cup√©rer un module avec ce nom.
Un module n&#39;est rien d&#39;autre qu&#39;un fichier JavaScript. Node va essayer de loader
un <code>.js</code>, puis <code>.json</code> et enfin <code>.node</code> si besoin), qui lui m√™me peut
√©ventuellement charger d&#39;autres d√©pendances (les d√©pendances sont g√©r√©es localement)
tout en prenant en compte les packages NPM.
M√™me si <a href="http://nodejs.org/">Node</a> n&#39;impl√©mente pas totalement
<a href="http://wiki.commonjs.org/wiki/CommonJS">CommonJS</a>, un projet de d√©veloppement d&#39;une API pour
√©crire des programmes en JavaScript ailleurs que dans le navigateur,
la fa√ßon de faire est assez proche.</p>
<figure><img src="../../../images/posts/browserify.png" alt=""></figure>

<p>L&#39;id√©e de <a href="http://browserify.org/">Browserify</a> est d&#39;amener cette fa√ßon de faire
dans le navigateur.</p>
<p>√Ä c√¥t√© de √ßa, vous me direz qu&#39;on a d√©j√† <a href="http://requirejs.org/">RequireJS</a>
pour un r√©sultat similaire.</p>
<p>RequireJS impl√©mente l&#39;API AMD  (Asynchronous Module Definition),
diff√©rent de l&#39;API CommonJS.
Cette API, d√©riv√©e de CommonJS, se veut adapt√©e au navigateur. Son principal atout
√©tant le chargement des modules de mani√®re asynchrone.
En th√©orie, c&#39;est super.</p>
<p>Sauf que dans la pratique (du moins quelque chose de simple et classique,
disons pour l&#39;exemple du petit JavaScript pour am√©liorer une page web, ou encore
une simple <em>single page webapp</em> (SPA)) ce n&#39;est pas forc√©ment pertinent.</p>
<p>En effet charger des modules de mani√®res asynchrones n&#39;est forc√©ment pas optimis√©
lorsqu&#39;il s&#39;agit de faire des pages qui se chargent rapidement.
Il suffit de penser aux probl√©matiques de d√©bits selon la vitesse de la connexion
au r√©seau (Edge, faible 3G...) et donc nombre de requ√™tes HTTP qui peuvent nous
faire souffrir de gros ralentissement pour se rendre compte que cela peut poser
probl√®me.</p>
<p>En plus de cela, je trouve personnellement d√©gueulasse  la fa√ßon de d√©clarer les
modules AMD, mais √ßa ce n&#39;est qu&#39;un d√©tail.</p>
<p>Comparons les diff√©rentes m√©thodes comme on nous les montre sur le site de
<a href="http://requirejs.org/docs/whyamd.html">RequireJS</a> :</p>
<p>Le web aujourd&#39;hui:</p>
<pre><code class="lang-js">(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> $ = <span class="hljs-keyword">this</span>.jQuery;

    <span class="hljs-keyword">this</span>.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
}());
</code></pre>
<p>AMD:</p>
<pre><code class="lang-js">define([<span class="hljs-string">'jquery'</span>] , <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
});
</code></pre>
<p>CommonJS:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
exports.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
</code></pre>
<p>AMD et CommonJS utilisent tout les deux une identification par cha√Æne de caract√®res.
Il faut bien que ces cha√Ænes soient d√©clar√©es quelque part.</p>
<p>C√¥t√© RequireJS (AMD), on doit √©ventuellement mapper toutes ces cha√Ænes √† la main,
dans le fichier configuration.
De plus la d√©claration des d√©pendances se faisant dans l&#39;ent√™te du module, √ßa peut
devenir lourd :</p>
<pre><code class="lang-js">define([ <span class="hljs-string">"require"</span>, <span class="hljs-string">"jquery"</span>, <span class="hljs-string">"blade/object"</span>, <span class="hljs-string">"blade/fn"</span>, <span class="hljs-string">"rdapi"</span>,
         <span class="hljs-string">"oauth"</span>, <span class="hljs-string">"blade/jig"</span>, <span class="hljs-string">"blade/url"</span>, <span class="hljs-string">"dispatch"</span>, <span class="hljs-string">"accounts"</span>,
         <span class="hljs-string">"storage"</span>, <span class="hljs-string">"services"</span>, <span class="hljs-string">"widgets/AccountPanel"</span>, <span class="hljs-string">"widgets/TabButton"</span>,
         <span class="hljs-string">"widgets/AddAccount"</span>, <span class="hljs-string">"less"</span>, <span class="hljs-string">"osTheme"</span>, <span class="hljs-string">"jquery-ui-1.8.7.min"</span>,
         <span class="hljs-string">"jquery.textOverflow"</span>],
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(require,   $,        object,         fn,         rdapi,
          oauth,   jig,         url,         dispatch,   accounts,
          storage,   services,   AccountPanel,           TabButton,
          AddAccount,           less,   osTheme)</span> {</span>
  <span class="hljs-comment">// ici le corps de la fonction</span>
});
</code></pre>
<p>Bon vous me direz que si un module a autant de d√©pendances, il y a peut √™tre un
probl√®me en amont et vous n&#39;aurez pas tort.</p>
<p>C√¥t√© Browserify (CommonJS like), les d√©pendances externes proviennent (√† la base)
de NPM.
On a donc rien √† mapper nul part. Puis pour avoir un module local, il suffit de
faire un <code>require(&#39;./mon/module&#39;)</code>, et Browserify se chargera de r√©gler la
d√©pendance (et je vous montre encore mieux apr√®s).</p>
<p>RequireJS propose un &quot;optimizer&quot;, qui au final ne fait que supprimer son point fort:
le c√¥t√© asynchrone du t√©l√©chargement des modules.
Du coup on se retrouve avec tout RequireJS dans la source ET toutes les d√©pendances avec le mapping.
Il y a bien une fa√ßon de vraiment optimiser par bundle quand on cherche un peu
dans la doc, mais
<a href="http://requirejs.org/docs/optimization.html#wholemultipage">√ßa n&#39;est pas vraiment mis en avant</a>.
Il existe aussi <a href="https://github.com/jrburke/almond">Almond.js</a> qui se veut √™tre
plus l√©ger, mais du coup, utiliser RequireJS pour optimiser avec Almond, je ne
trouve pas √ßa coh√©rent.</p>
<p>Si jusque l√†, Browserify vous int√©resse (plus car les autres solutions ne vous
int√©ressent pas), attaquons le corps du sujet.</p>
<h2>Installation de Browserify</h2>

<p>Si vous souhaitez acc√©der √† la commande via le terminal, la chose la plus simple
√† faire est d&#39;installer le paquet en global.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>npm install -g browserify
</code></pre>
<p>Si vous ne l&#39;installez pas en global (sans l&#39;option <code>-g</code>, vous aurez la commande
accessible dans <code>./node_modules/.bin/browserify</code>).
Mais selon votre workflow, vous pouvez l&#39;utiliser via une t√¢che
<a href="https://www.npmjs.org/package/grunt-browserify">grunt-browserify</a>
ou <a href="https://www.npmjs.org/package/gulp-browserify">gulp-browserify</a>.</p>
<h2>Utilisation de Browserify</h2>

<p>Partons d&#39;un simple fichier <code>main.js</code>:</p>
<pre><code class="lang-js"><span class="hljs-function">alert(<span class="hljs-string">'Hello world !'</span>)</span>;
</code></pre>
<p>Sans aucune d√©pendance, √ßa n&#39;a que peu de sens, mais c&#39;est plus pour montrer un
dernier point int√©ressant.</p>
<p>Je le compile avec la commande suivante:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> -o bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>J&#39;obtiens le fichier suivant.</p>
<pre><code class="lang-js">(function e(t,n,r){function s(o,u){if(!n[<span class="hljs-link_label">o</span>]){if(!t[<span class="hljs-link_label">o</span>]){var a=typeof require=="function"&amp;&amp;require;if(!u&amp;&amp;a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[<span class="hljs-link_label">o</span>]={exports:{}};t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">0</span>].call(f.exports,function(e){var n=t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">1</span>][<span class="hljs-link_label">e</span>];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&amp;&amp;require;for(var o=0;o<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">r.length;o++)s(r[o]);return</span> <span class="hljs-attribute">s</span>})({<span class="hljs-attribute">1:</span>[<span class="hljs-attribute">function</span>(<span class="hljs-attribute">require</span>,<span class="hljs-attribute">module</span>,<span class="hljs-attribute">exports</span>){
<span class="hljs-attribute">alert</span>('<span class="hljs-attribute">Hello</span> <span class="hljs-attribute">world</span> !');


},{}]},{},[<span class="hljs-attribute">1</span>])</span></span>
</code></pre>
<p>On reconna√Æt notre ligne en plein milieu. Avec un ajout cons√©quent. √áa peut para√Ætre
beaucoup, mais c&#39;est rien compar√© √† la
<a href="http://requirejs.org/docs/release/2.1.10/minified/require.js">source de RequireJS</a></p>
<p>Bon du coup partons avec un exemple peut √™tre plus repr√©sentatif qu&#39;on peut voir
sur la homepage de Browserify.</p>
<pre><code class="lang-js"><span class="hljs-reserved">var</span> foo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./foo'</span>);
<span class="hljs-reserved">var</span> gamma = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gamma'</span>);

<span class="hljs-reserved">var</span> n = gamma(foo(<span class="hljs-number">5</span>) * <span class="hljs-number">3</span>);
<span class="hljs-reserved">var</span> txt = <span class="hljs-built_in">document</span>.createTextNode(n);
<span class="hljs-built_in">document</span>.body.appendChild(txt);
</code></pre>
<p>Ici on aura en plus <code>foo.js</code></p>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span></span> { <span class="hljs-keyword">return</span> n * <span class="hljs-number">11</span> }
</code></pre>
<p>Et le module <code>gamma</code> qu&#39;on a install√© depuis NPM</p>
<pre><code class="lang-bash">$ npm <span class="hljs-built_in">i</span> <span class="hljs-built_in">gamma</span>
</code></pre>
<p><small><i><code>i</code> est l&#39;alias de <code>install</code>.</i></small></p>
<p>Avec la m√™me commande que pr√©c√©dement (et donc le m√™me ajout), Browserify va parser
l&#39;arbre syntaxique abstrait (AST) des appels √† <code>require()</code> et va cr√©er un graph
des d√©pendances du projet.<br>Un fois ceci fait, il va simplement ajuster les chemins et d√©clarer les fonctions
mapp√©es dans un object par leur identifiant. Lorsqu&#39;une fonction appelle <code>require</code>,
le petit bout de script ajout√© va se charger de retourner la d√©pendance.</p>
<p>Notez qu&#39;on peut aussi simplement utiliser une redirection de sortie de commande
pour g√©rer le fichier final:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> &gt; bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>Du coup on a plus qu&#39;√† utiliser une simple balise <code>&lt;script&gt;</code> pour incorporer √ßa
dans nos pages web.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"bundle.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2>Les transformations avec Browserify</h2>

<p>Tant qu&#39;√† utiliser un outil, autant l&#39;exploiter jusqu&#39;au bout. Car pour l&#39;instant
je n&#39;ai parl√© que de NPM.
Que faire si mon module n&#39;est pas sur NPM ?
Bon d√©j√† je double check, car maintenant la plupart des librairies y sont
(jQuery, Backbone et Jean passe).
Si ce n&#39;est pas le cas, je pourrais toujours faire <code>npm i https//adresse.git</code>
mais si le paquet n&#39;a pas de <code>package.json</code> avec le <code>main</code> bien rempli, √ßa ne va
pas forc√©ment √™tre le mieux.</p>
<p>Cela dit, si mon paquet est pr√©vu pour Bower par exemple, il existe une <i>transformation</i>
pr√©vue pour aider Browserify √† r√©soudre les r√©f√©rences aux paquets pour les
consommer depuis Bower: <code>debowerify</code>.
Dans le m√™me esprit, on va retrouver de nombreuses transformations telles que :</p>
<ul>
<li><code>decomponentify</code>: pour consommer des <a href="https://github.com/component/component">component</a>s,</li>
<li><code>deamdify</code>:  pour consommer des modules AMD,</li>
<li><code>deglobalify</code>: pour consommer des modules qui utilisent des variables globales,</li>
<li><code>jadeify</code>: pour consommer des fichiers de templates jade,</li>
<li><code>hbsify</code>: pour consommer des fichiers de templates handlebars,</li>
<li><code>es6ify</code>: pour √©crire du JavaScript ES6 (compil√© en ES5),</li>
<li><code>uglifyify</code>: appliquer uglify.</li>
</ul>
<p>Il existe plein <a href="https://www.npmjs.org/browse/keyword/browserify">d&#39;autres transformations</a>
qui s&#39;adapteront s√ªrement √† vos besoins.</p>
<p>Du coup la ligne ultime pour consommer a peu pr√®s n&#39;importe quel module :</p>
<pre><code class="lang-bash">browserify <span class="hljs-attribute">-t</span> debowerify <span class="hljs-attribute">-t</span> decomponentify <span class="hljs-attribute">-t</span> deamdify <span class="hljs-attribute">-t</span> deglobalify <span class="hljs-attribute">-t</span> es6ify main<span class="hljs-built_in">.</span>js <span class="hljs-subst">&gt;</span> bundle<span class="hljs-built_in">.</span>js
</code></pre>
<p>L&#39;√©quivalent avec les t√¢ches Grunt ou Gulp sera tout aussi simple via un tableau.
Pensez bien √† installer ces d√©pendances avant:</p>
<pre><code class="lang-bash"><span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">debowerify</span> <span class="hljs-comment">decomponentify</span> <span class="hljs-comment">deamdify</span> <span class="hljs-comment">deglobalify</span> <span class="hljs-comment">es6ify</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span>
</code></pre>
<h2>Ecrire un module pour Browserify (mais pas que)</h2>

<p>Consommer c&#39;est bien, mais faire c&#39;est <del>mieux</del> bien aussi.</p>
<figure><img src="../../../images/posts/browserify-potter.png" alt=""></figure>

<p>Tout droit sorti de <a href="https://github.com/umdjs/umd">UMD</a> (Universal Module Definition),
voici un wrapper qui vous permettra de cr√©er votre module compatible avec CommonJS,
AMD et pour les projets old school !</p>
<pre><code class="lang-js"><span class="hljs-list">(<span class="hljs-title">function</span> <span class="hljs-list">(<span class="hljs-title">root</span>, factory)</span> <span class="hljs-collection">{
  if <span class="hljs-list">(<span class="hljs-title">typeof</span> exports === 'object')</span> <span class="hljs-collection">{
    // CommonJS
    module.exports = factory<span class="hljs-list">(<span class="hljs-title">require</span><span class="hljs-list">(<span class="hljs-title">'b'</span>)</span>)</span><span class="hljs-comment">;</span>
  }</span> else if <span class="hljs-list">(<span class="hljs-title">typeof</span> define === 'function' &amp;&amp; define.amd)</span> <span class="hljs-collection">{
    // AMD
    define<span class="hljs-list">(<span class="hljs-collection">['b']</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{
      return <span class="hljs-list">(<span class="hljs-title">root.returnExportsGlobal</span> = factory<span class="hljs-list">(<span class="hljs-title">b</span>)</span>)</span><span class="hljs-comment">;</span>
    }</span>)</span><span class="hljs-comment">;</span>
  }</span> else <span class="hljs-collection">{
    // Global Variables
    root.returnExportsGlobal = factory<span class="hljs-list">(<span class="hljs-title">root.b</span>)</span><span class="hljs-comment">;</span>
  }</span>
}</span><span class="hljs-list">(<span class="hljs-title">this</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{

  // Ici votre module <span class="hljs-list">(<span class="hljs-title">fonction</span>, objet, whatever...)</span>
  return <span class="hljs-collection">{}</span><span class="hljs-comment">;</span>
}</span>)</span>)</span><span class="hljs-comment">;</span>
</code></pre>
<p>Il existe bien sur <a href="https://github.com/umdjs/umd#variations">plusieurs fa√ßons de faire</a>
selon vos crit√®res. √Ä vous de choisir.</p>
<p>Maintenant vous aller pouvoir consommer et √©crire des modules facilement, et
sans vous prendre la t√™te.</p>
<p>Bisous.</p>

]]></description><pubDate>Wed, 15 Jan 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/browserify-all-the-things/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/browserify-all-the-things/</guid></item><item><title>Responsive webdesign et structure du DOM</title><description><![CDATA[[
<p>Bien, commen√ßons par le commencement, si tu veux bien. Le <strong>responsive
webdesign</strong>, √ßa te dit quelque chose ? Oui ? Bon. Dans ce cas, tu as peut-√™tre
comme moi d√©j√† √©t√© confront√© √† un cas de figure plut√¥t ennuyeux. Que tu sois
adepte du <em>mobile-first</em> ou irr√©ductible d√©gradateur progressiste, il est
forc√©ment arriv√© un moment o√π tu t&#39;es dit cette chose toute b√™te :</p>
<blockquote>
<p>Ce serait quand m√™me pas mal si cet √©l√©ment √©tait ici plut√¥t que l√†. Sauf que
non.</p>
</blockquote>
<p>Le cas typique est celui d&#39;un menu un minimum complexe, dont on r√©ordonnerait
volontiers les √©l√©ments un chou√Øa au dessus ou en de√ß√† d&#39;une certaine taille
d&#39;√©cran. Et l√†, il faut bien avouer qu&#39;il n&#39;existe pas vraiment de solution
miracle.</p>
<p>J&#39;entends d√©j√† les plus teigneux vocif√©rer qu&#39;avec une meilleure r√©flexion en
amont, le <em>markup</em> aurait √©t√© mieux con√ßu et on n&#39;en serait pas l√†. Bien qu&#39;un
peu facile, cette r√©ponse peut s&#39;av√©rer vraie dans un certain nombre de cas
(admire la phrase du mec qui ne se mouille pas). Mais quoi qu&#39;il en soit, si tu
en es au stade de ce type de questionnement, c&#39;est qu&#39;il est de toute fa√ßon trop
tard pour faire machine arri√®re.</p>
<p>Au train o√π va l&#39;innovation dans notre branche, surtout pour tout ce qui touche
au mobile en g√©n√©ral et √† la conception web en particulier, il n&#39;est pas exclu
que les bouts de ficelle que je vais t&#39;exposer ici soient obsol√®tes dans six
mois, et que cet article fasse un comeback incroyable sur Twitter, les RT
moquant gentiment les techniques pr√©colombiennes auxquelles nous √©tions r√©duits
il n&#39;y a encore pas si longtemps. Va savoir, je pourrais bien faire l&#39;objet
d&#39;une c√©l√©brit√© paradoxalement d√©cadente √† la Rick Astley. En attendant, il
s&#39;agit des seules solutions que je connais pour ce type de cas. Si tu as mieux √†
proposer, je te recommande chaudement de l&#39;ouvrir dans les commentaires pour
qu&#39;on en b√©n√©ficie tous. C&#39;est bon, on y va ? Je t&#39;attends, moi !</p>
<h2 id="-l-ancienne-do-repeat-yourself">√Ä l&#39;ancienne : Do Repeat Yourself</h2>
<p>Imagine une page de blog, o√π apparaissent cons√©cutivement le titre de l&#39;article,
la photo l&#39;illustrant, et enfin le texte. Comme une photo, selon la qualit√© de
ta connexion, √ßa peut √™tre un peu gal√®re √† charger sur mobile (et que la
question des images en responsive design
<a href="http://css-tricks.com/responsive-images-hard/">est encore un sacr√© bordel</a>), tu
prends la d√©cision de passer la photo en dessous du contenu textuel pour que tes
visiteurs puissent lire leur article peinards m√™me si la photo n&#39;a pas fini de
charger - et tu vas m√™me en profiter pour la remplacer par une version plus
light.</p>
<p>Dans un tel cas, la meilleure solution peut encore √™tre de dupliquer ta balise
<code>img</code>, et de masquer l&#39;une ou l&#39;autre avec CSS en fonction de la taille d&#39;√©cran,
gr√¢ce √† une <code>media query</code>. Voil√† un exemple rudimentaire :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>L√¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* Par d√©faut, l'image desktop est cach√©e */</span>
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-comment">/* Si on est sur "grand" √©cran, on affiche l'image desktop... */</span>
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-comment">/* ...et on masque l'image mobile */</span>
  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>√âvidemment, le gros inconv√©nient de ce type de solution est que qui dit
duplication de contenu dit augmentation du poids total. Dans le cas d&#39;un contenu
purement textuel, selon sa taille, cela peut √™tre n√©gligeable. J&#39;ai ici
volontairement pris l&#39;exemple le moins adapt√© : une image, qu&#39;il ne faut
absolument pas faire charger deux fois √† nos visiteurs. On va tricher un peu
avec JavaScript :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Ces images ne seront pas charg√©es car elles n'ont pas d'attribut src --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>L√¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Cette image ne sera charg√©e que si le visiteur n'a pas activ√© le JS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile img-noscript"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}

<span class="hljs-class">.img-noscript</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* On surcharge le style desktop pour s'assurer
     que cette image s'affiche quelle que soit la taille de l'√©cran */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> handleImages = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// On charge les images ayant l'attribut data-src,</span>
  <span class="hljs-comment">// non encore charg√©es (attribut src ind√©fini)</span>
  <span class="hljs-comment">// et non masqu√©es par CSS</span>

  [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img[data-src]:not([src])'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">if</span> (window.getComputedStyle(el).display != <span class="hljs-string">'none'</span>) {
      el.src = el.getAttribute(<span class="hljs-string">'data-src'</span>);
    }
  });
};

window.addEventListener(<span class="hljs-string">'load'</span>, handleImages);
window.addEventListener(<span class="hljs-string">'resize'</span>, handleImages);
</code></pre>
<p>Ainsi, seules les images n√©cessaires seront charg√©es avec la page. J&#39;applique
√©galement le m√™me traitement au <code>resize</code> ; c&#39;est un peu bourrin, je te
l&#39;accorde, on pourrait probablement faire plus fin avec <code>matchMedia</code>.</p>
<p>Dans le cas d&#39;un visiteur naviguant sans JavaScript, seule l&#39;image mobile est
charg√©e : je pars du principe qu&#39;√©tant donn√© qu&#39;on ne peut pas d√©finir laquelle
des deux versions de l&#39;image est la mieux adapt√©e pour lui, autant lui envoyer
la plus l√©g√®re.</p>
<h2 id="js-powa-enquire-js">JS powa : enquire.js</h2>
<p>La seconde solution peut tout √† fait √™tre r√©alis√©e &quot;√† la main&quot;, mais je vais te
parler d&#39;une petite librairie que j&#39;aime beaucoup et que j&#39;ai d√©j√† utilis√©e dans
ce genre de cas. Elle se nomme <a href="http://wicky.nillia.ms/enquire.js/">enquire.js</a>
et permet tout simplement d&#39;affecter des callbacks √† des media queries :</p>
<pre><code class="lang-javascript">enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, {
  match: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// L'√©cran fait 768px de large ou plus...</span>
  },

  unmatch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// ...et ici, 767px de large ou moins.</span>
    <span class="hljs-comment">// La librairie repose sur matchMedia et matchMedia.addListener</span>
  }
});
</code></pre>
<p>Plut√¥t sympa, non ? Pour reprendre notre exemple de tout √† l&#39;heure (le CSS n&#39;est
plus n√©cessaire) :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">data-mobile-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>L√¢che tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> content = document.querySelector(<span class="hljs-string">'p'</span>),

  switchImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(isMobile)</span> {</span>
    <span class="hljs-keyword">var</span> attr = isMobile ? <span class="hljs-string">'data-mobile-src'</span> : <span class="hljs-string">'data-src'</span>;

    [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img['</span> + attr + <span class="hljs-string">']'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
      <span class="hljs-comment">// On affecte l'une ou l'autre source √† notre image,</span>
      <span class="hljs-comment">// entra√Ænant son chargement si n√©cessaire.</span>
      el.src = el.getAttribute(attr);

      <span class="hljs-comment">// On en profite pour la bouger avant ou apr√®s le contenu</span>
      content.parentNode.insertBefore(el, isMobile ? content.nextSibling : content);
    });
  };

enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">false</span>);
});

enquire.register(<span class="hljs-string">'screen and (max-width: 767px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">true</span>);
});
</code></pre>
<p>On peut ainsi g√©rer facilement le chargement de l&#39;image, ainsi que son
emplacement. J&#39;utilise ici deux handlers distincts pour m&#39;assurer qu&#39;enquire
fait bien son boulot au chargement aussi, dans tous les cas (les callbacks
<code>unmatch</code> ne sont appel√©s qu&#39;au redimensionnement, semble-t-il : avec un seul
handler, l&#39;image n&#39;arrive donc jamais si on charge la page avec un √©cran d&#39;une
largeur inf√©rieure √† 768px).</p>
<h2 id="that-s-all-you-ve-got-bitch-">That&#39;s all you&#39;ve got, bitch?</h2>
<p>On peut √©galement, puisque tu y tiens tant, √©voquer d&#39;autres solutions plus
marginales mais qui m√©ritent d&#39;√™tre cit√©es.</p>
<h3 id="foundation">Foundation</h3>
<p><a href="http://foundation.zurb.com/">Foundation</a> propose, dans sa version 5 (et
peut-√™tre m√™me avant, j&#39;ai pas v√©rifi√©) un peu de sucre syntaxique HTML
permettant de switcher (via JS, ≈ìuf corse) simplement entre diff√©rents contenus
pour l&#39;√©l√©ment sur lequel on l&#39;utilise.</p>
<p>C&#39;est pas mal. √áa donne √ßa (tir√© de <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>) :</p>
<blockquote>
<p>We use the data-interchange attribute on a markup container (probably a div)
to do this. Here&#39;s an example which loads up a small, static map on mobile, a
larger static map for medium-sized devices, and a full interactive Google map
on large display devices.</p>
</blockquote>
<pre><code class="lang-html">&lt;<span class="hljs-keyword">div</span> data-interchange=<span class="hljs-string">"[../examples/interchange/default.html, (small)],
                       [../examples/interchange/medium.html, (medium)],
                       [../examples/interchange/large.html, (large)]"</span>&gt;
  &lt;<span class="hljs-keyword">div</span> data-alert <span class="hljs-type">class</span>=<span class="hljs-string">"alert-box secondary radius"</span>&gt;
    This <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> default content.
    &lt;a href=<span class="hljs-string">"#"</span> <span class="hljs-type">class</span>=<span class="hljs-string">"close"</span>&gt;&amp;<span class="hljs-keyword">times</span>;&lt;/a&gt;
  &lt;/<span class="hljs-keyword">div</span>&gt;
&lt;/<span class="hljs-keyword">div</span>&gt;
</code></pre>
<p><code>small</code>, <code>medium</code> et <code>large</code> √©tant des raccourcis pour des media queries donn√©es
(c&#39;est dans <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>,
toujours. J&#39;insiste.)</p>
<h3 id="flexbox-pas-toi-david-">Flexbox (pas toi, David)</h3>
<p>On peut √©galement, comme l&#39;a tr√®s justement soulign√© <a href="/#crew">lionelB</a>, se
pencher (mais pas trop) sur le cas de Flexbox, qui est un nouveau type de
positionnement introduit en CSS3. La <a href="http://caniuse.com/#search=flexbox">compatibilit√©</a>
n&#39;est pas encore au top (surtout gr√¢ce √† IE, qui l&#39;e√ªt cru) mais autant se tenir
pr√™ts ! Pour ceux qui ont dormi, en gros, tu d√©finis un conteneur :</p>
<pre><code class="lang-css"><span class="hljs-class">.flex-container</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;

  <span class="hljs-comment">/* ou bien */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-flex</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>...et tu donnes des num√©ros √† ses enfants, comme √† Bangkok :</p>
<pre><code class="lang-css"><span class="hljs-class">.title</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.content</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.image</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
Bien s√ªr, tu as √©t√© assez malin pour mettre ton image en dernier dans le DOM...
...n'est-ce pas ?
*/</span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.content</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.image</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>Et voil√†, pas besoin d&#39;avoir fait Pollypocket pour percevoir √† quel point la
flexibilit√© et la propret√© du code que cette technique nous permet d&#39;√©crire
r√©solvent notre probl√®me en deux secondes douze. Ce n&#39;est √©videmment ici que la
partie √©merg√©e du flexberg ; il y a des tas de bonnes ressources qui vous
expliqueront √ßa en long, en large et en travers bien mieux que moi, notamment
<a href="http://www.adobe.com/devnet/html5/articles/working-with-flexbox-the-new-spec.html">cet article</a>
sur lequel j&#39;ai honteusement pomp√© les snippets de cette partie.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Comme tu l&#39;as vu, rien de ce que je t&#39;ai montr√© n&#39;est r√©ellement satisfaisant :
pour pouvoir contr√¥ler le positionnement d&#39;un √©l√©ment dans le DOM dans le cadre
d&#39;un webdesign responsive, tu dois soit le dupliquer et jouer √† cache-cache,
soit le d√©placer avec JavaScript. Aussi, je serais ravi que tu partages ton
opinion, tes id√©es ou tes retours d&#39;XP √† ce sujet. √áa me fera de la lecture pour
passer le temps, et toi tu feras quelque chose de constructif !</p>
<p>Il est temps pour moi de te laisser reprendre le cours de ta vie. Peut-√™tre nos
routes se croiseront-elles de nouveau. Dans l&#39;intervalle, va, vis, et code !</p>

]]></description><pubDate>Thu, 26 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/html/responsive-dom/</link><guid isPermaLink="true">http://putaindecode.fr/posts/html/responsive-dom/</guid></item><item><title>Comment se passer de libraries/frameworks JavaScript</title><description><![CDATA[[
<p><strong> Petite note pr√©alable </strong> : √âvidemment que √ßa ne marche pas sous les vieux navigateurs, cet article s&#39;adresse principalement √† toi pour te faire comprendre comment les choses marchent.</p>
<p>De plus en plus, le besoin de l√©g√®ret√© se fait sentir sur les pages. En d√©pit d&#39;un web plus rapide sur desktop, on a maintenant beaucoup de devices connect√©s via 3G ou Edge (un petit coucou au m√©tro parisien). Du coup, tu te rendras vite compte qu&#39;embarquer jQuery + jQuery Mobile + jQuery UI et un tas d&#39;autres plug-ins grapill√©s sur le web, √ßa commence √† peser.</p>
<h2 id="pour-la-s-lection-d-lements">Pour la s√©lection d&#39;√©lements</h2>
<p>Pour remplacer ton bon vieux <code>$</code> magique, <code>document.querySelectorAll</code> semble faire l&#39;affaire. En revanche, il retourne une instance de <code>NodeList</code>, pas d&#39;<code>Array</code>, ce qui ne nous arrange pas des masses.</p>
<p>Du coup, on peut √©crire une petite function toute con, qui nous retourne un <code>Array</code> et ses m√©thodes bien utiles.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> nativeSlice = [].slice <span class="hljs-comment">// la m√©thode de conversion</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> list = document.querySelectorAll(selector)
  <span class="hljs-keyword">return</span> nativeSlice.call(list)
}
</code></pre>
<p>Alternativement, tu peux utiliser <code>Array.apply(null, list)</code> plut√¥t que <code>nativeSlice.call(list)</code>, si vraiment √ßa te fait plaisir.</p>
<p>Une troisi√®me solution, un peu plus chiante au quotidien (et terriblement laide), c&#39;est d&#39;utiliser directement les m√©thodes qui t&#39;int√©ressent (ex. <code>[].forEach</code>) de cette fa√ßon :</p>
<pre><code class="lang-javascript">;[].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(selector), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<p>Pour en revenir √† notre petite m√©thode <code>$</code>, on peut du coup faire :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// prends bien l'habitude de garder</span>
<span class="hljs-comment">// tes nodeLists si tu les r√©utilises</span>

<span class="hljs-keyword">var</span> elements = $(<span class="hljs-string">".my-elements-className"</span>)

elements.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<h3 id="pour-l-event-delegation">Pour l&#39;event delegation</h3>
<p>L&#39;event delegation, c&#39;est bien, mangez-en. √áa permet entre autres de ne pas attacher 150 listeners uniques √† 150 elements diff√©rents, mais √† attacher un seul listener sur un parent commun, et analyser les sources des √©venements √† l&#39;int√©rieur en se basant sur le bubbling (remont√©e d&#39;√©venement de la source au plus haut parent) ou capturing (descente d&#39;√©venement du plus haut parent √† la source, avant m√™me que la source ne le re√ßoive).</p>
<p>Pour faire de la d√©l√©gation, on va proc√©der en trois temps :</p>
<ul>
<li>Choper <code>event.target</code></li>
<li>V√©rifier que le s√©lecteur qui nous int√©resse correspond bien √† <code>event.target</code> ou un de ses parents (dans le cas o√π l&#39;on clique sur le <code>.icon-Arrow</code> dans <code>.js-Button-action</code>)</li>
<li>Si √ßa match, on garde l&#39;√©lement correspondant au s√©lecteur, sinon, exit</li>
</ul>
<p>Les browsers relativement r√©cents poss√®dent une m√©thode : <code>matchesSelector</code> (et tous ses alias pr√©fix√©s). Ce qu&#39;on peut donc faire, c&#39;est ceci :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> docEl = document.documentElement
    <span class="hljs-comment">// si c'est dans docEl, c'est que c'est dispo</span>
  , nativeMatchesSelector =
      docEl.matchesSelector ||
      docEl.webkitMatchesSelector ||
      docEl.mozMatchesSelector ||
      docEl.oMatchesSelector ||
      docEl.msMatchesSelector
  , matchesSelector = nativeMatchesSelector || matchesPolyfill

<span class="hljs-comment">// le polyfill utilise querySelectorAll</span>
<span class="hljs-comment">// et cherche dans le parent de l'√©lement</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchesPolyfill</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> node = this
    , <span class="hljs-keyword">parent</span> = node.parentNode
    , query, index, length
  <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">parent</span> || <span class="hljs-keyword">parent</span>.nodeType != <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
  }
  query = <span class="hljs-keyword">parent</span>.querySelectorAll(selector)
  index = -<span class="hljs-number">1</span>
  length = query.length
  <span class="hljs-keyword">while</span>(++index &lt; length) {
    <span class="hljs-keyword">if</span>(query[index] == node) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentTarget</span><span class="hljs-params">(node, selector)</span>{</span>
  <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  <span class="hljs-keyword">while</span>(node = node.parentNode) {
    <span class="hljs-keyword">if</span>(node.nodeType != <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}
</code></pre>
<p>D√®s lors, dans nos listeners, on pourra directement proc√©der ainsi :</p>
<pre><code class="lang-javascript">element.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  <span class="hljs-keyword">var</span> currentTarget = getCurrentTarget(evt.target, <span class="hljs-string">".Button-action"</span>)
  <span class="hljs-keyword">if</span>(!currentTarget) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">// all good with currentTarget</span>
})
</code></pre>
<h3 id="pour-l-ajax">Pour l&#39;Ajax</h3>
<p>Pourquoi est-ce que l&#39;on appelle √ßa encore Ajax, d&#39;ailleurs ? Bref.</p>
<p>Simple comme bonjour :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSuccessStatus</span><span class="hljs-params">(status)</span>{</span>
  <span class="hljs-keyword">return</span> status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span> || status == <span class="hljs-number">304</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ajax</span><span class="hljs-params">(options)</span>{</span>
  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
    , done = <span class="hljs-literal">false</span>
    , async = options.hasOwnProperty(<span class="hljs-string">"async"</span>) ? options.async : <span class="hljs-literal">true</span>

  xhr.open(options.method || <span class="hljs-string">"GET"</span>, options.url, async)

  xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">if</span>(done) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.readyState != <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>
    done = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">if</span>(isSuccessStatus(<span class="hljs-keyword">this</span>.status)) {
      <span class="hljs-keyword">if</span>(options.success) {
        options.success.call(<span class="hljs-keyword">this</span>)
      }
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span>(options.error) {
      options.error.call(<span class="hljs-keyword">this</span>)
    }
  }
  <span class="hljs-built_in">Object</span>.keys(options.headers || {})
    .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      xhr.setRequestHeader(key, options.headers[key])
    })
  xhr.send(options.data || <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">return</span> xhr
}
</code></pre>
<p>Cette fonction offre un support basique de XHR :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myXHR = ajax({
    url : <span class="hljs-string">"api/users"</span>
  , success : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      doStuff(<span class="hljs-keyword">this</span>.responseText)
    }
  , error : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      showError(<span class="hljs-keyword">this</span>.status)
    }
})
</code></pre>
<h3 id="es5-magic">ES5 magic</h3>
<p>EcmaScript 5 d√©livre des petites m√©thodes tr√®s int√©ressantes pour se simplifier la vie, fortement inspir√©es par ce qu&#39;on a l&#39;habitude de trouver dans les biblioth√®ques ayant connu l&#39;√¢ge d&#39;or, comme <a href="http://prototypejs.org">PrototypeJS</a> ou <a href="http://mootools.net">MooTools</a>.</p>
<p>D√®s lors, plut√¥t qu&#39;un ennuyeux :</p>
<pre><code class="lang-javascript">var key, <span class="hljs-keyword">item</span>
<span class="hljs-keyword">for</span>(key <span class="hljs-operator">in</span> myObject) {
  <span class="hljs-keyword">if</span>(myObject.hasOwnProperty(key)) {
    <span class="hljs-keyword">item</span> = myObject[key]
   <span class="hljs-comment"> // do something</span>
  }
}
</code></pre>
<p>on peut se contenter d&#39;un :</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">Object</span>.keys(myObject)
  .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
    <span class="hljs-keyword">var</span> item = myObject[i]
    <span class="hljs-comment">// do something</span>
  })
</code></pre>
<p>De m√™me, on b√©n√©ficie de m√©thodes s&#39;av√©rant tr√®s utiles, comme
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype"><code>Array.prototype.map</code>, <code>Array.prototype.reduce</code>, <code>Array.prototype.filter</code></a>,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object.create</code>, <code>Object.getPrototypeOf</code>, <code>Object.getOwnPropertyNames</code>, <code>Object.defineProperty</code></a>
dont je t&#39;invite, si cela t&#39;int√©resse, √† te renseigner sur ces m√©thodes.
Et si tu veux avoir plus de d√©tails, read the fucking manual :
<a href="http://es5.github.io">http://es5.github.io</a>.</p>
<h3 id="des-petits-d-tails-cools-du-c-t-des-events">Des petits d√©tails cools du c√¥t√© des events</h3>
<p>Avec <code>addEventListener</code>, on peut aussi passer un objet comme listener, avec <code>handleEvent</code> pour interface :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myElementClickEvents = {
    element : myElement
  , callbacks : []
  , handleEvent : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
      <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = this
      this.callbacks.<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item)</span>{</span>
        item.call(<span class="hljs-keyword">self</span>.element, evt)
      })
    }
}
myElement.addEventListener(<span class="hljs-string">"click"</span>, myElementClickEvents)

myElementClickEvents.callbacks.push(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  console.log(evt)
})
</code></pre>
<p>Avec √ßa, on peut facilement garder une trace de ce qu&#39;on pass√© comme listeners.</p>
<h3 id="du-type-checking-">Du type checking ?</h3>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> getClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span>{</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(o) }
  , someString = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">"foo"</span>)

<span class="hljs-keyword">typeof</span> someString <span class="hljs-comment">// "object"</span>
getClass(someString) <span class="hljs-comment">// "[object String]", sounds more reasonable</span>
</code></pre>
<h3 id="petit-bonus">Petit bonus</h3>
<p>Un petit bonus rien que pour toi : pour avoir une syntaxe plus sympathique et plus claire que les prototypes.</p>
<p>En principe, on fait comme √ßa :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span><span class="hljs-params">(name)</span>{</span>
  <span class="hljs-keyword">this</span>.name = name
}

Animal.prototype.getName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cat</span><span class="hljs-params">(name)</span>{</span>
  Animal.call(<span class="hljs-keyword">this</span>, name)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">K</span><span class="hljs-params">()</span>{</span>}
K.prototype = Animal.prototype

Cat.prototype = <span class="hljs-keyword">new</span> K
Cat.prototype.constructor = Cat
Cat.prototype.type = <span class="hljs-string">"cat"</span>

<span class="hljs-keyword">var</span> myAnimal = <span class="hljs-keyword">new</span> Animal(<span class="hljs-string">"Foo"</span>)
  , myCat = <span class="hljs-keyword">new</span> Cat(<span class="hljs-string">"Bar"</span>)

myCat <span class="hljs-keyword">instanceof</span> Cat <span class="hljs-comment">// true</span>
myCat <span class="hljs-keyword">instanceof</span> Animal <span class="hljs-comment">// true</span>
</code></pre>
<p>Maintenant, √† l&#39;aide de deux petites m√©thodes :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// wow</span>
<span class="hljs-comment">//         many magic</span>
<span class="hljs-comment">//   very es5</span>
<span class="hljs-comment">//            wow</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extend</span><span class="hljs-params">(object)</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(!object) <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
  Object.keys(object)
    .<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      <span class="hljs-keyword">self</span>[key] = object[key]
    })
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(typeof <span class="hljs-keyword">self</span>.constructor == <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">self</span>.constructor.apply(<span class="hljs-keyword">self</span>, arguments)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-keyword">var</span> klass = {
    create : create
  , extend : extend
}
</code></pre>
<p>Tu peux faire √ßa :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> animal = klass.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      <span class="hljs-keyword">this</span>.name = name
    }
  , getName : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
    }
})

<span class="hljs-keyword">var</span> cat = animal.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      animal.constructor.call(<span class="hljs-keyword">this</span>, name)
    }
  , type : <span class="hljs-string">"cat"</span>
})

<span class="hljs-keyword">var</span> myAnimal = animal.create(<span class="hljs-string">"Foo"</span>)
  , myCat = cat.create(<span class="hljs-string">"Bar"</span>)

cat.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
animal.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
</code></pre>
<p>Voil√†, j&#39;esp√®re que cela a pu attiser ta curiosit√© d&#39;en apprendre plus sur le langage lui-m√™me et le DOM.</p>

]]></description><pubDate>Fri, 06 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</guid></item><item><title>ExternalInterface.call() de Flash (et Backbone), toute une histoire</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/occupyflash.png" alt=""></figure>

<p>Je voulais vous parler d&#39;un bug qui m&#39;a bien emmerd√© r√©cemment et comme j&#39;aimerais que vous ne perdiez pas de temps avec cela, un article s&#39;imposait.</p>
<p><em>Note de la direction : j&#39;y connais rien en Flash (et je ne crois pas avoir trop envie de conna√Ætre en fait).</em></p>
<p>Dans la boite o√π je travaille, nous utilisons Flash en tant que lecteur vid√©o √©tant donn√© qu&#39;il est pour le moment tr√®s difficile de faire lire sur toutes les plateformes des vid√©os au format <em>H.264</em> et/ou passant par du <em>HLS</em>. Longue histoire qui fera office d&#39;un autre article. (Je dis √ßa √† chaque fois, haha).</p>
<h2 id="le-pitch">Le pitch</h2>
<p>Avec notre <em>flasheur</em> attitr√©, nous nous sommes mis en t√™te de cr√©er un objet <em>event</em> qui permettrait au Flash de d√©clencher des √©v√®nements lorsqu&#39;il le souhaite afin de communiquer avec l&#39;application JavaScript et que celui-ci fasse en cons√©quence. Cet objet, nous l&#39;avons appel√© <code>App.FlashManager</code> et plus pr√©cisemment <code>App.FlashManager.Events</code> dans le cas des √©v√®nements. Nous utilisons <strong>Backbone.js</strong> pour g√©rer ce principe d&#39;√©v√®nement mais vous en avez d&#39;<a href="http://microjs.com/#event">autres</a> de disponible. En pratique, voil√† ce que √ßa donne :</p>
<pre><code class="lang-javascript"> // on cr√©e un objet vide
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// on lui ajoute les fonctionnalit√©s des events Backbone
_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)
</code></pre>
<p>En soi, pas de souci, tout se passe bien √† ce moment, nous avons un <a href="http://backbonejs.org/#Events">objet d&#39;√©v√®nement fa√ßon Backbone</a>. Il pourra alors s&#39;√©couter lui-m√™me, √©couter un autre objet, mais aussi d√©clencher des √©v√®nements.</p>
<h2 id="c-t-flash">C√¥t√© Flash</h2>
<p>La base est en place, maintenant on souhaite que le Flash d√©clenche un √©v√®nement. On passe par l&#39;objet <code>ExternalInterface</code> :</p>
<pre><code class="lang-javascript">ExternalInterface<span class="hljs-preprocessor">.call</span>(<span class="hljs-string">"window.App.FlashManager.Events.trigger"</span>, <span class="hljs-string">"my-event"</span>)
// http://help<span class="hljs-preprocessor">.adobe</span><span class="hljs-preprocessor">.com</span>/en_US/FlashPlatform/reference/actionscript/<span class="hljs-number">3</span>/flash/external/ExternalInterface<span class="hljs-preprocessor">.html</span><span class="hljs-preprocessor">#call</span>
</code></pre>
<p>Et l√†, bug.</p>
<h2 id="pourquoi-bug-">Pourquoi bug ?</h2>
<p>Pour le moment, je ne sais pas vraiment. Je me pencherai plus sur le sujet d√®s que j&#39;ai un peu de temps, mais ce que je sais, c&#39;est que <code>ExtercalInterface.call()</code> ne s&#39;attend pas √† recevoir ce que <strong>Backbone.js</strong> lui propose. Lorsque vous faites <code>.trigger()</code>, <strong>Backbone.js</strong> renvoie l&#39;<a href="https://github.com/jashkenas/backbone/blob/master/backbone.js#L144-L153">objet en cours</a>, ce qui provoque un √©nooooorme bug dans le plugin Flash de votre navigateur.</p>
<h2 id="la-solution-c-t-javascript">La solution c√¥t√© JavaScript</h2>
<p>Pour contrer cela, je vous propose la solution suivante qui est de ne pas utiliser directement l&#39;objet <code>Backbone.Events|View</code> mais plut√¥t de passer par une interface, un objet proxy.</p>
<p>Voici le sch√©ma :</p>
<ul>
<li>Cr√©er un objet simple qui contient les m√™mes noms de m√©thodes que les objets √©v√®nements <strong>Backbone.js</strong> (en gros, se mapper sur l&#39;API Backbone)</li>
<li>Utiliser <strong>Backbone.js</strong> dans les m√©thodes de cet objet <em>Proxy</em></li>
</ul>
<p>Exemple :</p>
<pre><code class="lang-javascript">// Bridge between flash <span class="hljs-keyword">and</span> js
App<span class="hljs-preprocessor">.FlashManager</span> = {}
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// Backbone events used for Flash
App<span class="hljs-preprocessor">.InternalFlashManager</span> = {}
App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)

App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span> = function(name, opts) {
    App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span>(name, opts)

    // Must return nothing not to loop JavaScript engine, important!
    return
}
</code></pre>
<h2 id="oh-et-">Oh et...</h2>
<p>...il existe une version ayant plus ou moins le m√™me souci que moi disponible l√† : <a href="https://coderwall.com/p/e-8niw">ExternalInterface#call in a deadly loop (<strong>flash</strong>toXML)</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>De mani√®re g√©n√©rale (hors <strong>Backbone.js</strong>), lorsque vous utilisez <code>ExtercalInterface.call()</code>, faites en sorte que votre JavaScript retourne quelque chose de simple (un objet ayant que des atributs, pas de fonctions, ou encore un boul√©en ou un <em>integer</em>).</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</guid></item><item><title>De jQuery √† Vanilla JS</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/jquery-die.jpg" alt=""></figure>

<p>Oui alors jQuery, c&#39;est s√ªrement tr√®s bien, √ßa simplifie pas mal de choses et le <em>chaining</em> est int√©ressant mais eeeest-ce que vous connaissez l&#39;√©quivalent en <em>pur</em> JavaScript ? Pas s√ªr hein.</p>
<p>Ce petit article vous propose de quoi peut-√™tre vous faire changer d&#39;avis sur la biblioth√®que qui p√®se tout de m√™me environ ~80ko.</p>
<p><em>Note : <a href="http://vanilla-js.com/">Vanilla JS</a> n&#39;est pas un framework mais veut simplement dire &quot;√† nu&quot;, c&#39;est du JavaScript sans biblioth√®que.</em></p>
<p>C&#39;est parti !</p>
<h2 id="table-des-mati-res">Table des mati√®res</h2>
<ol>
<li><a href="/posts/js/de-jquery-a-vanillajs/#-v-nements">√âv√®nements</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#s-lecteurs">S√©lecteurs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#attributs">Attributs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#classes">Classes</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#manipulation">Manipulation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#navigation">Navigation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#ajax">AJAX</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#jsonp">JSONP</a></li>
</ol>
<h2 id="-v-nements">√âv√®nements</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
document.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'a'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code‚Ä¶</span>
})

<span class="hljs-comment">// Vanilla</span>
[].forEach.call(document.querySelectorAll(<span class="hljs-string">'a'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
  el.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// code‚Ä¶</span>
  })
})
</code></pre>
<h2 id="s-lecteurs">S√©lecteurs</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> divs = $(<span class="hljs-string">'div'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> divs = document.querySelectorAll(<span class="hljs-string">'div'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> newDiv = $(<span class="hljs-string">'&lt;div/&gt;'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> newDiv = document.createElement(<span class="hljs-string">'div'</span>)
</code></pre>
<h2 id="attributs">Attributs</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-variable">$(</span><span class="hljs-string">'img'</span>).<span class="hljs-keyword">filter</span>(<span class="hljs-string">':first'</span>).attr(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)

<span class="hljs-comment">// Vanilla</span>
document.querySelector(<span class="hljs-string">'img'</span>).setAttribute(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)
</code></pre>
<h2 id="classes">Classes</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.addClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">add</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.toggleClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">toggle</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<h2 id="manipulation">Manipulation</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'body'</span>).append($(<span class="hljs-string">'&lt;p/&gt;'</span>))

<span class="hljs-comment">// Vanilla</span>
document.body.appendChild(document.createElement(<span class="hljs-string">'p'</span>))
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> clonedElement = $(<span class="hljs-string">'#about'</span>).clone()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> clonedElement = document.getElementById(<span class="hljs-string">'about'</span>).cloneNode(<span class="hljs-literal">true</span>)
</code></pre>
<pre><code class="lang-javascript">// jQuery
$(<span class="hljs-string">'#wrap'</span>).<span class="hljs-constant">empty</span>()
<span class="hljs-comment">
// Vanilla</span>
var <span class="hljs-operator">wrap</span> = document.getElementById(<span class="hljs-string">'wrap'</span>)
<span class="hljs-keyword">while</span>(<span class="hljs-operator">wrap</span>.firstChild) <span class="hljs-operator">wrap</span>.removeChild(<span class="hljs-operator">wrap</span>.firstChild)
</code></pre>
<h2 id="navigation">Navigation</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = $(<span class="hljs-string">'#about'</span>).<span class="hljs-keyword">parent</span>()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = document.getElementById(<span class="hljs-string">'about'</span>).parentNode
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">if</span>($(<span class="hljs-string">'#wrap'</span>).<span class="hljs-keyword">is</span>(<span class="hljs-string">':empty'</span>))

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">if</span>(!document.getElementById(<span class="hljs-string">'wrap'</span>).hasChildNodes())
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> nextElement = $(<span class="hljs-string">'#wrap'</span>).next()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> nextElement = document.getElementById(<span class="hljs-string">'wrap'</span>).nextSibling
</code></pre>
<h2 id="ajax">AJAX</h2>
<h3 id="get">GET</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.get(<span class="hljs-string">'//example.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.open(<span class="hljs-string">'GET'</span>, url)
httpRequest.send()
</code></pre>
<h3 id="post">POST</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.post(<span class="hljs-string">'//example.com'</span>, { username: username }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>)
httpRequest.open(<span class="hljs-string">'POST'</span>, url)
httpRequest.send(<span class="hljs-string">'username='</span> + <span class="hljs-built_in">encodeURIComponent</span>(username))
</code></pre>
<h3 id="jsonp">JSONP</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.getJSON(<span class="hljs-string">'//openexchangerates.org/latest.json?callback=?'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
<span class="hljs-keyword">var</span> scr = document.createElement(<span class="hljs-string">'script'</span>)
scr.src = <span class="hljs-string">'//openexchangerates.org/latest.json?callback=formatCurrency'</span>
document.body.appendChild(scr)
</code></pre>
<p>Cela vous parait-il encore difficile de vous passer de jQuery ? :)</p>
<p>Un grand merci √† <a href="http://playground.deaxon.com/js/vanilla-js/">@deaxon</a> qui est √† l&#39;origine de cet √©claircissement.</p>
<h2 id="a-creuser">A creuser</h2>
<p>Il existe une version minimaliste de jQuery bas√©e sur la m√™me API mais beaucoup plus l√©g√®re s&#39;appelant <a href="http://zeptojs.com/">Zepto</a>. Il est actuellement utilis√© en production sur le site mobile de ma boite.</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</guid></item><item><title>Premiers pas avec Grunt</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/gruntjs.png" alt=""></figure>

<p>Vous avez s√ªrement d√©j√† entendu parler de <strong>Grunt</strong> √† droite √† gauche, en conf√©rence, voire votre boite l&#39;utilise d√©j√† mais vous ne savez toujours pas trop ce qui se cache derri√®re ce terme saugrenu digne d&#39;un personnage de Warcraft. Soit, ce n&#39;est pas bien grave. <strong>Grunt</strong> est simplement un <em>JavaScript Task Runner</em>, un outil vous permettant de cr√©er des t√¢ches automatis√©es en JavaScript. Forc√©ment ce n&#39;est pas tr√®s parlant mais c&#39;est tout l&#39;int√©r√™t de cet article, vous expliquer ce qu&#39;est <strong>Grunt</strong> et pourquoi il peut vous √™tre utile dans un <em>workflow</em> de front-end dev.</p>
<h1 id="commen-ons">Commen√ßons</h1>
<p>Vous est-il d√©j√† arriv√©(e) de devoir r√©guli√®rement lancer, lancer et relancer des processus tels que <em>Sass</em>, <em>LESS</em>, <em>uglify</em> - en somme des pr√©processeurs ou des minifiers - r√©guli√®rement √† la main ? N&#39;est-ce pas p√©nible ? N&#39;est-ce pas aussi p√©nible de devoir indiquer √† tous ses coll√®gues comment ils doivent bosser pour que vous soyez tous coh√©rents ? Oui ? <strong>Grunt</strong> permet de r√©soudre ce genre de choses : respecter un putain de <em>workflow</em> en s&#39;assurant que le parcours soit le m√™me pour tout le monde et d&#39;ex√©cuter tout √ßa en lan√ßant une seule commande. N&#39;est-ce pas fucking aweeeeesome dude ? Bref.</p>
<p>Voici un <em>workflow</em> assez classique :</p>
<ul>
<li>Compiler mes <code>.scss</code> en <code>.css</code>;</li>
<li>Concat√©ner mes <code>*.js</code> en un seul fichier;</li>
<li>Minifier (avec <em>uglify</em> par exemple) la r√©sultante de l&#39;action pr√©c√©dente.</li>
</ul>
<p>Voyons maintenant comment l&#39;on peut mettre en place ceci via <strong>Grunt</strong>.</p>
<h2 id="installation">Installation</h2>
<p>Tout d&#39;abord, installons <strong>Grunt</strong>. Notez que <strong>Grunt</strong> est en <em>nodejs</em> et que je consid√®re que vous avez d√©j√† <em>nodejs</em> d&#39;install√©. D&#39;autre part, nous allons cr√©er un nouveau projet <strong>npm</strong> afin d&#39;enregistrer tous les packages que vous allez installer. Je vous explique par la suite pourquoi nous faisons √ßa.</p>
<pre><code class="lang-bash">$ npm init <span class="hljs-comment">// puis plusieurs fois entr√©e</span>
</code></pre>
<p>En premier lieu, il faut installer le <em>package</em> qui permet de g√©rer <strong>Grunt</strong> en ligne de commande. C&#39;est le <em>commander</em> de <strong>Grunt</strong> en gros.</p>
<pre><code class="lang-bash">$ npm install <span class="hljs-attribute">-g</span> grunt<span class="hljs-attribute">-cli</span>
</code></pre>
<p>Une fois cela fait, installez <strong>Grunt</strong> en local dans votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-comment">$</span> <span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">grunt</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span><span class="hljs-literal">-</span><span class="hljs-comment">dev</span>
</code></pre>
<p>Ni plus ni moins, <strong>Grunt</strong> est enfin install√© dans votre projet.</p>
<h2 id="initialisation">Initialisation</h2>
<p>Maintenant, il est n√©cessaire de cr√©er un fichier de configuration <strong>Grunt</strong>. Pour cela, nous allons cr√©er un fichier nomm√© <code>Gruntfile.js</code> √† la racine de votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>touch <span class="hljs-constant">Gruntfile</span>.js
</code></pre>
<p>Fait ? Voici maintenant √† quoi doit ressembler la base d&#39;une configuration <strong>Grunt</strong>.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  <span class="hljs-comment">// Configuration de Grunt</span>
  grunt.initConfig({})

  <span class="hljs-comment">// D√©finition des t√¢ches Grunt</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, <span class="hljs-string">''</span>)

}
</code></pre>
<p>Nous avons maintenant tout le n√©cessaire pour d√©buter notre projet. Nous allons enfin pouvoir attaquer les choses s√©rieuses. Revenons un peu en arri√®re o√π nous expliquions que nous voulons en tout premier lieu compiler nos <code>.scss</code> en <code>.css</code>.</p>
<h2 id="cr-er-sa-premi-re-t-che">Cr√©er sa premi√®re t√¢che</h2>
<p>Une petite recherche sur votre moteur de recherche pr√©f√©r√© en tapant <code>grunt sass</code> et vous trouverez le projet <a href="https://github.com/gruntjs/grunt-contrib-sass"><code>grunt-contrib-sass</code></a>.</p>
<p>Toute documentation pour installer une t√¢che <strong>Grunt</strong> est indiqu√©e sur chaque <code>README.md</code> du projet mais pour un souci de clart√© et de compr√©hension, je vais tout de m√™me vous expliquer ici comment faire.</p>
<p>D&#39;abord, installons le package pour <em>Sass</em>.</p>
<pre><code class="lang-bash">$ npm install grunt<span class="hljs-attribute">-contrib</span><span class="hljs-attribute">-sass</span> <span class="hljs-subst">--</span>save<span class="hljs-attribute">-dev</span>
</code></pre>
<p>Ceci va installer le <em>package</em> <code>grunt-contrib-sass</code> dans votre dossier <code>node_modules</code> o√π vous pourrez l&#39;utiliser en l&#39;important dans votre <code>Gruntfile.js</code>.</p>
<p>Un exemple d&#39;utilisation :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {                              <span class="hljs-comment">// Nom de la t√¢che</span>
      dist: {                            <span class="hljs-comment">// Nom de la sous-t√¢che</span>
        options: {                       <span class="hljs-comment">// Options</span>
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {                         <span class="hljs-comment">// Liste des fichiers</span>
          <span class="hljs-string">'main.css'</span>: <span class="hljs-string">'main.scss'</span>,       <span class="hljs-comment">// 'destination': 'source'</span>
          <span class="hljs-string">'widgets.css'</span>: <span class="hljs-string">'widgets.scss'</span>
        }
      }
    }
  })

  <span class="hljs-comment">// Import du package</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  <span class="hljs-comment">// Red√©finition de la t√¢che `default` qui est la t√¢che lanc√©e d√®s que vous lancez Grunt sans rien sp√©cifier.</span>
  <span class="hljs-comment">// Note : ici, nous d√©finissons sass comme une t√¢che √† lancer si on lance la t√¢che `default`.</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Nous avons maintenant tout le n√©cessaire pour pouvoir compiler nos <code>.scss</code> en  <code>.css</code>.</p>
<p>Vous vous demandez peut-√™tre comment vous pouvez g√©n√©raliser vos sources plut√¥t que les d√©finir une par une. Pas de souci.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: { <span class="hljs-comment">// C'est ici que l'on d√©finit le dossier que l'on souhaite importer</span>
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<h2 id="deuxi-me-t-che-concat-ner-ses-fichiers-javascript">Deuxi√®me t√¢che : concat√©ner ses fichiers JavaScript</h2>
<p>Passons maintenant √† la concat√©nation des fichiers JavaScripts.</p>
<p>Comme pour la majorit√© des t√¢ches que vous aurez besoin avec <strong>Grunt</strong>, un <em>package</em> <strong>Grunt</strong> existe d√©j√† pour ce travail demand√©.</p>
<p>-&gt; <a href="https://github.com/gruntjs/grunt-contrib-concat"><code>grunt-contrib-concat</code></a></p>
<p>Installation : <code>npm install grunt-contrib-concat --save-dev</code> (<code>--save-dev</code> permet de sauvegarder le package dans <code>package.json</code> pour pouvoir √† tout moment le r√©installer en faisant <code>npm install</code>)</p>
<p>On ajoute alors √† notre configuration <strong>Grunt</strong> l&#39;importation de <code>grunt-contrib-concat</code> :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>); <span class="hljs-comment">// Voil√† l'ajout.</span>

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Puis on ajoute notre t√¢che :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concat√©n√©.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Ne pas oublier d&#39;ajouter la t√¢che de concat√©nation √† notre t√¢che par d√©faut :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concat√©n√©.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// ici m√™me.</span>
}
</code></pre>
<h2 id="compressons-le-tout-">Compressons le tout !</h2>
<p>Pour finir, compressons nos fichiers JavaScript ! Pour cela : <a href="https://github.com/gruntjs/grunt-contrib-uglify"><code>grunt-contrib-uglify</code></a> fera l&#39;affaire.</p>
<p>Je vous passe les d√©tails pour l&#39;installer, si vous avez bien suivi cet article, vous ne devriez avoir aucun probl√®me pour l&#39;installer.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
}
</code></pre>
<p>Ne constatez vous pas un souci ici ? Oui, nous ne voulons s√ªrement pas √† la fois concat√©ner nos fichiers et les compresser. Alors comment faire ? Pas d&#39;inqui√®tude, il suffit de cr√©er des t√¢ches d&#39;environnement ou de contexte. On pourrait par exemple cr√©er une t√¢che d√©veloppement et une t√¢che de production, qu&#39;en pensez-vous ? Pas mal non ? :)</p>
<h2 id="optimisons-">Optimisons !</h2>
<p>Supprimons alors dans un premier temps notre t√¢che par d√©faut et cr√©ons deux t√¢ches : <code>dev</code> et <code>dist</code>.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [])
}
</code></pre>
<p>Sauf que comme √ßa, vous le voyez, cela ne va pas faire grand chose, voire rien du tout. Agr√©mentons alors nos deux t√¢ches par ce qu&#39;on souhaite faire.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// C'est pas chouette √ßa ?</span>
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>]) <span class="hljs-comment">// Et hop, je compresse si je lance $ grunt dist</span>
}
</code></pre>
<p>Ha ! Nous y voil√† ! Nous avons alors deux t√¢ches <code>grunt dev</code> et <code>grunt dist</code> qui nous permettent dans tous les cas de g√©n√©rer nos css et dans un cas concat√©ner nos js, dans l&#39;autre les compresser (la compression fait aussi la concat√©nation implicitement).</p>
<p>Sauf que comme tout bon(ne) d√©veloppeur/euse, vous √™tes une grosse feignasse et compiler √† chaque fois que vous faites des modifications sur vos fichiers va vite √™tre saoulant.</p>
<p>Pour cela, une t√¢che existe, elle s&#39;appelle <code>watch</code> (via le package <a href="https://github.com/gruntjs/grunt-contrib-watch/"><code>grunt-contrib-watch</code></a>).</p>
<h2 id="regarde-ce-fichier-que-je-ne-euh-bref-">Regarde ce fichier que je ne... euh bref.</h2>
<p>Tr√®s simple, <code>watch</code> va vous permettre de &quot;regarder&quot; vos fichiers, savoir lesquels ont chang√© et donc lancer une action en fonction du type de fichiers.</p>
<p>Imaginons que l&#39;on veut par exemple compiler nos css √† chaque fois que l&#39;on change un fichier <em>Sass</em>. Ou encore que l&#39;on concat√®ne nos fichiers JavaScript d√®s que l&#39;on touche √† l&#39;un d&#39;entre eux.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>Maintenant, vous √™tes capable √† tout moment de compiler automatiquement vos fichiers en lan√ßant simplement <code>$ grunt watch</code>.</p>
<p>Oui, comprenez bien que lorsque vous ajoutez une t√¢che dans la d√©finition de la configuration de <strong>Grunt</strong>, elle est appelable directement. Typiquement, vous pouvez faire <code>$ grunt premier-niveau:deuxieme-niveau</code> soit par exemple <code>$ grunt sass:dist</code>. Vous n&#39;√™tes pas oblig√©(e) de (re)d√©finir chaque t√¢che via <code>grunt.registerTask()</code>.</p>
<p>Je ne sais pas si vous vous rappelez mais nous avions cr√©e une t√¢che de base s&#39;appelant <code>default</code>. Cette t√¢che se lance d√®s que vous ne passez aucun param√®tre √† <strong>Grunt</strong> soit <code>$ grunt</code>. Vous pouvez aussi l&#39;appeler via <code>$ grunt default</code> mais aucun int√©r√™t.</p>
<p>Tout √ßa pour dire qu&#39;il est serait s√ªrement int√©ressant de lancer la t√¢che <code>watch</code> d√®s qu&#39;on souhaite lancer <strong>Grunt</strong> √©tant donn√© que c&#39;est s√ªrement la t√¢che la plus r√©currente que vous utiliserez.</p>
<p>C&#39;est parti !</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])<span class="hljs-comment"> // Oui, je conseille de toujours compiler une fois avant de lancer watch.</span>
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>That&#39;s it. Nous avons maintenant tout le n√©cessaire pour compiler des css, du js, l&#39;optimiser, ainsi qu&#39;avoir une commande de d√©veloppement avec compilation automatique.</p>
<p>Et puisque je suis maniaque, nous allons ranger un peu :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

 <span class="hljs-comment"> // Je pr√©f√®re d√©finir mes imports tout en haut</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  var jsSrc = [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
    , jsDist = <span class="hljs-string">'dist/built.js'</span>

 <span class="hljs-comment"> // Configuration de Grunt</span>
  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      },
      dev: {}<span class="hljs-comment"> // A vous de le faire ! vous verrez que certaines options Sass sont plus int√©ressantes en mode dev que d'autres.</span>
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {<span class="hljs-comment"> // On renomme vu qu'on a pas de mode dev/dist. Dist √©tant une autre t√¢che : uglify</span>
        src: jsSrc,<span class="hljs-comment"> // Vu qu'on doit l'utiliser deux fois, autant en faire une variable.</span>
        dest: jsDist<span class="hljs-comment"> // Il existe des hacks plus int√©ressants mais ce n'est pas le sujet du post.</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {
        src: jsSrc,
        dest: jsDist
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,
        tasks: [<span class="hljs-string">'scripts:dev'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,
        tasks: [<span class="hljs-string">'styles:dev'</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'styles:dev'</span>, <span class="hljs-string">'scripts:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'styles:dist'</span>, <span class="hljs-string">'scripts:dist'</span>])

 <span class="hljs-comment"> // J'aime bien avoir des noms g√©n√©riques</span>
  grunt.registerTask(<span class="hljs-string">'scripts:dev'</span>, [<span class="hljs-string">'concat:compile'</span>])
  grunt.registerTask(<span class="hljs-string">'scripts:dist'</span>, [<span class="hljs-string">'uglify:compile'</span>])

  grunt.registerTask(<span class="hljs-string">'styles:dev'</span>, [<span class="hljs-string">'sass:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'styles:dist'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Avec √ßa, je pense qu&#39;on est pas trop mal. Il reste des optimisations √©ventuelles √† faire et nombreuses autres t√¢ches int√©ressantes peuvent √™tre ajout√©es comme <a href="https://github.com/gruntjs/grunt-contrib-jshint/">jshint</a>. Cela fera probablement office d&#39;un autre article.</p>
<p>J&#39;esp√®re que vous y voyez maintenant un peu plus clair dans <strong>Grunt</strong> ainsi que dans la compilation c√¥t√© front-end. <strong>Grunt</strong> est un excellent produit, avec une communaut√© r√©active et il est rare qu&#39;une t√¢che que vous souhaitiez mettre en place n&#39;existe pas.</p>
<p>Bon workflow !</p>

]]></description><pubDate>Sat, 16 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</guid></item><item><title>Structurer son projet avec Revel et Mgo</title><description><![CDATA[[
<p>Tu te sens l‚Äô√¢me d‚Äôun rebelle ? Tu veux tester de la techno atypique ? √áa tombe
bien, aujourd‚Äôhui on est l√† pour √ßa. On va toucher √† un sujet pas forc√©ment
majoritaire : le langage Go. Si tu ne connais pas les bases, je t‚Äôinvite √† aller
sur la <a href="http://golang.org/">homepage du projet</a> et √† parcourir le
<a href="http://tour.golang.org/">go-tour anglais</a> ou
<a href="http://go-tour-fr.appspot.com/">celui en fran√ßais</a>, c&#39;est un showcase complet du langage
(et tr√®s bien fichu).
Mais si t&#39;es juste curieux et que comprendre chaque pixel de l&#39;article n&#39;est pas
une obsession pour toi, tu devrais pouvoir voir de quoi on parle. M√™me
<a href="/#crew">Nyalab</a> y est arriv√©.</p>
<p>Dans cet article on va voir <strong>comment brancher un projet go+revel √† une base de
donn√©es mongodb</strong> et obtenir ainsi une base de travail sympa pour explorer le
d√©veloppement web avec Go.</p>
<h2 id="les-technos-utilis-es">Les technos utilis√©es</h2>
<h3 id="-golang-http-golang-org-"><a href="http://golang.org">Golang</a></h3>
<p>Langage compil√©, publi√© en 2009, commun√©ment consid√©r√© comme ‚Äúd√©sorient√© objet‚Äù,
c‚Äôest une alternative solide au C/C++ qui pr√¥ne un d√©coupage modulaire (par
‚Äúpackage‚Äù) des applications. Il est pr√©dispos√© √† une utilisation en
d√©veloppement web gr√¢ce √† un package natif de gestion des r√©seaux et du
protocole http.</p>
<h3 id="-revel-http-robfig-github-io-revel-"><a href="http://robfig.github.io/revel/">Revel</a></h3>
<p>Framework d√©velopp√© en Go et pour Go. Il int√®gre tout ce qu‚Äôil faut pour
d√©velopper une application web : rechargement du code √† chaud, gestion des urls
par routing, parsing des param√®tres GET et POST, m√©canisme de validation des
donn√©es, gestion de sessions, gestion du cache, framework de tests et m√™me
moteur de t√¢ches planifi√©es cron-likes. Il a pour particularit√© d‚Äô√™tre
compl√®tement d√©coupl√© sur la partie mod√®le et ne fourni aucun ORM ou ODM,
juste un petit module pour g√©rer des transactions sur des bases sql-like.</p>
<h3 id="-mgo-http-labix-org-mgo-"><a href="http://labix.org/mgo">Mgo</a></h3>
<p>Driver Go complet pour MongoDB, permettant d‚Äô√©tablir la connexion et d‚Äôenvoyer
des requ√™tes. Il dispose d‚Äôun m√©canisme de mapping des documents mongodb sur les
type struct de Go.</p>
<h3 id="-mongodb-http-www-mongodb-org-"><a href="http://www.mongodb.org/">MongoDB</a></h3>
<p>Base de donn√©es NoSql agile et scalable, les documents sont stock√©s au format
json dans des collections. Le requ√™tage se fait en manipulant des objets et des
fonctions javascript.</p>
<h2 id="attends-attends-pourquoi-go-">Attends, attends ... Pourquoi Go ?</h2>
<p>Le premier vrai argument, c&#39;est la <strong>performance</strong>. Sans rentrer dans
l&#39;explication hyper pouss√©e d&#39;un <a href="http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013">benchmark</a>, on peut
affirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On
va pas risquer de vexer les autres membres du crew avec des affirmations
trollesques d√®s le premier post.</p>
<p>On peut aussi ajouter que Go est un <strong>langage moderne</strong>, qui inclut toutes les
<strong>petites friandises pour attirer le d√©veloppeur</strong> curieux et assoiff√© de
qualit√©. Framework de tests et outil de mise en forme du code sont natifs et
permettent √† la techno d&#39;√©chapper aux interminables guerres de conventions :</p>
<blockquote>
<p>De toutes fa√ßons le no-newline avant &quot;{&quot; c&#39;est vraiment pour les pourritures
responsables de 99% des maux de la Terre.</p>
<ul>
<li><cite>Un √©vangeliste du PSR</cite></li>
</ul>
</blockquote>
<p>Troisi√®me argument de choix en Go : la <strong>simplicit√© de parall√©lisation</strong>.
Personne ne viendra te dire <em>&quot;√ßa c&#39;est synchrone, sry bro.&quot;</em> ou <em>&quot;√ßa c&#39;est
asynchrone, callback it bitch.&quot;</em>. Tout repose sur le mot clef qui a donn√© son
nom au langage (ou l&#39;inverse) <code>go</code>. Tu peux te faire un <code>go myFunc()</code> et paf !
Tout ce qui est appel√© dans myFunc() saute sur un thread s√©par√©. Et pour g√©rer
la synchronicit√© entre plusieurs thread il y a un m√©canisme de canaux. Ce sont
des files FIFO (the First In is the First Out) dont la lecture est bloquante
(il existe des techniques √©volu√©es pour faire du polling, cf
<a href="http://tour.golang.org/#68">gotour#68</a>).</p>
<p>Pour finir, cerise sur le gateau, <strong>Go compile vite</strong>, extr√™ment vite, et √ßa va
sauver ton int√©grit√© mentale sur les gros projets. Par contre c&#39;est foutu pour
tes pauses caf√©s aux pr√©textes douteux.</p>
<h2 id="let-s-go-nojoke-siriouz-bizness-">Let‚Äôs Go (#nojoke, siriouz bizness)</h2>
<p>On va partir du principe que tu as Go et Revel pr√™ts pour la baston. On attaque
direct √† sec par le classique ‚Äúrevel new‚Äù puisqu&#39;on va partir de la structure de
base.</p>
<pre><code class="lang-shell">$ revel <span class="hljs-keyword">new</span> github.com/OwlyCode/PutainDeProjet
</code></pre>
<p>L√† th√©oriquement, tu te retrouves avec la structure par d√©faut du boilerplate
revel, quelque chose comme √ßa:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>C‚Äôest l√† qu‚Äôon se met au boulot. On a de quoi faire un site complet avec √ßa mais
 aucune trace de gestion de base de donn√©es l√† dedans. On commence donc par
 cr√©er un dossier <code>app/modules</code> et un sous dossier <code>app/modules/mongo</code>. C‚Äôest
 dans ce dossier que va se trouver notre gestionnaire de connexion √† mongoDB.
 En fait ce n‚Äôest rien de plus qu‚Äôun binding entre Revel et Mgo. La technique
 utilis√©e pour brancher ce binding c√¥t√© Revel est celle des
 <a href="http://robfig.github.io/revel/manual/interceptors.html">interceptors</a>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> mongo

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"labix.org/v2/mgo"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-comment">// Extension du controlleur.</span>
<span class="hljs-keyword">type</span> Mongo <span class="hljs-keyword">struct</span> {
    *revel.Controller
    MongoSession  *mgo.Session
    MongoDatabase *mgo.Database
}

<span class="hljs-comment">// Stockage global de la session dont la visibilit√© est restreinte au package.</span>
<span class="hljs-keyword">var</span> session *mgo.Session

<span class="hljs-comment">// Singleton</span>
<span class="hljs-keyword">var</span> dial sync.Once

<span class="hljs-comment">// Renvoie la session mgo en cours, si aucune n'existe, elle est cr√©√©e.</span>
<span class="hljs-keyword">func</span> GetSession() *mgo.Session {

    host, _ := revel.Config.String(<span class="hljs-string">"mongo.host"</span>)

    <span class="hljs-comment">// Gr√¢ce au package sync cette fonction n'est appel√©e</span>
    <span class="hljs-comment">// qu'une seule fois et de mani√®re synchrone.</span>
    dial.Do(<span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">var</span> err error
        session, err = mgo.Dial(host)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
    })

    <span class="hljs-keyword">return</span> session
}

<span class="hljs-comment">// Alimente les propri√©t√©s affect√©es au controlleur en clonant la session mongo.</span>
<span class="hljs-keyword">func</span> (c *Mongo) Bind() revel.Result {
    <span class="hljs-comment">// Oublie pas de mettre mongo.database dans le app.conf, genre "localhost"</span>
    databaseName, _ := revel.Config.String(<span class="hljs-string">"mongo.database"</span>)

    c.MongoSession = GetSession().Clone()
    c.MongoDatabase = c.MongoSession.DB(databaseName)

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Ferme un clone</span>
<span class="hljs-keyword">func</span> (c *Mongo) Close() revel.Result {

    <span class="hljs-keyword">if</span> c.MongoSession != <span class="hljs-constant">nil</span> {
        c.MongoSession.Close()
    }

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Fonction appel√©e au chargement de l'application.</span>
<span class="hljs-comment">// Elle effectue un appel a notre fonction Bind avant</span>
<span class="hljs-comment">// chaque execution du controlleur.</span>
<span class="hljs-keyword">func</span> init() {
    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)
    revel.InterceptMethod((*Mongo).Close, revel.AFTER)
    <span class="hljs-comment">// On veut aussi fermer le clone si le controlleur plante.</span>
    revel.InterceptMethod((*Mongo).Close, revel.PANIC)
}
</code></pre>
<p>On a cr√©√© notre connexion √† mongo, mais maintenant on va aussi l‚Äôutiliser. Dans
le contr√¥leur, rien de plus simple :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

type AppController struct {
    *revel.Controller
    mongo.Mongo // Le controlleur doit √©tendre notre type Mongo.
}

func (c *AppController) Index() revel.Result {
    usersCollection := c.MongoDatabase.C(<span class="hljs-string">"users"</span>)
    // tu peux maintenant manipuler ta mgo.Collection.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p>Mais tu peux aussi l‚Äôappeler ailleurs dans le projet, par exemple dans un autre
module :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

func DoStuff(user *models.User) {
    session := mongo.GetSession()
    defer session.Close() // Oublie pas de fermer le robinet √† la fin!

    // tu peux maintenant manipuler ta mgo.Session.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p><strong>C&#39;est bien beau de copier coller mais ...</strong></p>
<p>... tu te demandes certainement pourquoi on a cr√©√© un dossier <code>app/modules</code>, si
c‚Äôest pour n‚Äôy mettre qu‚Äôun sous dossier mongo dedans. Et c‚Äôest une tr√®s bonne
question. En fait, notre dossier mongo repr√©sente un module du projet bien
d√©limit√©. A l‚Äôavenir, si tu veux aussi brancher du mysql, et bien y a juste √†
cr√©er <code>app/modules/mysql</code>. Rien ne change pour l‚Äôexistant et tu ne pollues pas
la racine de ton projet. L‚Äôautre avantage c‚Äôest qu‚Äôen un coup d‚Äôoeil dans ce
dossier tu as un aper√ßu direct des features de l‚Äôapplication.</p>
<p>Enfin, l&#39;approche module, c&#39;est aussi un gage de MVC. Admettons qu&#39;on veuille
coder une application de facturation, il nous suffit de cr√©er un dossier
<code>app/modules/invoicing</code> et de travailler dans ce dossier sur toute la partie
m√©tier. Comme par exemple le calcul des totaux, le calcul de la TVA etc... Gr√¢ce
 √† cette approche, on garde des contr√¥leurs tr√®s fins et restreints √† ce que
 doit √™tre leur r√¥le premier : faire communiquer le mod√®le et la vue.</p>
<h2 id="mod-les-globaux-mod-les-locaux">Mod√®les globaux, mod√®les locaux</h2>
<p>J‚Äôai √©voqu√© plus haut dans la liste des technos une feature hyper sexy de mgo :
le mapping des documents mongodb en json sur les types struct. Ce qui veut dire
qu‚Äôavec mgo, on peut d√©finir des mod√®les bien structur√©s. Certains seront
communs √† toute l‚Äôapplication, par exemple un utilisateur, mais d‚Äôautres seront
sp√©cifiques √† un module, comme par exemple une facture.</p>
<p>Une bonne pratique est d‚Äôapprocher le rangement des mod√®les selon cette
structure:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li><strong>models</strong></li>
<li>modules<ul>
<li>invoicing<ul>
<li>engine</li>
<li><strong>models</strong></li>
</ul>
</li>
<li>mongo</li>
</ul>
</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>Le but du jeu √©videmment c&#39;est d&#39;avoir le moins de mod√®les globaux possibles.
Id√©alement, si le dossier <code>app/models</code> n&#39;existe pas ce n&#39;est pas plus mal. Mais
attention √† ne pas chercher √† l&#39;√©liminer au prix de la modularit√© du code. Il
vaut mieux avoir un mod√®le explicitement d√©clar√© comme global plutot que de
l&#39;isoler dans un module et de rendre tous les autres modules du projet
d√©pendants de ce dernier.</p>
<p>Pourquoi c&#39;est important ? C&#39;est surtout parce que √ßa pose les bonnes questions
et am√®ne les bonnes remarques. &quot;Vais-je avoir besoin de ce mod√®le r√©ellement
PARTOUT ?&quot;, &quot;C&#39;est √©trange j&#39;ai cr√©√© deux modules mais au final je passe mon
temps √† faire des va-et-vient de l&#39;un √† l&#39;autre... Peut √™tre que je devrais les
fusionner.&quot; ou encore &quot;90% de mon projet se trouve dans un seul module, il y a
peut √™tre un probl√®me.&quot;. Mais au del√† de √ßa, √ßa te permets d&#39;isoler des modules
quasi autonomes (deux ou trois coups d&#39;abstraction avec des interfaces et √ßa
roule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les
r√©utiliser sur un autre (svn include pour les anc√™tres, git submodules pour les
autres).</p>
<h2 id="pour-aller-plus-loin">Pour aller plus loin</h2>
<p>Isoler distinctement le gestionnaire de connexion, la logique m√©tier et les
mod√®les dans des modules est une premi√®re √©tape vers une architecture propre et
√©volutive. Tu peux m√™me pousser √ßa plus loin en utilisant des interfaces comme
je l&#39;ai bri√®vement mentionn√© un peu plus t√¥t, c&#39;est m√™me d&#39;ailleurs ce que je te
conseille. Si tu veux creuser ce sujet l√† tu trouveras pas mal de monde qui s&#39;y
int√©resse en fouinant sur le
<a href="https://groups.google.com/forum/#!forum/Golang-Nuts">groupe de discussion des utilisateurs golang</a>.
Tu as par exemple ce gars l√† qui a
<a href="https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ">remplac√© sa d√©pendance √† la librairie mgo par des interfaces</a>
pour √©viter d&#39;inclure le package a chaque fois et faciliter ses tests. Tu peux
envisager de faire la m√™me chose pour d√©coupler tes mod√®les et la logique m√©tier
.</p>
<p>En attendant il ne me reste qu&#39;√† te souhaiter une bonne coding night, tu as
toutes les armes n√©cessaires pour g√©rer mongo dans ton projet revel. ;-)</p>

]]></description><pubDate>Mon, 11 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</link><guid isPermaLink="true">http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</guid></item><item><title>Vagrant, enlarge your VM</title><description><![CDATA[[
<p>Vagrant, au cas o√π tu ne conna√Ætrais pas encore, permet de fournir des
environnements de d√©veloppements reproductibles, facilement configurables et
qui se partagent entre les membres de l‚Äô√©quipe. En gros, tu vas pouvoir d√©crire
et configurer des machines virtuelles (VM) depuis un seul fichier texte,
le <code>Vagrantfile</code>.  Plut√¥t pratique pour avoir un environnement de dev
√©quivalent √† celui de la prod. Et tout cela avec un processus simplifi√©
√† l&#39;extr√™me.</p>
<h1 id="et-c-est-pour-qui-le-beau-joujou-">Et c‚Äôest pour qui le beau joujou ?</h1>
<p>Vagrant s‚Äôadresse principalement √† toi, mais aussi √† un public
de <strong>d√©veloppeurs</strong> qui souhaitent pouvoir mettre en place rapidement
un environnement de dev avec une machine virtuelle (genre apache-php-<em>sql)
sans y passer trop de temps.
Vagrant, c‚Äôest aussi pour des <em>*devops</em></em> qui voudraient tester la mise en
place et le provisioning de leur infra.
Dans la doc, ils disent m√™me que √ßa s‚Äôadresse aux designers
(pour dire si c‚Äôest simple) mais faut pas d√©conner non plus,
on a jamais vu un designer d√©gainer une console :)</p>
<p>Globalement le workflow vagrant se r√©sume √† 2-3 commandes,</p>
<ol>
<li><code>vagrant init</code> au d√©but du projet
Puis</li>
<li><code>vagrant up</code> pour lancer la VM.</li>
<li><code>vagrant halt</code>pour l‚Äôarr√™ter.</li>
</ol>
<h1 id="etape-1-vagrant-init">Etape 1 - vagrant init</h1>
<p>Vagrant fournit un support pour les principales plateformes de virtualisation,
appel√©es Provider dans la langue de Justin Bieber et avec par d√©faut celui
pour virtualbox.  Et  cerise sur le clafoutis, tu as aussi la possibilit√©
de configurer / provisionner tes box avec des scripts Chef ou Puppet
(ou juste un script shell si t‚Äôes old-school \o/ ).</p>
<p>Bon, je suppose que c‚Äôest encore un peu flou, alors voil√† comme √ßa se pr√©sente.
Une fois install√© ( <a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a> ), tu devrais avoir
une nouvelle commande de dispo.
Alors d√©gaine ton terminal et envoie un <code>vagrant init</code>. √áa devrait cr√©er
un fichier <code>Vagrantfile</code>  qui va d√©crire ta machine virtuelle
(ne t‚Äôinqui√®te pas, c‚Äôest juste √©crit en Ruby).
En gros de quelle box de base tu pars, comment tu la configures (r√©seaux,
dossier partag√© entre la VM et le Host, ta machine r√©elle) et comment tu
la provisionnes (via un shell, avec un script Puppet...)</p>
<h2 id="la-config-de-la-box">La config de la box</h2>
<p>Ensuite voil√† les quelques points √† param√©trer.</p>
<ul>
<li><code>config.vm.box = &quot;base&quot;</code>pour sp√©cifier le nom d‚Äôune box pr√©alablement
t√©l√©charg√©e.</li>
<li><code>config.vm.box_url = &quot;http://domain.com/path/to/above.box&quot;</code> Tu remplaces
par l‚Äôurl de la box de tes r√™ves. Tu peux trouver une liste assez compl√®tes
de box plus ou moins configur√©es sur le site <a href="http://www.vagrantbox.es/">http://www.vagrantbox.es/</a>
( ProTip‚Ñ¢: Choisis bien le provider correspondant √† ton gestionnaire de VM)</li>
<li><code>config.vm.network :forwarded_port, guest: 80, host: 8080</code> Pratique
pour acc√©der au serveur qui tourne sur la VM. Apr√®s tu retrouves un peu
les m√™mes options de config r√©seaux qu‚Äôavec virtualbox
(r√©seaux priv√©s, connexion par pont...)</li>
<li><code># config.vm.synced_folder &quot;../data&quot;, &quot;/vagrant_data&quot;</code> Avec √ßa,
tu vas pouvoir ajouter un r√©pertoire qui sera partag√©
avec ta machine virtuelle.
Par d√©faut, Vagrant te permet d‚Äôacc√©der au r√©pertoire courant
depuis <code>/home/vagrant</code> dans la VM.</li>
</ul>
<h2 id="le-provisioning-de-box">le provisioning de box</h2>
<p>Alors attention, c&#39;est un des trucs cools avec vagrant. Avant, quand tu
voulais te monter une VM pour travailler, il fallait aussi la configurer,
installer les bonnes versions de chaque brique que le projet utilis√©. √áa‚Äé
pouvait √™tre long, p√©nible, et surtout prendre du temps.
Avec Vagrant, tu peux automatiser cette partie, soit en utilisant simplement
un script, soit avec un moyen moderne comme Chef ou Puppet. Et si jamais t&#39;as
besoin d&#39;un truc particulier, une config que tu utilises souvent, tu peux
toujours packager la box que t&#39;as configur√© avec amour pour pouvoir la
r√©utiliser d√®s que l&#39;occasion se pr√©sente. Sinon tu peux d√©j√† trouver pas mal
de box d√©j√† pr√™tes √† l&#39;emploi, avec ou sans support pour puppet, chef...</p>
<p>La suite du fichier contient des exemples de type de provisioning
(Puppet, Chef solo ou Chef server)
Et si jamais tu souhaites lancer un script de provisioning :</p>
<pre><code class="lang-ruby">Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-built_in">do</span> |config|
  config.vm.provision <span class="hljs-string">"shell"</span>, path: <span class="hljs-string">"provision.sh"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre>
<blockquote>
<p>Vagrant te permet aussi de cr√©er tes propres box d√©j√† provisionn√©es via
la commande vagrant package. C‚Äôest assez pratique quand tu dois
t√©l√©charger-compiler-installer tout l‚Äôinternet</p>
</blockquote>
<h1 id="etape-2-vagrant-up">Etape 2 - vagrant up</h1>
<p>Bon, la premi√®re fois risque de prendre du temps, parce que vagrant
va t√©l√©charger ta box, puis lancer le provisioning. Profites-en pour faire
un tour sur <a href="http://vim-adventures.com/">http://vim-adventures.com/</a> et jouer un peu en attendant.</p>
<p>Une fois termin√©, tu as maintenant une box dispo avec laquelle travailler.</p>
<h1 id="etape-3-joie-o-">Etape 3 - Joie \o/.</h1>
<p>Je pensais faire une troisi√®me partie sur comment arr√™ter la VM mais
√ßa pr√©sente pas vraiment d‚Äôint√©r√™t car √ßa tient en une ligne de commande.</p>
<p>Bref, le point important de tout √ßa, c‚Äôest que les autres relous de ton √©quipe
ne pourront plus dire que pourtant √ßa marche bien chez eux, et qu‚Äôils
comprennent pas, c‚Äôest vraiment √©trange... enfin sauf s&#39;ils sont
de mauvaise foi :)</p>
<ul>
<li>L‚Äôint√©grateur n‚Äôaura plus √† se taper 14 installations de trucs en
ligne de commande qu‚Äôil ne retient jamais, pour rajouter un bout de css
ou de js.
(ProTip‚Ñ¢: l√†, √ßa rentre sur un post-it !)</li>
<li>Le dev backend n‚Äôaura plus √† pleurer quand on lui demande de remettre le nez
dans une projet vieux de 2 ans avec que des versions de php / ruby ou mysql
d√©pass√©es qui vont casser la superbe config qu‚Äôil a mis 1 semaine √† fignoler
avec les derni√®res techno √† la mode.</li>
<li>l‚Äôadmin sys pourra packager les box de chaque projets, provisionn√©es
et configur√©es et pour √©viter d‚Äôavoir √† configurer les postes des autres
dev √† chaque changement de projet.</li>
</ul>
<h1 id="quelques-commande-pratiques">Quelques commande pratiques</h1>
<blockquote>
<p><code>vagrant ssh</code> te permet de te connecter en mode terminal
<code>vagrant status</code> pour les t√™tes <del>√† claques</del> en l‚Äôair</p>
</blockquote>
<h1 id="quelques-liens">Quelques liens</h1>
<ul>
<li><a href="http://docs.vagrantup.com/v2/">la documentation officielle de <del>viagra</del> vagrant</a></li>
<li><a href="https://github.com/putaindecode/propositions-de-posts/issues/4">Virtualisation sur OSx et acc√®s √† localhost</a></li>
<li><a href="http://jolicode.com/blog/cuisinez-vos-serveurs-comme-un-chef-premiere-partie">Cuisinez vos serveurs comme un Chef ‚Äì Premi√®re partie</a></li>
</ul>

]]></description><pubDate>Fri, 08 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/env/vagrant-enlarge-your-vm/</link><guid isPermaLink="true">http://putaindecode.fr/posts/env/vagrant-enlarge-your-vm/</guid></item><item><title>HTML¬†? H√¢che-Th√©-Aime-Elle vous dites¬†?</title><description><![CDATA[[
<p>Ahh, le HTML. LE <a href="http://fr.wikipedia.org/wiki/HTML">H.T.M.L</a>. Sacr√© langage hein ?</p>
<p>On le connait tous ce fameux truc qu&#39;on retrouve dans pas mal d&#39;URLs : <code>.html</code>.
Oui d&#39;accord par le pass√© on avait l&#39;extension de radin <code>.htm</code>, mais elle n&#39;a
clairement pas dur√©.</p>
<p>Vous vous demandez d√©j√† ce qu&#39;il-y-a √† raconter sur l&#39;HTML peut √™tre ? Et bien,
je ne suis pas l√† pour vous apprendre toutes les balises, leurs enfants, parents,
les cousins cousines, patati patata‚Ä¶ Ah √ßa non, j&#39;ai autre chose √† faire,
et vous aussi. Et si c&#39;est ce que vous cherchez, vous trouverez ce qu&#39;il vous
faut sur <a href="http://docs.webplatform.org/wiki/html/elements">tout</a>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element">un</a>
<a href="http://www.w3.org/html/wg/drafts/html/CR/dom.html#elements">tas</a>
<a href="http://en.wikipedia.org/wiki/HTML_element">d&#39;autres</a>
<a href="http://www.vectorskin.com/referentiels-standards-w3c/balises-html5/">sites</a>.</p>
<p>Ce que je vais faire par contre, c&#39;est tenter de partager un document s√©rieux
(dans le fond hein) avec tout pleins de conseils super pertinents pour que vous
√©criviez de l&#39;HTML comme personne.
Non je d√©conne. En fait, √ßa va √™tre la grosse marrade avec les trucs
les plus nazes que je peux vous raconter. C&#39;est parti mon jQu√©ri.</p>
<h2 id="l-ancien-testament">L&#39;ancien testament</h2>
<p>Si vous avez ouvert ne serait-ce que quelques documents HTML dans votre vie,
vous avez du croiser ce qu&#39;on appelle un <a href="http://fr.wikipedia.org/wiki/Doctype">doctype</a>
qui ressemble √† √ßa:</p>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
</code></pre>
<p>Vous pourrez remarquer dans ce <del>petit</del> gros bout de code bien relou qu&#39;il y&#39;a
une <a href="http://fr.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a>:
c&#39;est tout simplement la DTD (doctype) du langage en question.
Avec les sp√©cifications pour la validation, toussa toussa‚Ä¶
Si vous avez 2 minutes, allez jeter un coup d&#39;oeil.</p>
<p>Je ne vais pas vous le cacher, et m√™me si en th√©orie, par h√©ritage de SGML/XML
√ßa part d&#39;une bonne intention, dans la pratique √ßa sert juste √† se toucher la
nouille sur la validation.
Car aujourd&#39;hui HTML (5) n&#39;est clairement plus du XML.</p>
<p>Oui bon ok, moi m√™me √† une √©poque j&#39;ai eu ma passe o√π je collais ce petit badge
partout dans mes footers:</p>
<figure>
  <a href="http://validator.w3.org/check?uri=referer">
    <img src="http://www.w3.org/Icons/valid-xhtml10"
        alt="Valid XHTML 1.0 Transitional" height="31" width="88" />
  </a>
  <figcaption>√áa p√®te la classe hein ?</figcaption>
</figure>

<p>Mais bon les conneries, √ßa va un moment.
Pour info, j&#39;ai du valider le code suivant pour obtenir ce logo:</p>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Ben dites donc, c&#39;est propre tout √ßa. Un petit document tout vide mais d√©j√†
bien rempli.
Mais attendez en 2013, on peut pas faire mieux ? Oh si !</p>
<h2 id="le-nouveau-testament">Le nouveau testament</h2>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
</code></pre>
<p>Il faut savoir qu&#39;un simple document <em>valide</em>, peut se r√©sumer √† √ßa.
Oui oui mes cocos, ce document est parfaitement valide. Voil√† j&#39;voulais vous le
dire. Arr√™tez d&#39;utiliser des doctypes dans tous les sens, √ßa ne sert √† rien.
Sachant la qualit√© du code qu&#39;on trouve sur les internets, les navigateurs
s&#39;arr√™tent au parsing lorsqu&#39;ils voient √ßa <code>&lt;!doctype html</code>
(C&#39;est <a href="http://paulrouget.com/">Paul Rouget</a> qui me l&#39;a dit, je le crois donc
sur parole).
Et apr√®s ma petite parenth√®se ci dessous, je vais vous expliquer pourquoi.</p>
<p>Car je sais ce que certains vont me r√©torquer.</p>
<blockquote>
<p>Oui mais moi monsieur, je valide en <strong>XHTML 1.1 Strict Turbo X Prime Ultra</strong><br />
Puis ton document valide l√†, il sera valide quand HTML5 sera finalis√©‚Ä¶</p>
</blockquote>
<p>Dans un sens ils n&#39;auraient pas tort. Mais dans la pratique, les navigateurs
s&#39;en contre branlent de savoir quel type d&#39;HTML vous utilisez
<small>(√† moins que vous aimiez jouer avec la mort et que vous utilisez le
prologue XML lorsque vous servez de l&#39;XHTML‚Ä¶)</small>.
Car quand bien m√™me vous utilisez un doctype √† rallonge, il est tout √† fait
possible que vous vous chiiez, et que vous laissiez des erreurs.
Oui, l&#39;erreur est humaine‚Ä¶
Puis HTML 5 est d√©j√† bien impl√©ment√© dans les grandes lignes. Et √ßa car il est
presque r√©trocompatible.
Vous devriez le comprendre d&#39;ici la fin de cet √©crit. Ou pas. Mais je vous le
dit, il a √©t√© pens√© dans ce sens.</p>
<p>Revenons √† la validation. Du coup √† quoi √ßa sert de valider ?
On va voir √ßa par un exemple digne des plus grands dipl√¥mes.</p>
<h2 id="ce-p-fout-la-merde-">Ce <code>&lt;p&gt;</code> fout la merde.</h2>
<p>Prenons le code suivant:</p>
<pre><code class="lang-html"><span class="xml"><span class="vbscript"></span></span><span class="hljs-expression">{{<span class="hljs-variable">include</span> <span class="hljs-string">"src/posts/html/hache-the-aime-elle-vous-dites/notvalid.html.hbs"</span>}}</span><span class="xml"><span class="vbscript"></span></span>
</code></pre>
<p>Certains d&#39;entre vous ont du remarquer la coquille.
Celle-l√†, mes √©l√®ves qui d√©couvrent le HTML me la font √† chaque fois lorsqu&#39;ils
codent leur super CV
(super exercice tavu, ils appr√©cient particuli√®rement le titre).</p>
<p>Toi l√† au fond, t&#39;as pas rep√©r√© le souci encore ?</p>
<p>Regarde plut√¥t le rendu:</p>
<iframe
  class="putainde-Post-iframe"
  height="350"
  src="/posts/html/hache-the-aime-elle-vous-dites/notvalid.html">
</iframe>

<blockquote>
<p>WAT ?
ET MON MARGIN BOTTOM KESSIF√âL√Ä EN DEUBEULE ?</p>
</blockquote>
<p>Le rapport avec la validation me direz-vous ? Et bien plut√¥t que de perdre du
temps √† comprendre le pourquoi du comment, en validant le code ci dessus,
l&#39;erreur vous est implicitement expliqu√©e
(oui ce code n&#39;a qu&#39;une seule erreur √† la validation).</p>
<blockquote>
<p>Line 17, Column 4: <strong>No p element in scope but a p end tag seen.</strong></p>
</blockquote>
<p>Typiquement, il faut savoir comprendre un message d&#39;erreur et savoir lire entre
les lignes. Pas faire &quot;mais monsieur, j&#39;comprends pas l√†&quot; (d&#39;ailleurs mes √©l√®ves
valident tous leur code, pour apprendre sur le tas, c&#39;est une bonne fa√ßon).</p>
<p>Celui l√† nous dit en gros : <em>je ne vois pas d&#39;element <strong>p</strong> √† fermer dans le coin</em>.
Ca veut dire que‚Ä¶ √áa veut dire que mon <strong>p</strong> ouvert n&#39;est pas reconnu ?
Mais attend qu&#39;est-ce que c&#39;est que cette histoire ?!</p>
<p>Si vous prenez 10 secondes pour inspecter ce code, vous allez vite vous
aper√ßevoir qu&#39;il est pars√© ainsi:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
</code></pre>
<p><em>Mais qu&#39;est-ce que‚Ä¶ ? Hein ? Mais ? Quoi ? Comment ?</em></p>
<p>Oui vous avez bien vu. L&#39;HTML est pars√© n&#39;importe comment. Enfin non il est pars√©
comme il peut, au mieux.
Je pense que l√† vous commencez √† comprendre ?</p>
<p>Ce que j&#39;essaye de vous montrer par l√†, ce qu&#39;il faut toujours faire attention
entre ce qu&#39;on √©crit et ce qu&#39;on pense avoir comme r√©sultat, m√™me avec du
<em>simple</em> HTML.</p>
<p><strong>Bon apr√®s j&#39;esp√®re qu&#39;en 2013, vous avez tous le r√©flexe d&#39;inspecter
l&#39;HTML d√®s que vous avez un truc bizarre en CSS ou en JavaScript‚Ä¶ Si
c&#39;est pas encore le cas, prenez l&#39;habitude.</strong></p>
<h2 id="mais-du-coup-le-navigateur-il-fait-n-importe-quoi-">Mais du coup le navigateur il fait n&#39;importe quoi ?</h2>
<p>Le navigateur essaye clairement de faire au mieux.
Si vous inspectez l&#39;exemple pr√©c√©dent, vous vous apercevrez aussi que je n&#39;ai
mis aucune balise <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code> ou <code>&lt;body&gt;</code>.
Pourquoi ? Ben car le parseur le fait √† ma place.
Mais pourquoi il fait √ßa ?
Tout simplement car on oublie (tr√®s - trop ?) souvent de bien √©crire.
Comme quand j&#39;√©cris en.</p>
<p>La balise <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/tbody"><code>&lt;tbody&gt;</code></a>
est un bon exemple.
Si vous inspectez vos tableaux HTML, vous verrez vite fait que cette balise, que
quasiment personne ne connait/utilise, est pourtant n√©cessaire/utile.
Mais du coup, si je me fais une petite requ√™te JavaScript
<code>document.querySelectorAll(&#39;table &gt; tr&#39;)</code>,
il est fort possible que je n&#39;aie pas ce que je souhaite.
<a href="http://codepen.io/MoOx/pen/esFjx">La preuve</a>.</p>
<p>Voyons une autre exemple: mettons nous √† la place d&#39;un navigateur si,
alors que je suis en XHTML 1.1 Strict, je lui glisse une balise <code>&lt;center&gt;</code>.</p>
<ul>
<li><p><strong>Cas 1.</strong> Je n&#39;ai pas fait attention au doctype et je veux vraiment une balise
<code>&lt;center&gt;</code> : bah l√†, rien √† dire √† part <em>Merci</em>. Le navigateur essaye clairement
de faire au mieux, et dans un cas comme celui l√†, on ne peut que le remercier.</p>
</li>
<li><p><strong>Cas 2.</strong> Je sais exactement dans quel doctype je suis, j&#39;ai conscience de ce
que je fais: je joue au con, tant pis pour ma gueule !</p>
</li>
</ul>
<p>Dans tous les cas, le navigateur va laisser passer cette balise au cas o√π que.
Puis bon faut avouer que c&#39;est super pratique cette balise hein ?
Comme <code>&lt;blink&gt;</code> et <code>&lt;marquee&gt;</code> quoi. ‚ù§</p>
<figure>
  <img src="../../../images/posts/memes/canthandlemyswag.gif" alt="Can&#39;t handle my swag">
  <figcaption><marquee>Marquee for the win.</marquee></figcaption>
</figure>

<h2 id="note-de-service">Note de service</h2>
<p>S&#39;il vous pla√Æt mesdames messieurs, lorsque vous faites du CSS inline, ou que
vous incorporez un JavaScript, arr√™tez vous √† des choses simples,
qui fonctionnent :</p>
<ul>
<li><p><code>&lt;style&gt;</code> suffit. Pas besoin de mettre un type, un langage etc. Et √ßa vous
√©vitera des <a href="http://codepen.io/MoOx/pen/sEzuJ">prises de t√™tes √† la con</a>.
Puis vous avez d√©j√† utilis√© autre chose que du CSS vous ?!</p>
</li>
<li><p><code>&lt;script&gt;</code>, idem, m√™me sur IE 6.
Pareil que pr√©c√©dement, pas besoin de mettre un hideux
<code>&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript 1.1&quot;&gt;</code>.
La moindre faute de frappe ne pardonne pas.
Aucun int√™ret de se fatiguer, sauf si votre <a href="https://code.google.com/p/ruby-in-browser/">script n&#39;est pas du JavaScript</a>.</p>
</li>
</ul>
<h2 id="le-mot-de-la-fin">Le mot de la fin</h2>
<p>Ne soyez jamais s√ªr de vous, que ce soit pour √©crire de l&#39;HTML ou faire une mise
en prod&#39; un vendredi soir √† <a href="http://www.miximum.fr/le-bug-de-17h30.html">17h30</a>.
Faites pas les malins. Ne sous-estimez pas HTML.
Si √ßa merde quelque part, v√©rifiez plus loin que le bout de votre nez, que votre
r√®gle CSS qui marche pas, ou votre morceau de JavaScript bugg√©.</p>
<h2 id="-aller-plus-loiiin-allez-plus-haaauuut-https-www-youtube-com-watch-v-bcylqudsn5g-t-39s-"><a href="https://www.youtube.com/watch?v=BCYLQUdsN5g&amp;t=39s">Aller plus loiiin, allez plus haaauuut‚Ä¶ !</a></h2>
<ul>
<li><a href="https://github.com/necolas/idiomatic-html" lang="en">idiomatic-html</a>
(<a href="http://fr.wikipedia.org/wiki/Idiomatique">ceci n&#39;est pas une contraction d&#39;<em>idiot</em> et d&#39;<em>automatique</em></a>).</li>
<li><a href="https://github.com/necolas/idiomatic-css" lang="en">idiomatic-css</a> (traduction incluse)</li>
<li>Validation automatique dans un workflow Grunt:<ul>
<li><a href="https://github.com/praveenvijayan/grunt-html-validation">praveenvijayan/grunt-html-validation</a></li>
<li><a href="https://github.com/jzaefferer/grunt-html">jzaefferer/grunt-html</a> (bas√© sur validator.nu)</li>
</ul>
</li>
</ul>

]]></description><pubDate>Thu, 07 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/html/hache-the-aime-elle-vous-dites/</link><guid isPermaLink="true">http://putaindecode.fr/posts/html/hache-the-aime-elle-vous-dites/</guid></item><item><title>Versionner avec Git</title><description><![CDATA[[
<p>Chez Putain de Code, on aime se servir de <a href="http://git-scm.com/">Git</a> (et de GitHub, mais
c&#39;est une autre histoire), m√™me si certains d&#39;entre nous (comme Lionel) ne s&#39;en
servent pas forc√©ment bien.</p>
<p>Pour √©viter ce genre de m√©saventures, on s&#39;est dit qu&#39;on allait consacrer une
s√©rie d&#39;articles √† ce merveilleux gestionnaire de versions, et de vous en faire
profiter par la m√™me occasion.</p>
<p>Et si Git permet de faire √† peu pr√®s ce qu&#39;on veut sur un d√©p√¥t, vous verrez
qu&#39;on peut assez facilement r√©parer ses erreurs (et m√™me celles des autres
parfois !).</p>
<h2 id="c-est-quoi-git-">C&#39;est quoi Git ?</h2>
<p>Si vous √™tes un d√©veloppeur un tant soit peu consciencieux, vous utilisez un
gestionnaire de versions pour suivre l&#39;√©volution de votre code. Non,
<a href="http://roland.entierement.nu/blog/2008/01/22/cpold-la-poudre-verte-du-suivi-de-versions.html">CPOLD</a> n&#39;est pas un gestionnaire de versions.</p>
<p>Git, c&#39;est un gestionnaire de versions d√©centralis√©, aussi connu sous le terme
de DVCS (pour Distributed Version Control System) pour les amateurs.</p>
<p>Le terme <em>distribu√©</em> est tr√®s important car c&#39;est ce qui le diff√©rencie d&#39;autres
gestionnaires historiquement plus connus comme Subversion (SVN) ou le v√©n√©rable
CVS.</p>
<p>√áa veut dire que chaque d√©veloppeur poss√®de sa propre copie du d√©p√¥t, chez lui,
localement, contra√Ærement √† un gestionnaire centralis√© ou tout est‚Ä¶ centralis√©
sur un m√™me serveur (merci Captain Obvious).</p>
<p>Git est principalement utilisable en ligne de commande, mais il existe des
interfaces graphiques sous les principaux OS du march√© (OS X, Linux, Windows).
Ici on va traiter de la ligne de commande, car c&#39;est l&#39;arme de base du bon
d√©veloppeur.</p>
<p>Je vous passe l&#39;installation, r√©f√©rez-vous √† la documentation officielle pour
cette partie. (√áa se r√©sume souvent √† un <code>nom-du-package-manager install git</code>)</p>
<h2 id="comment-a-marche-">Comment √ßa marche ?</h2>
<p>Avant d&#39;attaquer la partie pratique, on va s&#39;attarder un peu √† comment Git
fonctionne, parce qu&#39;√† mon sens c&#39;est essentiel pour comprendre rapidement ce
qu&#39;il est possible de faire et pour se construire un mod√®le mental des
op√©rations.</p>
<p>Dans Git les commits sont tous reli√©s avec leur(s) parent(s) comme les maillons
d&#39;une cha√Æne qui pourrait avoir des bifurcations. Chaque commit stocke des
informations sur l&#39;√©tat du d√©p√¥t √† un instant donn√© (l&#39;√©tat complet, pas
uniquement un diff).</p>
<p>On construit cette cha√Æne et ses bifurcations en cr√©ant des commits, en
branchant et en fusionant une branche dans une autre.</p>
<p>Enfin, une derni√®re chose que vous devez garder en t√™te c&#39;est qu&#39;un commit est
d√©finitif dans le sens ou on ne pourra jamais modifier son contenu (on pourra
par contre le remplacer par un autre). Comme il est unique, il a un num√©ro qui
est un hach√© <code>SHA1</code> de diverses informations.</p>
<p>Ces <code>SHA1</code> sont utilis√© √† foison, habituez-y vous !</p>
<p>Voil√†, maintenant sortons nous les doigts et regardons comment √ßa marche
concr√®tement.</p>
<h2 id="cr-er-ou-r-cup-rer-un-repo">Cr√©er ou r√©cup√©rer un repo</h2>
<p>Il y a deux mani√®res de cr√©er un d√©p√¥t Git : soit on en veut un tout neuf et on
utilise <code>git init</code>, soit on veut cloner un d√©p√¥t d√©j√† existant et on utilise le
bien nomm√© <code>git clone</code>.</p>
<p>Appell√© sans argument, <code>git init</code> initialise un d√©p√¥t dans le dossier courant,
on peut lui passer un nom de d√©p√¥t en argument pour le cr√©er dans un
sous-dossier sp√©cifique du dossier courant.</p>
<p>Du c√¥t√© de <code>git clone</code>, on va passer l&#39;adresse d&#39;un d√©p√¥t, et optionnellement un
nom local pour le d√©p√¥t. Il va r√©cup√©rer le d√©p√¥t √† l&#39;adresse sp√©cifi√©e (c&#39;est
bien foutu hein ?) puis le mettre soit dans un dossier du m√™me nom soit dans un
dossier du nom sp√©cifi√© en dernier argument.</p>
<p>Par exemple, si je veux cloner le d√©p√¥t du site :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git clone <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/putaindecode</span><span class="hljs-regexp">/website.git</span>
</code></pre>
<p>√áa va cr√©er un dossier <code>website</code> avec le contenu du d√©p√¥t.</p>
<p><code>clone</code> accepte plusieurs types d&#39;adresse : HTTP(S), SSH, protocole Git d√©di√© et
m√™me des chemins locaux pour cloner un d√©p√¥t situ√© ailleurs sur le syst√®me de
fichiers.</p>
<p>Pour la suite, il va falloir se placer dans un d√©p√¥t avec le petit <code>cd</code> qui va
bien pour lancer les vraies commandes int√©ressantes de Git.</p>
<h2 id="premiers-commits">Premiers commits</h2>
<p>Pour commencer √† s&#39;amuser, √©crivez un bout de code dans un fichier et
sauvegardez le :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>cat &gt; putain_de_hello_world.rb
puts <span class="hljs-string">"Hello, putain de codeur !"</span>
^<span class="hljs-constant">D</span>
</code></pre>
<p>On va tout se suite introduire l&#39;un des concepts d√©routants de Git, <em>l&#39;Index</em>.
Git utilise trois zones distinctes pour les fichiers : le dossier de travail
(<em>Working Dir</em>) qui contient les fichiers dans leur version actuelle, <em>l&#39;Index</em>
qui permet de stocker les modifications et <code>HEAD</code> qui pointe vers le dernier
commit.</p>
<p>L&#39;id√©e, c&#39;est qu&#39;on peut modifier les fichiers comme on le souhaite, et
constuire le commit avec seulement les modifications que l&#39;on souhaite voir
appara√Ætre.</p>
<p>Cette possibilit√© permet d&#39;avoir des commits atomiques, c&#39;est √† dire qui
introduisent une modification simple. √áa √©vite de se retrouver avec un commit
mammouth qui change tout le programme d&#39;un coup et qui est un enfer pour le
futur d√©veloppeur qui revient sur le code et qui cherche √† comprendre la logique
de sa construction. Ce d√©veloppeur, c&#39;est vous dans 1 ou 2 semaines.</p>
<p>Pour info, vous verrez parfois <em>l&#39;Index</em> appell√© <em>Staging Area</em>, ou encore
<em>Cache</em>.</p>
<p>Git fournit des commandes pour passer les fichiers d&#39;un √©tat √† l&#39;autre. Elles
sont certes parfois un peu obscures, mais dans l&#39;ensemble c&#39;est pas si
difficile.</p>
<p>Dans notre cas, notre fichier n&#39;est m√™me pas encore suivi par Git ! Vous pouvez
v√©rifier √ßa en utilisant <code>git status</code>, dont vous ne pourrez bient√¥t plus vous
passer :</p>
<pre><code class="lang-bash">$ git status
<span class="hljs-preprocessor"># Sur la branche master</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Validation initiale.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Fichiers non suivis:</span>
<span class="hljs-preprocessor">#   (utilisez "git add &lt;fichier&gt;..." pour inclure dans ce qui sera valid√©)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor">#    putain_de_hello_world.rb</span>
Aucune modification index√©e mais des fichiers non suivis sont pr√©sents (utilisez <span class="hljs-string">"git add"</span> pour les suivre)
</code></pre>
<p>Pour pallier cel√†, on utilise <code>git add</code> pour l&#39;ajouter direct √† l&#39;index.</p>
<p>Dans notre cas, √ßa donne <code>git add putain_de_hello_world.rb</code></p>
<p>On peut utilise <code>git add</code> pour ajouter des dossiers entiers, des motifs, ‚Ä¶ Mais
soyez vigilants, c&#39;est une bonne source d&#39;erreurs souvent chiantes.</p>
<p>Vous pouvez v√©rifier que <code>git add</code> a bien march√© avec la commande <code>git status</code>,</p>
<pre><code class="lang-bash">$ git status
<span class="hljs-preprocessor"># Sur la branche master</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Validation initiale.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Modifications qui seront valid√©es :</span>
<span class="hljs-preprocessor">#   (utilisez "git rm --cached &lt;fichier&gt;..." pour d√©sindexer)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor">#    nouveau : putain_de_hello_world.rb</span>
<span class="hljs-preprocessor">#</span>
</code></pre>
<p>Ok c&#39;est pr√™t ! On lance maintenant <code>git commit</code> pour cr√©er notre premier commit
(pas con le <em>naming</em> de la commande hein ?). Si tout se passe bien vous devriez
avoir un √©diteur qui s&#39;ouvre pour √©crire un message de commit. Prenez l&#39;habitude
de d√©crire votre changement sur la premi√®re ligne succintement et, si vous avez
besoin de d√©tails, sautez une ligne et d√©taillez les modifications.</p>
<p>Un petit <code>git status</code> nous confirme qu&#39;on s&#39;est pas foir√© (la preuve, tout est
propre) :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git status
<span class="hljs-comment"># Sur la branche master</span>
rien √† valider, la copie de travail est propre
</code></pre>
<h2 id="inspecter">Inspecter</h2>
<p>Bon, c&#39;est bien beau de commiter, mais √† un moment on arrive sur un projet en
cours et on aimerait bien savoir o√π on en est. Pour √ßa vous pouvez utiliser un
outil graphique (il y en a pour <a href="https://wiki.gnome.org/Apps/Gitg">Linux</a>, <a href="http://gitx.frim.nl/">OS X</a> et m√™me s√ªrement
Windows) ou retrousser vos poils de barbe et sortir le bon vieux <code>git log</code>.</p>
<p>C&#39;est un vrai couteau-suisse qui va vous permettre d&#39;inspecter tout l&#39;historique
de votre d√©p√¥t, avec des options en veux-tu en voil√† pour personnaliser
l&#39;affichage.</p>
<p>Un <code>git log</code> basique √ßa ressemble √† √ßa :</p>
<pre><code class="lang-bash">$ git log
<span class="hljs-operator"><span class="hljs-keyword">commit</span> <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
Author: madx &lt;madx+github@yapok.org&gt;
<span class="hljs-keyword">Date</span>:   Mon Nov <span class="hljs-number">4</span> <span class="hljs-number">23</span>:<span class="hljs-number">28</span>:<span class="hljs-number">11</span> <span class="hljs-number">2013</span> +<span class="hljs-number">0100</span>

    Premier <span class="hljs-keyword">commit</span></span>
</code></pre>
<p>Oui, c&#39;est le commit que je viens de faire dans la partie pr√©c√©dente. Comment
j&#39;en suis s√ªr ? Car je peux utiliser <code>git show</code> pour afficher les d√©tails d&#39;un
objet Git (il n&#39;y a pas que des commits, mais on verra √ßa une prochaine fois).</p>
<p><code>git show</code> prend en argument le fameux <code>SHA1</code> du commit :</p>
<pre><code class="lang-bash">$ git show <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
commit <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
<span class="hljs-label">Author:</span> madx &lt;madx+github@yapok<span class="hljs-preprocessor">.org</span>&gt;
<span class="hljs-label">Date:</span>   Mon Nov <span class="hljs-number">4</span> <span class="hljs-number">23</span>:<span class="hljs-number">28</span>:<span class="hljs-number">11</span> <span class="hljs-number">2013</span> +<span class="hljs-number">0100</span>

    Premier commit

diff --git a/putain_de_hello_world<span class="hljs-preprocessor">.rb</span> b/putain_de_hello_world<span class="hljs-preprocessor">.rb</span>
new file mode <span class="hljs-number">100644</span>
index <span class="hljs-number">0000000.</span><span class="hljs-preprocessor">.ded</span>37dc
--- /dev/null
+++ b/putain_de_hello_world<span class="hljs-preprocessor">.rb</span>
@@ -<span class="hljs-number">0</span>,<span class="hljs-number">0</span> +<span class="hljs-number">1</span> @@
+puts <span class="hljs-string">"Hello, putain de codeur !!!"</span>
</code></pre>
<p>Dit comme √ßa, √ßa a pas l&#39;air de casser trois pattes √† un canard, mais c&#39;est la
base de la base de la praticit√©. Je vous fait pas l&#39;insulte de vous expliquer le
d√©tails, vous √™tes sans doute assez malins pour comprendre ce que git raconte
sur la sortie de ces deux commandes.</p>
<p>Remarquez que <code>git show</code> affiche en bonus les diff√©rences introduites par un
fichier. Ces diff√©rences on peut aussi les voir avant de commiter avec <code>git
diff</code>, ce qui est bien pratique.</p>
<p>Entra√Ænez vous maintenant √† faire des commits, √† inspecter et √† farfouiller les
pages de <code>man</code>, c&#39;est la meilleure fa√ßon d&#39;apprendre. Apr√®s on va attaquer le
gros morceau, celui qui fait la force de Git.</p>
<figure>
  <img src="../../../images/posts/memes/mind_blown.gif" alt="Mind blown">
</figure>

<h2 id="branchement-et-fusions">Branchement et fusions</h2>
<p>Cr√©er une branche, √ßa permet de travailler sur une fonctionnalit√© ou un bug
pr√©cis, sans encombrer la ligne de conduite principale, qui peut √©voluer sous
d&#39;autres contraintes.</p>
<p>Dans Git, les branches sont une partie essentielle de quasiment tout <em>workflow</em>,
et leur manipulation est tr√®s rapide et tr√®s l√©g√®re.</p>
<p>Pour en revenir √† mon histoire de maillon, cr√©er une branche revient √† cr√©er un
point √† partir duquel deux cha√Ænes vont √™tre possibles.</p>
<p>C&#39;est aussi simple qu&#39;un <code>git branch le-nom-de-ma-branche</code>. Cette commande se
contente de cr√©er la branche, pour se positionner dessus on utilise <code>git
checkout</code> qui permet de naviguer de branche en branche tel Tarzan sur ses
lianes.</p>
<p>Comme c&#39;est super chiant √† √©crire, il existe un raccourci bien pratique : <code>git
checkout -b</code>, auquel on passe un nom de branche comme pour <code>git branch</code>.</p>
<p>Une fois qu&#39;on est bien sur la branche, tous les commits suivants seront li√©s √†
cette branche.</p>
<p>On peut utiliser <code>git branch</code> sans argument pour lister les branches, celle avec
un petit asterisque devant c&#39;est la branche courante.</p>
<p>Essayons √ßa avec notre petit d√©p√¥t :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git branch
* master
<span class="hljs-variable">$ </span>git checkout -b add-shebang
<span class="hljs-constant">Basculement</span> sur la nouvelle branche <span class="hljs-string">'add-shebang'</span>
<span class="hljs-variable">$ </span>vim putain_de_hello_world.rb
<span class="hljs-variable">$ </span>git status
<span class="hljs-comment"># Sur la branche add-shebang</span>
<span class="hljs-comment"># Modifications qui ne seront pas valid√©es :</span>
<span class="hljs-comment">#   (utilisez "git add &lt;fichier&gt;..." pour mettre √† jour ce qui sera valid√©)</span>
<span class="hljs-comment">#   (utilisez "git checkout -- &lt;fichier&gt;..." pour annuler les modifications dans la copie de travail)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    modifi√© : putain_de_hello_world.rb</span>
<span class="hljs-comment">#</span>
aucune modification n<span class="hljs-string">'a √©t√© ajout√©e au commit (utilisez "git add" ou "git commit -a")
$ git add putain_de_hello_world.rb
$ git commit
[add-shebang 5d48735] Add shebang
 1 file changed, 1 insertion(+)
$ git log --pretty=oneline --decorate
5d48735fcc805d51e2e294df5d9d22d481250789 (HEAD, add-shebang) Add shebang
8120de7b7139e46b9cbc1c3ee89a02962dbc198e (master) Premier commit</span>
</code></pre>
<p>Comme vous le voyez gr√¢ce √† l&#39;option <code>--decorate--</code> de <code>git log</code>, on a bien
notre branche qui pointe sur le dernier commit fait, alors que la branche de
base fournie par Git, <code>master</code>, reste au commit pr√©c√©dent.</p>
<p>Derni√®re √©tape avant la fin de cette article : le redout√© et redoutable
<code>merge</code> !</p>
<p>Pour fusionner nos deux branches on va utiliser cette commande en se pla√ßant sur
la branche dans laquelle on va fusionner et en passant en argument la branche √†
fusionner.</p>
<p>Si vous avez bien suivi, on va donc faire les choses suivantes :</p>
<pre><code class="lang-bash">$ git checkout master
Basculement sur la branche <span class="hljs-string">'master'</span>
$ git <span class="hljs-built_in">merge</span> <span class="hljs-built_in">add</span>-shebang
Updating <span class="hljs-number">8120</span>de7.<span class="hljs-number">.5</span>d48735
Fast-forward
 putain_de_hello_world.rb | <span class="hljs-number">1</span> +
 <span class="hljs-number">1</span> <span class="hljs-built_in">file</span> changed, <span class="hljs-number">1</span> insertion(+)
</code></pre>
<p>Vous remarquez que Git signale <em>Fast-forward</em>. Comme le commit point√© par
<code>add-shebang</code> est un fils direct de celui de <code>master</code>, Git se contente de faire
pointer <code>master</code> sur celui-ci, ce qui est beaucoup plus rapide.</p>
<p>Dans le cas o√π on a eu des modifications sur <code>master</code> entre temps, on aurait eu
une vraie fusion des contenus des commits, avec √©ventuellement une r√©solution de
conflits, mais on verra √ßa dans un prochain article !</p>
<h2 id="la-suite">La suite</h2>
<p>On a vu les bases, et tr√®s bient√¥t on va approfondir le sujet, en voyant
notamment comment collaborer, comment r√©soudre des conflits ou des probl√®mes
d&#39;utilisation de Git, tout √ßa dans la joie et la bonne humeur.</p>
<h2 id="r-f-rences">R√©f√©rences</h2>
<p>Si vous voulez en savoir plus sur Git, la <a href="http://git-scm.com/documentation">documentation officielle</a> est plut√¥t
bien foutue.</p>
<p>Si vous aimez les petites r√©f√©rences rapides et illustr√©es, le <a href="http://rogerdudler.github.io/git-guide/">Git
Guide</a> de Roger Dudler est une bonne mani√®re d&#39;apprendre.</p>
<h2 id="hey-tu-veux-appliquer-a-pour-contribuer-putain-de-code-">Hey ! Tu veux appliquer √ßa pour contribuer √† Putain de Code ?</h2>
<p>Pas de probl√®me, on a √©crit un post expr√®s :
<a href="/posts/comment-contribuer/">Comment contribuer</a> !</p>

]]></description><pubDate>Wed, 06 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/git/versionner-avec-git/</link><guid isPermaLink="true">http://putaindecode.fr/posts/git/versionner-avec-git/</guid></item></channel></rss>